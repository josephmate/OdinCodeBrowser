<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/css/styles.css"/>
    </head>
<body>
<pre class="code">
/*
 * Copyright (c) 2005, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.security.jgss.wrapper;

import java.util.HashMap;
import java.security.Provider;
import java.security.AccessController;
import java.security.PrivilegedAction;
import org.ietf.jgss.Oid;
import sun.security.action.PutAllAction;

/**
 * Defines the Sun NativeGSS provider for plugging in the
 * native GSS mechanisms to Java GSS.
 *
 * List of supported mechanisms depends on the local
 * machine configuration.
 *
 * @author Yu-Ching Valerie Peng
 */

public final class SunNativeProvider extends Provider {

    private static final long serialVersionUID = -238911724858694204L;

    private static final String NAME = &quot;SunNativeGSS&quot;;
    private static final String INFO = &quot;Sun Native GSS provider&quot;;
    private static final String MF_CLASS =
        &quot;sun.security.jgss.wrapper.NativeGSSFactory&quot;;
    private static final String LIB_PROP = &quot;sun.security.jgss.lib&quot;;
    private static final String DEBUG_PROP = &quot;sun.security.nativegss.debug&quot;;
    private static HashMap&lt;String, String&gt; MECH_MAP;
    static final Provider INSTANCE = new SunNativeProvider();
    static boolean DEBUG;
    static void debug(String message) {
        if (DEBUG) {
            if (message == null) {
                throw new NullPointerException();
            }
            System.out.println(NAME + &quot;: &quot; + message);
        }
    }

    static {
        MECH_MAP =
            AccessController.doPrivileged(
                new PrivilegedAction&lt;HashMap&lt;String, String&gt;&gt;() {
                    public HashMap&lt;String, String&gt; run() {
                        DEBUG = Boolean.parseBoolean
                            (System.getProperty(DEBUG_PROP));
                        try {
                            System.loadLibrary(&quot;j2gss&quot;);
                        } catch (Error err) {
                            debug(&quot;No j2gss library found!&quot;);
                            if (DEBUG) err.printStackTrace();
                            return null;
                        }
                        String gssLibs[] = new String[0];
                        String defaultLib = System.getProperty(LIB_PROP);
                        if (defaultLib == null || defaultLib.trim().equals(&quot;&quot;)) {
                            String osname = System.getProperty(&quot;os.name&quot;);
                            if (osname.startsWith(&quot;SunOS&quot;)) {
                                gssLibs = new String[]{ &quot;libgss.so&quot; };
                            } else if (osname.startsWith(&quot;Linux&quot;)) {
                                gssLibs = new String[]{
                                    &quot;libgssapi.so&quot;,
                                    &quot;libgssapi_krb5.so&quot;,
                                    &quot;libgssapi_krb5.so.2&quot;,
                                };
                            } else if (osname.contains(&quot;OS X&quot;)) {
                                gssLibs = new String[]{
                                    &quot;libgssapi_krb5.dylib&quot;,
                                    &quot;/usr/lib/sasl2/libgssapiv2.2.so&quot;,
                               };
                            }
                        } else {
                            gssLibs = new String[]{ defaultLib };
                        }
                        for (String libName: gssLibs) {
                            if (GSSLibStub.init(libName)) {
                                debug(&quot;Loaded GSS library: &quot; + libName);
                                Oid[] mechs = GSSLibStub.indicateMechs();
                                HashMap&lt;String, String&gt; map =
                                            new HashMap&lt;String, String&gt;();
                                for (int i = 0; i &lt; mechs.length; i++) {
                                    debug(&quot;Native MF for &quot; + mechs[i]);
                                    map.put(&quot;GssApiMechanism.&quot; + mechs[i],
                                            MF_CLASS);
                                }
                                return map;
                            }
                        }
                        return null;
                    }
                });
    }

    public SunNativeProvider() {
        /* We are the Sun NativeGSS provider */
        super(NAME, 1.8d, INFO);

        if (MECH_MAP != null) {
            AccessController.doPrivileged(new PutAllAction(this, MECH_MAP));
        }
    }
}
</pre>
</body>
</html>
