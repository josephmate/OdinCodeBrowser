<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/OdinCodeBrowser/css/styles.css"/>
    </head>
<body>
<table>
<tr>
<td><a class="linenum-cell" data-linenum="1" href="#"></a></td>
<td><pre>/*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2" href="#"></a></td>
<td><pre> * Copyright (c) 1996, 2013, Oracle and/or its affiliates. All rights reserved.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3" href="#"></a></td>
<td><pre> * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5" href="#"></a></td>
<td><pre> * This code is free software; you can redistribute it and/or modify it</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="6" href="#"></a></td>
<td><pre> * under the terms of the GNU General Public License version 2 only, as</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="7" href="#"></a></td>
<td><pre> * published by the Free Software Foundation.  Oracle designates this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="8" href="#"></a></td>
<td><pre> * particular file as subject to the &quot;Classpath&quot; exception as provided</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="9" href="#"></a></td>
<td><pre> * by Oracle in the LICENSE file that accompanied this code.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="10" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="11" href="#"></a></td>
<td><pre> * This code is distributed in the hope that it will be useful, but WITHOUT</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="12" href="#"></a></td>
<td><pre> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="13" href="#"></a></td>
<td><pre> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="14" href="#"></a></td>
<td><pre> * version 2 for more details (a copy is included in the LICENSE file that</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="15" href="#"></a></td>
<td><pre> * accompanied this code).</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="16" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="17" href="#"></a></td>
<td><pre> * You should have received a copy of the GNU General Public License version</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="18" href="#"></a></td>
<td><pre> * 2 along with this work; if not, write to the Free Software Foundation,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="19" href="#"></a></td>
<td><pre> * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="20" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="21" href="#"></a></td>
<td><pre> * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="22" href="#"></a></td>
<td><pre> * or visit www.oracle.com if you need additional information or have any</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="23" href="#"></a></td>
<td><pre> * questions.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="24" href="#"></a></td>
<td><pre> */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="25" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="26" href="#"></a></td>
<td><pre>/*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="27" href="#"></a></td>
<td><pre> * Portions Copyright IBM Corporation, 2001. All Rights Reserved.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="28" href="#"></a></td>
<td><pre> */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="29" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="30" href="#"></a></td>
<td><pre>package java.math;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="31" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="32" href="#"></a></td>
<td><pre>import java.util.Arrays;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="33" href="#"></a></td>
<td><pre>import static java.math.BigInteger.LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="34" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="35" href="#"></a></td>
<td><pre>/**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="36" href="#"></a></td>
<td><pre> * Immutable, arbitrary-precision signed decimal numbers.  A</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="37" href="#"></a></td>
<td><pre> * {@code BigDecimal} consists of an arbitrary precision integer</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="38" href="#"></a></td>
<td><pre> * &lt;i&gt;unscaled value&lt;/i&gt; and a 32-bit integer &lt;i&gt;scale&lt;/i&gt;.  If zero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="39" href="#"></a></td>
<td><pre> * or positive, the scale is the number of digits to the right of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="40" href="#"></a></td>
<td><pre> * decimal point.  If negative, the unscaled value of the number is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="41" href="#"></a></td>
<td><pre> * multiplied by ten to the power of the negation of the scale.  The</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="42" href="#"></a></td>
<td><pre> * value of the number represented by the {@code BigDecimal} is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="43" href="#"></a></td>
<td><pre> * therefore &lt;tt&gt;(unscaledValue &amp;times; 10&lt;sup&gt;-scale&lt;/sup&gt;)&lt;/tt&gt;.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="44" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="45" href="#"></a></td>
<td><pre> * &lt;p&gt;The {@code BigDecimal} class provides operations for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="46" href="#"></a></td>
<td><pre> * arithmetic, scale manipulation, rounding, comparison, hashing, and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="47" href="#"></a></td>
<td><pre> * format conversion.  The {@link #toString} method provides a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="48" href="#"></a></td>
<td><pre> * canonical representation of a {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="49" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="50" href="#"></a></td>
<td><pre> * &lt;p&gt;The {@code BigDecimal} class gives its user complete control</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="51" href="#"></a></td>
<td><pre> * over rounding behavior.  If no rounding mode is specified and the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="52" href="#"></a></td>
<td><pre> * exact result cannot be represented, an exception is thrown;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="53" href="#"></a></td>
<td><pre> * otherwise, calculations can be carried out to a chosen precision</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="54" href="#"></a></td>
<td><pre> * and rounding mode by supplying an appropriate {@link MathContext}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="55" href="#"></a></td>
<td><pre> * object to the operation.  In either case, eight &lt;em&gt;rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="56" href="#"></a></td>
<td><pre> * modes&lt;/em&gt; are provided for the control of rounding.  Using the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="57" href="#"></a></td>
<td><pre> * integer fields in this class (such as {@link #ROUND_HALF_UP}) to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="58" href="#"></a></td>
<td><pre> * represent rounding mode is largely obsolete; the enumeration values</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="59" href="#"></a></td>
<td><pre> * of the {@code RoundingMode} {@code enum}, (such as {@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="60" href="#"></a></td>
<td><pre> * RoundingMode#HALF_UP}) should be used instead.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="61" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="62" href="#"></a></td>
<td><pre> * &lt;p&gt;When a {@code MathContext} object is supplied with a precision</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="63" href="#"></a></td>
<td><pre> * setting of 0 (for example, {@link MathContext#UNLIMITED}),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="64" href="#"></a></td>
<td><pre> * arithmetic operations are exact, as are the arithmetic methods</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="65" href="#"></a></td>
<td><pre> * which take no {@code MathContext} object.  (This is the only</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="66" href="#"></a></td>
<td><pre> * behavior that was supported in releases prior to 5.)  As a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="67" href="#"></a></td>
<td><pre> * corollary of computing the exact result, the rounding mode setting</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="68" href="#"></a></td>
<td><pre> * of a {@code MathContext} object with a precision setting of 0 is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="69" href="#"></a></td>
<td><pre> * not used and thus irrelevant.  In the case of divide, the exact</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="70" href="#"></a></td>
<td><pre> * quotient could have an infinitely long decimal expansion; for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="71" href="#"></a></td>
<td><pre> * example, 1 divided by 3.  If the quotient has a nonterminating</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="72" href="#"></a></td>
<td><pre> * decimal expansion and the operation is specified to return an exact</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="73" href="#"></a></td>
<td><pre> * result, an {@code ArithmeticException} is thrown.  Otherwise, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="74" href="#"></a></td>
<td><pre> * exact result of the division is returned, as done for other</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="75" href="#"></a></td>
<td><pre> * operations.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="76" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="77" href="#"></a></td>
<td><pre> * &lt;p&gt;When the precision setting is not 0, the rules of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="78" href="#"></a></td>
<td><pre> * {@code BigDecimal} arithmetic are broadly compatible with selected</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="79" href="#"></a></td>
<td><pre> * modes of operation of the arithmetic defined in ANSI X3.274-1996</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="80" href="#"></a></td>
<td><pre> * and ANSI X3.274-1996/AM 1-2000 (section 7.4).  Unlike those</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="81" href="#"></a></td>
<td><pre> * standards, {@code BigDecimal} includes many rounding modes, which</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="82" href="#"></a></td>
<td><pre> * were mandatory for division in {@code BigDecimal} releases prior</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="83" href="#"></a></td>
<td><pre> * to 5.  Any conflicts between these ANSI standards and the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="84" href="#"></a></td>
<td><pre> * {@code BigDecimal} specification are resolved in favor of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="85" href="#"></a></td>
<td><pre> * {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="86" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="87" href="#"></a></td>
<td><pre> * &lt;p&gt;Since the same numerical value can have different</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="88" href="#"></a></td>
<td><pre> * representations (with different scales), the rules of arithmetic</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="89" href="#"></a></td>
<td><pre> * and rounding must specify both the numerical result and the scale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="90" href="#"></a></td>
<td><pre> * used in the result's representation.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="91" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="92" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="93" href="#"></a></td>
<td><pre> * &lt;p&gt;In general the rounding modes and precision setting determine</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="94" href="#"></a></td>
<td><pre> * how operations return results with a limited number of digits when</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="95" href="#"></a></td>
<td><pre> * the exact result has more digits (perhaps infinitely many in the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="96" href="#"></a></td>
<td><pre> * case of division) than the number of digits returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="97" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="98" href="#"></a></td>
<td><pre> * First, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="99" href="#"></a></td>
<td><pre> * total number of digits to return is specified by the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="100" href="#"></a></td>
<td><pre> * {@code MathContext}'s {@code precision} setting; this determines</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="101" href="#"></a></td>
<td><pre> * the result's &lt;i&gt;precision&lt;/i&gt;.  The digit count starts from the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="102" href="#"></a></td>
<td><pre> * leftmost nonzero digit of the exact result.  The rounding mode</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="103" href="#"></a></td>
<td><pre> * determines how any discarded trailing digits affect the returned</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="104" href="#"></a></td>
<td><pre> * result.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="105" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="106" href="#"></a></td>
<td><pre> * &lt;p&gt;For all arithmetic operators , the operation is carried out as</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="107" href="#"></a></td>
<td><pre> * though an exact intermediate result were first calculated and then</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="108" href="#"></a></td>
<td><pre> * rounded to the number of digits specified by the precision setting</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="109" href="#"></a></td>
<td><pre> * (if necessary), using the selected rounding mode.  If the exact</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="110" href="#"></a></td>
<td><pre> * result is not returned, some digit positions of the exact result</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="111" href="#"></a></td>
<td><pre> * are discarded.  When rounding increases the magnitude of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="112" href="#"></a></td>
<td><pre> * returned result, it is possible for a new digit position to be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="113" href="#"></a></td>
<td><pre> * created by a carry propagating to a leading {@literal &quot;9&quot;} digit.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="114" href="#"></a></td>
<td><pre> * For example, rounding the value 999.9 to three digits rounding up</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="115" href="#"></a></td>
<td><pre> * would be numerically equal to one thousand, represented as</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="116" href="#"></a></td>
<td><pre> * 100&amp;times;10&lt;sup&gt;1&lt;/sup&gt;.  In such cases, the new {@literal &quot;1&quot;} is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="117" href="#"></a></td>
<td><pre> * the leading digit position of the returned result.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="118" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="119" href="#"></a></td>
<td><pre> * &lt;p&gt;Besides a logical exact result, each arithmetic operation has a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="120" href="#"></a></td>
<td><pre> * preferred scale for representing a result.  The preferred</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="121" href="#"></a></td>
<td><pre> * scale for each operation is listed in the table below.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="122" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="123" href="#"></a></td>
<td><pre> * &lt;table border&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="124" href="#"></a></td>
<td><pre> * &lt;caption&gt;&lt;b&gt;Preferred Scales for Results of Arithmetic Operations</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="125" href="#"></a></td>
<td><pre> * &lt;/b&gt;&lt;/caption&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="126" href="#"></a></td>
<td><pre> * &lt;tr&gt;&lt;th&gt;Operation&lt;/th&gt;&lt;th&gt;Preferred Scale of Result&lt;/th&gt;&lt;/tr&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="127" href="#"></a></td>
<td><pre> * &lt;tr&gt;&lt;td&gt;Add&lt;/td&gt;&lt;td&gt;max(addend.scale(), augend.scale())&lt;/td&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="128" href="#"></a></td>
<td><pre> * &lt;tr&gt;&lt;td&gt;Subtract&lt;/td&gt;&lt;td&gt;max(minuend.scale(), subtrahend.scale())&lt;/td&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="129" href="#"></a></td>
<td><pre> * &lt;tr&gt;&lt;td&gt;Multiply&lt;/td&gt;&lt;td&gt;multiplier.scale() + multiplicand.scale()&lt;/td&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="130" href="#"></a></td>
<td><pre> * &lt;tr&gt;&lt;td&gt;Divide&lt;/td&gt;&lt;td&gt;dividend.scale() - divisor.scale()&lt;/td&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="131" href="#"></a></td>
<td><pre> * &lt;/table&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="132" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="133" href="#"></a></td>
<td><pre> * These scales are the ones used by the methods which return exact</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="134" href="#"></a></td>
<td><pre> * arithmetic results; except that an exact divide may have to use a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="135" href="#"></a></td>
<td><pre> * larger scale since the exact result may have more digits.  For</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="136" href="#"></a></td>
<td><pre> * example, {@code 1/32} is {@code 0.03125}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="137" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="138" href="#"></a></td>
<td><pre> * &lt;p&gt;Before rounding, the scale of the logical exact intermediate</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="139" href="#"></a></td>
<td><pre> * result is the preferred scale for that operation.  If the exact</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="140" href="#"></a></td>
<td><pre> * numerical result cannot be represented in {@code precision}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="141" href="#"></a></td>
<td><pre> * digits, rounding selects the set of digits to return and the scale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="142" href="#"></a></td>
<td><pre> * of the result is reduced from the scale of the intermediate result</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="143" href="#"></a></td>
<td><pre> * to the least scale which can represent the {@code precision}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="144" href="#"></a></td>
<td><pre> * digits actually returned.  If the exact result can be represented</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="145" href="#"></a></td>
<td><pre> * with at most {@code precision} digits, the representation</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="146" href="#"></a></td>
<td><pre> * of the result with the scale closest to the preferred scale is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="147" href="#"></a></td>
<td><pre> * returned.  In particular, an exactly representable quotient may be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="148" href="#"></a></td>
<td><pre> * represented in fewer than {@code precision} digits by removing</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="149" href="#"></a></td>
<td><pre> * trailing zeros and decreasing the scale.  For example, rounding to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="150" href="#"></a></td>
<td><pre> * three digits using the {@linkplain RoundingMode#FLOOR floor}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="151" href="#"></a></td>
<td><pre> * rounding mode, &lt;br&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="152" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="153" href="#"></a></td>
<td><pre> * {@code 19/100 = 0.19   // integer=19,  scale=2} &lt;br&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="154" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="155" href="#"></a></td>
<td><pre> * but&lt;br&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="156" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="157" href="#"></a></td>
<td><pre> * {@code 21/110 = 0.190  // integer=190, scale=3} &lt;br&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="158" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="159" href="#"></a></td>
<td><pre> * &lt;p&gt;Note that for add, subtract, and multiply, the reduction in</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="160" href="#"></a></td>
<td><pre> * scale will equal the number of digit positions of the exact result</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="161" href="#"></a></td>
<td><pre> * which are discarded. If the rounding causes a carry propagation to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="162" href="#"></a></td>
<td><pre> * create a new high-order digit position, an additional digit of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="163" href="#"></a></td>
<td><pre> * result is discarded than when no new digit position is created.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="164" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="165" href="#"></a></td>
<td><pre> * &lt;p&gt;Other methods may have slightly different rounding semantics.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="166" href="#"></a></td>
<td><pre> * For example, the result of the {@code pow} method using the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="167" href="#"></a></td>
<td><pre> * {@linkplain #pow(int, MathContext) specified algorithm} can</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="168" href="#"></a></td>
<td><pre> * occasionally differ from the rounded mathematical result by more</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="169" href="#"></a></td>
<td><pre> * than one unit in the last place, one &lt;i&gt;{@linkplain #ulp() ulp}&lt;/i&gt;.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="170" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="171" href="#"></a></td>
<td><pre> * &lt;p&gt;Two types of operations are provided for manipulating the scale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="172" href="#"></a></td>
<td><pre> * of a {@code BigDecimal}: scaling/rounding operations and decimal</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="173" href="#"></a></td>
<td><pre> * point motion operations.  Scaling/rounding operations ({@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="174" href="#"></a></td>
<td><pre> * #setScale setScale} and {@link #round round}) return a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="175" href="#"></a></td>
<td><pre> * {@code BigDecimal} whose value is approximately (or exactly) equal</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="176" href="#"></a></td>
<td><pre> * to that of the operand, but whose scale or precision is the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="177" href="#"></a></td>
<td><pre> * specified value; that is, they increase or decrease the precision</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="178" href="#"></a></td>
<td><pre> * of the stored number with minimal effect on its value.  Decimal</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="179" href="#"></a></td>
<td><pre> * point motion operations ({@link #movePointLeft movePointLeft} and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="180" href="#"></a></td>
<td><pre> * {@link #movePointRight movePointRight}) return a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="181" href="#"></a></td>
<td><pre> * {@code BigDecimal} created from the operand by moving the decimal</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="182" href="#"></a></td>
<td><pre> * point a specified distance in the specified direction.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="183" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="184" href="#"></a></td>
<td><pre> * &lt;p&gt;For the sake of brevity and clarity, pseudo-code is used</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="185" href="#"></a></td>
<td><pre> * throughout the descriptions of {@code BigDecimal} methods.  The</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="186" href="#"></a></td>
<td><pre> * pseudo-code expression {@code (i + j)} is shorthand for &quot;a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="187" href="#"></a></td>
<td><pre> * {@code BigDecimal} whose value is that of the {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="188" href="#"></a></td>
<td><pre> * {@code i} added to that of the {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="189" href="#"></a></td>
<td><pre> * {@code j}.&quot; The pseudo-code expression {@code (i == j)} is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="190" href="#"></a></td>
<td><pre> * shorthand for &quot;{@code true} if and only if the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="191" href="#"></a></td>
<td><pre> * {@code BigDecimal} {@code i} represents the same value as the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="192" href="#"></a></td>
<td><pre> * {@code BigDecimal} {@code j}.&quot; Other pseudo-code expressions</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="193" href="#"></a></td>
<td><pre> * are interpreted similarly.  Square brackets are used to represent</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="194" href="#"></a></td>
<td><pre> * the particular {@code BigInteger} and scale pair defining a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="195" href="#"></a></td>
<td><pre> * {@code BigDecimal} value; for example [19, 2] is the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="196" href="#"></a></td>
<td><pre> * {@code BigDecimal} numerically equal to 0.19 having a scale of 2.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="197" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="198" href="#"></a></td>
<td><pre> * &lt;p&gt;Note: care should be exercised if {@code BigDecimal} objects</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="199" href="#"></a></td>
<td><pre> * are used as keys in a {@link java.util.SortedMap SortedMap} or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="200" href="#"></a></td>
<td><pre> * elements in a {@link java.util.SortedSet SortedSet} since</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="201" href="#"></a></td>
<td><pre> * {@code BigDecimal}'s &lt;i&gt;natural ordering&lt;/i&gt; is &lt;i&gt;inconsistent</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="202" href="#"></a></td>
<td><pre> * with equals&lt;/i&gt;.  See {@link Comparable}, {@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="203" href="#"></a></td>
<td><pre> * java.util.SortedMap} or {@link java.util.SortedSet} for more</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="204" href="#"></a></td>
<td><pre> * information.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="205" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="206" href="#"></a></td>
<td><pre> * &lt;p&gt;All methods and constructors for this class throw</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="207" href="#"></a></td>
<td><pre> * {@code NullPointerException} when passed a {@code null} object</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="208" href="#"></a></td>
<td><pre> * reference for any input parameter.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="209" href="#"></a></td>
<td><pre> *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="210" href="#"></a></td>
<td><pre> * @see     BigInteger</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="211" href="#"></a></td>
<td><pre> * @see     MathContext</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="212" href="#"></a></td>
<td><pre> * @see     RoundingMode</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="213" href="#"></a></td>
<td><pre> * @see     java.util.SortedMap</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="214" href="#"></a></td>
<td><pre> * @see     java.util.SortedSet</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="215" href="#"></a></td>
<td><pre> * @author  Josh Bloch</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="216" href="#"></a></td>
<td><pre> * @author  Mike Cowlishaw</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="217" href="#"></a></td>
<td><pre> * @author  Joseph D. Darcy</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="218" href="#"></a></td>
<td><pre> * @author  Sergey V. Kuksenko</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="219" href="#"></a></td>
<td><pre> */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="220" href="#"></a></td>
<td><pre>public class BigDecimal extends Number implements Comparable&lt;BigDecimal&gt; {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="221" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="222" href="#"></a></td>
<td><pre>     * The unscaled value of this BigDecimal, as returned by {@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="223" href="#"></a></td>
<td><pre>     * #unscaledValue}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="224" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="225" href="#"></a></td>
<td><pre>     * @serial</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="226" href="#"></a></td>
<td><pre>     * @see #unscaledValue</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="227" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="228" href="#"></a></td>
<td><pre>    private final BigInteger intVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="229" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="230" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="231" href="#"></a></td>
<td><pre>     * The scale of this BigDecimal, as returned by {@link #scale}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="232" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="233" href="#"></a></td>
<td><pre>     * @serial</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="234" href="#"></a></td>
<td><pre>     * @see #scale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="235" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="236" href="#"></a></td>
<td><pre>    private final int scale;  // Note: this may have any value, so</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="237" href="#"></a></td>
<td><pre>                              // calculations must be done in longs</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="238" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="239" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="240" href="#"></a></td>
<td><pre>     * The number of decimal digits in this BigDecimal, or 0 if the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="241" href="#"></a></td>
<td><pre>     * number of digits are not known (lookaside information).  If</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="242" href="#"></a></td>
<td><pre>     * nonzero, the value is guaranteed correct.  Use the precision()</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="243" href="#"></a></td>
<td><pre>     * method to obtain and set the value if it might be 0.  This</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="244" href="#"></a></td>
<td><pre>     * field is mutable until set nonzero.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="245" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="246" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="247" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="248" href="#"></a></td>
<td><pre>    private transient int precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="249" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="250" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="251" href="#"></a></td>
<td><pre>     * Used to store the canonical string representation, if computed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="252" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="253" href="#"></a></td>
<td><pre>    private transient String stringCache;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="254" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="255" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="256" href="#"></a></td>
<td><pre>     * Sentinel value for {@link #intCompact} indicating the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="257" href="#"></a></td>
<td><pre>     * significand information is only available from {@code intVal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="258" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="259" href="#"></a></td>
<td><pre>    static final long INFLATED = Long.MIN_VALUE;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="260" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="261" href="#"></a></td>
<td><pre>    private static final BigInteger INFLATED_BIGINT = BigInteger.valueOf(INFLATED);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="262" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="263" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="264" href="#"></a></td>
<td><pre>     * If the absolute value of the significand of this BigDecimal is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="265" href="#"></a></td>
<td><pre>     * less than or equal to {@code Long.MAX_VALUE}, the value can be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="266" href="#"></a></td>
<td><pre>     * compactly stored in this field and used in computations.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="267" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="268" href="#"></a></td>
<td><pre>    private final transient long intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="269" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="270" href="#"></a></td>
<td><pre>    // All 18-digit base ten strings fit into a long; not all 19-digit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="271" href="#"></a></td>
<td><pre>    // strings will</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="272" href="#"></a></td>
<td><pre>    private static final int MAX_COMPACT_DIGITS = 18;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="273" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="274" href="#"></a></td>
<td><pre>    /* Appease the serialization gods */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="275" href="#"></a></td>
<td><pre>    private static final long serialVersionUID = 6108874887143696463L;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="276" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="277" href="#"></a></td>
<td><pre>    private static final ThreadLocal&lt;StringBuilderHelper&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="278" href="#"></a></td>
<td><pre>        threadLocalStringBuilderHelper = new ThreadLocal&lt;StringBuilderHelper&gt;() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="279" href="#"></a></td>
<td><pre>        @Override</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="280" href="#"></a></td>
<td><pre>        protected StringBuilderHelper initialValue() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="281" href="#"></a></td>
<td><pre>            return new StringBuilderHelper();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="282" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="283" href="#"></a></td>
<td><pre>    };</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="284" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="285" href="#"></a></td>
<td><pre>    // Cache of common small BigDecimal values.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="286" href="#"></a></td>
<td><pre>    private static final BigDecimal zeroThroughTen[] = {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="287" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO,       0,  0, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="288" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ONE,        1,  0, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="289" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.valueOf(2), 2,  0, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="290" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.valueOf(3), 3,  0, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="291" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.valueOf(4), 4,  0, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="292" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.valueOf(5), 5,  0, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="293" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.valueOf(6), 6,  0, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="294" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.valueOf(7), 7,  0, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="295" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.valueOf(8), 8,  0, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="296" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.valueOf(9), 9,  0, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="297" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.TEN,        10, 0, 2),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="298" href="#"></a></td>
<td><pre>    };</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="299" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="300" href="#"></a></td>
<td><pre>    // Cache of zero scaled by 0 - 15</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="301" href="#"></a></td>
<td><pre>    private static final BigDecimal[] ZERO_SCALED_BY = {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="302" href="#"></a></td>
<td><pre>        zeroThroughTen[0],</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="303" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 1, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="304" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 2, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="305" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 3, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="306" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 4, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="307" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 5, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="308" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 6, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="309" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 7, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="310" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 8, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="311" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 9, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="312" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 10, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="313" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 11, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="314" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 12, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="315" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 13, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="316" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 14, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="317" href="#"></a></td>
<td><pre>        new BigDecimal(BigInteger.ZERO, 0, 15, 1),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="318" href="#"></a></td>
<td><pre>    };</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="319" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="320" href="#"></a></td>
<td><pre>    // Half of Long.MIN_VALUE &amp; Long.MAX_VALUE.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="321" href="#"></a></td>
<td><pre>    private static final long HALF_LONG_MAX_VALUE = Long.MAX_VALUE / 2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="322" href="#"></a></td>
<td><pre>    private static final long HALF_LONG_MIN_VALUE = Long.MIN_VALUE / 2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="323" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="324" href="#"></a></td>
<td><pre>    // Constants</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="325" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="326" href="#"></a></td>
<td><pre>     * The value 0, with a scale of 0.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="327" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="328" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="329" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="330" href="#"></a></td>
<td><pre>    public static final BigDecimal ZERO =</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="331" href="#"></a></td>
<td><pre>        zeroThroughTen[0];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="332" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="333" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="334" href="#"></a></td>
<td><pre>     * The value 1, with a scale of 0.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="335" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="336" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="337" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="338" href="#"></a></td>
<td><pre>    public static final BigDecimal ONE =</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="339" href="#"></a></td>
<td><pre>        zeroThroughTen[1];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="340" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="341" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="342" href="#"></a></td>
<td><pre>     * The value 10, with a scale of 0.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="343" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="344" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="345" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="346" href="#"></a></td>
<td><pre>    public static final BigDecimal TEN =</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="347" href="#"></a></td>
<td><pre>        zeroThroughTen[10];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="348" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="349" href="#"></a></td>
<td><pre>    // Constructors</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="350" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="351" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="352" href="#"></a></td>
<td><pre>     * Trusted package private constructor.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="353" href="#"></a></td>
<td><pre>     * Trusted simply means if val is INFLATED, intVal could not be null and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="354" href="#"></a></td>
<td><pre>     * if intVal is null, val could not be INFLATED.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="355" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="356" href="#"></a></td>
<td><pre>    BigDecimal(BigInteger intVal, long val, int scale, int prec) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="357" href="#"></a></td>
<td><pre>        this.scale = scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="358" href="#"></a></td>
<td><pre>        this.precision = prec;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="359" href="#"></a></td>
<td><pre>        this.intCompact = val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="360" href="#"></a></td>
<td><pre>        this.intVal = intVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="361" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="362" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="363" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="364" href="#"></a></td>
<td><pre>     * Translates a character array representation of a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="365" href="#"></a></td>
<td><pre>     * {@code BigDecimal} into a {@code BigDecimal}, accepting the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="366" href="#"></a></td>
<td><pre>     * same sequence of characters as the {@link #BigDecimal(String)}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="367" href="#"></a></td>
<td><pre>     * constructor, while allowing a sub-array to be specified.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="368" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="369" href="#"></a></td>
<td><pre>     * &lt;p&gt;Note that if the sequence of characters is already available</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="370" href="#"></a></td>
<td><pre>     * within a character array, using this constructor is faster than</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="371" href="#"></a></td>
<td><pre>     * converting the {@code char} array to string and using the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="372" href="#"></a></td>
<td><pre>     * {@code BigDecimal(String)} constructor .</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="373" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="374" href="#"></a></td>
<td><pre>     * @param  in {@code char} array that is the source of characters.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="375" href="#"></a></td>
<td><pre>     * @param  offset first character in the array to inspect.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="376" href="#"></a></td>
<td><pre>     * @param  len number of characters to consider.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="377" href="#"></a></td>
<td><pre>     * @throws NumberFormatException if {@code in} is not a valid</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="378" href="#"></a></td>
<td><pre>     *         representation of a {@code BigDecimal} or the defined subarray</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="379" href="#"></a></td>
<td><pre>     *         is not wholly within {@code in}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="380" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="381" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="382" href="#"></a></td>
<td><pre>    public BigDecimal(char[] in, int offset, int len) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="383" href="#"></a></td>
<td><pre>        this(in,offset,len,MathContext.UNLIMITED);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="384" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="385" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="386" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="387" href="#"></a></td>
<td><pre>     * Translates a character array representation of a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="388" href="#"></a></td>
<td><pre>     * {@code BigDecimal} into a {@code BigDecimal}, accepting the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="389" href="#"></a></td>
<td><pre>     * same sequence of characters as the {@link #BigDecimal(String)}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="390" href="#"></a></td>
<td><pre>     * constructor, while allowing a sub-array to be specified and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="391" href="#"></a></td>
<td><pre>     * with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="392" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="393" href="#"></a></td>
<td><pre>     * &lt;p&gt;Note that if the sequence of characters is already available</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="394" href="#"></a></td>
<td><pre>     * within a character array, using this constructor is faster than</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="395" href="#"></a></td>
<td><pre>     * converting the {@code char} array to string and using the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="396" href="#"></a></td>
<td><pre>     * {@code BigDecimal(String)} constructor .</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="397" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="398" href="#"></a></td>
<td><pre>     * @param  in {@code char} array that is the source of characters.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="399" href="#"></a></td>
<td><pre>     * @param  offset first character in the array to inspect.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="400" href="#"></a></td>
<td><pre>     * @param  len number of characters to consider..</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="401" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="402" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="403" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="404" href="#"></a></td>
<td><pre>     * @throws NumberFormatException if {@code in} is not a valid</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="405" href="#"></a></td>
<td><pre>     *         representation of a {@code BigDecimal} or the defined subarray</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="406" href="#"></a></td>
<td><pre>     *         is not wholly within {@code in}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="407" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="408" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="409" href="#"></a></td>
<td><pre>    public BigDecimal(char[] in, int offset, int len, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="410" href="#"></a></td>
<td><pre>        // protect against huge length.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="411" href="#"></a></td>
<td><pre>        if (offset + len &gt; in.length || offset &lt; 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="412" href="#"></a></td>
<td><pre>            throw new NumberFormatException(&quot;Bad offset or len arguments for char[] input.&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="413" href="#"></a></td>
<td><pre>        // This is the primary string to BigDecimal constructor; all</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="414" href="#"></a></td>
<td><pre>        // incoming strings end up here; it uses explicit (inline)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="415" href="#"></a></td>
<td><pre>        // parsing for speed and generates at most one intermediate</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="416" href="#"></a></td>
<td><pre>        // (temporary) object (a char[] array) for non-compact case.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="417" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="418" href="#"></a></td>
<td><pre>        // Use locals for all fields values until completion</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="419" href="#"></a></td>
<td><pre>        int prec = 0;                 // record precision value</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="420" href="#"></a></td>
<td><pre>        int scl = 0;                  // record scale value</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="421" href="#"></a></td>
<td><pre>        long rs = 0;                  // the compact value in long</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="422" href="#"></a></td>
<td><pre>        BigInteger rb = null;         // the inflated value in BigInteger</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="423" href="#"></a></td>
<td><pre>        // use array bounds checking to handle too-long, len == 0,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="424" href="#"></a></td>
<td><pre>        // bad offset, etc.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="425" href="#"></a></td>
<td><pre>        try {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="426" href="#"></a></td>
<td><pre>            // handle the sign</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="427" href="#"></a></td>
<td><pre>            boolean isneg = false;          // assume positive</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="428" href="#"></a></td>
<td><pre>            if (in[offset] == '-') {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="429" href="#"></a></td>
<td><pre>                isneg = true;               // leading minus means negative</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="430" href="#"></a></td>
<td><pre>                offset++;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="431" href="#"></a></td>
<td><pre>                len--;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="432" href="#"></a></td>
<td><pre>            } else if (in[offset] == '+') { // leading + allowed</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="433" href="#"></a></td>
<td><pre>                offset++;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="434" href="#"></a></td>
<td><pre>                len--;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="435" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="436" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="437" href="#"></a></td>
<td><pre>            // should now be at numeric part of the significand</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="438" href="#"></a></td>
<td><pre>            boolean dot = false;             // true when there is a '.'</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="439" href="#"></a></td>
<td><pre>            long exp = 0;                    // exponent</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="440" href="#"></a></td>
<td><pre>            char c;                          // current character</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="441" href="#"></a></td>
<td><pre>            boolean isCompact = (len &lt;= MAX_COMPACT_DIGITS);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="442" href="#"></a></td>
<td><pre>            // integer significand array &amp; idx is the index to it. The array</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="443" href="#"></a></td>
<td><pre>            // is ONLY used when we can't use a compact representation.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="444" href="#"></a></td>
<td><pre>            int idx = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="445" href="#"></a></td>
<td><pre>            if (isCompact) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="446" href="#"></a></td>
<td><pre>                // First compact case, we need not to preserve the character</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="447" href="#"></a></td>
<td><pre>                // and we can just compute the value in place.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="448" href="#"></a></td>
<td><pre>                for (; len &gt; 0; offset++, len--) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="449" href="#"></a></td>
<td><pre>                    c = in[offset];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="450" href="#"></a></td>
<td><pre>                    if ((c == '0')) { // have zero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="451" href="#"></a></td>
<td><pre>                        if (prec == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="452" href="#"></a></td>
<td><pre>                            prec = 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="453" href="#"></a></td>
<td><pre>                        else if (rs != 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="454" href="#"></a></td>
<td><pre>                            rs *= 10;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="455" href="#"></a></td>
<td><pre>                            ++prec;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="456" href="#"></a></td>
<td><pre>                        } // else digit is a redundant leading zero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="457" href="#"></a></td>
<td><pre>                        if (dot)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="458" href="#"></a></td>
<td><pre>                            ++scl;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="459" href="#"></a></td>
<td><pre>                    } else if ((c &gt;= '1' &amp;&amp; c &lt;= '9')) { // have digit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="460" href="#"></a></td>
<td><pre>                        int digit = c - '0';</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="461" href="#"></a></td>
<td><pre>                        if (prec != 1 || rs != 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="462" href="#"></a></td>
<td><pre>                            ++prec; // prec unchanged if preceded by 0s</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="463" href="#"></a></td>
<td><pre>                        rs = rs * 10 + digit;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="464" href="#"></a></td>
<td><pre>                        if (dot)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="465" href="#"></a></td>
<td><pre>                            ++scl;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="466" href="#"></a></td>
<td><pre>                    } else if (c == '.') {   // have dot</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="467" href="#"></a></td>
<td><pre>                        // have dot</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="468" href="#"></a></td>
<td><pre>                        if (dot) // two dots</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="469" href="#"></a></td>
<td><pre>                            throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="470" href="#"></a></td>
<td><pre>                        dot = true;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="471" href="#"></a></td>
<td><pre>                    } else if (Character.isDigit(c)) { // slow path</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="472" href="#"></a></td>
<td><pre>                        int digit = Character.digit(c, 10);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="473" href="#"></a></td>
<td><pre>                        if (digit == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="474" href="#"></a></td>
<td><pre>                            if (prec == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="475" href="#"></a></td>
<td><pre>                                prec = 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="476" href="#"></a></td>
<td><pre>                            else if (rs != 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="477" href="#"></a></td>
<td><pre>                                rs *= 10;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="478" href="#"></a></td>
<td><pre>                                ++prec;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="479" href="#"></a></td>
<td><pre>                            } // else digit is a redundant leading zero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="480" href="#"></a></td>
<td><pre>                        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="481" href="#"></a></td>
<td><pre>                            if (prec != 1 || rs != 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="482" href="#"></a></td>
<td><pre>                                ++prec; // prec unchanged if preceded by 0s</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="483" href="#"></a></td>
<td><pre>                            rs = rs * 10 + digit;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="484" href="#"></a></td>
<td><pre>                        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="485" href="#"></a></td>
<td><pre>                        if (dot)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="486" href="#"></a></td>
<td><pre>                            ++scl;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="487" href="#"></a></td>
<td><pre>                    } else if ((c == 'e') || (c == 'E')) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="488" href="#"></a></td>
<td><pre>                        exp = parseExp(in, offset, len);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="489" href="#"></a></td>
<td><pre>                        // Next test is required for backwards compatibility</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="490" href="#"></a></td>
<td><pre>                        if ((int) exp != exp) // overflow</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="491" href="#"></a></td>
<td><pre>                            throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="492" href="#"></a></td>
<td><pre>                        break; // [saves a test]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="493" href="#"></a></td>
<td><pre>                    } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="494" href="#"></a></td>
<td><pre>                        throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="495" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="496" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="497" href="#"></a></td>
<td><pre>                if (prec == 0) // no digits found</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="498" href="#"></a></td>
<td><pre>                    throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="499" href="#"></a></td>
<td><pre>                // Adjust scale if exp is not zero.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="500" href="#"></a></td>
<td><pre>                if (exp != 0) { // had significant exponent</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="501" href="#"></a></td>
<td><pre>                    scl = adjustScale(scl, exp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="502" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="503" href="#"></a></td>
<td><pre>                rs = isneg ? -rs : rs;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="504" href="#"></a></td>
<td><pre>                int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="505" href="#"></a></td>
<td><pre>                int drop = prec - mcp; // prec has range [1, MAX_INT], mcp has range [0, MAX_INT];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="506" href="#"></a></td>
<td><pre>                                       // therefore, this subtract cannot overflow</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="507" href="#"></a></td>
<td><pre>                if (mcp &gt; 0 &amp;&amp; drop &gt; 0) {  // do rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="508" href="#"></a></td>
<td><pre>                    while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="509" href="#"></a></td>
<td><pre>                        scl = checkScaleNonZero((long) scl - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="510" href="#"></a></td>
<td><pre>                        rs = divideAndRound(rs, LONG_TEN_POWERS_TABLE[drop], mc.roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="511" href="#"></a></td>
<td><pre>                        prec = longDigitLength(rs);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="512" href="#"></a></td>
<td><pre>                        drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="513" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="514" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="515" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="516" href="#"></a></td>
<td><pre>                char coeff[] = new char[len];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="517" href="#"></a></td>
<td><pre>                for (; len &gt; 0; offset++, len--) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="518" href="#"></a></td>
<td><pre>                    c = in[offset];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="519" href="#"></a></td>
<td><pre>                    // have digit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="520" href="#"></a></td>
<td><pre>                    if ((c &gt;= '0' &amp;&amp; c &lt;= '9') || Character.isDigit(c)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="521" href="#"></a></td>
<td><pre>                        // First compact case, we need not to preserve the character</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="522" href="#"></a></td>
<td><pre>                        // and we can just compute the value in place.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="523" href="#"></a></td>
<td><pre>                        if (c == '0' || Character.digit(c, 10) == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="524" href="#"></a></td>
<td><pre>                            if (prec == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="525" href="#"></a></td>
<td><pre>                                coeff[idx] = c;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="526" href="#"></a></td>
<td><pre>                                prec = 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="527" href="#"></a></td>
<td><pre>                            } else if (idx != 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="528" href="#"></a></td>
<td><pre>                                coeff[idx++] = c;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="529" href="#"></a></td>
<td><pre>                                ++prec;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="530" href="#"></a></td>
<td><pre>                            } // else c must be a redundant leading zero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="531" href="#"></a></td>
<td><pre>                        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="532" href="#"></a></td>
<td><pre>                            if (prec != 1 || idx != 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="533" href="#"></a></td>
<td><pre>                                ++prec; // prec unchanged if preceded by 0s</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="534" href="#"></a></td>
<td><pre>                            coeff[idx++] = c;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="535" href="#"></a></td>
<td><pre>                        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="536" href="#"></a></td>
<td><pre>                        if (dot)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="537" href="#"></a></td>
<td><pre>                            ++scl;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="538" href="#"></a></td>
<td><pre>                        continue;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="539" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="540" href="#"></a></td>
<td><pre>                    // have dot</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="541" href="#"></a></td>
<td><pre>                    if (c == '.') {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="542" href="#"></a></td>
<td><pre>                        // have dot</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="543" href="#"></a></td>
<td><pre>                        if (dot) // two dots</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="544" href="#"></a></td>
<td><pre>                            throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="545" href="#"></a></td>
<td><pre>                        dot = true;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="546" href="#"></a></td>
<td><pre>                        continue;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="547" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="548" href="#"></a></td>
<td><pre>                    // exponent expected</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="549" href="#"></a></td>
<td><pre>                    if ((c != 'e') &amp;&amp; (c != 'E'))</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="550" href="#"></a></td>
<td><pre>                        throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="551" href="#"></a></td>
<td><pre>                    exp = parseExp(in, offset, len);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="552" href="#"></a></td>
<td><pre>                    // Next test is required for backwards compatibility</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="553" href="#"></a></td>
<td><pre>                    if ((int) exp != exp) // overflow</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="554" href="#"></a></td>
<td><pre>                        throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="555" href="#"></a></td>
<td><pre>                    break; // [saves a test]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="556" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="557" href="#"></a></td>
<td><pre>                // here when no characters left</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="558" href="#"></a></td>
<td><pre>                if (prec == 0) // no digits found</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="559" href="#"></a></td>
<td><pre>                    throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="560" href="#"></a></td>
<td><pre>                // Adjust scale if exp is not zero.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="561" href="#"></a></td>
<td><pre>                if (exp != 0) { // had significant exponent</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="562" href="#"></a></td>
<td><pre>                    scl = adjustScale(scl, exp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="563" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="564" href="#"></a></td>
<td><pre>                // Remove leading zeros from precision (digits count)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="565" href="#"></a></td>
<td><pre>                rb = new BigInteger(coeff, isneg ? -1 : 1, prec);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="566" href="#"></a></td>
<td><pre>                rs = compactValFor(rb);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="567" href="#"></a></td>
<td><pre>                int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="568" href="#"></a></td>
<td><pre>                if (mcp &gt; 0 &amp;&amp; (prec &gt; mcp)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="569" href="#"></a></td>
<td><pre>                    if (rs == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="570" href="#"></a></td>
<td><pre>                        int drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="571" href="#"></a></td>
<td><pre>                        while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="572" href="#"></a></td>
<td><pre>                            scl = checkScaleNonZero((long) scl - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="573" href="#"></a></td>
<td><pre>                            rb = divideAndRoundByTenPow(rb, drop, mc.roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="574" href="#"></a></td>
<td><pre>                            rs = compactValFor(rb);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="575" href="#"></a></td>
<td><pre>                            if (rs != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="576" href="#"></a></td>
<td><pre>                                prec = longDigitLength(rs);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="577" href="#"></a></td>
<td><pre>                                break;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="578" href="#"></a></td>
<td><pre>                            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="579" href="#"></a></td>
<td><pre>                            prec = bigDigitLength(rb);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="580" href="#"></a></td>
<td><pre>                            drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="581" href="#"></a></td>
<td><pre>                        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="582" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="583" href="#"></a></td>
<td><pre>                    if (rs != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="584" href="#"></a></td>
<td><pre>                        int drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="585" href="#"></a></td>
<td><pre>                        while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="586" href="#"></a></td>
<td><pre>                            scl = checkScaleNonZero((long) scl - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="587" href="#"></a></td>
<td><pre>                            rs = divideAndRound(rs, LONG_TEN_POWERS_TABLE[drop], mc.roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="588" href="#"></a></td>
<td><pre>                            prec = longDigitLength(rs);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="589" href="#"></a></td>
<td><pre>                            drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="590" href="#"></a></td>
<td><pre>                        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="591" href="#"></a></td>
<td><pre>                        rb = null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="592" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="593" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="594" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="595" href="#"></a></td>
<td><pre>        } catch (ArrayIndexOutOfBoundsException e) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="596" href="#"></a></td>
<td><pre>            throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="597" href="#"></a></td>
<td><pre>        } catch (NegativeArraySizeException e) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="598" href="#"></a></td>
<td><pre>            throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="599" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="600" href="#"></a></td>
<td><pre>        this.scale = scl;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="601" href="#"></a></td>
<td><pre>        this.precision = prec;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="602" href="#"></a></td>
<td><pre>        this.intCompact = rs;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="603" href="#"></a></td>
<td><pre>        this.intVal = rb;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="604" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="605" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="606" href="#"></a></td>
<td><pre>    private int adjustScale(int scl, long exp) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="607" href="#"></a></td>
<td><pre>        long adjustedScale = scl - exp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="608" href="#"></a></td>
<td><pre>        if (adjustedScale &gt; Integer.MAX_VALUE || adjustedScale &lt; Integer.MIN_VALUE)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="609" href="#"></a></td>
<td><pre>            throw new NumberFormatException(&quot;Scale out of range.&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="610" href="#"></a></td>
<td><pre>        scl = (int) adjustedScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="611" href="#"></a></td>
<td><pre>        return scl;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="612" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="613" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="614" href="#"></a></td>
<td><pre>    /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="615" href="#"></a></td>
<td><pre>     * parse exponent</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="616" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="617" href="#"></a></td>
<td><pre>    private static long parseExp(char[] in, int offset, int len){</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="618" href="#"></a></td>
<td><pre>        long exp = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="619" href="#"></a></td>
<td><pre>        offset++;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="620" href="#"></a></td>
<td><pre>        char c = in[offset];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="621" href="#"></a></td>
<td><pre>        len--;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="622" href="#"></a></td>
<td><pre>        boolean negexp = (c == '-');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="623" href="#"></a></td>
<td><pre>        // optional sign</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="624" href="#"></a></td>
<td><pre>        if (negexp || c == '+') {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="625" href="#"></a></td>
<td><pre>            offset++;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="626" href="#"></a></td>
<td><pre>            c = in[offset];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="627" href="#"></a></td>
<td><pre>            len--;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="628" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="629" href="#"></a></td>
<td><pre>        if (len &lt;= 0) // no exponent digits</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="630" href="#"></a></td>
<td><pre>            throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="631" href="#"></a></td>
<td><pre>        // skip leading zeros in the exponent</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="632" href="#"></a></td>
<td><pre>        while (len &gt; 10 &amp;&amp; (c=='0' || (Character.digit(c, 10) == 0))) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="633" href="#"></a></td>
<td><pre>            offset++;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="634" href="#"></a></td>
<td><pre>            c = in[offset];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="635" href="#"></a></td>
<td><pre>            len--;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="636" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="637" href="#"></a></td>
<td><pre>        if (len &gt; 10) // too many nonzero exponent digits</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="638" href="#"></a></td>
<td><pre>            throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="639" href="#"></a></td>
<td><pre>        // c now holds first digit of exponent</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="640" href="#"></a></td>
<td><pre>        for (;; len--) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="641" href="#"></a></td>
<td><pre>            int v;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="642" href="#"></a></td>
<td><pre>            if (c &gt;= '0' &amp;&amp; c &lt;= '9') {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="643" href="#"></a></td>
<td><pre>                v = c - '0';</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="644" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="645" href="#"></a></td>
<td><pre>                v = Character.digit(c, 10);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="646" href="#"></a></td>
<td><pre>                if (v &lt; 0) // not a digit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="647" href="#"></a></td>
<td><pre>                    throw new NumberFormatException();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="648" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="649" href="#"></a></td>
<td><pre>            exp = exp * 10 + v;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="650" href="#"></a></td>
<td><pre>            if (len == 1)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="651" href="#"></a></td>
<td><pre>                break; // that was final character</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="652" href="#"></a></td>
<td><pre>            offset++;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="653" href="#"></a></td>
<td><pre>            c = in[offset];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="654" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="655" href="#"></a></td>
<td><pre>        if (negexp) // apply sign</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="656" href="#"></a></td>
<td><pre>            exp = -exp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="657" href="#"></a></td>
<td><pre>        return exp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="658" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="659" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="660" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="661" href="#"></a></td>
<td><pre>     * Translates a character array representation of a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="662" href="#"></a></td>
<td><pre>     * {@code BigDecimal} into a {@code BigDecimal}, accepting the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="663" href="#"></a></td>
<td><pre>     * same sequence of characters as the {@link #BigDecimal(String)}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="664" href="#"></a></td>
<td><pre>     * constructor.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="665" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="666" href="#"></a></td>
<td><pre>     * &lt;p&gt;Note that if the sequence of characters is already available</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="667" href="#"></a></td>
<td><pre>     * as a character array, using this constructor is faster than</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="668" href="#"></a></td>
<td><pre>     * converting the {@code char} array to string and using the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="669" href="#"></a></td>
<td><pre>     * {@code BigDecimal(String)} constructor .</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="670" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="671" href="#"></a></td>
<td><pre>     * @param in {@code char} array that is the source of characters.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="672" href="#"></a></td>
<td><pre>     * @throws NumberFormatException if {@code in} is not a valid</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="673" href="#"></a></td>
<td><pre>     *         representation of a {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="674" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="675" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="676" href="#"></a></td>
<td><pre>    public BigDecimal(char[] in) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="677" href="#"></a></td>
<td><pre>        this(in, 0, in.length);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="678" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="679" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="680" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="681" href="#"></a></td>
<td><pre>     * Translates a character array representation of a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="682" href="#"></a></td>
<td><pre>     * {@code BigDecimal} into a {@code BigDecimal}, accepting the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="683" href="#"></a></td>
<td><pre>     * same sequence of characters as the {@link #BigDecimal(String)}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="684" href="#"></a></td>
<td><pre>     * constructor and with rounding according to the context</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="685" href="#"></a></td>
<td><pre>     * settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="686" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="687" href="#"></a></td>
<td><pre>     * &lt;p&gt;Note that if the sequence of characters is already available</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="688" href="#"></a></td>
<td><pre>     * as a character array, using this constructor is faster than</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="689" href="#"></a></td>
<td><pre>     * converting the {@code char} array to string and using the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="690" href="#"></a></td>
<td><pre>     * {@code BigDecimal(String)} constructor .</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="691" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="692" href="#"></a></td>
<td><pre>     * @param  in {@code char} array that is the source of characters.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="693" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="694" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="695" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="696" href="#"></a></td>
<td><pre>     * @throws NumberFormatException if {@code in} is not a valid</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="697" href="#"></a></td>
<td><pre>     *         representation of a {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="698" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="699" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="700" href="#"></a></td>
<td><pre>    public BigDecimal(char[] in, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="701" href="#"></a></td>
<td><pre>        this(in, 0, in.length, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="702" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="703" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="704" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="705" href="#"></a></td>
<td><pre>     * Translates the string representation of a {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="706" href="#"></a></td>
<td><pre>     * into a {@code BigDecimal}.  The string representation consists</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="707" href="#"></a></td>
<td><pre>     * of an optional sign, {@code '+'} (&lt;tt&gt; '&amp;#92;u002B'&lt;/tt&gt;) or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="708" href="#"></a></td>
<td><pre>     * {@code '-'} (&lt;tt&gt;'&amp;#92;u002D'&lt;/tt&gt;), followed by a sequence of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="709" href="#"></a></td>
<td><pre>     * zero or more decimal digits (&quot;the integer&quot;), optionally</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="710" href="#"></a></td>
<td><pre>     * followed by a fraction, optionally followed by an exponent.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="711" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="712" href="#"></a></td>
<td><pre>     * &lt;p&gt;The fraction consists of a decimal point followed by zero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="713" href="#"></a></td>
<td><pre>     * or more decimal digits.  The string must contain at least one</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="714" href="#"></a></td>
<td><pre>     * digit in either the integer or the fraction.  The number formed</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="715" href="#"></a></td>
<td><pre>     * by the sign, the integer and the fraction is referred to as the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="716" href="#"></a></td>
<td><pre>     * &lt;i&gt;significand&lt;/i&gt;.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="717" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="718" href="#"></a></td>
<td><pre>     * &lt;p&gt;The exponent consists of the character {@code 'e'}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="719" href="#"></a></td>
<td><pre>     * (&lt;tt&gt;'&amp;#92;u0065'&lt;/tt&gt;) or {@code 'E'} (&lt;tt&gt;'&amp;#92;u0045'&lt;/tt&gt;)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="720" href="#"></a></td>
<td><pre>     * followed by one or more decimal digits.  The value of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="721" href="#"></a></td>
<td><pre>     * exponent must lie between -{@link Integer#MAX_VALUE} ({@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="722" href="#"></a></td>
<td><pre>     * Integer#MIN_VALUE}+1) and {@link Integer#MAX_VALUE}, inclusive.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="723" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="724" href="#"></a></td>
<td><pre>     * &lt;p&gt;More formally, the strings this constructor accepts are</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="725" href="#"></a></td>
<td><pre>     * described by the following grammar:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="726" href="#"></a></td>
<td><pre>     * &lt;blockquote&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="727" href="#"></a></td>
<td><pre>     * &lt;dl&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="728" href="#"></a></td>
<td><pre>     * &lt;dt&gt;&lt;i&gt;BigDecimalString:&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="729" href="#"></a></td>
<td><pre>     * &lt;dd&gt;&lt;i&gt;Sign&lt;sub&gt;opt&lt;/sub&gt; Significand Exponent&lt;sub&gt;opt&lt;/sub&gt;&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="730" href="#"></a></td>
<td><pre>     * &lt;dt&gt;&lt;i&gt;Sign:&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="731" href="#"></a></td>
<td><pre>     * &lt;dd&gt;{@code +}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="732" href="#"></a></td>
<td><pre>     * &lt;dd&gt;{@code -}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="733" href="#"></a></td>
<td><pre>     * &lt;dt&gt;&lt;i&gt;Significand:&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="734" href="#"></a></td>
<td><pre>     * &lt;dd&gt;&lt;i&gt;IntegerPart&lt;/i&gt; {@code .} &lt;i&gt;FractionPart&lt;sub&gt;opt&lt;/sub&gt;&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="735" href="#"></a></td>
<td><pre>     * &lt;dd&gt;{@code .} &lt;i&gt;FractionPart&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="736" href="#"></a></td>
<td><pre>     * &lt;dd&gt;&lt;i&gt;IntegerPart&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="737" href="#"></a></td>
<td><pre>     * &lt;dt&gt;&lt;i&gt;IntegerPart:&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="738" href="#"></a></td>
<td><pre>     * &lt;dd&gt;&lt;i&gt;Digits&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="739" href="#"></a></td>
<td><pre>     * &lt;dt&gt;&lt;i&gt;FractionPart:&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="740" href="#"></a></td>
<td><pre>     * &lt;dd&gt;&lt;i&gt;Digits&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="741" href="#"></a></td>
<td><pre>     * &lt;dt&gt;&lt;i&gt;Exponent:&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="742" href="#"></a></td>
<td><pre>     * &lt;dd&gt;&lt;i&gt;ExponentIndicator SignedInteger&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="743" href="#"></a></td>
<td><pre>     * &lt;dt&gt;&lt;i&gt;ExponentIndicator:&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="744" href="#"></a></td>
<td><pre>     * &lt;dd&gt;{@code e}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="745" href="#"></a></td>
<td><pre>     * &lt;dd&gt;{@code E}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="746" href="#"></a></td>
<td><pre>     * &lt;dt&gt;&lt;i&gt;SignedInteger:&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="747" href="#"></a></td>
<td><pre>     * &lt;dd&gt;&lt;i&gt;Sign&lt;sub&gt;opt&lt;/sub&gt; Digits&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="748" href="#"></a></td>
<td><pre>     * &lt;dt&gt;&lt;i&gt;Digits:&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="749" href="#"></a></td>
<td><pre>     * &lt;dd&gt;&lt;i&gt;Digit&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="750" href="#"></a></td>
<td><pre>     * &lt;dd&gt;&lt;i&gt;Digits Digit&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="751" href="#"></a></td>
<td><pre>     * &lt;dt&gt;&lt;i&gt;Digit:&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="752" href="#"></a></td>
<td><pre>     * &lt;dd&gt;any character for which {@link Character#isDigit}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="753" href="#"></a></td>
<td><pre>     * returns {@code true}, including 0, 1, 2 ...</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="754" href="#"></a></td>
<td><pre>     * &lt;/dl&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="755" href="#"></a></td>
<td><pre>     * &lt;/blockquote&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="756" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="757" href="#"></a></td>
<td><pre>     * &lt;p&gt;The scale of the returned {@code BigDecimal} will be the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="758" href="#"></a></td>
<td><pre>     * number of digits in the fraction, or zero if the string</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="759" href="#"></a></td>
<td><pre>     * contains no decimal point, subject to adjustment for any</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="760" href="#"></a></td>
<td><pre>     * exponent; if the string contains an exponent, the exponent is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="761" href="#"></a></td>
<td><pre>     * subtracted from the scale.  The value of the resulting scale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="762" href="#"></a></td>
<td><pre>     * must lie between {@code Integer.MIN_VALUE} and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="763" href="#"></a></td>
<td><pre>     * {@code Integer.MAX_VALUE}, inclusive.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="764" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="765" href="#"></a></td>
<td><pre>     * &lt;p&gt;The character-to-digit mapping is provided by {@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="766" href="#"></a></td>
<td><pre>     * java.lang.Character#digit} set to convert to radix 10.  The</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="767" href="#"></a></td>
<td><pre>     * String may not contain any extraneous characters (whitespace,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="768" href="#"></a></td>
<td><pre>     * for example).</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="769" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="770" href="#"></a></td>
<td><pre>     * &lt;p&gt;&lt;b&gt;Examples:&lt;/b&gt;&lt;br&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="771" href="#"></a></td>
<td><pre>     * The value of the returned {@code BigDecimal} is equal to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="772" href="#"></a></td>
<td><pre>     * &lt;i&gt;significand&lt;/i&gt; &amp;times; 10&lt;sup&gt;&amp;nbsp;&lt;i&gt;exponent&lt;/i&gt;&lt;/sup&gt;.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="773" href="#"></a></td>
<td><pre>     * For each string on the left, the resulting representation</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="774" href="#"></a></td>
<td><pre>     * [{@code BigInteger}, {@code scale}] is shown on the right.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="775" href="#"></a></td>
<td><pre>     * &lt;pre&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="776" href="#"></a></td>
<td><pre>     * &quot;0&quot;            [0,0]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="777" href="#"></a></td>
<td><pre>     * &quot;0.00&quot;         [0,2]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="778" href="#"></a></td>
<td><pre>     * &quot;123&quot;          [123,0]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="779" href="#"></a></td>
<td><pre>     * &quot;-123&quot;         [-123,0]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="780" href="#"></a></td>
<td><pre>     * &quot;1.23E3&quot;       [123,-1]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="781" href="#"></a></td>
<td><pre>     * &quot;1.23E+3&quot;      [123,-1]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="782" href="#"></a></td>
<td><pre>     * &quot;12.3E+7&quot;      [123,-6]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="783" href="#"></a></td>
<td><pre>     * &quot;12.0&quot;         [120,1]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="784" href="#"></a></td>
<td><pre>     * &quot;12.3&quot;         [123,1]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="785" href="#"></a></td>
<td><pre>     * &quot;0.00123&quot;      [123,5]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="786" href="#"></a></td>
<td><pre>     * &quot;-1.23E-12&quot;    [-123,14]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="787" href="#"></a></td>
<td><pre>     * &quot;1234.5E-4&quot;    [12345,5]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="788" href="#"></a></td>
<td><pre>     * &quot;0E+7&quot;         [0,-7]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="789" href="#"></a></td>
<td><pre>     * &quot;-0&quot;           [0,0]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="790" href="#"></a></td>
<td><pre>     * &lt;/pre&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="791" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="792" href="#"></a></td>
<td><pre>     * &lt;p&gt;Note: For values other than {@code float} and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="793" href="#"></a></td>
<td><pre>     * {@code double} NaN and &amp;plusmn;Infinity, this constructor is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="794" href="#"></a></td>
<td><pre>     * compatible with the values returned by {@link Float#toString}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="795" href="#"></a></td>
<td><pre>     * and {@link Double#toString}.  This is generally the preferred</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="796" href="#"></a></td>
<td><pre>     * way to convert a {@code float} or {@code double} into a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="797" href="#"></a></td>
<td><pre>     * BigDecimal, as it doesn't suffer from the unpredictability of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="798" href="#"></a></td>
<td><pre>     * the {@link #BigDecimal(double)} constructor.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="799" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="800" href="#"></a></td>
<td><pre>     * @param val String representation of {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="801" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="802" href="#"></a></td>
<td><pre>     * @throws NumberFormatException if {@code val} is not a valid</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="803" href="#"></a></td>
<td><pre>     *         representation of a {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="804" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="805" href="#"></a></td>
<td><pre>    public BigDecimal(String val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="806" href="#"></a></td>
<td><pre>        this(val.toCharArray(), 0, val.length());</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="807" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="808" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="809" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="810" href="#"></a></td>
<td><pre>     * Translates the string representation of a {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="811" href="#"></a></td>
<td><pre>     * into a {@code BigDecimal}, accepting the same strings as the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="812" href="#"></a></td>
<td><pre>     * {@link #BigDecimal(String)} constructor, with rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="813" href="#"></a></td>
<td><pre>     * according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="814" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="815" href="#"></a></td>
<td><pre>     * @param  val string representation of a {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="816" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="817" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="818" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="819" href="#"></a></td>
<td><pre>     * @throws NumberFormatException if {@code val} is not a valid</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="820" href="#"></a></td>
<td><pre>     *         representation of a BigDecimal.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="821" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="822" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="823" href="#"></a></td>
<td><pre>    public BigDecimal(String val, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="824" href="#"></a></td>
<td><pre>        this(val.toCharArray(), 0, val.length(), mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="825" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="826" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="827" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="828" href="#"></a></td>
<td><pre>     * Translates a {@code double} into a {@code BigDecimal} which</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="829" href="#"></a></td>
<td><pre>     * is the exact decimal representation of the {@code double}'s</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="830" href="#"></a></td>
<td><pre>     * binary floating-point value.  The scale of the returned</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="831" href="#"></a></td>
<td><pre>     * {@code BigDecimal} is the smallest value such that</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="832" href="#"></a></td>
<td><pre>     * &lt;tt&gt;(10&lt;sup&gt;scale&lt;/sup&gt; &amp;times; val)&lt;/tt&gt; is an integer.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="833" href="#"></a></td>
<td><pre>     * &lt;p&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="834" href="#"></a></td>
<td><pre>     * &lt;b&gt;Notes:&lt;/b&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="835" href="#"></a></td>
<td><pre>     * &lt;ol&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="836" href="#"></a></td>
<td><pre>     * &lt;li&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="837" href="#"></a></td>
<td><pre>     * The results of this constructor can be somewhat unpredictable.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="838" href="#"></a></td>
<td><pre>     * One might assume that writing {@code new BigDecimal(0.1)} in</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="839" href="#"></a></td>
<td><pre>     * Java creates a {@code BigDecimal} which is exactly equal to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="840" href="#"></a></td>
<td><pre>     * 0.1 (an unscaled value of 1, with a scale of 1), but it is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="841" href="#"></a></td>
<td><pre>     * actually equal to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="842" href="#"></a></td>
<td><pre>     * 0.1000000000000000055511151231257827021181583404541015625.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="843" href="#"></a></td>
<td><pre>     * This is because 0.1 cannot be represented exactly as a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="844" href="#"></a></td>
<td><pre>     * {@code double} (or, for that matter, as a binary fraction of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="845" href="#"></a></td>
<td><pre>     * any finite length).  Thus, the value that is being passed</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="846" href="#"></a></td>
<td><pre>     * &lt;i&gt;in&lt;/i&gt; to the constructor is not exactly equal to 0.1,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="847" href="#"></a></td>
<td><pre>     * appearances notwithstanding.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="848" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="849" href="#"></a></td>
<td><pre>     * &lt;li&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="850" href="#"></a></td>
<td><pre>     * The {@code String} constructor, on the other hand, is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="851" href="#"></a></td>
<td><pre>     * perfectly predictable: writing {@code new BigDecimal(&quot;0.1&quot;)}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="852" href="#"></a></td>
<td><pre>     * creates a {@code BigDecimal} which is &lt;i&gt;exactly&lt;/i&gt; equal to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="853" href="#"></a></td>
<td><pre>     * 0.1, as one would expect.  Therefore, it is generally</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="854" href="#"></a></td>
<td><pre>     * recommended that the {@linkplain #BigDecimal(String)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="855" href="#"></a></td>
<td><pre>     * &lt;tt&gt;String&lt;/tt&gt; constructor} be used in preference to this one.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="856" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="857" href="#"></a></td>
<td><pre>     * &lt;li&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="858" href="#"></a></td>
<td><pre>     * When a {@code double} must be used as a source for a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="859" href="#"></a></td>
<td><pre>     * {@code BigDecimal}, note that this constructor provides an</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="860" href="#"></a></td>
<td><pre>     * exact conversion; it does not give the same result as</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="861" href="#"></a></td>
<td><pre>     * converting the {@code double} to a {@code String} using the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="862" href="#"></a></td>
<td><pre>     * {@link Double#toString(double)} method and then using the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="863" href="#"></a></td>
<td><pre>     * {@link #BigDecimal(String)} constructor.  To get that result,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="864" href="#"></a></td>
<td><pre>     * use the {@code static} {@link #valueOf(double)} method.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="865" href="#"></a></td>
<td><pre>     * &lt;/ol&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="866" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="867" href="#"></a></td>
<td><pre>     * @param val {@code double} value to be converted to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="868" href="#"></a></td>
<td><pre>     *        {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="869" href="#"></a></td>
<td><pre>     * @throws NumberFormatException if {@code val} is infinite or NaN.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="870" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="871" href="#"></a></td>
<td><pre>    public BigDecimal(double val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="872" href="#"></a></td>
<td><pre>        this(val,MathContext.UNLIMITED);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="873" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="874" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="875" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="876" href="#"></a></td>
<td><pre>     * Translates a {@code double} into a {@code BigDecimal}, with</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="877" href="#"></a></td>
<td><pre>     * rounding according to the context settings.  The scale of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="878" href="#"></a></td>
<td><pre>     * {@code BigDecimal} is the smallest value such that</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="879" href="#"></a></td>
<td><pre>     * &lt;tt&gt;(10&lt;sup&gt;scale&lt;/sup&gt; &amp;times; val)&lt;/tt&gt; is an integer.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="880" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="881" href="#"></a></td>
<td><pre>     * &lt;p&gt;The results of this constructor can be somewhat unpredictable</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="882" href="#"></a></td>
<td><pre>     * and its use is generally not recommended; see the notes under</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="883" href="#"></a></td>
<td><pre>     * the {@link #BigDecimal(double)} constructor.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="884" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="885" href="#"></a></td>
<td><pre>     * @param  val {@code double} value to be converted to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="886" href="#"></a></td>
<td><pre>     *         {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="887" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="888" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="889" href="#"></a></td>
<td><pre>     *         RoundingMode is UNNECESSARY.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="890" href="#"></a></td>
<td><pre>     * @throws NumberFormatException if {@code val} is infinite or NaN.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="891" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="892" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="893" href="#"></a></td>
<td><pre>    public BigDecimal(double val, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="894" href="#"></a></td>
<td><pre>        if (Double.isInfinite(val) || Double.isNaN(val))</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="895" href="#"></a></td>
<td><pre>            throw new NumberFormatException(&quot;Infinite or NaN&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="896" href="#"></a></td>
<td><pre>        // Translate the double into sign, exponent and significand, according</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="897" href="#"></a></td>
<td><pre>        // to the formulae in JLS, Section 20.10.22.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="898" href="#"></a></td>
<td><pre>        long valBits = Double.doubleToLongBits(val);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="899" href="#"></a></td>
<td><pre>        int sign = ((valBits &gt;&gt; 63) == 0 ? 1 : -1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="900" href="#"></a></td>
<td><pre>        int exponent = (int) ((valBits &gt;&gt; 52) &amp; 0x7ffL);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="901" href="#"></a></td>
<td><pre>        long significand = (exponent == 0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="902" href="#"></a></td>
<td><pre>                ? (valBits &amp; ((1L &lt;&lt; 52) - 1)) &lt;&lt; 1</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="903" href="#"></a></td>
<td><pre>                : (valBits &amp; ((1L &lt;&lt; 52) - 1)) | (1L &lt;&lt; 52));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="904" href="#"></a></td>
<td><pre>        exponent -= 1075;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="905" href="#"></a></td>
<td><pre>        // At this point, val == sign * significand * 2**exponent.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="906" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="907" href="#"></a></td>
<td><pre>        /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="908" href="#"></a></td>
<td><pre>         * Special case zero to supress nonterminating normalization and bogus</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="909" href="#"></a></td>
<td><pre>         * scale calculation.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="910" href="#"></a></td>
<td><pre>         */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="911" href="#"></a></td>
<td><pre>        if (significand == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="912" href="#"></a></td>
<td><pre>            this.intVal = BigInteger.ZERO;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="913" href="#"></a></td>
<td><pre>            this.scale = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="914" href="#"></a></td>
<td><pre>            this.intCompact = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="915" href="#"></a></td>
<td><pre>            this.precision = 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="916" href="#"></a></td>
<td><pre>            return;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="917" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="918" href="#"></a></td>
<td><pre>        // Normalize</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="919" href="#"></a></td>
<td><pre>        while ((significand &amp; 1) == 0) { // i.e., significand is even</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="920" href="#"></a></td>
<td><pre>            significand &gt;&gt;= 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="921" href="#"></a></td>
<td><pre>            exponent++;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="922" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="923" href="#"></a></td>
<td><pre>        int scale = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="924" href="#"></a></td>
<td><pre>        // Calculate intVal and scale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="925" href="#"></a></td>
<td><pre>        BigInteger intVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="926" href="#"></a></td>
<td><pre>        long compactVal = sign * significand;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="927" href="#"></a></td>
<td><pre>        if (exponent == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="928" href="#"></a></td>
<td><pre>            intVal = (compactVal == INFLATED) ? INFLATED_BIGINT : null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="929" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="930" href="#"></a></td>
<td><pre>            if (exponent &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="931" href="#"></a></td>
<td><pre>                intVal = BigInteger.valueOf(5).pow(-exponent).multiply(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="932" href="#"></a></td>
<td><pre>                scale = -exponent;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="933" href="#"></a></td>
<td><pre>            } else { //  (exponent &gt; 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="934" href="#"></a></td>
<td><pre>                intVal = BigInteger.valueOf(2).pow(exponent).multiply(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="935" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="936" href="#"></a></td>
<td><pre>            compactVal = compactValFor(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="937" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="938" href="#"></a></td>
<td><pre>        int prec = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="939" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="940" href="#"></a></td>
<td><pre>        if (mcp &gt; 0) { // do rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="941" href="#"></a></td>
<td><pre>            int mode = mc.roundingMode.oldMode;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="942" href="#"></a></td>
<td><pre>            int drop;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="943" href="#"></a></td>
<td><pre>            if (compactVal == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="944" href="#"></a></td>
<td><pre>                prec = bigDigitLength(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="945" href="#"></a></td>
<td><pre>                drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="946" href="#"></a></td>
<td><pre>                while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="947" href="#"></a></td>
<td><pre>                    scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="948" href="#"></a></td>
<td><pre>                    intVal = divideAndRoundByTenPow(intVal, drop, mode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="949" href="#"></a></td>
<td><pre>                    compactVal = compactValFor(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="950" href="#"></a></td>
<td><pre>                    if (compactVal != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="951" href="#"></a></td>
<td><pre>                        break;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="952" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="953" href="#"></a></td>
<td><pre>                    prec = bigDigitLength(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="954" href="#"></a></td>
<td><pre>                    drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="955" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="956" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="957" href="#"></a></td>
<td><pre>            if (compactVal != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="958" href="#"></a></td>
<td><pre>                prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="959" href="#"></a></td>
<td><pre>                drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="960" href="#"></a></td>
<td><pre>                while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="961" href="#"></a></td>
<td><pre>                    scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="962" href="#"></a></td>
<td><pre>                    compactVal = divideAndRound(compactVal, LONG_TEN_POWERS_TABLE[drop], mc.roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="963" href="#"></a></td>
<td><pre>                    prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="964" href="#"></a></td>
<td><pre>                    drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="965" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="966" href="#"></a></td>
<td><pre>                intVal = null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="967" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="968" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="969" href="#"></a></td>
<td><pre>        this.intVal = intVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="970" href="#"></a></td>
<td><pre>        this.intCompact = compactVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="971" href="#"></a></td>
<td><pre>        this.scale = scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="972" href="#"></a></td>
<td><pre>        this.precision = prec;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="973" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="974" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="975" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="976" href="#"></a></td>
<td><pre>     * Translates a {@code BigInteger} into a {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="977" href="#"></a></td>
<td><pre>     * The scale of the {@code BigDecimal} is zero.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="978" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="979" href="#"></a></td>
<td><pre>     * @param val {@code BigInteger} value to be converted to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="980" href="#"></a></td>
<td><pre>     *            {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="981" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="982" href="#"></a></td>
<td><pre>    public BigDecimal(BigInteger val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="983" href="#"></a></td>
<td><pre>        scale = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="984" href="#"></a></td>
<td><pre>        intVal = val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="985" href="#"></a></td>
<td><pre>        intCompact = compactValFor(val);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="986" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="987" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="988" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="989" href="#"></a></td>
<td><pre>     * Translates a {@code BigInteger} into a {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="990" href="#"></a></td>
<td><pre>     * rounding according to the context settings.  The scale of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="991" href="#"></a></td>
<td><pre>     * {@code BigDecimal} is zero.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="992" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="993" href="#"></a></td>
<td><pre>     * @param val {@code BigInteger} value to be converted to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="994" href="#"></a></td>
<td><pre>     *            {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="995" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="996" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="997" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="998" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="999" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1000" href="#"></a></td>
<td><pre>    public BigDecimal(BigInteger val, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1001" href="#"></a></td>
<td><pre>        this(val,0,mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1002" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1003" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1004" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1005" href="#"></a></td>
<td><pre>     * Translates a {@code BigInteger} unscaled value and an</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1006" href="#"></a></td>
<td><pre>     * {@code int} scale into a {@code BigDecimal}.  The value of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1007" href="#"></a></td>
<td><pre>     * the {@code BigDecimal} is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1008" href="#"></a></td>
<td><pre>     * &lt;tt&gt;(unscaledVal &amp;times; 10&lt;sup&gt;-scale&lt;/sup&gt;)&lt;/tt&gt;.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1009" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1010" href="#"></a></td>
<td><pre>     * @param unscaledVal unscaled value of the {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1011" href="#"></a></td>
<td><pre>     * @param scale scale of the {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1012" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1013" href="#"></a></td>
<td><pre>    public BigDecimal(BigInteger unscaledVal, int scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1014" href="#"></a></td>
<td><pre>        // Negative scales are now allowed</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1015" href="#"></a></td>
<td><pre>        this.intVal = unscaledVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1016" href="#"></a></td>
<td><pre>        this.intCompact = compactValFor(unscaledVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1017" href="#"></a></td>
<td><pre>        this.scale = scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1018" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1019" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1020" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1021" href="#"></a></td>
<td><pre>     * Translates a {@code BigInteger} unscaled value and an</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1022" href="#"></a></td>
<td><pre>     * {@code int} scale into a {@code BigDecimal}, with rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1023" href="#"></a></td>
<td><pre>     * according to the context settings.  The value of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1024" href="#"></a></td>
<td><pre>     * {@code BigDecimal} is &lt;tt&gt;(unscaledVal &amp;times;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1025" href="#"></a></td>
<td><pre>     * 10&lt;sup&gt;-scale&lt;/sup&gt;)&lt;/tt&gt;, rounded according to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1026" href="#"></a></td>
<td><pre>     * {@code precision} and rounding mode settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1027" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1028" href="#"></a></td>
<td><pre>     * @param  unscaledVal unscaled value of the {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1029" href="#"></a></td>
<td><pre>     * @param  scale scale of the {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1030" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1031" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1032" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1033" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1034" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1035" href="#"></a></td>
<td><pre>    public BigDecimal(BigInteger unscaledVal, int scale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1036" href="#"></a></td>
<td><pre>        long compactVal = compactValFor(unscaledVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1037" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1038" href="#"></a></td>
<td><pre>        int prec = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1039" href="#"></a></td>
<td><pre>        if (mcp &gt; 0) { // do rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1040" href="#"></a></td>
<td><pre>            int mode = mc.roundingMode.oldMode;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1041" href="#"></a></td>
<td><pre>            if (compactVal == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1042" href="#"></a></td>
<td><pre>                prec = bigDigitLength(unscaledVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1043" href="#"></a></td>
<td><pre>                int drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1044" href="#"></a></td>
<td><pre>                while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1045" href="#"></a></td>
<td><pre>                    scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1046" href="#"></a></td>
<td><pre>                    unscaledVal = divideAndRoundByTenPow(unscaledVal, drop, mode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1047" href="#"></a></td>
<td><pre>                    compactVal = compactValFor(unscaledVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1048" href="#"></a></td>
<td><pre>                    if (compactVal != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1049" href="#"></a></td>
<td><pre>                        break;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1050" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1051" href="#"></a></td>
<td><pre>                    prec = bigDigitLength(unscaledVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1052" href="#"></a></td>
<td><pre>                    drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1053" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1054" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1055" href="#"></a></td>
<td><pre>            if (compactVal != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1056" href="#"></a></td>
<td><pre>                prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1057" href="#"></a></td>
<td><pre>                int drop = prec - mcp;     // drop can't be more than 18</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1058" href="#"></a></td>
<td><pre>                while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1059" href="#"></a></td>
<td><pre>                    scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1060" href="#"></a></td>
<td><pre>                    compactVal = divideAndRound(compactVal, LONG_TEN_POWERS_TABLE[drop], mode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1061" href="#"></a></td>
<td><pre>                    prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1062" href="#"></a></td>
<td><pre>                    drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1063" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1064" href="#"></a></td>
<td><pre>                unscaledVal = null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1065" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1066" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1067" href="#"></a></td>
<td><pre>        this.intVal = unscaledVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1068" href="#"></a></td>
<td><pre>        this.intCompact = compactVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1069" href="#"></a></td>
<td><pre>        this.scale = scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1070" href="#"></a></td>
<td><pre>        this.precision = prec;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1071" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1072" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1073" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1074" href="#"></a></td>
<td><pre>     * Translates an {@code int} into a {@code BigDecimal}.  The</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1075" href="#"></a></td>
<td><pre>     * scale of the {@code BigDecimal} is zero.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1076" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1077" href="#"></a></td>
<td><pre>     * @param val {@code int} value to be converted to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1078" href="#"></a></td>
<td><pre>     *            {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1079" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1080" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1081" href="#"></a></td>
<td><pre>    public BigDecimal(int val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1082" href="#"></a></td>
<td><pre>        this.intCompact = val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1083" href="#"></a></td>
<td><pre>        this.scale = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1084" href="#"></a></td>
<td><pre>        this.intVal = null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1085" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1086" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1087" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1088" href="#"></a></td>
<td><pre>     * Translates an {@code int} into a {@code BigDecimal}, with</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1089" href="#"></a></td>
<td><pre>     * rounding according to the context settings.  The scale of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1090" href="#"></a></td>
<td><pre>     * {@code BigDecimal}, before any rounding, is zero.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1091" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1092" href="#"></a></td>
<td><pre>     * @param  val {@code int} value to be converted to {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1093" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1094" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1095" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1096" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1097" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1098" href="#"></a></td>
<td><pre>    public BigDecimal(int val, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1099" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1100" href="#"></a></td>
<td><pre>        long compactVal = val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1101" href="#"></a></td>
<td><pre>        int scale = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1102" href="#"></a></td>
<td><pre>        int prec = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1103" href="#"></a></td>
<td><pre>        if (mcp &gt; 0) { // do rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1104" href="#"></a></td>
<td><pre>            prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1105" href="#"></a></td>
<td><pre>            int drop = prec - mcp; // drop can't be more than 18</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1106" href="#"></a></td>
<td><pre>            while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1107" href="#"></a></td>
<td><pre>                scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1108" href="#"></a></td>
<td><pre>                compactVal = divideAndRound(compactVal, LONG_TEN_POWERS_TABLE[drop], mc.roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1109" href="#"></a></td>
<td><pre>                prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1110" href="#"></a></td>
<td><pre>                drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1111" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1112" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1113" href="#"></a></td>
<td><pre>        this.intVal = null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1114" href="#"></a></td>
<td><pre>        this.intCompact = compactVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1115" href="#"></a></td>
<td><pre>        this.scale = scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1116" href="#"></a></td>
<td><pre>        this.precision = prec;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1117" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1118" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1119" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1120" href="#"></a></td>
<td><pre>     * Translates a {@code long} into a {@code BigDecimal}.  The</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1121" href="#"></a></td>
<td><pre>     * scale of the {@code BigDecimal} is zero.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1122" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1123" href="#"></a></td>
<td><pre>     * @param val {@code long} value to be converted to {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1124" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1125" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1126" href="#"></a></td>
<td><pre>    public BigDecimal(long val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1127" href="#"></a></td>
<td><pre>        this.intCompact = val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1128" href="#"></a></td>
<td><pre>        this.intVal = (val == INFLATED) ? INFLATED_BIGINT : null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1129" href="#"></a></td>
<td><pre>        this.scale = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1130" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1131" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1132" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1133" href="#"></a></td>
<td><pre>     * Translates a {@code long} into a {@code BigDecimal}, with</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1134" href="#"></a></td>
<td><pre>     * rounding according to the context settings.  The scale of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1135" href="#"></a></td>
<td><pre>     * {@code BigDecimal}, before any rounding, is zero.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1136" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1137" href="#"></a></td>
<td><pre>     * @param  val {@code long} value to be converted to {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1138" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1139" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1140" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1141" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1142" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1143" href="#"></a></td>
<td><pre>    public BigDecimal(long val, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1144" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1145" href="#"></a></td>
<td><pre>        int mode = mc.roundingMode.oldMode;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1146" href="#"></a></td>
<td><pre>        int prec = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1147" href="#"></a></td>
<td><pre>        int scale = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1148" href="#"></a></td>
<td><pre>        BigInteger intVal = (val == INFLATED) ? INFLATED_BIGINT : null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1149" href="#"></a></td>
<td><pre>        if (mcp &gt; 0) { // do rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1150" href="#"></a></td>
<td><pre>            if (val == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1151" href="#"></a></td>
<td><pre>                prec = 19;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1152" href="#"></a></td>
<td><pre>                int drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1153" href="#"></a></td>
<td><pre>                while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1154" href="#"></a></td>
<td><pre>                    scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1155" href="#"></a></td>
<td><pre>                    intVal = divideAndRoundByTenPow(intVal, drop, mode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1156" href="#"></a></td>
<td><pre>                    val = compactValFor(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1157" href="#"></a></td>
<td><pre>                    if (val != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1158" href="#"></a></td>
<td><pre>                        break;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1159" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1160" href="#"></a></td>
<td><pre>                    prec = bigDigitLength(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1161" href="#"></a></td>
<td><pre>                    drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1162" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1163" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1164" href="#"></a></td>
<td><pre>            if (val != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1165" href="#"></a></td>
<td><pre>                prec = longDigitLength(val);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1166" href="#"></a></td>
<td><pre>                int drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1167" href="#"></a></td>
<td><pre>                while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1168" href="#"></a></td>
<td><pre>                    scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1169" href="#"></a></td>
<td><pre>                    val = divideAndRound(val, LONG_TEN_POWERS_TABLE[drop], mc.roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1170" href="#"></a></td>
<td><pre>                    prec = longDigitLength(val);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1171" href="#"></a></td>
<td><pre>                    drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1172" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1173" href="#"></a></td>
<td><pre>                intVal = null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1174" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1175" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1176" href="#"></a></td>
<td><pre>        this.intVal = intVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1177" href="#"></a></td>
<td><pre>        this.intCompact = val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1178" href="#"></a></td>
<td><pre>        this.scale = scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1179" href="#"></a></td>
<td><pre>        this.precision = prec;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1180" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1181" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1182" href="#"></a></td>
<td><pre>    // Static Factory Methods</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1183" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1184" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1185" href="#"></a></td>
<td><pre>     * Translates a {@code long} unscaled value and an</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1186" href="#"></a></td>
<td><pre>     * {@code int} scale into a {@code BigDecimal}.  This</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1187" href="#"></a></td>
<td><pre>     * {@literal &quot;static factory method&quot;} is provided in preference to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1188" href="#"></a></td>
<td><pre>     * a ({@code long}, {@code int}) constructor because it</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1189" href="#"></a></td>
<td><pre>     * allows for reuse of frequently used {@code BigDecimal} values..</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1190" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1191" href="#"></a></td>
<td><pre>     * @param unscaledVal unscaled value of the {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1192" href="#"></a></td>
<td><pre>     * @param scale scale of the {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1193" href="#"></a></td>
<td><pre>     * @return a {@code BigDecimal} whose value is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1194" href="#"></a></td>
<td><pre>     *         &lt;tt&gt;(unscaledVal &amp;times; 10&lt;sup&gt;-scale&lt;/sup&gt;)&lt;/tt&gt;.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1195" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1196" href="#"></a></td>
<td><pre>    public static BigDecimal valueOf(long unscaledVal, int scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1197" href="#"></a></td>
<td><pre>        if (scale == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1198" href="#"></a></td>
<td><pre>            return valueOf(unscaledVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1199" href="#"></a></td>
<td><pre>        else if (unscaledVal == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1200" href="#"></a></td>
<td><pre>            return zeroValueOf(scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1201" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1202" href="#"></a></td>
<td><pre>        return new BigDecimal(unscaledVal == INFLATED ?</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1203" href="#"></a></td>
<td><pre>                              INFLATED_BIGINT : null,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1204" href="#"></a></td>
<td><pre>                              unscaledVal, scale, 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1205" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1206" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1207" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1208" href="#"></a></td>
<td><pre>     * Translates a {@code long} value into a {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1209" href="#"></a></td>
<td><pre>     * with a scale of zero.  This {@literal &quot;static factory method&quot;}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1210" href="#"></a></td>
<td><pre>     * is provided in preference to a ({@code long}) constructor</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1211" href="#"></a></td>
<td><pre>     * because it allows for reuse of frequently used</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1212" href="#"></a></td>
<td><pre>     * {@code BigDecimal} values.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1213" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1214" href="#"></a></td>
<td><pre>     * @param val value of the {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1215" href="#"></a></td>
<td><pre>     * @return a {@code BigDecimal} whose value is {@code val}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1216" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1217" href="#"></a></td>
<td><pre>    public static BigDecimal valueOf(long val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1218" href="#"></a></td>
<td><pre>        if (val &gt;= 0 &amp;&amp; val &lt; zeroThroughTen.length)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1219" href="#"></a></td>
<td><pre>            return zeroThroughTen[(int)val];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1220" href="#"></a></td>
<td><pre>        else if (val != INFLATED)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1221" href="#"></a></td>
<td><pre>            return new BigDecimal(null, val, 0, 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1222" href="#"></a></td>
<td><pre>        return new BigDecimal(INFLATED_BIGINT, val, 0, 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1223" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1224" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1225" href="#"></a></td>
<td><pre>    static BigDecimal valueOf(long unscaledVal, int scale, int prec) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1226" href="#"></a></td>
<td><pre>        if (scale == 0 &amp;&amp; unscaledVal &gt;= 0 &amp;&amp; unscaledVal &lt; zeroThroughTen.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1227" href="#"></a></td>
<td><pre>            return zeroThroughTen[(int) unscaledVal];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1228" href="#"></a></td>
<td><pre>        } else if (unscaledVal == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1229" href="#"></a></td>
<td><pre>            return zeroValueOf(scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1230" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1231" href="#"></a></td>
<td><pre>        return new BigDecimal(unscaledVal == INFLATED ? INFLATED_BIGINT : null,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1232" href="#"></a></td>
<td><pre>                unscaledVal, scale, prec);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1233" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1234" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1235" href="#"></a></td>
<td><pre>    static BigDecimal valueOf(BigInteger intVal, int scale, int prec) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1236" href="#"></a></td>
<td><pre>        long val = compactValFor(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1237" href="#"></a></td>
<td><pre>        if (val == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1238" href="#"></a></td>
<td><pre>            return zeroValueOf(scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1239" href="#"></a></td>
<td><pre>        } else if (scale == 0 &amp;&amp; val &gt;= 0 &amp;&amp; val &lt; zeroThroughTen.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1240" href="#"></a></td>
<td><pre>            return zeroThroughTen[(int) val];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1241" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1242" href="#"></a></td>
<td><pre>        return new BigDecimal(intVal, val, scale, prec);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1243" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1244" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1245" href="#"></a></td>
<td><pre>    static BigDecimal zeroValueOf(int scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1246" href="#"></a></td>
<td><pre>        if (scale &gt;= 0 &amp;&amp; scale &lt; ZERO_SCALED_BY.length)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1247" href="#"></a></td>
<td><pre>            return ZERO_SCALED_BY[scale];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1248" href="#"></a></td>
<td><pre>        else</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1249" href="#"></a></td>
<td><pre>            return new BigDecimal(BigInteger.ZERO, 0, scale, 1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1250" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1251" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1252" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1253" href="#"></a></td>
<td><pre>     * Translates a {@code double} into a {@code BigDecimal}, using</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1254" href="#"></a></td>
<td><pre>     * the {@code double}'s canonical string representation provided</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1255" href="#"></a></td>
<td><pre>     * by the {@link Double#toString(double)} method.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1256" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1257" href="#"></a></td>
<td><pre>     * &lt;p&gt;&lt;b&gt;Note:&lt;/b&gt; This is generally the preferred way to convert</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1258" href="#"></a></td>
<td><pre>     * a {@code double} (or {@code float}) into a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1259" href="#"></a></td>
<td><pre>     * {@code BigDecimal}, as the value returned is equal to that</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1260" href="#"></a></td>
<td><pre>     * resulting from constructing a {@code BigDecimal} from the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1261" href="#"></a></td>
<td><pre>     * result of using {@link Double#toString(double)}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1262" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1263" href="#"></a></td>
<td><pre>     * @param  val {@code double} to convert to a {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1264" href="#"></a></td>
<td><pre>     * @return a {@code BigDecimal} whose value is equal to or approximately</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1265" href="#"></a></td>
<td><pre>     *         equal to the value of {@code val}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1266" href="#"></a></td>
<td><pre>     * @throws NumberFormatException if {@code val} is infinite or NaN.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1267" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1268" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1269" href="#"></a></td>
<td><pre>    public static BigDecimal valueOf(double val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1270" href="#"></a></td>
<td><pre>        // Reminder: a zero double returns '0.0', so we cannot fastpath</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1271" href="#"></a></td>
<td><pre>        // to use the constant ZERO.  This might be important enough to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1272" href="#"></a></td>
<td><pre>        // justify a factory approach, a cache, or a few private</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1273" href="#"></a></td>
<td><pre>        // constants, later.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1274" href="#"></a></td>
<td><pre>        return new BigDecimal(Double.toString(val));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1275" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1276" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1277" href="#"></a></td>
<td><pre>    // Arithmetic Operations</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1278" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1279" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1280" href="#"></a></td>
<td><pre>     * augend)}, and whose scale is {@code max(this.scale(),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1281" href="#"></a></td>
<td><pre>     * augend.scale())}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1282" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1283" href="#"></a></td>
<td><pre>     * @param  augend value to be added to this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1284" href="#"></a></td>
<td><pre>     * @return {@code this + augend}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1285" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1286" href="#"></a></td>
<td><pre>    public BigDecimal add(BigDecimal augend) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1287" href="#"></a></td>
<td><pre>        if (this.intCompact != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1288" href="#"></a></td>
<td><pre>            if ((augend.intCompact != INFLATED)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1289" href="#"></a></td>
<td><pre>                return add(this.intCompact, this.scale, augend.intCompact, augend.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1290" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1291" href="#"></a></td>
<td><pre>                return add(this.intCompact, this.scale, augend.intVal, augend.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1292" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1293" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1294" href="#"></a></td>
<td><pre>            if ((augend.intCompact != INFLATED)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1295" href="#"></a></td>
<td><pre>                return add(augend.intCompact, augend.scale, this.intVal, this.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1296" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1297" href="#"></a></td>
<td><pre>                return add(this.intVal, this.scale, augend.intVal, augend.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1298" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1299" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1300" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1301" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1302" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1303" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this + augend)},</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1304" href="#"></a></td>
<td><pre>     * with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1305" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1306" href="#"></a></td>
<td><pre>     * If either number is zero and the precision setting is nonzero then</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1307" href="#"></a></td>
<td><pre>     * the other number, rounded if necessary, is used as the result.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1308" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1309" href="#"></a></td>
<td><pre>     * @param  augend value to be added to this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1310" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1311" href="#"></a></td>
<td><pre>     * @return {@code this + augend}, rounded as necessary.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1312" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1313" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1314" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1315" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1316" href="#"></a></td>
<td><pre>    public BigDecimal add(BigDecimal augend, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1317" href="#"></a></td>
<td><pre>        if (mc.precision == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1318" href="#"></a></td>
<td><pre>            return add(augend);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1319" href="#"></a></td>
<td><pre>        BigDecimal lhs = this;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1320" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1321" href="#"></a></td>
<td><pre>        // If either number is zero then the other number, rounded and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1322" href="#"></a></td>
<td><pre>        // scaled if necessary, is used as the result.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1323" href="#"></a></td>
<td><pre>        {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1324" href="#"></a></td>
<td><pre>            boolean lhsIsZero = lhs.signum() == 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1325" href="#"></a></td>
<td><pre>            boolean augendIsZero = augend.signum() == 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1326" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1327" href="#"></a></td>
<td><pre>            if (lhsIsZero || augendIsZero) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1328" href="#"></a></td>
<td><pre>                int preferredScale = Math.max(lhs.scale(), augend.scale());</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1329" href="#"></a></td>
<td><pre>                BigDecimal result;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1330" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1331" href="#"></a></td>
<td><pre>                if (lhsIsZero &amp;&amp; augendIsZero)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1332" href="#"></a></td>
<td><pre>                    return zeroValueOf(preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1333" href="#"></a></td>
<td><pre>                result = lhsIsZero ? doRound(augend, mc) : doRound(lhs, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1334" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1335" href="#"></a></td>
<td><pre>                if (result.scale() == preferredScale)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1336" href="#"></a></td>
<td><pre>                    return result;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1337" href="#"></a></td>
<td><pre>                else if (result.scale() &gt; preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1338" href="#"></a></td>
<td><pre>                    return stripZerosToMatchScale(result.intVal, result.intCompact, result.scale, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1339" href="#"></a></td>
<td><pre>                } else { // result.scale &lt; preferredScale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1340" href="#"></a></td>
<td><pre>                    int precisionDiff = mc.precision - result.precision();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1341" href="#"></a></td>
<td><pre>                    int scaleDiff     = preferredScale - result.scale();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1342" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1343" href="#"></a></td>
<td><pre>                    if (precisionDiff &gt;= scaleDiff)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1344" href="#"></a></td>
<td><pre>                        return result.setScale(preferredScale); // can achieve target scale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1345" href="#"></a></td>
<td><pre>                    else</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1346" href="#"></a></td>
<td><pre>                        return result.setScale(result.scale() + precisionDiff);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1347" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1348" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1349" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1350" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1351" href="#"></a></td>
<td><pre>        long padding = (long) lhs.scale - augend.scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1352" href="#"></a></td>
<td><pre>        if (padding != 0) { // scales differ; alignment needed</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1353" href="#"></a></td>
<td><pre>            BigDecimal arg[] = preAlign(lhs, augend, padding, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1354" href="#"></a></td>
<td><pre>            matchScale(arg);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1355" href="#"></a></td>
<td><pre>            lhs = arg[0];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1356" href="#"></a></td>
<td><pre>            augend = arg[1];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1357" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1358" href="#"></a></td>
<td><pre>        return doRound(lhs.inflated().add(augend.inflated()), lhs.scale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1359" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1360" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1361" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1362" href="#"></a></td>
<td><pre>     * Returns an array of length two, the sum of whose entries is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1363" href="#"></a></td>
<td><pre>     * equal to the rounded sum of the {@code BigDecimal} arguments.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1364" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1365" href="#"></a></td>
<td><pre>     * &lt;p&gt;If the digit positions of the arguments have a sufficient</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1366" href="#"></a></td>
<td><pre>     * gap between them, the value smaller in magnitude can be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1367" href="#"></a></td>
<td><pre>     * condensed into a {@literal &quot;sticky bit&quot;} and the end result will</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1368" href="#"></a></td>
<td><pre>     * round the same way &lt;em&gt;if&lt;/em&gt; the precision of the final</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1369" href="#"></a></td>
<td><pre>     * result does not include the high order digit of the small</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1370" href="#"></a></td>
<td><pre>     * magnitude operand.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1371" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1372" href="#"></a></td>
<td><pre>     * &lt;p&gt;Note that while strictly speaking this is an optimization,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1373" href="#"></a></td>
<td><pre>     * it makes a much wider range of additions practical.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1374" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1375" href="#"></a></td>
<td><pre>     * &lt;p&gt;This corresponds to a pre-shift operation in a fixed</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1376" href="#"></a></td>
<td><pre>     * precision floating-point adder; this method is complicated by</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1377" href="#"></a></td>
<td><pre>     * variable precision of the result as determined by the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1378" href="#"></a></td>
<td><pre>     * MathContext.  A more nuanced operation could implement a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1379" href="#"></a></td>
<td><pre>     * {@literal &quot;right shift&quot;} on the smaller magnitude operand so</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1380" href="#"></a></td>
<td><pre>     * that the number of digits of the smaller operand could be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1381" href="#"></a></td>
<td><pre>     * reduced even though the significands partially overlapped.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1382" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1383" href="#"></a></td>
<td><pre>    private BigDecimal[] preAlign(BigDecimal lhs, BigDecimal augend, long padding, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1384" href="#"></a></td>
<td><pre>        assert padding != 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1385" href="#"></a></td>
<td><pre>        BigDecimal big;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1386" href="#"></a></td>
<td><pre>        BigDecimal small;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1387" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1388" href="#"></a></td>
<td><pre>        if (padding &lt; 0) { // lhs is big; augend is small</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1389" href="#"></a></td>
<td><pre>            big = lhs;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1390" href="#"></a></td>
<td><pre>            small = augend;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1391" href="#"></a></td>
<td><pre>        } else { // lhs is small; augend is big</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1392" href="#"></a></td>
<td><pre>            big = augend;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1393" href="#"></a></td>
<td><pre>            small = lhs;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1394" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1395" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1396" href="#"></a></td>
<td><pre>        /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1397" href="#"></a></td>
<td><pre>         * This is the estimated scale of an ulp of the result; it assumes that</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1398" href="#"></a></td>
<td><pre>         * the result doesn't have a carry-out on a true add (e.g. 999 + 1 =&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1399" href="#"></a></td>
<td><pre>         * 1000) or any subtractive cancellation on borrowing (e.g. 100 - 1.2 =&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1400" href="#"></a></td>
<td><pre>         * 98.8)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1401" href="#"></a></td>
<td><pre>         */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1402" href="#"></a></td>
<td><pre>        long estResultUlpScale = (long) big.scale - big.precision() + mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1403" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1404" href="#"></a></td>
<td><pre>        /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1405" href="#"></a></td>
<td><pre>         * The low-order digit position of big is big.scale().  This</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1406" href="#"></a></td>
<td><pre>         * is true regardless of whether big has a positive or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1407" href="#"></a></td>
<td><pre>         * negative scale.  The high-order digit position of small is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1408" href="#"></a></td>
<td><pre>         * small.scale - (small.precision() - 1).  To do the full</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1409" href="#"></a></td>
<td><pre>         * condensation, the digit positions of big and small must be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1410" href="#"></a></td>
<td><pre>         * disjoint *and* the digit positions of small should not be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1411" href="#"></a></td>
<td><pre>         * directly visible in the result.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1412" href="#"></a></td>
<td><pre>         */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1413" href="#"></a></td>
<td><pre>        long smallHighDigitPos = (long) small.scale - small.precision() + 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1414" href="#"></a></td>
<td><pre>        if (smallHighDigitPos &gt; big.scale + 2 &amp;&amp; // big and small disjoint</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1415" href="#"></a></td>
<td><pre>            smallHighDigitPos &gt; estResultUlpScale + 2) { // small digits not visible</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1416" href="#"></a></td>
<td><pre>            small = BigDecimal.valueOf(small.signum(), this.checkScale(Math.max(big.scale, estResultUlpScale) + 3));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1417" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1418" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1419" href="#"></a></td>
<td><pre>        // Since addition is symmetric, preserving input order in</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1420" href="#"></a></td>
<td><pre>        // returned operands doesn't matter</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1421" href="#"></a></td>
<td><pre>        BigDecimal[] result = {big, small};</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1422" href="#"></a></td>
<td><pre>        return result;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1423" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1424" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1425" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1426" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this -</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1427" href="#"></a></td>
<td><pre>     * subtrahend)}, and whose scale is {@code max(this.scale(),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1428" href="#"></a></td>
<td><pre>     * subtrahend.scale())}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1429" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1430" href="#"></a></td>
<td><pre>     * @param  subtrahend value to be subtracted from this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1431" href="#"></a></td>
<td><pre>     * @return {@code this - subtrahend}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1432" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1433" href="#"></a></td>
<td><pre>    public BigDecimal subtract(BigDecimal subtrahend) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1434" href="#"></a></td>
<td><pre>        if (this.intCompact != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1435" href="#"></a></td>
<td><pre>            if ((subtrahend.intCompact != INFLATED)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1436" href="#"></a></td>
<td><pre>                return add(this.intCompact, this.scale, -subtrahend.intCompact, subtrahend.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1437" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1438" href="#"></a></td>
<td><pre>                return add(this.intCompact, this.scale, subtrahend.intVal.negate(), subtrahend.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1439" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1440" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1441" href="#"></a></td>
<td><pre>            if ((subtrahend.intCompact != INFLATED)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1442" href="#"></a></td>
<td><pre>                // Pair of subtrahend values given before pair of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1443" href="#"></a></td>
<td><pre>                // values from this BigDecimal to avoid need for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1444" href="#"></a></td>
<td><pre>                // method overloading on the specialized add method</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1445" href="#"></a></td>
<td><pre>                return add(-subtrahend.intCompact, subtrahend.scale, this.intVal, this.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1446" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1447" href="#"></a></td>
<td><pre>                return add(this.intVal, this.scale, subtrahend.intVal.negate(), subtrahend.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1448" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1449" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1450" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1451" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1452" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1453" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this - subtrahend)},</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1454" href="#"></a></td>
<td><pre>     * with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1455" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1456" href="#"></a></td>
<td><pre>     * If {@code subtrahend} is zero then this, rounded if necessary, is used as the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1457" href="#"></a></td>
<td><pre>     * result.  If this is zero then the result is {@code subtrahend.negate(mc)}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1458" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1459" href="#"></a></td>
<td><pre>     * @param  subtrahend value to be subtracted from this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1460" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1461" href="#"></a></td>
<td><pre>     * @return {@code this - subtrahend}, rounded as necessary.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1462" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1463" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1464" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1465" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1466" href="#"></a></td>
<td><pre>    public BigDecimal subtract(BigDecimal subtrahend, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1467" href="#"></a></td>
<td><pre>        if (mc.precision == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1468" href="#"></a></td>
<td><pre>            return subtract(subtrahend);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1469" href="#"></a></td>
<td><pre>        // share the special rounding code in add()</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1470" href="#"></a></td>
<td><pre>        return add(subtrahend.negate(), mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1471" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1472" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1473" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1474" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is &lt;tt&gt;(this &amp;times;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1475" href="#"></a></td>
<td><pre>     * multiplicand)&lt;/tt&gt;, and whose scale is {@code (this.scale() +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1476" href="#"></a></td>
<td><pre>     * multiplicand.scale())}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1477" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1478" href="#"></a></td>
<td><pre>     * @param  multiplicand value to be multiplied by this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1479" href="#"></a></td>
<td><pre>     * @return {@code this * multiplicand}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1480" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1481" href="#"></a></td>
<td><pre>    public BigDecimal multiply(BigDecimal multiplicand) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1482" href="#"></a></td>
<td><pre>        int productScale = checkScale((long) scale + multiplicand.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1483" href="#"></a></td>
<td><pre>        if (this.intCompact != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1484" href="#"></a></td>
<td><pre>            if ((multiplicand.intCompact != INFLATED)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1485" href="#"></a></td>
<td><pre>                return multiply(this.intCompact, multiplicand.intCompact, productScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1486" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1487" href="#"></a></td>
<td><pre>                return multiply(this.intCompact, multiplicand.intVal, productScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1488" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1489" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1490" href="#"></a></td>
<td><pre>            if ((multiplicand.intCompact != INFLATED)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1491" href="#"></a></td>
<td><pre>                return multiply(multiplicand.intCompact, this.intVal, productScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1492" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1493" href="#"></a></td>
<td><pre>                return multiply(this.intVal, multiplicand.intVal, productScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1494" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1495" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1496" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1497" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1498" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1499" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is &lt;tt&gt;(this &amp;times;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1500" href="#"></a></td>
<td><pre>     * multiplicand)&lt;/tt&gt;, with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1501" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1502" href="#"></a></td>
<td><pre>     * @param  multiplicand value to be multiplied by this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1503" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1504" href="#"></a></td>
<td><pre>     * @return {@code this * multiplicand}, rounded as necessary.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1505" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1506" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1507" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1508" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1509" href="#"></a></td>
<td><pre>    public BigDecimal multiply(BigDecimal multiplicand, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1510" href="#"></a></td>
<td><pre>        if (mc.precision == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1511" href="#"></a></td>
<td><pre>            return multiply(multiplicand);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1512" href="#"></a></td>
<td><pre>        int productScale = checkScale((long) scale + multiplicand.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1513" href="#"></a></td>
<td><pre>        if (this.intCompact != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1514" href="#"></a></td>
<td><pre>            if ((multiplicand.intCompact != INFLATED)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1515" href="#"></a></td>
<td><pre>                return multiplyAndRound(this.intCompact, multiplicand.intCompact, productScale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1516" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1517" href="#"></a></td>
<td><pre>                return multiplyAndRound(this.intCompact, multiplicand.intVal, productScale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1518" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1519" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1520" href="#"></a></td>
<td><pre>            if ((multiplicand.intCompact != INFLATED)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1521" href="#"></a></td>
<td><pre>                return multiplyAndRound(multiplicand.intCompact, this.intVal, productScale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1522" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1523" href="#"></a></td>
<td><pre>                return multiplyAndRound(this.intVal, multiplicand.intVal, productScale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1524" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1525" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1526" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1527" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1528" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1529" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this /</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1530" href="#"></a></td>
<td><pre>     * divisor)}, and whose scale is as specified.  If rounding must</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1531" href="#"></a></td>
<td><pre>     * be performed to generate a result with the specified scale, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1532" href="#"></a></td>
<td><pre>     * specified rounding mode is applied.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1533" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1534" href="#"></a></td>
<td><pre>     * &lt;p&gt;The new {@link #divide(BigDecimal, int, RoundingMode)} method</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1535" href="#"></a></td>
<td><pre>     * should be used in preference to this legacy method.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1536" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1537" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1538" href="#"></a></td>
<td><pre>     * @param  scale scale of the {@code BigDecimal} quotient to be returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1539" href="#"></a></td>
<td><pre>     * @param  roundingMode rounding mode to apply.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1540" href="#"></a></td>
<td><pre>     * @return {@code this / divisor}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1541" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code divisor} is zero,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1542" href="#"></a></td>
<td><pre>     *         {@code roundingMode==ROUND_UNNECESSARY} and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1543" href="#"></a></td>
<td><pre>     *         the specified scale is insufficient to represent the result</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1544" href="#"></a></td>
<td><pre>     *         of the division exactly.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1545" href="#"></a></td>
<td><pre>     * @throws IllegalArgumentException if {@code roundingMode} does not</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1546" href="#"></a></td>
<td><pre>     *         represent a valid rounding mode.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1547" href="#"></a></td>
<td><pre>     * @see    #ROUND_UP</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1548" href="#"></a></td>
<td><pre>     * @see    #ROUND_DOWN</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1549" href="#"></a></td>
<td><pre>     * @see    #ROUND_CEILING</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1550" href="#"></a></td>
<td><pre>     * @see    #ROUND_FLOOR</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1551" href="#"></a></td>
<td><pre>     * @see    #ROUND_HALF_UP</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1552" href="#"></a></td>
<td><pre>     * @see    #ROUND_HALF_DOWN</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1553" href="#"></a></td>
<td><pre>     * @see    #ROUND_HALF_EVEN</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1554" href="#"></a></td>
<td><pre>     * @see    #ROUND_UNNECESSARY</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1555" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1556" href="#"></a></td>
<td><pre>    public BigDecimal divide(BigDecimal divisor, int scale, int roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1557" href="#"></a></td>
<td><pre>        if (roundingMode &lt; ROUND_UP || roundingMode &gt; ROUND_UNNECESSARY)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1558" href="#"></a></td>
<td><pre>            throw new IllegalArgumentException(&quot;Invalid rounding mode&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1559" href="#"></a></td>
<td><pre>        if (this.intCompact != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1560" href="#"></a></td>
<td><pre>            if ((divisor.intCompact != INFLATED)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1561" href="#"></a></td>
<td><pre>                return divide(this.intCompact, this.scale, divisor.intCompact, divisor.scale, scale, roundingMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1562" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1563" href="#"></a></td>
<td><pre>                return divide(this.intCompact, this.scale, divisor.intVal, divisor.scale, scale, roundingMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1564" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1565" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1566" href="#"></a></td>
<td><pre>            if ((divisor.intCompact != INFLATED)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1567" href="#"></a></td>
<td><pre>                return divide(this.intVal, this.scale, divisor.intCompact, divisor.scale, scale, roundingMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1568" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1569" href="#"></a></td>
<td><pre>                return divide(this.intVal, this.scale, divisor.intVal, divisor.scale, scale, roundingMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1570" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1571" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1572" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1573" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1574" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1575" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this /</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1576" href="#"></a></td>
<td><pre>     * divisor)}, and whose scale is as specified.  If rounding must</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1577" href="#"></a></td>
<td><pre>     * be performed to generate a result with the specified scale, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1578" href="#"></a></td>
<td><pre>     * specified rounding mode is applied.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1579" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1580" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1581" href="#"></a></td>
<td><pre>     * @param  scale scale of the {@code BigDecimal} quotient to be returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1582" href="#"></a></td>
<td><pre>     * @param  roundingMode rounding mode to apply.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1583" href="#"></a></td>
<td><pre>     * @return {@code this / divisor}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1584" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code divisor} is zero,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1585" href="#"></a></td>
<td><pre>     *         {@code roundingMode==RoundingMode.UNNECESSARY} and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1586" href="#"></a></td>
<td><pre>     *         the specified scale is insufficient to represent the result</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1587" href="#"></a></td>
<td><pre>     *         of the division exactly.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1588" href="#"></a></td>
<td><pre>     * @since 1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1589" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1590" href="#"></a></td>
<td><pre>    public BigDecimal divide(BigDecimal divisor, int scale, RoundingMode roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1591" href="#"></a></td>
<td><pre>        return divide(divisor, scale, roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1592" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1593" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1594" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1595" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this /</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1596" href="#"></a></td>
<td><pre>     * divisor)}, and whose scale is {@code this.scale()}.  If</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1597" href="#"></a></td>
<td><pre>     * rounding must be performed to generate a result with the given</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1598" href="#"></a></td>
<td><pre>     * scale, the specified rounding mode is applied.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1599" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1600" href="#"></a></td>
<td><pre>     * &lt;p&gt;The new {@link #divide(BigDecimal, RoundingMode)} method</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1601" href="#"></a></td>
<td><pre>     * should be used in preference to this legacy method.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1602" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1603" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1604" href="#"></a></td>
<td><pre>     * @param  roundingMode rounding mode to apply.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1605" href="#"></a></td>
<td><pre>     * @return {@code this / divisor}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1606" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code divisor==0}, or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1607" href="#"></a></td>
<td><pre>     *         {@code roundingMode==ROUND_UNNECESSARY} and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1608" href="#"></a></td>
<td><pre>     *         {@code this.scale()} is insufficient to represent the result</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1609" href="#"></a></td>
<td><pre>     *         of the division exactly.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1610" href="#"></a></td>
<td><pre>     * @throws IllegalArgumentException if {@code roundingMode} does not</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1611" href="#"></a></td>
<td><pre>     *         represent a valid rounding mode.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1612" href="#"></a></td>
<td><pre>     * @see    #ROUND_UP</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1613" href="#"></a></td>
<td><pre>     * @see    #ROUND_DOWN</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1614" href="#"></a></td>
<td><pre>     * @see    #ROUND_CEILING</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1615" href="#"></a></td>
<td><pre>     * @see    #ROUND_FLOOR</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1616" href="#"></a></td>
<td><pre>     * @see    #ROUND_HALF_UP</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1617" href="#"></a></td>
<td><pre>     * @see    #ROUND_HALF_DOWN</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1618" href="#"></a></td>
<td><pre>     * @see    #ROUND_HALF_EVEN</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1619" href="#"></a></td>
<td><pre>     * @see    #ROUND_UNNECESSARY</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1620" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1621" href="#"></a></td>
<td><pre>    public BigDecimal divide(BigDecimal divisor, int roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1622" href="#"></a></td>
<td><pre>        return this.divide(divisor, scale, roundingMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1623" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1624" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1625" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1626" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this /</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1627" href="#"></a></td>
<td><pre>     * divisor)}, and whose scale is {@code this.scale()}.  If</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1628" href="#"></a></td>
<td><pre>     * rounding must be performed to generate a result with the given</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1629" href="#"></a></td>
<td><pre>     * scale, the specified rounding mode is applied.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1630" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1631" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1632" href="#"></a></td>
<td><pre>     * @param  roundingMode rounding mode to apply.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1633" href="#"></a></td>
<td><pre>     * @return {@code this / divisor}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1634" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code divisor==0}, or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1635" href="#"></a></td>
<td><pre>     *         {@code roundingMode==RoundingMode.UNNECESSARY} and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1636" href="#"></a></td>
<td><pre>     *         {@code this.scale()} is insufficient to represent the result</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1637" href="#"></a></td>
<td><pre>     *         of the division exactly.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1638" href="#"></a></td>
<td><pre>     * @since 1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1639" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1640" href="#"></a></td>
<td><pre>    public BigDecimal divide(BigDecimal divisor, RoundingMode roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1641" href="#"></a></td>
<td><pre>        return this.divide(divisor, scale, roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1642" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1643" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1644" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1645" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this /</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1646" href="#"></a></td>
<td><pre>     * divisor)}, and whose preferred scale is {@code (this.scale() -</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1647" href="#"></a></td>
<td><pre>     * divisor.scale())}; if the exact quotient cannot be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1648" href="#"></a></td>
<td><pre>     * represented (because it has a non-terminating decimal</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1649" href="#"></a></td>
<td><pre>     * expansion) an {@code ArithmeticException} is thrown.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1650" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1651" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1652" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the exact quotient does not have a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1653" href="#"></a></td>
<td><pre>     *         terminating decimal expansion</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1654" href="#"></a></td>
<td><pre>     * @return {@code this / divisor}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1655" href="#"></a></td>
<td><pre>     * @since 1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1656" href="#"></a></td>
<td><pre>     * @author Joseph D. Darcy</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1657" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1658" href="#"></a></td>
<td><pre>    public BigDecimal divide(BigDecimal divisor) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1659" href="#"></a></td>
<td><pre>        /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1660" href="#"></a></td>
<td><pre>         * Handle zero cases first.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1661" href="#"></a></td>
<td><pre>         */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1662" href="#"></a></td>
<td><pre>        if (divisor.signum() == 0) {   // x/0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1663" href="#"></a></td>
<td><pre>            if (this.signum() == 0)    // 0/0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1664" href="#"></a></td>
<td><pre>                throw new ArithmeticException(&quot;Division undefined&quot;);  // NaN</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1665" href="#"></a></td>
<td><pre>            throw new ArithmeticException(&quot;Division by zero&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1666" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1667" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1668" href="#"></a></td>
<td><pre>        // Calculate preferred scale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1669" href="#"></a></td>
<td><pre>        int preferredScale = saturateLong((long) this.scale - divisor.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1670" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1671" href="#"></a></td>
<td><pre>        if (this.signum() == 0) // 0/y</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1672" href="#"></a></td>
<td><pre>            return zeroValueOf(preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1673" href="#"></a></td>
<td><pre>        else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1674" href="#"></a></td>
<td><pre>            /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1675" href="#"></a></td>
<td><pre>             * If the quotient this/divisor has a terminating decimal</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1676" href="#"></a></td>
<td><pre>             * expansion, the expansion can have no more than</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1677" href="#"></a></td>
<td><pre>             * (a.precision() + ceil(10*b.precision)/3) digits.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1678" href="#"></a></td>
<td><pre>             * Therefore, create a MathContext object with this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1679" href="#"></a></td>
<td><pre>             * precision and do a divide with the UNNECESSARY rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1680" href="#"></a></td>
<td><pre>             * mode.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1681" href="#"></a></td>
<td><pre>             */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1682" href="#"></a></td>
<td><pre>            MathContext mc = new MathContext( (int)Math.min(this.precision() +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1683" href="#"></a></td>
<td><pre>                                                            (long)Math.ceil(10.0*divisor.precision()/3.0),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1684" href="#"></a></td>
<td><pre>                                                            Integer.MAX_VALUE),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1685" href="#"></a></td>
<td><pre>                                              RoundingMode.UNNECESSARY);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1686" href="#"></a></td>
<td><pre>            BigDecimal quotient;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1687" href="#"></a></td>
<td><pre>            try {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1688" href="#"></a></td>
<td><pre>                quotient = this.divide(divisor, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1689" href="#"></a></td>
<td><pre>            } catch (ArithmeticException e) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1690" href="#"></a></td>
<td><pre>                throw new ArithmeticException(&quot;Non-terminating decimal expansion; &quot; +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1691" href="#"></a></td>
<td><pre>                                              &quot;no exact representable decimal result.&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1692" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1693" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1694" href="#"></a></td>
<td><pre>            int quotientScale = quotient.scale();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1695" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1696" href="#"></a></td>
<td><pre>            // divide(BigDecimal, mc) tries to adjust the quotient to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1697" href="#"></a></td>
<td><pre>            // the desired one by removing trailing zeros; since the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1698" href="#"></a></td>
<td><pre>            // exact divide method does not have an explicit digit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1699" href="#"></a></td>
<td><pre>            // limit, we can add zeros too.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1700" href="#"></a></td>
<td><pre>            if (preferredScale &gt; quotientScale)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1701" href="#"></a></td>
<td><pre>                return quotient.setScale(preferredScale, ROUND_UNNECESSARY);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1702" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1703" href="#"></a></td>
<td><pre>            return quotient;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1704" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1705" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1706" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1707" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1708" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this /</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1709" href="#"></a></td>
<td><pre>     * divisor)}, with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1710" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1711" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1712" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1713" href="#"></a></td>
<td><pre>     * @return {@code this / divisor}, rounded as necessary.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1714" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1715" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY} or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1716" href="#"></a></td>
<td><pre>     *         {@code mc.precision == 0} and the quotient has a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1717" href="#"></a></td>
<td><pre>     *         non-terminating decimal expansion.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1718" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1719" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1720" href="#"></a></td>
<td><pre>    public BigDecimal divide(BigDecimal divisor, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1721" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1722" href="#"></a></td>
<td><pre>        if (mcp == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1723" href="#"></a></td>
<td><pre>            return divide(divisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1724" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1725" href="#"></a></td>
<td><pre>        BigDecimal dividend = this;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1726" href="#"></a></td>
<td><pre>        long preferredScale = (long)dividend.scale - divisor.scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1727" href="#"></a></td>
<td><pre>        // Now calculate the answer.  We use the existing</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1728" href="#"></a></td>
<td><pre>        // divide-and-round method, but as this rounds to scale we have</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1729" href="#"></a></td>
<td><pre>        // to normalize the values here to achieve the desired result.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1730" href="#"></a></td>
<td><pre>        // For x/y we first handle y=0 and x=0, and then normalize x and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1731" href="#"></a></td>
<td><pre>        // y to give x' and y' with the following constraints:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1732" href="#"></a></td>
<td><pre>        //   (a) 0.1 &lt;= x' &lt; 1</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1733" href="#"></a></td>
<td><pre>        //   (b)  x' &lt;= y' &lt; 10*x'</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1734" href="#"></a></td>
<td><pre>        // Dividing x'/y' with the required scale set to mc.precision then</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1735" href="#"></a></td>
<td><pre>        // will give a result in the range 0.1 to 1 rounded to exactly</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1736" href="#"></a></td>
<td><pre>        // the right number of digits (except in the case of a result of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1737" href="#"></a></td>
<td><pre>        // 1.000... which can arise when x=y, or when rounding overflows</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1738" href="#"></a></td>
<td><pre>        // The 1.000... case will reduce properly to 1.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1739" href="#"></a></td>
<td><pre>        if (divisor.signum() == 0) {      // x/0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1740" href="#"></a></td>
<td><pre>            if (dividend.signum() == 0)    // 0/0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1741" href="#"></a></td>
<td><pre>                throw new ArithmeticException(&quot;Division undefined&quot;);  // NaN</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1742" href="#"></a></td>
<td><pre>            throw new ArithmeticException(&quot;Division by zero&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1743" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1744" href="#"></a></td>
<td><pre>        if (dividend.signum() == 0) // 0/y</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1745" href="#"></a></td>
<td><pre>            return zeroValueOf(saturateLong(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1746" href="#"></a></td>
<td><pre>        int xscale = dividend.precision();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1747" href="#"></a></td>
<td><pre>        int yscale = divisor.precision();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1748" href="#"></a></td>
<td><pre>        if(dividend.intCompact!=INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1749" href="#"></a></td>
<td><pre>            if(divisor.intCompact!=INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1750" href="#"></a></td>
<td><pre>                return divide(dividend.intCompact, xscale, divisor.intCompact, yscale, preferredScale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1751" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1752" href="#"></a></td>
<td><pre>                return divide(dividend.intCompact, xscale, divisor.intVal, yscale, preferredScale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1753" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1754" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1755" href="#"></a></td>
<td><pre>            if(divisor.intCompact!=INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1756" href="#"></a></td>
<td><pre>                return divide(dividend.intVal, xscale, divisor.intCompact, yscale, preferredScale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1757" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1758" href="#"></a></td>
<td><pre>                return divide(dividend.intVal, xscale, divisor.intVal, yscale, preferredScale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1759" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1760" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1761" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1762" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1763" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1764" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is the integer part</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1765" href="#"></a></td>
<td><pre>     * of the quotient {@code (this / divisor)} rounded down.  The</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1766" href="#"></a></td>
<td><pre>     * preferred scale of the result is {@code (this.scale() -</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1767" href="#"></a></td>
<td><pre>     * divisor.scale())}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1768" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1769" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1770" href="#"></a></td>
<td><pre>     * @return The integer part of {@code this / divisor}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1771" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code divisor==0}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1772" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1773" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1774" href="#"></a></td>
<td><pre>    public BigDecimal divideToIntegralValue(BigDecimal divisor) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1775" href="#"></a></td>
<td><pre>        // Calculate preferred scale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1776" href="#"></a></td>
<td><pre>        int preferredScale = saturateLong((long) this.scale - divisor.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1777" href="#"></a></td>
<td><pre>        if (this.compareMagnitude(divisor) &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1778" href="#"></a></td>
<td><pre>            // much faster when this &lt;&lt; divisor</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1779" href="#"></a></td>
<td><pre>            return zeroValueOf(preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1780" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1781" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1782" href="#"></a></td>
<td><pre>        if (this.signum() == 0 &amp;&amp; divisor.signum() != 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1783" href="#"></a></td>
<td><pre>            return this.setScale(preferredScale, ROUND_UNNECESSARY);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1784" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1785" href="#"></a></td>
<td><pre>        // Perform a divide with enough digits to round to a correct</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1786" href="#"></a></td>
<td><pre>        // integer value; then remove any fractional digits</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1787" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1788" href="#"></a></td>
<td><pre>        int maxDigits = (int)Math.min(this.precision() +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1789" href="#"></a></td>
<td><pre>                                      (long)Math.ceil(10.0*divisor.precision()/3.0) +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1790" href="#"></a></td>
<td><pre>                                      Math.abs((long)this.scale() - divisor.scale()) + 2,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1791" href="#"></a></td>
<td><pre>                                      Integer.MAX_VALUE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1792" href="#"></a></td>
<td><pre>        BigDecimal quotient = this.divide(divisor, new MathContext(maxDigits,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1793" href="#"></a></td>
<td><pre>                                                                   RoundingMode.DOWN));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1794" href="#"></a></td>
<td><pre>        if (quotient.scale &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1795" href="#"></a></td>
<td><pre>            quotient = quotient.setScale(0, RoundingMode.DOWN);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1796" href="#"></a></td>
<td><pre>            quotient = stripZerosToMatchScale(quotient.intVal, quotient.intCompact, quotient.scale, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1797" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1798" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1799" href="#"></a></td>
<td><pre>        if (quotient.scale &lt; preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1800" href="#"></a></td>
<td><pre>            // pad with zeros if necessary</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1801" href="#"></a></td>
<td><pre>            quotient = quotient.setScale(preferredScale, ROUND_UNNECESSARY);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1802" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1803" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1804" href="#"></a></td>
<td><pre>        return quotient;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1805" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1806" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1807" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1808" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is the integer part</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1809" href="#"></a></td>
<td><pre>     * of {@code (this / divisor)}.  Since the integer part of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1810" href="#"></a></td>
<td><pre>     * exact quotient does not depend on the rounding mode, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1811" href="#"></a></td>
<td><pre>     * rounding mode does not affect the values returned by this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1812" href="#"></a></td>
<td><pre>     * method.  The preferred scale of the result is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1813" href="#"></a></td>
<td><pre>     * {@code (this.scale() - divisor.scale())}.  An</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1814" href="#"></a></td>
<td><pre>     * {@code ArithmeticException} is thrown if the integer part of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1815" href="#"></a></td>
<td><pre>     * the exact quotient needs more than {@code mc.precision}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1816" href="#"></a></td>
<td><pre>     * digits.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1817" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1818" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1819" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1820" href="#"></a></td>
<td><pre>     * @return The integer part of {@code this / divisor}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1821" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code divisor==0}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1822" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code mc.precision} {@literal &gt;} 0 and the result</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1823" href="#"></a></td>
<td><pre>     *         requires a precision of more than {@code mc.precision} digits.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1824" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1825" href="#"></a></td>
<td><pre>     * @author Joseph D. Darcy</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1826" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1827" href="#"></a></td>
<td><pre>    public BigDecimal divideToIntegralValue(BigDecimal divisor, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1828" href="#"></a></td>
<td><pre>        if (mc.precision == 0 || // exact result</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1829" href="#"></a></td>
<td><pre>            (this.compareMagnitude(divisor) &lt; 0)) // zero result</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1830" href="#"></a></td>
<td><pre>            return divideToIntegralValue(divisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1831" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1832" href="#"></a></td>
<td><pre>        // Calculate preferred scale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1833" href="#"></a></td>
<td><pre>        int preferredScale = saturateLong((long)this.scale - divisor.scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1834" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1835" href="#"></a></td>
<td><pre>        /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1836" href="#"></a></td>
<td><pre>         * Perform a normal divide to mc.precision digits.  If the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1837" href="#"></a></td>
<td><pre>         * remainder has absolute value less than the divisor, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1838" href="#"></a></td>
<td><pre>         * integer portion of the quotient fits into mc.precision</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1839" href="#"></a></td>
<td><pre>         * digits.  Next, remove any fractional digits from the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1840" href="#"></a></td>
<td><pre>         * quotient and adjust the scale to the preferred value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1841" href="#"></a></td>
<td><pre>         */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1842" href="#"></a></td>
<td><pre>        BigDecimal result = this.divide(divisor, new MathContext(mc.precision, RoundingMode.DOWN));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1843" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1844" href="#"></a></td>
<td><pre>        if (result.scale() &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1845" href="#"></a></td>
<td><pre>            /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1846" href="#"></a></td>
<td><pre>             * Result is an integer. See if quotient represents the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1847" href="#"></a></td>
<td><pre>             * full integer portion of the exact quotient; if it does,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1848" href="#"></a></td>
<td><pre>             * the computed remainder will be less than the divisor.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1849" href="#"></a></td>
<td><pre>             */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1850" href="#"></a></td>
<td><pre>            BigDecimal product = result.multiply(divisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1851" href="#"></a></td>
<td><pre>            // If the quotient is the full integer value,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1852" href="#"></a></td>
<td><pre>            // |dividend-product| &lt; |divisor|.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1853" href="#"></a></td>
<td><pre>            if (this.subtract(product).compareMagnitude(divisor) &gt;= 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1854" href="#"></a></td>
<td><pre>                throw new ArithmeticException(&quot;Division impossible&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1855" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1856" href="#"></a></td>
<td><pre>        } else if (result.scale() &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1857" href="#"></a></td>
<td><pre>            /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1858" href="#"></a></td>
<td><pre>             * Integer portion of quotient will fit into precision</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1859" href="#"></a></td>
<td><pre>             * digits; recompute quotient to scale 0 to avoid double</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1860" href="#"></a></td>
<td><pre>             * rounding and then try to adjust, if necessary.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1861" href="#"></a></td>
<td><pre>             */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1862" href="#"></a></td>
<td><pre>            result = result.setScale(0, RoundingMode.DOWN);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1863" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1864" href="#"></a></td>
<td><pre>        // else result.scale() == 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1865" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1866" href="#"></a></td>
<td><pre>        int precisionDiff;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1867" href="#"></a></td>
<td><pre>        if ((preferredScale &gt; result.scale()) &amp;&amp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1868" href="#"></a></td>
<td><pre>            (precisionDiff = mc.precision - result.precision()) &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1869" href="#"></a></td>
<td><pre>            return result.setScale(result.scale() +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1870" href="#"></a></td>
<td><pre>                                   Math.min(precisionDiff, preferredScale - result.scale) );</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1871" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1872" href="#"></a></td>
<td><pre>            return stripZerosToMatchScale(result.intVal,result.intCompact,result.scale,preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1873" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1874" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1875" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1876" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1877" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this % divisor)}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1878" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1879" href="#"></a></td>
<td><pre>     * &lt;p&gt;The remainder is given by</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1880" href="#"></a></td>
<td><pre>     * {@code this.subtract(this.divideToIntegralValue(divisor).multiply(divisor))}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1881" href="#"></a></td>
<td><pre>     * Note that this is not the modulo operation (the result can be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1882" href="#"></a></td>
<td><pre>     * negative).</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1883" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1884" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1885" href="#"></a></td>
<td><pre>     * @return {@code this % divisor}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1886" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code divisor==0}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1887" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1888" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1889" href="#"></a></td>
<td><pre>    public BigDecimal remainder(BigDecimal divisor) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1890" href="#"></a></td>
<td><pre>        BigDecimal divrem[] = this.divideAndRemainder(divisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1891" href="#"></a></td>
<td><pre>        return divrem[1];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1892" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1893" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1894" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1895" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1896" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (this %</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1897" href="#"></a></td>
<td><pre>     * divisor)}, with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1898" href="#"></a></td>
<td><pre>     * The {@code MathContext} settings affect the implicit divide</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1899" href="#"></a></td>
<td><pre>     * used to compute the remainder.  The remainder computation</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1900" href="#"></a></td>
<td><pre>     * itself is by definition exact.  Therefore, the remainder may</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1901" href="#"></a></td>
<td><pre>     * contain more than {@code mc.getPrecision()} digits.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1902" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1903" href="#"></a></td>
<td><pre>     * &lt;p&gt;The remainder is given by</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1904" href="#"></a></td>
<td><pre>     * {@code this.subtract(this.divideToIntegralValue(divisor,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1905" href="#"></a></td>
<td><pre>     * mc).multiply(divisor))}.  Note that this is not the modulo</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1906" href="#"></a></td>
<td><pre>     * operation (the result can be negative).</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1907" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1908" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1909" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1910" href="#"></a></td>
<td><pre>     * @return {@code this % divisor}, rounded as necessary.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1911" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code divisor==0}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1912" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1913" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}, or {@code mc.precision}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1914" href="#"></a></td>
<td><pre>     *         {@literal &gt;} 0 and the result of {@code this.divideToIntgralValue(divisor)} would</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1915" href="#"></a></td>
<td><pre>     *         require a precision of more than {@code mc.precision} digits.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1916" href="#"></a></td>
<td><pre>     * @see    #divideToIntegralValue(java.math.BigDecimal, java.math.MathContext)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1917" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1918" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1919" href="#"></a></td>
<td><pre>    public BigDecimal remainder(BigDecimal divisor, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1920" href="#"></a></td>
<td><pre>        BigDecimal divrem[] = this.divideAndRemainder(divisor, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1921" href="#"></a></td>
<td><pre>        return divrem[1];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1922" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1923" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1924" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1925" href="#"></a></td>
<td><pre>     * Returns a two-element {@code BigDecimal} array containing the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1926" href="#"></a></td>
<td><pre>     * result of {@code divideToIntegralValue} followed by the result of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1927" href="#"></a></td>
<td><pre>     * {@code remainder} on the two operands.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1928" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1929" href="#"></a></td>
<td><pre>     * &lt;p&gt;Note that if both the integer quotient and remainder are</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1930" href="#"></a></td>
<td><pre>     * needed, this method is faster than using the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1931" href="#"></a></td>
<td><pre>     * {@code divideToIntegralValue} and {@code remainder} methods</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1932" href="#"></a></td>
<td><pre>     * separately because the division need only be carried out once.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1933" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1934" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1935" href="#"></a></td>
<td><pre>     *         and the remainder computed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1936" href="#"></a></td>
<td><pre>     * @return a two element {@code BigDecimal} array: the quotient</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1937" href="#"></a></td>
<td><pre>     *         (the result of {@code divideToIntegralValue}) is the initial element</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1938" href="#"></a></td>
<td><pre>     *         and the remainder is the final element.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1939" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code divisor==0}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1940" href="#"></a></td>
<td><pre>     * @see    #divideToIntegralValue(java.math.BigDecimal, java.math.MathContext)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1941" href="#"></a></td>
<td><pre>     * @see    #remainder(java.math.BigDecimal, java.math.MathContext)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1942" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1943" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1944" href="#"></a></td>
<td><pre>    public BigDecimal[] divideAndRemainder(BigDecimal divisor) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1945" href="#"></a></td>
<td><pre>        // we use the identity  x = i * y + r to determine r</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1946" href="#"></a></td>
<td><pre>        BigDecimal[] result = new BigDecimal[2];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1947" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1948" href="#"></a></td>
<td><pre>        result[0] = this.divideToIntegralValue(divisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1949" href="#"></a></td>
<td><pre>        result[1] = this.subtract(result[0].multiply(divisor));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1950" href="#"></a></td>
<td><pre>        return result;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1951" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1952" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1953" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1954" href="#"></a></td>
<td><pre>     * Returns a two-element {@code BigDecimal} array containing the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1955" href="#"></a></td>
<td><pre>     * result of {@code divideToIntegralValue} followed by the result of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1956" href="#"></a></td>
<td><pre>     * {@code remainder} on the two operands calculated with rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1957" href="#"></a></td>
<td><pre>     * according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1958" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1959" href="#"></a></td>
<td><pre>     * &lt;p&gt;Note that if both the integer quotient and remainder are</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1960" href="#"></a></td>
<td><pre>     * needed, this method is faster than using the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1961" href="#"></a></td>
<td><pre>     * {@code divideToIntegralValue} and {@code remainder} methods</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1962" href="#"></a></td>
<td><pre>     * separately because the division need only be carried out once.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1963" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1964" href="#"></a></td>
<td><pre>     * @param  divisor value by which this {@code BigDecimal} is to be divided,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1965" href="#"></a></td>
<td><pre>     *         and the remainder computed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1966" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1967" href="#"></a></td>
<td><pre>     * @return a two element {@code BigDecimal} array: the quotient</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1968" href="#"></a></td>
<td><pre>     *         (the result of {@code divideToIntegralValue}) is the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1969" href="#"></a></td>
<td><pre>     *         initial element and the remainder is the final element.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1970" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code divisor==0}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1971" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1972" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}, or {@code mc.precision}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1973" href="#"></a></td>
<td><pre>     *         {@literal &gt;} 0 and the result of {@code this.divideToIntgralValue(divisor)} would</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1974" href="#"></a></td>
<td><pre>     *         require a precision of more than {@code mc.precision} digits.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1975" href="#"></a></td>
<td><pre>     * @see    #divideToIntegralValue(java.math.BigDecimal, java.math.MathContext)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1976" href="#"></a></td>
<td><pre>     * @see    #remainder(java.math.BigDecimal, java.math.MathContext)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1977" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1978" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1979" href="#"></a></td>
<td><pre>    public BigDecimal[] divideAndRemainder(BigDecimal divisor, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1980" href="#"></a></td>
<td><pre>        if (mc.precision == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1981" href="#"></a></td>
<td><pre>            return divideAndRemainder(divisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1982" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1983" href="#"></a></td>
<td><pre>        BigDecimal[] result = new BigDecimal[2];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1984" href="#"></a></td>
<td><pre>        BigDecimal lhs = this;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1985" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1986" href="#"></a></td>
<td><pre>        result[0] = lhs.divideToIntegralValue(divisor, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1987" href="#"></a></td>
<td><pre>        result[1] = lhs.subtract(result[0].multiply(divisor));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1988" href="#"></a></td>
<td><pre>        return result;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1989" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1990" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1991" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1992" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1993" href="#"></a></td>
<td><pre>     * &lt;tt&gt;(this&lt;sup&gt;n&lt;/sup&gt;)&lt;/tt&gt;, The power is computed exactly, to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1994" href="#"></a></td>
<td><pre>     * unlimited precision.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1995" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1996" href="#"></a></td>
<td><pre>     * &lt;p&gt;The parameter {@code n} must be in the range 0 through</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1997" href="#"></a></td>
<td><pre>     * 999999999, inclusive.  {@code ZERO.pow(0)} returns {@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1998" href="#"></a></td>
<td><pre>     * #ONE}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="1999" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2000" href="#"></a></td>
<td><pre>     * Note that future releases may expand the allowable exponent</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2001" href="#"></a></td>
<td><pre>     * range of this method.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2002" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2003" href="#"></a></td>
<td><pre>     * @param  n power to raise this {@code BigDecimal} to.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2004" href="#"></a></td>
<td><pre>     * @return &lt;tt&gt;this&lt;sup&gt;n&lt;/sup&gt;&lt;/tt&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2005" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code n} is out of range.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2006" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2007" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2008" href="#"></a></td>
<td><pre>    public BigDecimal pow(int n) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2009" href="#"></a></td>
<td><pre>        if (n &lt; 0 || n &gt; 999999999)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2010" href="#"></a></td>
<td><pre>            throw new ArithmeticException(&quot;Invalid operation&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2011" href="#"></a></td>
<td><pre>        // No need to calculate pow(n) if result will over/underflow.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2012" href="#"></a></td>
<td><pre>        // Don't attempt to support &quot;supernormal&quot; numbers.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2013" href="#"></a></td>
<td><pre>        int newScale = checkScale((long)scale * n);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2014" href="#"></a></td>
<td><pre>        return new BigDecimal(this.inflated().pow(n), newScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2015" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2016" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2017" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2018" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2019" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2020" href="#"></a></td>
<td><pre>     * &lt;tt&gt;(this&lt;sup&gt;n&lt;/sup&gt;)&lt;/tt&gt;.  The current implementation uses</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2021" href="#"></a></td>
<td><pre>     * the core algorithm defined in ANSI standard X3.274-1996 with</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2022" href="#"></a></td>
<td><pre>     * rounding according to the context settings.  In general, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2023" href="#"></a></td>
<td><pre>     * returned numerical value is within two ulps of the exact</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2024" href="#"></a></td>
<td><pre>     * numerical value for the chosen precision.  Note that future</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2025" href="#"></a></td>
<td><pre>     * releases may use a different algorithm with a decreased</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2026" href="#"></a></td>
<td><pre>     * allowable error bound and increased allowable exponent range.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2027" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2028" href="#"></a></td>
<td><pre>     * &lt;p&gt;The X3.274-1996 algorithm is:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2029" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2030" href="#"></a></td>
<td><pre>     * &lt;ul&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2031" href="#"></a></td>
<td><pre>     * &lt;li&gt; An {@code ArithmeticException} exception is thrown if</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2032" href="#"></a></td>
<td><pre>     *  &lt;ul&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2033" href="#"></a></td>
<td><pre>     *    &lt;li&gt;{@code abs(n) &gt; 999999999}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2034" href="#"></a></td>
<td><pre>     *    &lt;li&gt;{@code mc.precision == 0} and {@code n &lt; 0}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2035" href="#"></a></td>
<td><pre>     *    &lt;li&gt;{@code mc.precision &gt; 0} and {@code n} has more than</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2036" href="#"></a></td>
<td><pre>     *    {@code mc.precision} decimal digits</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2037" href="#"></a></td>
<td><pre>     *  &lt;/ul&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2038" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2039" href="#"></a></td>
<td><pre>     * &lt;li&gt; if {@code n} is zero, {@link #ONE} is returned even if</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2040" href="#"></a></td>
<td><pre>     * {@code this} is zero, otherwise</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2041" href="#"></a></td>
<td><pre>     * &lt;ul&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2042" href="#"></a></td>
<td><pre>     *   &lt;li&gt; if {@code n} is positive, the result is calculated via</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2043" href="#"></a></td>
<td><pre>     *   the repeated squaring technique into a single accumulator.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2044" href="#"></a></td>
<td><pre>     *   The individual multiplications with the accumulator use the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2045" href="#"></a></td>
<td><pre>     *   same math context settings as in {@code mc} except for a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2046" href="#"></a></td>
<td><pre>     *   precision increased to {@code mc.precision + elength + 1}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2047" href="#"></a></td>
<td><pre>     *   where {@code elength} is the number of decimal digits in</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2048" href="#"></a></td>
<td><pre>     *   {@code n}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2049" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2050" href="#"></a></td>
<td><pre>     *   &lt;li&gt; if {@code n} is negative, the result is calculated as if</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2051" href="#"></a></td>
<td><pre>     *   {@code n} were positive; this value is then divided into one</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2052" href="#"></a></td>
<td><pre>     *   using the working precision specified above.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2053" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2054" href="#"></a></td>
<td><pre>     *   &lt;li&gt; The final value from either the positive or negative case</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2055" href="#"></a></td>
<td><pre>     *   is then rounded to the destination precision.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2056" href="#"></a></td>
<td><pre>     *   &lt;/ul&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2057" href="#"></a></td>
<td><pre>     * &lt;/ul&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2058" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2059" href="#"></a></td>
<td><pre>     * @param  n power to raise this {@code BigDecimal} to.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2060" href="#"></a></td>
<td><pre>     * @param  mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2061" href="#"></a></td>
<td><pre>     * @return &lt;tt&gt;this&lt;sup&gt;n&lt;/sup&gt;&lt;/tt&gt; using the ANSI standard X3.274-1996</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2062" href="#"></a></td>
<td><pre>     *         algorithm</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2063" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2064" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}, or {@code n} is out</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2065" href="#"></a></td>
<td><pre>     *         of range.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2066" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2067" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2068" href="#"></a></td>
<td><pre>    public BigDecimal pow(int n, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2069" href="#"></a></td>
<td><pre>        if (mc.precision == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2070" href="#"></a></td>
<td><pre>            return pow(n);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2071" href="#"></a></td>
<td><pre>        if (n &lt; -999999999 || n &gt; 999999999)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2072" href="#"></a></td>
<td><pre>            throw new ArithmeticException(&quot;Invalid operation&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2073" href="#"></a></td>
<td><pre>        if (n == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2074" href="#"></a></td>
<td><pre>            return ONE;                      // x**0 == 1 in X3.274</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2075" href="#"></a></td>
<td><pre>        BigDecimal lhs = this;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2076" href="#"></a></td>
<td><pre>        MathContext workmc = mc;           // working settings</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2077" href="#"></a></td>
<td><pre>        int mag = Math.abs(n);               // magnitude of n</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2078" href="#"></a></td>
<td><pre>        if (mc.precision &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2079" href="#"></a></td>
<td><pre>            int elength = longDigitLength(mag); // length of n in digits</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2080" href="#"></a></td>
<td><pre>            if (elength &gt; mc.precision)        // X3.274 rule</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2081" href="#"></a></td>
<td><pre>                throw new ArithmeticException(&quot;Invalid operation&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2082" href="#"></a></td>
<td><pre>            workmc = new MathContext(mc.precision + elength + 1,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2083" href="#"></a></td>
<td><pre>                                      mc.roundingMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2084" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2085" href="#"></a></td>
<td><pre>        // ready to carry out power calculation...</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2086" href="#"></a></td>
<td><pre>        BigDecimal acc = ONE;           // accumulator</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2087" href="#"></a></td>
<td><pre>        boolean seenbit = false;        // set once we've seen a 1-bit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2088" href="#"></a></td>
<td><pre>        for (int i=1;;i++) {            // for each bit [top bit ignored]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2089" href="#"></a></td>
<td><pre>            mag += mag;                 // shift left 1 bit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2090" href="#"></a></td>
<td><pre>            if (mag &lt; 0) {              // top bit is set</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2091" href="#"></a></td>
<td><pre>                seenbit = true;         // OK, we're off</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2092" href="#"></a></td>
<td><pre>                acc = acc.multiply(lhs, workmc); // acc=acc*x</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2093" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2094" href="#"></a></td>
<td><pre>            if (i == 31)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2095" href="#"></a></td>
<td><pre>                break;                  // that was the last bit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2096" href="#"></a></td>
<td><pre>            if (seenbit)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2097" href="#"></a></td>
<td><pre>                acc=acc.multiply(acc, workmc);   // acc=acc*acc [square]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2098" href="#"></a></td>
<td><pre>                // else (!seenbit) no point in squaring ONE</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2099" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2100" href="#"></a></td>
<td><pre>        // if negative n, calculate the reciprocal using working precision</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2101" href="#"></a></td>
<td><pre>        if (n &lt; 0) // [hence mc.precision&gt;0]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2102" href="#"></a></td>
<td><pre>            acc=ONE.divide(acc, workmc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2103" href="#"></a></td>
<td><pre>        // round to final precision and strip zeros</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2104" href="#"></a></td>
<td><pre>        return doRound(acc, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2105" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2106" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2107" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2108" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is the absolute value</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2109" href="#"></a></td>
<td><pre>     * of this {@code BigDecimal}, and whose scale is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2110" href="#"></a></td>
<td><pre>     * {@code this.scale()}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2111" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2112" href="#"></a></td>
<td><pre>     * @return {@code abs(this)}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2113" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2114" href="#"></a></td>
<td><pre>    public BigDecimal abs() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2115" href="#"></a></td>
<td><pre>        return (signum() &lt; 0 ? negate() : this);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2116" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2117" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2118" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2119" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is the absolute value</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2120" href="#"></a></td>
<td><pre>     * of this {@code BigDecimal}, with rounding according to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2121" href="#"></a></td>
<td><pre>     * context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2122" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2123" href="#"></a></td>
<td><pre>     * @param mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2124" href="#"></a></td>
<td><pre>     * @return {@code abs(this)}, rounded as necessary.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2125" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2126" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2127" href="#"></a></td>
<td><pre>     * @since 1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2128" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2129" href="#"></a></td>
<td><pre>    public BigDecimal abs(MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2130" href="#"></a></td>
<td><pre>        return (signum() &lt; 0 ? negate(mc) : plus(mc));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2131" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2132" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2133" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2134" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (-this)},</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2135" href="#"></a></td>
<td><pre>     * and whose scale is {@code this.scale()}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2136" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2137" href="#"></a></td>
<td><pre>     * @return {@code -this}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2138" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2139" href="#"></a></td>
<td><pre>    public BigDecimal negate() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2140" href="#"></a></td>
<td><pre>        if (intCompact == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2141" href="#"></a></td>
<td><pre>            return new BigDecimal(intVal.negate(), INFLATED, scale, precision);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2142" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2143" href="#"></a></td>
<td><pre>            return valueOf(-intCompact, scale, precision);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2144" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2145" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2146" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2147" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2148" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (-this)},</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2149" href="#"></a></td>
<td><pre>     * with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2150" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2151" href="#"></a></td>
<td><pre>     * @param mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2152" href="#"></a></td>
<td><pre>     * @return {@code -this}, rounded as necessary.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2153" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2154" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2155" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2156" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2157" href="#"></a></td>
<td><pre>    public BigDecimal negate(MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2158" href="#"></a></td>
<td><pre>        return negate().plus(mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2159" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2160" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2161" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2162" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (+this)}, and whose</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2163" href="#"></a></td>
<td><pre>     * scale is {@code this.scale()}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2164" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2165" href="#"></a></td>
<td><pre>     * &lt;p&gt;This method, which simply returns this {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2166" href="#"></a></td>
<td><pre>     * is included for symmetry with the unary minus method {@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2167" href="#"></a></td>
<td><pre>     * #negate()}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2168" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2169" href="#"></a></td>
<td><pre>     * @return {@code this}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2170" href="#"></a></td>
<td><pre>     * @see #negate()</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2171" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2172" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2173" href="#"></a></td>
<td><pre>    public BigDecimal plus() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2174" href="#"></a></td>
<td><pre>        return this;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2175" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2176" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2177" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2178" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (+this)},</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2179" href="#"></a></td>
<td><pre>     * with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2180" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2181" href="#"></a></td>
<td><pre>     * &lt;p&gt;The effect of this method is identical to that of the {@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2182" href="#"></a></td>
<td><pre>     * #round(MathContext)} method.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2183" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2184" href="#"></a></td>
<td><pre>     * @param mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2185" href="#"></a></td>
<td><pre>     * @return {@code this}, rounded as necessary.  A zero result will</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2186" href="#"></a></td>
<td><pre>     *         have a scale of 0.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2187" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the result is inexact but the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2188" href="#"></a></td>
<td><pre>     *         rounding mode is {@code UNNECESSARY}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2189" href="#"></a></td>
<td><pre>     * @see    #round(MathContext)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2190" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2191" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2192" href="#"></a></td>
<td><pre>    public BigDecimal plus(MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2193" href="#"></a></td>
<td><pre>        if (mc.precision == 0)                 // no rounding please</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2194" href="#"></a></td>
<td><pre>            return this;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2195" href="#"></a></td>
<td><pre>        return doRound(this, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2196" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2197" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2198" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2199" href="#"></a></td>
<td><pre>     * Returns the signum function of this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2200" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2201" href="#"></a></td>
<td><pre>     * @return -1, 0, or 1 as the value of this {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2202" href="#"></a></td>
<td><pre>     *         is negative, zero, or positive.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2203" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2204" href="#"></a></td>
<td><pre>    public int signum() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2205" href="#"></a></td>
<td><pre>        return (intCompact != INFLATED)?</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2206" href="#"></a></td>
<td><pre>            Long.signum(intCompact):</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2207" href="#"></a></td>
<td><pre>            intVal.signum();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2208" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2209" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2210" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2211" href="#"></a></td>
<td><pre>     * Returns the &lt;i&gt;scale&lt;/i&gt; of this {@code BigDecimal}.  If zero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2212" href="#"></a></td>
<td><pre>     * or positive, the scale is the number of digits to the right of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2213" href="#"></a></td>
<td><pre>     * the decimal point.  If negative, the unscaled value of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2214" href="#"></a></td>
<td><pre>     * number is multiplied by ten to the power of the negation of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2215" href="#"></a></td>
<td><pre>     * scale.  For example, a scale of {@code -3} means the unscaled</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2216" href="#"></a></td>
<td><pre>     * value is multiplied by 1000.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2217" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2218" href="#"></a></td>
<td><pre>     * @return the scale of this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2219" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2220" href="#"></a></td>
<td><pre>    public int scale() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2221" href="#"></a></td>
<td><pre>        return scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2222" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2223" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2224" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2225" href="#"></a></td>
<td><pre>     * Returns the &lt;i&gt;precision&lt;/i&gt; of this {@code BigDecimal}.  (The</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2226" href="#"></a></td>
<td><pre>     * precision is the number of digits in the unscaled value.)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2227" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2228" href="#"></a></td>
<td><pre>     * &lt;p&gt;The precision of a zero value is 1.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2229" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2230" href="#"></a></td>
<td><pre>     * @return the precision of this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2231" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2232" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2233" href="#"></a></td>
<td><pre>    public int precision() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2234" href="#"></a></td>
<td><pre>        int result = precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2235" href="#"></a></td>
<td><pre>        if (result == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2236" href="#"></a></td>
<td><pre>            long s = intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2237" href="#"></a></td>
<td><pre>            if (s != INFLATED)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2238" href="#"></a></td>
<td><pre>                result = longDigitLength(s);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2239" href="#"></a></td>
<td><pre>            else</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2240" href="#"></a></td>
<td><pre>                result = bigDigitLength(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2241" href="#"></a></td>
<td><pre>            precision = result;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2242" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2243" href="#"></a></td>
<td><pre>        return result;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2244" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2245" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2246" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2247" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2248" href="#"></a></td>
<td><pre>     * Returns a {@code BigInteger} whose value is the &lt;i&gt;unscaled</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2249" href="#"></a></td>
<td><pre>     * value&lt;/i&gt; of this {@code BigDecimal}.  (Computes &lt;tt&gt;(this *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2250" href="#"></a></td>
<td><pre>     * 10&lt;sup&gt;this.scale()&lt;/sup&gt;)&lt;/tt&gt;.)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2251" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2252" href="#"></a></td>
<td><pre>     * @return the unscaled value of this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2253" href="#"></a></td>
<td><pre>     * @since  1.2</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2254" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2255" href="#"></a></td>
<td><pre>    public BigInteger unscaledValue() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2256" href="#"></a></td>
<td><pre>        return this.inflated();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2257" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2258" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2259" href="#"></a></td>
<td><pre>    // Rounding Modes</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2260" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2261" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2262" href="#"></a></td>
<td><pre>     * Rounding mode to round away from zero.  Always increments the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2263" href="#"></a></td>
<td><pre>     * digit prior to a nonzero discarded fraction.  Note that this rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2264" href="#"></a></td>
<td><pre>     * mode never decreases the magnitude of the calculated value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2265" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2266" href="#"></a></td>
<td><pre>    public final static int ROUND_UP =           0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2267" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2268" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2269" href="#"></a></td>
<td><pre>     * Rounding mode to round towards zero.  Never increments the digit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2270" href="#"></a></td>
<td><pre>     * prior to a discarded fraction (i.e., truncates).  Note that this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2271" href="#"></a></td>
<td><pre>     * rounding mode never increases the magnitude of the calculated value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2272" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2273" href="#"></a></td>
<td><pre>    public final static int ROUND_DOWN =         1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2274" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2275" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2276" href="#"></a></td>
<td><pre>     * Rounding mode to round towards positive infinity.  If the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2277" href="#"></a></td>
<td><pre>     * {@code BigDecimal} is positive, behaves as for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2278" href="#"></a></td>
<td><pre>     * {@code ROUND_UP}; if negative, behaves as for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2279" href="#"></a></td>
<td><pre>     * {@code ROUND_DOWN}.  Note that this rounding mode never</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2280" href="#"></a></td>
<td><pre>     * decreases the calculated value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2281" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2282" href="#"></a></td>
<td><pre>    public final static int ROUND_CEILING =      2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2283" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2284" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2285" href="#"></a></td>
<td><pre>     * Rounding mode to round towards negative infinity.  If the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2286" href="#"></a></td>
<td><pre>     * {@code BigDecimal} is positive, behave as for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2287" href="#"></a></td>
<td><pre>     * {@code ROUND_DOWN}; if negative, behave as for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2288" href="#"></a></td>
<td><pre>     * {@code ROUND_UP}.  Note that this rounding mode never</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2289" href="#"></a></td>
<td><pre>     * increases the calculated value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2290" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2291" href="#"></a></td>
<td><pre>    public final static int ROUND_FLOOR =        3;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2292" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2293" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2294" href="#"></a></td>
<td><pre>     * Rounding mode to round towards {@literal &quot;nearest neighbor&quot;}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2295" href="#"></a></td>
<td><pre>     * unless both neighbors are equidistant, in which case round up.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2296" href="#"></a></td>
<td><pre>     * Behaves as for {@code ROUND_UP} if the discarded fraction is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2297" href="#"></a></td>
<td><pre>     * &amp;ge; 0.5; otherwise, behaves as for {@code ROUND_DOWN}.  Note</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2298" href="#"></a></td>
<td><pre>     * that this is the rounding mode that most of us were taught in</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2299" href="#"></a></td>
<td><pre>     * grade school.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2300" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2301" href="#"></a></td>
<td><pre>    public final static int ROUND_HALF_UP =      4;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2302" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2303" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2304" href="#"></a></td>
<td><pre>     * Rounding mode to round towards {@literal &quot;nearest neighbor&quot;}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2305" href="#"></a></td>
<td><pre>     * unless both neighbors are equidistant, in which case round</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2306" href="#"></a></td>
<td><pre>     * down.  Behaves as for {@code ROUND_UP} if the discarded</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2307" href="#"></a></td>
<td><pre>     * fraction is {@literal &gt;} 0.5; otherwise, behaves as for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2308" href="#"></a></td>
<td><pre>     * {@code ROUND_DOWN}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2309" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2310" href="#"></a></td>
<td><pre>    public final static int ROUND_HALF_DOWN =    5;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2311" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2312" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2313" href="#"></a></td>
<td><pre>     * Rounding mode to round towards the {@literal &quot;nearest neighbor&quot;}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2314" href="#"></a></td>
<td><pre>     * unless both neighbors are equidistant, in which case, round</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2315" href="#"></a></td>
<td><pre>     * towards the even neighbor.  Behaves as for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2316" href="#"></a></td>
<td><pre>     * {@code ROUND_HALF_UP} if the digit to the left of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2317" href="#"></a></td>
<td><pre>     * discarded fraction is odd; behaves as for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2318" href="#"></a></td>
<td><pre>     * {@code ROUND_HALF_DOWN} if it's even.  Note that this is the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2319" href="#"></a></td>
<td><pre>     * rounding mode that minimizes cumulative error when applied</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2320" href="#"></a></td>
<td><pre>     * repeatedly over a sequence of calculations.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2321" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2322" href="#"></a></td>
<td><pre>    public final static int ROUND_HALF_EVEN =    6;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2323" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2324" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2325" href="#"></a></td>
<td><pre>     * Rounding mode to assert that the requested operation has an exact</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2326" href="#"></a></td>
<td><pre>     * result, hence no rounding is necessary.  If this rounding mode is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2327" href="#"></a></td>
<td><pre>     * specified on an operation that yields an inexact result, an</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2328" href="#"></a></td>
<td><pre>     * {@code ArithmeticException} is thrown.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2329" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2330" href="#"></a></td>
<td><pre>    public final static int ROUND_UNNECESSARY =  7;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2331" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2332" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2333" href="#"></a></td>
<td><pre>    // Scaling/Rounding Operations</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2334" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2335" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2336" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} rounded according to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2337" href="#"></a></td>
<td><pre>     * {@code MathContext} settings.  If the precision setting is 0 then</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2338" href="#"></a></td>
<td><pre>     * no rounding takes place.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2339" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2340" href="#"></a></td>
<td><pre>     * &lt;p&gt;The effect of this method is identical to that of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2341" href="#"></a></td>
<td><pre>     * {@link #plus(MathContext)} method.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2342" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2343" href="#"></a></td>
<td><pre>     * @param mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2344" href="#"></a></td>
<td><pre>     * @return a {@code BigDecimal} rounded according to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2345" href="#"></a></td>
<td><pre>     *         {@code MathContext} settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2346" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the rounding mode is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2347" href="#"></a></td>
<td><pre>     *         {@code UNNECESSARY} and the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2348" href="#"></a></td>
<td><pre>     *         {@code BigDecimal}  operation would require rounding.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2349" href="#"></a></td>
<td><pre>     * @see    #plus(MathContext)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2350" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2351" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2352" href="#"></a></td>
<td><pre>    public BigDecimal round(MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2353" href="#"></a></td>
<td><pre>        return plus(mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2354" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2355" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2356" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2357" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose scale is the specified</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2358" href="#"></a></td>
<td><pre>     * value, and whose unscaled value is determined by multiplying or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2359" href="#"></a></td>
<td><pre>     * dividing this {@code BigDecimal}'s unscaled value by the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2360" href="#"></a></td>
<td><pre>     * appropriate power of ten to maintain its overall value.  If the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2361" href="#"></a></td>
<td><pre>     * scale is reduced by the operation, the unscaled value must be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2362" href="#"></a></td>
<td><pre>     * divided (rather than multiplied), and the value may be changed;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2363" href="#"></a></td>
<td><pre>     * in this case, the specified rounding mode is applied to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2364" href="#"></a></td>
<td><pre>     * division.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2365" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2366" href="#"></a></td>
<td><pre>     * &lt;p&gt;Note that since BigDecimal objects are immutable, calls of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2367" href="#"></a></td>
<td><pre>     * this method do &lt;i&gt;not&lt;/i&gt; result in the original object being</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2368" href="#"></a></td>
<td><pre>     * modified, contrary to the usual convention of having methods</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2369" href="#"></a></td>
<td><pre>     * named &lt;tt&gt;set&lt;i&gt;X&lt;/i&gt;&lt;/tt&gt; mutate field &lt;i&gt;{@code X}&lt;/i&gt;.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2370" href="#"></a></td>
<td><pre>     * Instead, {@code setScale} returns an object with the proper</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2371" href="#"></a></td>
<td><pre>     * scale; the returned object may or may not be newly allocated.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2372" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2373" href="#"></a></td>
<td><pre>     * @param  newScale scale of the {@code BigDecimal} value to be returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2374" href="#"></a></td>
<td><pre>     * @param  roundingMode The rounding mode to apply.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2375" href="#"></a></td>
<td><pre>     * @return a {@code BigDecimal} whose scale is the specified value,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2376" href="#"></a></td>
<td><pre>     *         and whose unscaled value is determined by multiplying or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2377" href="#"></a></td>
<td><pre>     *         dividing this {@code BigDecimal}'s unscaled value by the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2378" href="#"></a></td>
<td><pre>     *         appropriate power of ten to maintain its overall value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2379" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code roundingMode==UNNECESSARY}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2380" href="#"></a></td>
<td><pre>     *         and the specified scaling operation would require</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2381" href="#"></a></td>
<td><pre>     *         rounding.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2382" href="#"></a></td>
<td><pre>     * @see    RoundingMode</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2383" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2384" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2385" href="#"></a></td>
<td><pre>    public BigDecimal setScale(int newScale, RoundingMode roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2386" href="#"></a></td>
<td><pre>        return setScale(newScale, roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2387" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2388" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2389" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2390" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose scale is the specified</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2391" href="#"></a></td>
<td><pre>     * value, and whose unscaled value is determined by multiplying or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2392" href="#"></a></td>
<td><pre>     * dividing this {@code BigDecimal}'s unscaled value by the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2393" href="#"></a></td>
<td><pre>     * appropriate power of ten to maintain its overall value.  If the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2394" href="#"></a></td>
<td><pre>     * scale is reduced by the operation, the unscaled value must be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2395" href="#"></a></td>
<td><pre>     * divided (rather than multiplied), and the value may be changed;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2396" href="#"></a></td>
<td><pre>     * in this case, the specified rounding mode is applied to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2397" href="#"></a></td>
<td><pre>     * division.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2398" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2399" href="#"></a></td>
<td><pre>     * &lt;p&gt;Note that since BigDecimal objects are immutable, calls of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2400" href="#"></a></td>
<td><pre>     * this method do &lt;i&gt;not&lt;/i&gt; result in the original object being</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2401" href="#"></a></td>
<td><pre>     * modified, contrary to the usual convention of having methods</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2402" href="#"></a></td>
<td><pre>     * named &lt;tt&gt;set&lt;i&gt;X&lt;/i&gt;&lt;/tt&gt; mutate field &lt;i&gt;{@code X}&lt;/i&gt;.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2403" href="#"></a></td>
<td><pre>     * Instead, {@code setScale} returns an object with the proper</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2404" href="#"></a></td>
<td><pre>     * scale; the returned object may or may not be newly allocated.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2405" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2406" href="#"></a></td>
<td><pre>     * &lt;p&gt;The new {@link #setScale(int, RoundingMode)} method should</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2407" href="#"></a></td>
<td><pre>     * be used in preference to this legacy method.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2408" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2409" href="#"></a></td>
<td><pre>     * @param  newScale scale of the {@code BigDecimal} value to be returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2410" href="#"></a></td>
<td><pre>     * @param  roundingMode The rounding mode to apply.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2411" href="#"></a></td>
<td><pre>     * @return a {@code BigDecimal} whose scale is the specified value,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2412" href="#"></a></td>
<td><pre>     *         and whose unscaled value is determined by multiplying or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2413" href="#"></a></td>
<td><pre>     *         dividing this {@code BigDecimal}'s unscaled value by the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2414" href="#"></a></td>
<td><pre>     *         appropriate power of ten to maintain its overall value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2415" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code roundingMode==ROUND_UNNECESSARY}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2416" href="#"></a></td>
<td><pre>     *         and the specified scaling operation would require</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2417" href="#"></a></td>
<td><pre>     *         rounding.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2418" href="#"></a></td>
<td><pre>     * @throws IllegalArgumentException if {@code roundingMode} does not</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2419" href="#"></a></td>
<td><pre>     *         represent a valid rounding mode.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2420" href="#"></a></td>
<td><pre>     * @see    #ROUND_UP</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2421" href="#"></a></td>
<td><pre>     * @see    #ROUND_DOWN</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2422" href="#"></a></td>
<td><pre>     * @see    #ROUND_CEILING</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2423" href="#"></a></td>
<td><pre>     * @see    #ROUND_FLOOR</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2424" href="#"></a></td>
<td><pre>     * @see    #ROUND_HALF_UP</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2425" href="#"></a></td>
<td><pre>     * @see    #ROUND_HALF_DOWN</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2426" href="#"></a></td>
<td><pre>     * @see    #ROUND_HALF_EVEN</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2427" href="#"></a></td>
<td><pre>     * @see    #ROUND_UNNECESSARY</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2428" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2429" href="#"></a></td>
<td><pre>    public BigDecimal setScale(int newScale, int roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2430" href="#"></a></td>
<td><pre>        if (roundingMode &lt; ROUND_UP || roundingMode &gt; ROUND_UNNECESSARY)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2431" href="#"></a></td>
<td><pre>            throw new IllegalArgumentException(&quot;Invalid rounding mode&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2432" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2433" href="#"></a></td>
<td><pre>        int oldScale = this.scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2434" href="#"></a></td>
<td><pre>        if (newScale == oldScale)        // easy case</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2435" href="#"></a></td>
<td><pre>            return this;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2436" href="#"></a></td>
<td><pre>        if (this.signum() == 0)            // zero can have any scale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2437" href="#"></a></td>
<td><pre>            return zeroValueOf(newScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2438" href="#"></a></td>
<td><pre>        if(this.intCompact!=INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2439" href="#"></a></td>
<td><pre>            long rs = this.intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2440" href="#"></a></td>
<td><pre>            if (newScale &gt; oldScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2441" href="#"></a></td>
<td><pre>                int raise = checkScale((long) newScale - oldScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2442" href="#"></a></td>
<td><pre>                if ((rs = longMultiplyPowerTen(rs, raise)) != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2443" href="#"></a></td>
<td><pre>                    return valueOf(rs,newScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2444" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2445" href="#"></a></td>
<td><pre>                BigInteger rb = bigMultiplyPowerTen(raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2446" href="#"></a></td>
<td><pre>                return new BigDecimal(rb, INFLATED, newScale, (precision &gt; 0) ? precision + raise : 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2447" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2448" href="#"></a></td>
<td><pre>                // newScale &lt; oldScale -- drop some digits</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2449" href="#"></a></td>
<td><pre>                // Can't predict the precision due to the effect of rounding.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2450" href="#"></a></td>
<td><pre>                int drop = checkScale((long) oldScale - newScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2451" href="#"></a></td>
<td><pre>                if (drop &lt; LONG_TEN_POWERS_TABLE.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2452" href="#"></a></td>
<td><pre>                    return divideAndRound(rs, LONG_TEN_POWERS_TABLE[drop], newScale, roundingMode, newScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2453" href="#"></a></td>
<td><pre>                } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2454" href="#"></a></td>
<td><pre>                    return divideAndRound(this.inflated(), bigTenToThe(drop), newScale, roundingMode, newScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2455" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2456" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2457" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2458" href="#"></a></td>
<td><pre>            if (newScale &gt; oldScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2459" href="#"></a></td>
<td><pre>                int raise = checkScale((long) newScale - oldScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2460" href="#"></a></td>
<td><pre>                BigInteger rb = bigMultiplyPowerTen(this.intVal,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2461" href="#"></a></td>
<td><pre>                return new BigDecimal(rb, INFLATED, newScale, (precision &gt; 0) ? precision + raise : 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2462" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2463" href="#"></a></td>
<td><pre>                // newScale &lt; oldScale -- drop some digits</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2464" href="#"></a></td>
<td><pre>                // Can't predict the precision due to the effect of rounding.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2465" href="#"></a></td>
<td><pre>                int drop = checkScale((long) oldScale - newScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2466" href="#"></a></td>
<td><pre>                if (drop &lt; LONG_TEN_POWERS_TABLE.length)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2467" href="#"></a></td>
<td><pre>                    return divideAndRound(this.intVal, LONG_TEN_POWERS_TABLE[drop], newScale, roundingMode,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2468" href="#"></a></td>
<td><pre>                                          newScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2469" href="#"></a></td>
<td><pre>                else</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2470" href="#"></a></td>
<td><pre>                    return divideAndRound(this.intVal,  bigTenToThe(drop), newScale, roundingMode, newScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2471" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2472" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2473" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2474" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2475" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2476" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose scale is the specified</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2477" href="#"></a></td>
<td><pre>     * value, and whose value is numerically equal to this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2478" href="#"></a></td>
<td><pre>     * {@code BigDecimal}'s.  Throws an {@code ArithmeticException}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2479" href="#"></a></td>
<td><pre>     * if this is not possible.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2480" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2481" href="#"></a></td>
<td><pre>     * &lt;p&gt;This call is typically used to increase the scale, in which</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2482" href="#"></a></td>
<td><pre>     * case it is guaranteed that there exists a {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2483" href="#"></a></td>
<td><pre>     * of the specified scale and the correct value.  The call can</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2484" href="#"></a></td>
<td><pre>     * also be used to reduce the scale if the caller knows that the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2485" href="#"></a></td>
<td><pre>     * {@code BigDecimal} has sufficiently many zeros at the end of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2486" href="#"></a></td>
<td><pre>     * its fractional part (i.e., factors of ten in its integer value)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2487" href="#"></a></td>
<td><pre>     * to allow for the rescaling without changing its value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2488" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2489" href="#"></a></td>
<td><pre>     * &lt;p&gt;This method returns the same result as the two-argument</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2490" href="#"></a></td>
<td><pre>     * versions of {@code setScale}, but saves the caller the trouble</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2491" href="#"></a></td>
<td><pre>     * of specifying a rounding mode in cases where it is irrelevant.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2492" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2493" href="#"></a></td>
<td><pre>     * &lt;p&gt;Note that since {@code BigDecimal} objects are immutable,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2494" href="#"></a></td>
<td><pre>     * calls of this method do &lt;i&gt;not&lt;/i&gt; result in the original</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2495" href="#"></a></td>
<td><pre>     * object being modified, contrary to the usual convention of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2496" href="#"></a></td>
<td><pre>     * having methods named &lt;tt&gt;set&lt;i&gt;X&lt;/i&gt;&lt;/tt&gt; mutate field</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2497" href="#"></a></td>
<td><pre>     * &lt;i&gt;{@code X}&lt;/i&gt;.  Instead, {@code setScale} returns an</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2498" href="#"></a></td>
<td><pre>     * object with the proper scale; the returned object may or may</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2499" href="#"></a></td>
<td><pre>     * not be newly allocated.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2500" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2501" href="#"></a></td>
<td><pre>     * @param  newScale scale of the {@code BigDecimal} value to be returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2502" href="#"></a></td>
<td><pre>     * @return a {@code BigDecimal} whose scale is the specified value, and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2503" href="#"></a></td>
<td><pre>     *         whose unscaled value is determined by multiplying or dividing</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2504" href="#"></a></td>
<td><pre>     *         this {@code BigDecimal}'s unscaled value by the appropriate</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2505" href="#"></a></td>
<td><pre>     *         power of ten to maintain its overall value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2506" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the specified scaling operation would</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2507" href="#"></a></td>
<td><pre>     *         require rounding.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2508" href="#"></a></td>
<td><pre>     * @see    #setScale(int, int)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2509" href="#"></a></td>
<td><pre>     * @see    #setScale(int, RoundingMode)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2510" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2511" href="#"></a></td>
<td><pre>    public BigDecimal setScale(int newScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2512" href="#"></a></td>
<td><pre>        return setScale(newScale, ROUND_UNNECESSARY);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2513" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2514" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2515" href="#"></a></td>
<td><pre>    // Decimal Point Motion Operations</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2516" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2517" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2518" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} which is equivalent to this one</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2519" href="#"></a></td>
<td><pre>     * with the decimal point moved {@code n} places to the left.  If</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2520" href="#"></a></td>
<td><pre>     * {@code n} is non-negative, the call merely adds {@code n} to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2521" href="#"></a></td>
<td><pre>     * the scale.  If {@code n} is negative, the call is equivalent</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2522" href="#"></a></td>
<td><pre>     * to {@code movePointRight(-n)}.  The {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2523" href="#"></a></td>
<td><pre>     * returned by this call has value &lt;tt&gt;(this &amp;times;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2524" href="#"></a></td>
<td><pre>     * 10&lt;sup&gt;-n&lt;/sup&gt;)&lt;/tt&gt; and scale {@code max(this.scale()+n,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2525" href="#"></a></td>
<td><pre>     * 0)}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2526" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2527" href="#"></a></td>
<td><pre>     * @param  n number of places to move the decimal point to the left.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2528" href="#"></a></td>
<td><pre>     * @return a {@code BigDecimal} which is equivalent to this one with the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2529" href="#"></a></td>
<td><pre>     *         decimal point moved {@code n} places to the left.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2530" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if scale overflows.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2531" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2532" href="#"></a></td>
<td><pre>    public BigDecimal movePointLeft(int n) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2533" href="#"></a></td>
<td><pre>        // Cannot use movePointRight(-n) in case of n==Integer.MIN_VALUE</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2534" href="#"></a></td>
<td><pre>        int newScale = checkScale((long)scale + n);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2535" href="#"></a></td>
<td><pre>        BigDecimal num = new BigDecimal(intVal, intCompact, newScale, 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2536" href="#"></a></td>
<td><pre>        return num.scale &lt; 0 ? num.setScale(0, ROUND_UNNECESSARY) : num;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2537" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2538" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2539" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2540" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} which is equivalent to this one</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2541" href="#"></a></td>
<td><pre>     * with the decimal point moved {@code n} places to the right.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2542" href="#"></a></td>
<td><pre>     * If {@code n} is non-negative, the call merely subtracts</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2543" href="#"></a></td>
<td><pre>     * {@code n} from the scale.  If {@code n} is negative, the call</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2544" href="#"></a></td>
<td><pre>     * is equivalent to {@code movePointLeft(-n)}.  The</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2545" href="#"></a></td>
<td><pre>     * {@code BigDecimal} returned by this call has value &lt;tt&gt;(this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2546" href="#"></a></td>
<td><pre>     * &amp;times; 10&lt;sup&gt;n&lt;/sup&gt;)&lt;/tt&gt; and scale {@code max(this.scale()-n,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2547" href="#"></a></td>
<td><pre>     * 0)}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2548" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2549" href="#"></a></td>
<td><pre>     * @param  n number of places to move the decimal point to the right.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2550" href="#"></a></td>
<td><pre>     * @return a {@code BigDecimal} which is equivalent to this one</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2551" href="#"></a></td>
<td><pre>     *         with the decimal point moved {@code n} places to the right.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2552" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if scale overflows.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2553" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2554" href="#"></a></td>
<td><pre>    public BigDecimal movePointRight(int n) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2555" href="#"></a></td>
<td><pre>        // Cannot use movePointLeft(-n) in case of n==Integer.MIN_VALUE</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2556" href="#"></a></td>
<td><pre>        int newScale = checkScale((long)scale - n);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2557" href="#"></a></td>
<td><pre>        BigDecimal num = new BigDecimal(intVal, intCompact, newScale, 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2558" href="#"></a></td>
<td><pre>        return num.scale &lt; 0 ? num.setScale(0, ROUND_UNNECESSARY) : num;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2559" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2560" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2561" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2562" href="#"></a></td>
<td><pre>     * Returns a BigDecimal whose numerical value is equal to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2563" href="#"></a></td>
<td><pre>     * ({@code this} * 10&lt;sup&gt;n&lt;/sup&gt;).  The scale of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2564" href="#"></a></td>
<td><pre>     * the result is {@code (this.scale() - n)}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2565" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2566" href="#"></a></td>
<td><pre>     * @param n the exponent power of ten to scale by</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2567" href="#"></a></td>
<td><pre>     * @return a BigDecimal whose numerical value is equal to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2568" href="#"></a></td>
<td><pre>     * ({@code this} * 10&lt;sup&gt;n&lt;/sup&gt;)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2569" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the scale would be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2570" href="#"></a></td>
<td><pre>     *         outside the range of a 32-bit integer.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2571" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2572" href="#"></a></td>
<td><pre>     * @since 1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2573" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2574" href="#"></a></td>
<td><pre>    public BigDecimal scaleByPowerOfTen(int n) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2575" href="#"></a></td>
<td><pre>        return new BigDecimal(intVal, intCompact,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2576" href="#"></a></td>
<td><pre>                              checkScale((long)scale - n), precision);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2577" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2578" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2579" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2580" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} which is numerically equal to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2581" href="#"></a></td>
<td><pre>     * this one but with any trailing zeros removed from the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2582" href="#"></a></td>
<td><pre>     * representation.  For example, stripping the trailing zeros from</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2583" href="#"></a></td>
<td><pre>     * the {@code BigDecimal} value {@code 600.0}, which has</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2584" href="#"></a></td>
<td><pre>     * [{@code BigInteger}, {@code scale}] components equals to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2585" href="#"></a></td>
<td><pre>     * [6000, 1], yields {@code 6E2} with [{@code BigInteger},</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2586" href="#"></a></td>
<td><pre>     * {@code scale}] components equals to [6, -2].  If</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2587" href="#"></a></td>
<td><pre>     * this BigDecimal is numerically equal to zero, then</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2588" href="#"></a></td>
<td><pre>     * {@code BigDecimal.ZERO} is returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2589" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2590" href="#"></a></td>
<td><pre>     * @return a numerically equal {@code BigDecimal} with any</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2591" href="#"></a></td>
<td><pre>     * trailing zeros removed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2592" href="#"></a></td>
<td><pre>     * @since 1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2593" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2594" href="#"></a></td>
<td><pre>    public BigDecimal stripTrailingZeros() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2595" href="#"></a></td>
<td><pre>        if (intCompact == 0 || (intVal != null &amp;&amp; intVal.signum() == 0)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2596" href="#"></a></td>
<td><pre>            return BigDecimal.ZERO;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2597" href="#"></a></td>
<td><pre>        } else if (intCompact != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2598" href="#"></a></td>
<td><pre>            return createAndStripZerosToMatchScale(intCompact, scale, Long.MIN_VALUE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2599" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2600" href="#"></a></td>
<td><pre>            return createAndStripZerosToMatchScale(intVal, scale, Long.MIN_VALUE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2601" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2602" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2603" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2604" href="#"></a></td>
<td><pre>    // Comparison Operations</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2605" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2606" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2607" href="#"></a></td>
<td><pre>     * Compares this {@code BigDecimal} with the specified</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2608" href="#"></a></td>
<td><pre>     * {@code BigDecimal}.  Two {@code BigDecimal} objects that are</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2609" href="#"></a></td>
<td><pre>     * equal in value but have a different scale (like 2.0 and 2.00)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2610" href="#"></a></td>
<td><pre>     * are considered equal by this method.  This method is provided</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2611" href="#"></a></td>
<td><pre>     * in preference to individual methods for each of the six boolean</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2612" href="#"></a></td>
<td><pre>     * comparison operators ({@literal &lt;}, ==,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2613" href="#"></a></td>
<td><pre>     * {@literal &gt;}, {@literal &gt;=}, !=, {@literal &lt;=}).  The</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2614" href="#"></a></td>
<td><pre>     * suggested idiom for performing these comparisons is:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2615" href="#"></a></td>
<td><pre>     * {@code (x.compareTo(y)} &amp;lt;&lt;i&gt;op&lt;/i&gt;&amp;gt; {@code 0)}, where</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2616" href="#"></a></td>
<td><pre>     * &amp;lt;&lt;i&gt;op&lt;/i&gt;&amp;gt; is one of the six comparison operators.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2617" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2618" href="#"></a></td>
<td><pre>     * @param  val {@code BigDecimal} to which this {@code BigDecimal} is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2619" href="#"></a></td>
<td><pre>     *         to be compared.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2620" href="#"></a></td>
<td><pre>     * @return -1, 0, or 1 as this {@code BigDecimal} is numerically</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2621" href="#"></a></td>
<td><pre>     *          less than, equal to, or greater than {@code val}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2622" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2623" href="#"></a></td>
<td><pre>    public int compareTo(BigDecimal val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2624" href="#"></a></td>
<td><pre>        // Quick path for equal scale and non-inflated case.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2625" href="#"></a></td>
<td><pre>        if (scale == val.scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2626" href="#"></a></td>
<td><pre>            long xs = intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2627" href="#"></a></td>
<td><pre>            long ys = val.intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2628" href="#"></a></td>
<td><pre>            if (xs != INFLATED &amp;&amp; ys != INFLATED)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2629" href="#"></a></td>
<td><pre>                return xs != ys ? ((xs &gt; ys) ? 1 : -1) : 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2630" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2631" href="#"></a></td>
<td><pre>        int xsign = this.signum();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2632" href="#"></a></td>
<td><pre>        int ysign = val.signum();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2633" href="#"></a></td>
<td><pre>        if (xsign != ysign)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2634" href="#"></a></td>
<td><pre>            return (xsign &gt; ysign) ? 1 : -1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2635" href="#"></a></td>
<td><pre>        if (xsign == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2636" href="#"></a></td>
<td><pre>            return 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2637" href="#"></a></td>
<td><pre>        int cmp = compareMagnitude(val);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2638" href="#"></a></td>
<td><pre>        return (xsign &gt; 0) ? cmp : -cmp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2639" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2640" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2641" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2642" href="#"></a></td>
<td><pre>     * Version of compareTo that ignores sign.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2643" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2644" href="#"></a></td>
<td><pre>    private int compareMagnitude(BigDecimal val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2645" href="#"></a></td>
<td><pre>        // Match scales, avoid unnecessary inflation</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2646" href="#"></a></td>
<td><pre>        long ys = val.intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2647" href="#"></a></td>
<td><pre>        long xs = this.intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2648" href="#"></a></td>
<td><pre>        if (xs == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2649" href="#"></a></td>
<td><pre>            return (ys == 0) ? 0 : -1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2650" href="#"></a></td>
<td><pre>        if (ys == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2651" href="#"></a></td>
<td><pre>            return 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2652" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2653" href="#"></a></td>
<td><pre>        long sdiff = (long)this.scale - val.scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2654" href="#"></a></td>
<td><pre>        if (sdiff != 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2655" href="#"></a></td>
<td><pre>            // Avoid matching scales if the (adjusted) exponents differ</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2656" href="#"></a></td>
<td><pre>            long xae = (long)this.precision() - this.scale;   // [-1]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2657" href="#"></a></td>
<td><pre>            long yae = (long)val.precision() - val.scale;     // [-1]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2658" href="#"></a></td>
<td><pre>            if (xae &lt; yae)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2659" href="#"></a></td>
<td><pre>                return -1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2660" href="#"></a></td>
<td><pre>            if (xae &gt; yae)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2661" href="#"></a></td>
<td><pre>                return 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2662" href="#"></a></td>
<td><pre>            BigInteger rb = null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2663" href="#"></a></td>
<td><pre>            if (sdiff &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2664" href="#"></a></td>
<td><pre>                // The cases sdiff &lt;= Integer.MIN_VALUE intentionally fall through.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2665" href="#"></a></td>
<td><pre>                if ( sdiff &gt; Integer.MIN_VALUE &amp;&amp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2666" href="#"></a></td>
<td><pre>                      (xs == INFLATED ||</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2667" href="#"></a></td>
<td><pre>                      (xs = longMultiplyPowerTen(xs, (int)-sdiff)) == INFLATED) &amp;&amp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2668" href="#"></a></td>
<td><pre>                     ys == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2669" href="#"></a></td>
<td><pre>                    rb = bigMultiplyPowerTen((int)-sdiff);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2670" href="#"></a></td>
<td><pre>                    return rb.compareMagnitude(val.intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2671" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2672" href="#"></a></td>
<td><pre>            } else { // sdiff &gt; 0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2673" href="#"></a></td>
<td><pre>                // The cases sdiff &gt; Integer.MAX_VALUE intentionally fall through.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2674" href="#"></a></td>
<td><pre>                if ( sdiff &lt;= Integer.MAX_VALUE &amp;&amp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2675" href="#"></a></td>
<td><pre>                      (ys == INFLATED ||</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2676" href="#"></a></td>
<td><pre>                      (ys = longMultiplyPowerTen(ys, (int)sdiff)) == INFLATED) &amp;&amp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2677" href="#"></a></td>
<td><pre>                     xs == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2678" href="#"></a></td>
<td><pre>                    rb = val.bigMultiplyPowerTen((int)sdiff);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2679" href="#"></a></td>
<td><pre>                    return this.intVal.compareMagnitude(rb);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2680" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2681" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2682" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2683" href="#"></a></td>
<td><pre>        if (xs != INFLATED)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2684" href="#"></a></td>
<td><pre>            return (ys != INFLATED) ? longCompareMagnitude(xs, ys) : -1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2685" href="#"></a></td>
<td><pre>        else if (ys != INFLATED)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2686" href="#"></a></td>
<td><pre>            return 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2687" href="#"></a></td>
<td><pre>        else</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2688" href="#"></a></td>
<td><pre>            return this.intVal.compareMagnitude(val.intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2689" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2690" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2691" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2692" href="#"></a></td>
<td><pre>     * Compares this {@code BigDecimal} with the specified</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2693" href="#"></a></td>
<td><pre>     * {@code Object} for equality.  Unlike {@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2694" href="#"></a></td>
<td><pre>     * #compareTo(BigDecimal) compareTo}, this method considers two</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2695" href="#"></a></td>
<td><pre>     * {@code BigDecimal} objects equal only if they are equal in</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2696" href="#"></a></td>
<td><pre>     * value and scale (thus 2.0 is not equal to 2.00 when compared by</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2697" href="#"></a></td>
<td><pre>     * this method).</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2698" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2699" href="#"></a></td>
<td><pre>     * @param  x {@code Object} to which this {@code BigDecimal} is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2700" href="#"></a></td>
<td><pre>     *         to be compared.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2701" href="#"></a></td>
<td><pre>     * @return {@code true} if and only if the specified {@code Object} is a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2702" href="#"></a></td>
<td><pre>     *         {@code BigDecimal} whose value and scale are equal to this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2703" href="#"></a></td>
<td><pre>     *         {@code BigDecimal}'s.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2704" href="#"></a></td>
<td><pre>     * @see    #compareTo(java.math.BigDecimal)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2705" href="#"></a></td>
<td><pre>     * @see    #hashCode</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2706" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2707" href="#"></a></td>
<td><pre>    @Override</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2708" href="#"></a></td>
<td><pre>    public boolean equals(Object x) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2709" href="#"></a></td>
<td><pre>        if (!(x instanceof BigDecimal))</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2710" href="#"></a></td>
<td><pre>            return false;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2711" href="#"></a></td>
<td><pre>        BigDecimal xDec = (BigDecimal) x;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2712" href="#"></a></td>
<td><pre>        if (x == this)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2713" href="#"></a></td>
<td><pre>            return true;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2714" href="#"></a></td>
<td><pre>        if (scale != xDec.scale)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2715" href="#"></a></td>
<td><pre>            return false;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2716" href="#"></a></td>
<td><pre>        long s = this.intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2717" href="#"></a></td>
<td><pre>        long xs = xDec.intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2718" href="#"></a></td>
<td><pre>        if (s != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2719" href="#"></a></td>
<td><pre>            if (xs == INFLATED)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2720" href="#"></a></td>
<td><pre>                xs = compactValFor(xDec.intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2721" href="#"></a></td>
<td><pre>            return xs == s;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2722" href="#"></a></td>
<td><pre>        } else if (xs != INFLATED)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2723" href="#"></a></td>
<td><pre>            return xs == compactValFor(this.intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2724" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2725" href="#"></a></td>
<td><pre>        return this.inflated().equals(xDec.inflated());</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2726" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2727" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2728" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2729" href="#"></a></td>
<td><pre>     * Returns the minimum of this {@code BigDecimal} and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2730" href="#"></a></td>
<td><pre>     * {@code val}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2731" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2732" href="#"></a></td>
<td><pre>     * @param  val value with which the minimum is to be computed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2733" href="#"></a></td>
<td><pre>     * @return the {@code BigDecimal} whose value is the lesser of this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2734" href="#"></a></td>
<td><pre>     *         {@code BigDecimal} and {@code val}.  If they are equal,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2735" href="#"></a></td>
<td><pre>     *         as defined by the {@link #compareTo(BigDecimal) compareTo}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2736" href="#"></a></td>
<td><pre>     *         method, {@code this} is returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2737" href="#"></a></td>
<td><pre>     * @see    #compareTo(java.math.BigDecimal)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2738" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2739" href="#"></a></td>
<td><pre>    public BigDecimal min(BigDecimal val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2740" href="#"></a></td>
<td><pre>        return (compareTo(val) &lt;= 0 ? this : val);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2741" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2742" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2743" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2744" href="#"></a></td>
<td><pre>     * Returns the maximum of this {@code BigDecimal} and {@code val}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2745" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2746" href="#"></a></td>
<td><pre>     * @param  val value with which the maximum is to be computed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2747" href="#"></a></td>
<td><pre>     * @return the {@code BigDecimal} whose value is the greater of this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2748" href="#"></a></td>
<td><pre>     *         {@code BigDecimal} and {@code val}.  If they are equal,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2749" href="#"></a></td>
<td><pre>     *         as defined by the {@link #compareTo(BigDecimal) compareTo}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2750" href="#"></a></td>
<td><pre>     *         method, {@code this} is returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2751" href="#"></a></td>
<td><pre>     * @see    #compareTo(java.math.BigDecimal)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2752" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2753" href="#"></a></td>
<td><pre>    public BigDecimal max(BigDecimal val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2754" href="#"></a></td>
<td><pre>        return (compareTo(val) &gt;= 0 ? this : val);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2755" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2756" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2757" href="#"></a></td>
<td><pre>    // Hash Function</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2758" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2759" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2760" href="#"></a></td>
<td><pre>     * Returns the hash code for this {@code BigDecimal}.  Note that</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2761" href="#"></a></td>
<td><pre>     * two {@code BigDecimal} objects that are numerically equal but</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2762" href="#"></a></td>
<td><pre>     * differ in scale (like 2.0 and 2.00) will generally &lt;i&gt;not&lt;/i&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2763" href="#"></a></td>
<td><pre>     * have the same hash code.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2764" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2765" href="#"></a></td>
<td><pre>     * @return hash code for this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2766" href="#"></a></td>
<td><pre>     * @see #equals(Object)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2767" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2768" href="#"></a></td>
<td><pre>    @Override</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2769" href="#"></a></td>
<td><pre>    public int hashCode() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2770" href="#"></a></td>
<td><pre>        if (intCompact != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2771" href="#"></a></td>
<td><pre>            long val2 = (intCompact &lt; 0)? -intCompact : intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2772" href="#"></a></td>
<td><pre>            int temp = (int)( ((int)(val2 &gt;&gt;&gt; 32)) * 31  +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2773" href="#"></a></td>
<td><pre>                              (val2 &amp; LONG_MASK));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2774" href="#"></a></td>
<td><pre>            return 31*((intCompact &lt; 0) ?-temp:temp) + scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2775" href="#"></a></td>
<td><pre>        } else</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2776" href="#"></a></td>
<td><pre>            return 31*intVal.hashCode() + scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2777" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2778" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2779" href="#"></a></td>
<td><pre>    // Format Converters</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2780" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2781" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2782" href="#"></a></td>
<td><pre>     * Returns the string representation of this {@code BigDecimal},</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2783" href="#"></a></td>
<td><pre>     * using scientific notation if an exponent is needed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2784" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2785" href="#"></a></td>
<td><pre>     * &lt;p&gt;A standard canonical string form of the {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2786" href="#"></a></td>
<td><pre>     * is created as though by the following steps: first, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2787" href="#"></a></td>
<td><pre>     * absolute value of the unscaled value of the {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2788" href="#"></a></td>
<td><pre>     * is converted to a string in base ten using the characters</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2789" href="#"></a></td>
<td><pre>     * {@code '0'} through {@code '9'} with no leading zeros (except</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2790" href="#"></a></td>
<td><pre>     * if its value is zero, in which case a single {@code '0'}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2791" href="#"></a></td>
<td><pre>     * character is used).</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2792" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2793" href="#"></a></td>
<td><pre>     * &lt;p&gt;Next, an &lt;i&gt;adjusted exponent&lt;/i&gt; is calculated; this is the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2794" href="#"></a></td>
<td><pre>     * negated scale, plus the number of characters in the converted</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2795" href="#"></a></td>
<td><pre>     * unscaled value, less one.  That is,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2796" href="#"></a></td>
<td><pre>     * {@code -scale+(ulength-1)}, where {@code ulength} is the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2797" href="#"></a></td>
<td><pre>     * length of the absolute value of the unscaled value in decimal</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2798" href="#"></a></td>
<td><pre>     * digits (its &lt;i&gt;precision&lt;/i&gt;).</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2799" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2800" href="#"></a></td>
<td><pre>     * &lt;p&gt;If the scale is greater than or equal to zero and the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2801" href="#"></a></td>
<td><pre>     * adjusted exponent is greater than or equal to {@code -6}, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2802" href="#"></a></td>
<td><pre>     * number will be converted to a character form without using</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2803" href="#"></a></td>
<td><pre>     * exponential notation.  In this case, if the scale is zero then</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2804" href="#"></a></td>
<td><pre>     * no decimal point is added and if the scale is positive a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2805" href="#"></a></td>
<td><pre>     * decimal point will be inserted with the scale specifying the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2806" href="#"></a></td>
<td><pre>     * number of characters to the right of the decimal point.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2807" href="#"></a></td>
<td><pre>     * {@code '0'} characters are added to the left of the converted</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2808" href="#"></a></td>
<td><pre>     * unscaled value as necessary.  If no character precedes the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2809" href="#"></a></td>
<td><pre>     * decimal point after this insertion then a conventional</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2810" href="#"></a></td>
<td><pre>     * {@code '0'} character is prefixed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2811" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2812" href="#"></a></td>
<td><pre>     * &lt;p&gt;Otherwise (that is, if the scale is negative, or the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2813" href="#"></a></td>
<td><pre>     * adjusted exponent is less than {@code -6}), the number will be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2814" href="#"></a></td>
<td><pre>     * converted to a character form using exponential notation.  In</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2815" href="#"></a></td>
<td><pre>     * this case, if the converted {@code BigInteger} has more than</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2816" href="#"></a></td>
<td><pre>     * one digit a decimal point is inserted after the first digit.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2817" href="#"></a></td>
<td><pre>     * An exponent in character form is then suffixed to the converted</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2818" href="#"></a></td>
<td><pre>     * unscaled value (perhaps with inserted decimal point); this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2819" href="#"></a></td>
<td><pre>     * comprises the letter {@code 'E'} followed immediately by the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2820" href="#"></a></td>
<td><pre>     * adjusted exponent converted to a character form.  The latter is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2821" href="#"></a></td>
<td><pre>     * in base ten, using the characters {@code '0'} through</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2822" href="#"></a></td>
<td><pre>     * {@code '9'} with no leading zeros, and is always prefixed by a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2823" href="#"></a></td>
<td><pre>     * sign character {@code '-'} (&lt;tt&gt;'&amp;#92;u002D'&lt;/tt&gt;) if the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2824" href="#"></a></td>
<td><pre>     * adjusted exponent is negative, {@code '+'}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2825" href="#"></a></td>
<td><pre>     * (&lt;tt&gt;'&amp;#92;u002B'&lt;/tt&gt;) otherwise).</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2826" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2827" href="#"></a></td>
<td><pre>     * &lt;p&gt;Finally, the entire string is prefixed by a minus sign</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2828" href="#"></a></td>
<td><pre>     * character {@code '-'} (&lt;tt&gt;'&amp;#92;u002D'&lt;/tt&gt;) if the unscaled</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2829" href="#"></a></td>
<td><pre>     * value is less than zero.  No sign character is prefixed if the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2830" href="#"></a></td>
<td><pre>     * unscaled value is zero or positive.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2831" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2832" href="#"></a></td>
<td><pre>     * &lt;p&gt;&lt;b&gt;Examples:&lt;/b&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2833" href="#"></a></td>
<td><pre>     * &lt;p&gt;For each representation [&lt;i&gt;unscaled value&lt;/i&gt;, &lt;i&gt;scale&lt;/i&gt;]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2834" href="#"></a></td>
<td><pre>     * on the left, the resulting string is shown on the right.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2835" href="#"></a></td>
<td><pre>     * &lt;pre&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2836" href="#"></a></td>
<td><pre>     * [123,0]      &quot;123&quot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2837" href="#"></a></td>
<td><pre>     * [-123,0]     &quot;-123&quot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2838" href="#"></a></td>
<td><pre>     * [123,-1]     &quot;1.23E+3&quot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2839" href="#"></a></td>
<td><pre>     * [123,-3]     &quot;1.23E+5&quot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2840" href="#"></a></td>
<td><pre>     * [123,1]      &quot;12.3&quot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2841" href="#"></a></td>
<td><pre>     * [123,5]      &quot;0.00123&quot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2842" href="#"></a></td>
<td><pre>     * [123,10]     &quot;1.23E-8&quot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2843" href="#"></a></td>
<td><pre>     * [-123,12]    &quot;-1.23E-10&quot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2844" href="#"></a></td>
<td><pre>     * &lt;/pre&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2845" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2846" href="#"></a></td>
<td><pre>     * &lt;b&gt;Notes:&lt;/b&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2847" href="#"></a></td>
<td><pre>     * &lt;ol&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2848" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2849" href="#"></a></td>
<td><pre>     * &lt;li&gt;There is a one-to-one mapping between the distinguishable</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2850" href="#"></a></td>
<td><pre>     * {@code BigDecimal} values and the result of this conversion.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2851" href="#"></a></td>
<td><pre>     * That is, every distinguishable {@code BigDecimal} value</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2852" href="#"></a></td>
<td><pre>     * (unscaled value and scale) has a unique string representation</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2853" href="#"></a></td>
<td><pre>     * as a result of using {@code toString}.  If that string</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2854" href="#"></a></td>
<td><pre>     * representation is converted back to a {@code BigDecimal} using</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2855" href="#"></a></td>
<td><pre>     * the {@link #BigDecimal(String)} constructor, then the original</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2856" href="#"></a></td>
<td><pre>     * value will be recovered.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2857" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2858" href="#"></a></td>
<td><pre>     * &lt;li&gt;The string produced for a given number is always the same;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2859" href="#"></a></td>
<td><pre>     * it is not affected by locale.  This means that it can be used</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2860" href="#"></a></td>
<td><pre>     * as a canonical string representation for exchanging decimal</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2861" href="#"></a></td>
<td><pre>     * data, or as a key for a Hashtable, etc.  Locale-sensitive</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2862" href="#"></a></td>
<td><pre>     * number formatting and parsing is handled by the {@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2863" href="#"></a></td>
<td><pre>     * java.text.NumberFormat} class and its subclasses.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2864" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2865" href="#"></a></td>
<td><pre>     * &lt;li&gt;The {@link #toEngineeringString} method may be used for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2866" href="#"></a></td>
<td><pre>     * presenting numbers with exponents in engineering notation, and the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2867" href="#"></a></td>
<td><pre>     * {@link #setScale(int,RoundingMode) setScale} method may be used for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2868" href="#"></a></td>
<td><pre>     * rounding a {@code BigDecimal} so it has a known number of digits after</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2869" href="#"></a></td>
<td><pre>     * the decimal point.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2870" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2871" href="#"></a></td>
<td><pre>     * &lt;li&gt;The digit-to-character mapping provided by</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2872" href="#"></a></td>
<td><pre>     * {@code Character.forDigit} is used.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2873" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2874" href="#"></a></td>
<td><pre>     * &lt;/ol&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2875" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2876" href="#"></a></td>
<td><pre>     * @return string representation of this {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2877" href="#"></a></td>
<td><pre>     * @see    Character#forDigit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2878" href="#"></a></td>
<td><pre>     * @see    #BigDecimal(java.lang.String)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2879" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2880" href="#"></a></td>
<td><pre>    @Override</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2881" href="#"></a></td>
<td><pre>    public String toString() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2882" href="#"></a></td>
<td><pre>        String sc = stringCache;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2883" href="#"></a></td>
<td><pre>        if (sc == null)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2884" href="#"></a></td>
<td><pre>            stringCache = sc = layoutChars(true);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2885" href="#"></a></td>
<td><pre>        return sc;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2886" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2887" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2888" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2889" href="#"></a></td>
<td><pre>     * Returns a string representation of this {@code BigDecimal},</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2890" href="#"></a></td>
<td><pre>     * using engineering notation if an exponent is needed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2891" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2892" href="#"></a></td>
<td><pre>     * &lt;p&gt;Returns a string that represents the {@code BigDecimal} as</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2893" href="#"></a></td>
<td><pre>     * described in the {@link #toString()} method, except that if</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2894" href="#"></a></td>
<td><pre>     * exponential notation is used, the power of ten is adjusted to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2895" href="#"></a></td>
<td><pre>     * be a multiple of three (engineering notation) such that the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2896" href="#"></a></td>
<td><pre>     * integer part of nonzero values will be in the range 1 through</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2897" href="#"></a></td>
<td><pre>     * 999.  If exponential notation is used for zero values, a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2898" href="#"></a></td>
<td><pre>     * decimal point and one or two fractional zero digits are used so</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2899" href="#"></a></td>
<td><pre>     * that the scale of the zero value is preserved.  Note that</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2900" href="#"></a></td>
<td><pre>     * unlike the output of {@link #toString()}, the output of this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2901" href="#"></a></td>
<td><pre>     * method is &lt;em&gt;not&lt;/em&gt; guaranteed to recover the same [integer,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2902" href="#"></a></td>
<td><pre>     * scale] pair of this {@code BigDecimal} if the output string is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2903" href="#"></a></td>
<td><pre>     * converting back to a {@code BigDecimal} using the {@linkplain</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2904" href="#"></a></td>
<td><pre>     * #BigDecimal(String) string constructor}.  The result of this method meets</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2905" href="#"></a></td>
<td><pre>     * the weaker constraint of always producing a numerically equal</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2906" href="#"></a></td>
<td><pre>     * result from applying the string constructor to the method's output.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2907" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2908" href="#"></a></td>
<td><pre>     * @return string representation of this {@code BigDecimal}, using</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2909" href="#"></a></td>
<td><pre>     *         engineering notation if an exponent is needed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2910" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2911" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2912" href="#"></a></td>
<td><pre>    public String toEngineeringString() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2913" href="#"></a></td>
<td><pre>        return layoutChars(false);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2914" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2915" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2916" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2917" href="#"></a></td>
<td><pre>     * Returns a string representation of this {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2918" href="#"></a></td>
<td><pre>     * without an exponent field.  For values with a positive scale,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2919" href="#"></a></td>
<td><pre>     * the number of digits to the right of the decimal point is used</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2920" href="#"></a></td>
<td><pre>     * to indicate scale.  For values with a zero or negative scale,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2921" href="#"></a></td>
<td><pre>     * the resulting string is generated as if the value were</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2922" href="#"></a></td>
<td><pre>     * converted to a numerically equal value with zero scale and as</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2923" href="#"></a></td>
<td><pre>     * if all the trailing zeros of the zero scale value were present</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2924" href="#"></a></td>
<td><pre>     * in the result.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2925" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2926" href="#"></a></td>
<td><pre>     * The entire string is prefixed by a minus sign character '-'</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2927" href="#"></a></td>
<td><pre>     * (&lt;tt&gt;'&amp;#92;u002D'&lt;/tt&gt;) if the unscaled value is less than</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2928" href="#"></a></td>
<td><pre>     * zero. No sign character is prefixed if the unscaled value is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2929" href="#"></a></td>
<td><pre>     * zero or positive.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2930" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2931" href="#"></a></td>
<td><pre>     * Note that if the result of this method is passed to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2932" href="#"></a></td>
<td><pre>     * {@linkplain #BigDecimal(String) string constructor}, only the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2933" href="#"></a></td>
<td><pre>     * numerical value of this {@code BigDecimal} will necessarily be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2934" href="#"></a></td>
<td><pre>     * recovered; the representation of the new {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2935" href="#"></a></td>
<td><pre>     * may have a different scale.  In particular, if this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2936" href="#"></a></td>
<td><pre>     * {@code BigDecimal} has a negative scale, the string resulting</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2937" href="#"></a></td>
<td><pre>     * from this method will have a scale of zero when processed by</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2938" href="#"></a></td>
<td><pre>     * the string constructor.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2939" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2940" href="#"></a></td>
<td><pre>     * (This method behaves analogously to the {@code toString}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2941" href="#"></a></td>
<td><pre>     * method in 1.4 and earlier releases.)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2942" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2943" href="#"></a></td>
<td><pre>     * @return a string representation of this {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2944" href="#"></a></td>
<td><pre>     * without an exponent field.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2945" href="#"></a></td>
<td><pre>     * @since 1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2946" href="#"></a></td>
<td><pre>     * @see #toString()</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2947" href="#"></a></td>
<td><pre>     * @see #toEngineeringString()</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2948" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2949" href="#"></a></td>
<td><pre>    public String toPlainString() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2950" href="#"></a></td>
<td><pre>        if(scale==0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2951" href="#"></a></td>
<td><pre>            if(intCompact!=INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2952" href="#"></a></td>
<td><pre>                return Long.toString(intCompact);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2953" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2954" href="#"></a></td>
<td><pre>                return intVal.toString();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2955" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2956" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2957" href="#"></a></td>
<td><pre>        if(this.scale&lt;0) { // No decimal point</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2958" href="#"></a></td>
<td><pre>            if(signum()==0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2959" href="#"></a></td>
<td><pre>                return &quot;0&quot;;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2960" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2961" href="#"></a></td>
<td><pre>            int tailingZeros = checkScaleNonZero((-(long)scale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2962" href="#"></a></td>
<td><pre>            StringBuilder buf;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2963" href="#"></a></td>
<td><pre>            if(intCompact!=INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2964" href="#"></a></td>
<td><pre>                buf = new StringBuilder(20+tailingZeros);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2965" href="#"></a></td>
<td><pre>                buf.append(intCompact);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2966" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2967" href="#"></a></td>
<td><pre>                String str = intVal.toString();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2968" href="#"></a></td>
<td><pre>                buf = new StringBuilder(str.length()+tailingZeros);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2969" href="#"></a></td>
<td><pre>                buf.append(str);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2970" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2971" href="#"></a></td>
<td><pre>            for (int i = 0; i &lt; tailingZeros; i++)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2972" href="#"></a></td>
<td><pre>                buf.append('0');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2973" href="#"></a></td>
<td><pre>            return buf.toString();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2974" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2975" href="#"></a></td>
<td><pre>        String str ;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2976" href="#"></a></td>
<td><pre>        if(intCompact!=INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2977" href="#"></a></td>
<td><pre>            str = Long.toString(Math.abs(intCompact));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2978" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2979" href="#"></a></td>
<td><pre>            str = intVal.abs().toString();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2980" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2981" href="#"></a></td>
<td><pre>        return getValueString(signum(), str, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2982" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2983" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2984" href="#"></a></td>
<td><pre>    /* Returns a digit.digit string */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2985" href="#"></a></td>
<td><pre>    private String getValueString(int signum, String intString, int scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2986" href="#"></a></td>
<td><pre>        /* Insert decimal point */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2987" href="#"></a></td>
<td><pre>        StringBuilder buf;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2988" href="#"></a></td>
<td><pre>        int insertionPoint = intString.length() - scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2989" href="#"></a></td>
<td><pre>        if (insertionPoint == 0) {  /* Point goes right before intVal */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2990" href="#"></a></td>
<td><pre>            return (signum&lt;0 ? &quot;-0.&quot; : &quot;0.&quot;) + intString;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2991" href="#"></a></td>
<td><pre>        } else if (insertionPoint &gt; 0) { /* Point goes inside intVal */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2992" href="#"></a></td>
<td><pre>            buf = new StringBuilder(intString);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2993" href="#"></a></td>
<td><pre>            buf.insert(insertionPoint, '.');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2994" href="#"></a></td>
<td><pre>            if (signum &lt; 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2995" href="#"></a></td>
<td><pre>                buf.insert(0, '-');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2996" href="#"></a></td>
<td><pre>        } else { /* We must insert zeros between point and intVal */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2997" href="#"></a></td>
<td><pre>            buf = new StringBuilder(3-insertionPoint + intString.length());</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2998" href="#"></a></td>
<td><pre>            buf.append(signum&lt;0 ? &quot;-0.&quot; : &quot;0.&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="2999" href="#"></a></td>
<td><pre>            for (int i=0; i&lt;-insertionPoint; i++)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3000" href="#"></a></td>
<td><pre>                buf.append('0');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3001" href="#"></a></td>
<td><pre>            buf.append(intString);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3002" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3003" href="#"></a></td>
<td><pre>        return buf.toString();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3004" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3005" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3006" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3007" href="#"></a></td>
<td><pre>     * Converts this {@code BigDecimal} to a {@code BigInteger}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3008" href="#"></a></td>
<td><pre>     * This conversion is analogous to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3009" href="#"></a></td>
<td><pre>     * &lt;i&gt;narrowing primitive conversion&lt;/i&gt; from {@code double} to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3010" href="#"></a></td>
<td><pre>     * {@code long} as defined in section 5.1.3 of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3011" href="#"></a></td>
<td><pre>     * &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3012" href="#"></a></td>
<td><pre>     * any fractional part of this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3013" href="#"></a></td>
<td><pre>     * {@code BigDecimal} will be discarded.  Note that this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3014" href="#"></a></td>
<td><pre>     * conversion can lose information about the precision of the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3015" href="#"></a></td>
<td><pre>     * {@code BigDecimal} value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3016" href="#"></a></td>
<td><pre>     * &lt;p&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3017" href="#"></a></td>
<td><pre>     * To have an exception thrown if the conversion is inexact (in</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3018" href="#"></a></td>
<td><pre>     * other words if a nonzero fractional part is discarded), use the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3019" href="#"></a></td>
<td><pre>     * {@link #toBigIntegerExact()} method.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3020" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3021" href="#"></a></td>
<td><pre>     * @return this {@code BigDecimal} converted to a {@code BigInteger}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3022" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3023" href="#"></a></td>
<td><pre>    public BigInteger toBigInteger() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3024" href="#"></a></td>
<td><pre>        // force to an integer, quietly</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3025" href="#"></a></td>
<td><pre>        return this.setScale(0, ROUND_DOWN).inflated();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3026" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3027" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3028" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3029" href="#"></a></td>
<td><pre>     * Converts this {@code BigDecimal} to a {@code BigInteger},</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3030" href="#"></a></td>
<td><pre>     * checking for lost information.  An exception is thrown if this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3031" href="#"></a></td>
<td><pre>     * {@code BigDecimal} has a nonzero fractional part.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3032" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3033" href="#"></a></td>
<td><pre>     * @return this {@code BigDecimal} converted to a {@code BigInteger}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3034" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code this} has a nonzero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3035" href="#"></a></td>
<td><pre>     *         fractional part.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3036" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3037" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3038" href="#"></a></td>
<td><pre>    public BigInteger toBigIntegerExact() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3039" href="#"></a></td>
<td><pre>        // round to an integer, with Exception if decimal part non-0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3040" href="#"></a></td>
<td><pre>        return this.setScale(0, ROUND_UNNECESSARY).inflated();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3041" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3042" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3043" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3044" href="#"></a></td>
<td><pre>     * Converts this {@code BigDecimal} to a {@code long}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3045" href="#"></a></td>
<td><pre>     * This conversion is analogous to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3046" href="#"></a></td>
<td><pre>     * &lt;i&gt;narrowing primitive conversion&lt;/i&gt; from {@code double} to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3047" href="#"></a></td>
<td><pre>     * {@code short} as defined in section 5.1.3 of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3048" href="#"></a></td>
<td><pre>     * &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3049" href="#"></a></td>
<td><pre>     * any fractional part of this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3050" href="#"></a></td>
<td><pre>     * {@code BigDecimal} will be discarded, and if the resulting</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3051" href="#"></a></td>
<td><pre>     * &quot;{@code BigInteger}&quot; is too big to fit in a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3052" href="#"></a></td>
<td><pre>     * {@code long}, only the low-order 64 bits are returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3053" href="#"></a></td>
<td><pre>     * Note that this conversion can lose information about the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3054" href="#"></a></td>
<td><pre>     * overall magnitude and precision of this {@code BigDecimal} value as well</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3055" href="#"></a></td>
<td><pre>     * as return a result with the opposite sign.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3056" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3057" href="#"></a></td>
<td><pre>     * @return this {@code BigDecimal} converted to a {@code long}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3058" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3059" href="#"></a></td>
<td><pre>    public long longValue(){</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3060" href="#"></a></td>
<td><pre>        return (intCompact != INFLATED &amp;&amp; scale == 0) ?</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3061" href="#"></a></td>
<td><pre>            intCompact:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3062" href="#"></a></td>
<td><pre>            toBigInteger().longValue();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3063" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3064" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3065" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3066" href="#"></a></td>
<td><pre>     * Converts this {@code BigDecimal} to a {@code long}, checking</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3067" href="#"></a></td>
<td><pre>     * for lost information.  If this {@code BigDecimal} has a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3068" href="#"></a></td>
<td><pre>     * nonzero fractional part or is out of the possible range for a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3069" href="#"></a></td>
<td><pre>     * {@code long} result then an {@code ArithmeticException} is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3070" href="#"></a></td>
<td><pre>     * thrown.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3071" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3072" href="#"></a></td>
<td><pre>     * @return this {@code BigDecimal} converted to a {@code long}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3073" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code this} has a nonzero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3074" href="#"></a></td>
<td><pre>     *         fractional part, or will not fit in a {@code long}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3075" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3076" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3077" href="#"></a></td>
<td><pre>    public long longValueExact() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3078" href="#"></a></td>
<td><pre>        if (intCompact != INFLATED &amp;&amp; scale == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3079" href="#"></a></td>
<td><pre>            return intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3080" href="#"></a></td>
<td><pre>        // If more than 19 digits in integer part it cannot possibly fit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3081" href="#"></a></td>
<td><pre>        if ((precision() - scale) &gt; 19) // [OK for negative scale too]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3082" href="#"></a></td>
<td><pre>            throw new java.lang.ArithmeticException(&quot;Overflow&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3083" href="#"></a></td>
<td><pre>        // Fastpath zero and &lt; 1.0 numbers (the latter can be very slow</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3084" href="#"></a></td>
<td><pre>        // to round if very small)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3085" href="#"></a></td>
<td><pre>        if (this.signum() == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3086" href="#"></a></td>
<td><pre>            return 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3087" href="#"></a></td>
<td><pre>        if ((this.precision() - this.scale) &lt;= 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3088" href="#"></a></td>
<td><pre>            throw new ArithmeticException(&quot;Rounding necessary&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3089" href="#"></a></td>
<td><pre>        // round to an integer, with Exception if decimal part non-0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3090" href="#"></a></td>
<td><pre>        BigDecimal num = this.setScale(0, ROUND_UNNECESSARY);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3091" href="#"></a></td>
<td><pre>        if (num.precision() &gt;= 19) // need to check carefully</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3092" href="#"></a></td>
<td><pre>            LongOverflow.check(num);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3093" href="#"></a></td>
<td><pre>        return num.inflated().longValue();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3094" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3095" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3096" href="#"></a></td>
<td><pre>    private static class LongOverflow {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3097" href="#"></a></td>
<td><pre>        /** BigInteger equal to Long.MIN_VALUE. */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3098" href="#"></a></td>
<td><pre>        private static final BigInteger LONGMIN = BigInteger.valueOf(Long.MIN_VALUE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3099" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3100" href="#"></a></td>
<td><pre>        /** BigInteger equal to Long.MAX_VALUE. */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3101" href="#"></a></td>
<td><pre>        private static final BigInteger LONGMAX = BigInteger.valueOf(Long.MAX_VALUE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3102" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3103" href="#"></a></td>
<td><pre>        public static void check(BigDecimal num) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3104" href="#"></a></td>
<td><pre>            BigInteger intVal = num.inflated();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3105" href="#"></a></td>
<td><pre>            if (intVal.compareTo(LONGMIN) &lt; 0 ||</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3106" href="#"></a></td>
<td><pre>                intVal.compareTo(LONGMAX) &gt; 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3107" href="#"></a></td>
<td><pre>                throw new java.lang.ArithmeticException(&quot;Overflow&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3108" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3109" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3110" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3111" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3112" href="#"></a></td>
<td><pre>     * Converts this {@code BigDecimal} to an {@code int}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3113" href="#"></a></td>
<td><pre>     * This conversion is analogous to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3114" href="#"></a></td>
<td><pre>     * &lt;i&gt;narrowing primitive conversion&lt;/i&gt; from {@code double} to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3115" href="#"></a></td>
<td><pre>     * {@code short} as defined in section 5.1.3 of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3116" href="#"></a></td>
<td><pre>     * &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3117" href="#"></a></td>
<td><pre>     * any fractional part of this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3118" href="#"></a></td>
<td><pre>     * {@code BigDecimal} will be discarded, and if the resulting</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3119" href="#"></a></td>
<td><pre>     * &quot;{@code BigInteger}&quot; is too big to fit in an</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3120" href="#"></a></td>
<td><pre>     * {@code int}, only the low-order 32 bits are returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3121" href="#"></a></td>
<td><pre>     * Note that this conversion can lose information about the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3122" href="#"></a></td>
<td><pre>     * overall magnitude and precision of this {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3123" href="#"></a></td>
<td><pre>     * value as well as return a result with the opposite sign.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3124" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3125" href="#"></a></td>
<td><pre>     * @return this {@code BigDecimal} converted to an {@code int}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3126" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3127" href="#"></a></td>
<td><pre>    public int intValue() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3128" href="#"></a></td>
<td><pre>        return  (intCompact != INFLATED &amp;&amp; scale == 0) ?</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3129" href="#"></a></td>
<td><pre>            (int)intCompact :</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3130" href="#"></a></td>
<td><pre>            toBigInteger().intValue();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3131" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3132" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3133" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3134" href="#"></a></td>
<td><pre>     * Converts this {@code BigDecimal} to an {@code int}, checking</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3135" href="#"></a></td>
<td><pre>     * for lost information.  If this {@code BigDecimal} has a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3136" href="#"></a></td>
<td><pre>     * nonzero fractional part or is out of the possible range for an</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3137" href="#"></a></td>
<td><pre>     * {@code int} result then an {@code ArithmeticException} is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3138" href="#"></a></td>
<td><pre>     * thrown.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3139" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3140" href="#"></a></td>
<td><pre>     * @return this {@code BigDecimal} converted to an {@code int}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3141" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code this} has a nonzero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3142" href="#"></a></td>
<td><pre>     *         fractional part, or will not fit in an {@code int}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3143" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3144" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3145" href="#"></a></td>
<td><pre>    public int intValueExact() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3146" href="#"></a></td>
<td><pre>       long num;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3147" href="#"></a></td>
<td><pre>       num = this.longValueExact();     // will check decimal part</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3148" href="#"></a></td>
<td><pre>       if ((int)num != num)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3149" href="#"></a></td>
<td><pre>           throw new java.lang.ArithmeticException(&quot;Overflow&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3150" href="#"></a></td>
<td><pre>       return (int)num;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3151" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3152" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3153" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3154" href="#"></a></td>
<td><pre>     * Converts this {@code BigDecimal} to a {@code short}, checking</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3155" href="#"></a></td>
<td><pre>     * for lost information.  If this {@code BigDecimal} has a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3156" href="#"></a></td>
<td><pre>     * nonzero fractional part or is out of the possible range for a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3157" href="#"></a></td>
<td><pre>     * {@code short} result then an {@code ArithmeticException} is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3158" href="#"></a></td>
<td><pre>     * thrown.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3159" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3160" href="#"></a></td>
<td><pre>     * @return this {@code BigDecimal} converted to a {@code short}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3161" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code this} has a nonzero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3162" href="#"></a></td>
<td><pre>     *         fractional part, or will not fit in a {@code short}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3163" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3164" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3165" href="#"></a></td>
<td><pre>    public short shortValueExact() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3166" href="#"></a></td>
<td><pre>       long num;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3167" href="#"></a></td>
<td><pre>       num = this.longValueExact();     // will check decimal part</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3168" href="#"></a></td>
<td><pre>       if ((short)num != num)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3169" href="#"></a></td>
<td><pre>           throw new java.lang.ArithmeticException(&quot;Overflow&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3170" href="#"></a></td>
<td><pre>       return (short)num;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3171" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3172" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3173" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3174" href="#"></a></td>
<td><pre>     * Converts this {@code BigDecimal} to a {@code byte}, checking</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3175" href="#"></a></td>
<td><pre>     * for lost information.  If this {@code BigDecimal} has a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3176" href="#"></a></td>
<td><pre>     * nonzero fractional part or is out of the possible range for a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3177" href="#"></a></td>
<td><pre>     * {@code byte} result then an {@code ArithmeticException} is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3178" href="#"></a></td>
<td><pre>     * thrown.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3179" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3180" href="#"></a></td>
<td><pre>     * @return this {@code BigDecimal} converted to a {@code byte}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3181" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if {@code this} has a nonzero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3182" href="#"></a></td>
<td><pre>     *         fractional part, or will not fit in a {@code byte}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3183" href="#"></a></td>
<td><pre>     * @since  1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3184" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3185" href="#"></a></td>
<td><pre>    public byte byteValueExact() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3186" href="#"></a></td>
<td><pre>       long num;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3187" href="#"></a></td>
<td><pre>       num = this.longValueExact();     // will check decimal part</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3188" href="#"></a></td>
<td><pre>       if ((byte)num != num)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3189" href="#"></a></td>
<td><pre>           throw new java.lang.ArithmeticException(&quot;Overflow&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3190" href="#"></a></td>
<td><pre>       return (byte)num;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3191" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3192" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3193" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3194" href="#"></a></td>
<td><pre>     * Converts this {@code BigDecimal} to a {@code float}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3195" href="#"></a></td>
<td><pre>     * This conversion is similar to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3196" href="#"></a></td>
<td><pre>     * &lt;i&gt;narrowing primitive conversion&lt;/i&gt; from {@code double} to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3197" href="#"></a></td>
<td><pre>     * {@code float} as defined in section 5.1.3 of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3198" href="#"></a></td>
<td><pre>     * &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3199" href="#"></a></td>
<td><pre>     * if this {@code BigDecimal} has too great a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3200" href="#"></a></td>
<td><pre>     * magnitude to represent as a {@code float}, it will be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3201" href="#"></a></td>
<td><pre>     * converted to {@link Float#NEGATIVE_INFINITY} or {@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3202" href="#"></a></td>
<td><pre>     * Float#POSITIVE_INFINITY} as appropriate.  Note that even when</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3203" href="#"></a></td>
<td><pre>     * the return value is finite, this conversion can lose</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3204" href="#"></a></td>
<td><pre>     * information about the precision of the {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3205" href="#"></a></td>
<td><pre>     * value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3206" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3207" href="#"></a></td>
<td><pre>     * @return this {@code BigDecimal} converted to a {@code float}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3208" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3209" href="#"></a></td>
<td><pre>    public float floatValue(){</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3210" href="#"></a></td>
<td><pre>        if(intCompact != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3211" href="#"></a></td>
<td><pre>            if (scale == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3212" href="#"></a></td>
<td><pre>                return (float)intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3213" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3214" href="#"></a></td>
<td><pre>                /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3215" href="#"></a></td>
<td><pre>                 * If both intCompact and the scale can be exactly</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3216" href="#"></a></td>
<td><pre>                 * represented as float values, perform a single float</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3217" href="#"></a></td>
<td><pre>                 * multiply or divide to compute the (properly</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3218" href="#"></a></td>
<td><pre>                 * rounded) result.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3219" href="#"></a></td>
<td><pre>                 */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3220" href="#"></a></td>
<td><pre>                if (Math.abs(intCompact) &lt; 1L&lt;&lt;22 ) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3221" href="#"></a></td>
<td><pre>                    // Don't have too guard against</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3222" href="#"></a></td>
<td><pre>                    // Math.abs(MIN_VALUE) because of outer check</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3223" href="#"></a></td>
<td><pre>                    // against INFLATED.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3224" href="#"></a></td>
<td><pre>                    if (scale &gt; 0 &amp;&amp; scale &lt; float10pow.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3225" href="#"></a></td>
<td><pre>                        return (float)intCompact / float10pow[scale];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3226" href="#"></a></td>
<td><pre>                    } else if (scale &lt; 0 &amp;&amp; scale &gt; -float10pow.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3227" href="#"></a></td>
<td><pre>                        return (float)intCompact * float10pow[-scale];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3228" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3229" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3230" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3231" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3232" href="#"></a></td>
<td><pre>        // Somewhat inefficient, but guaranteed to work.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3233" href="#"></a></td>
<td><pre>        return Float.parseFloat(this.toString());</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3234" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3235" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3236" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3237" href="#"></a></td>
<td><pre>     * Converts this {@code BigDecimal} to a {@code double}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3238" href="#"></a></td>
<td><pre>     * This conversion is similar to the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3239" href="#"></a></td>
<td><pre>     * &lt;i&gt;narrowing primitive conversion&lt;/i&gt; from {@code double} to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3240" href="#"></a></td>
<td><pre>     * {@code float} as defined in section 5.1.3 of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3241" href="#"></a></td>
<td><pre>     * &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3242" href="#"></a></td>
<td><pre>     * if this {@code BigDecimal} has too great a</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3243" href="#"></a></td>
<td><pre>     * magnitude represent as a {@code double}, it will be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3244" href="#"></a></td>
<td><pre>     * converted to {@link Double#NEGATIVE_INFINITY} or {@link</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3245" href="#"></a></td>
<td><pre>     * Double#POSITIVE_INFINITY} as appropriate.  Note that even when</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3246" href="#"></a></td>
<td><pre>     * the return value is finite, this conversion can lose</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3247" href="#"></a></td>
<td><pre>     * information about the precision of the {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3248" href="#"></a></td>
<td><pre>     * value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3249" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3250" href="#"></a></td>
<td><pre>     * @return this {@code BigDecimal} converted to a {@code double}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3251" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3252" href="#"></a></td>
<td><pre>    public double doubleValue(){</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3253" href="#"></a></td>
<td><pre>        if(intCompact != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3254" href="#"></a></td>
<td><pre>            if (scale == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3255" href="#"></a></td>
<td><pre>                return (double)intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3256" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3257" href="#"></a></td>
<td><pre>                /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3258" href="#"></a></td>
<td><pre>                 * If both intCompact and the scale can be exactly</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3259" href="#"></a></td>
<td><pre>                 * represented as double values, perform a single</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3260" href="#"></a></td>
<td><pre>                 * double multiply or divide to compute the (properly</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3261" href="#"></a></td>
<td><pre>                 * rounded) result.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3262" href="#"></a></td>
<td><pre>                 */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3263" href="#"></a></td>
<td><pre>                if (Math.abs(intCompact) &lt; 1L&lt;&lt;52 ) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3264" href="#"></a></td>
<td><pre>                    // Don't have too guard against</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3265" href="#"></a></td>
<td><pre>                    // Math.abs(MIN_VALUE) because of outer check</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3266" href="#"></a></td>
<td><pre>                    // against INFLATED.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3267" href="#"></a></td>
<td><pre>                    if (scale &gt; 0 &amp;&amp; scale &lt; double10pow.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3268" href="#"></a></td>
<td><pre>                        return (double)intCompact / double10pow[scale];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3269" href="#"></a></td>
<td><pre>                    } else if (scale &lt; 0 &amp;&amp; scale &gt; -double10pow.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3270" href="#"></a></td>
<td><pre>                        return (double)intCompact * double10pow[-scale];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3271" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3272" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3273" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3274" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3275" href="#"></a></td>
<td><pre>        // Somewhat inefficient, but guaranteed to work.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3276" href="#"></a></td>
<td><pre>        return Double.parseDouble(this.toString());</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3277" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3278" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3279" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3280" href="#"></a></td>
<td><pre>     * Powers of 10 which can be represented exactly in {@code</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3281" href="#"></a></td>
<td><pre>     * double}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3282" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3283" href="#"></a></td>
<td><pre>    private static final double double10pow[] = {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3284" href="#"></a></td>
<td><pre>        1.0e0,  1.0e1,  1.0e2,  1.0e3,  1.0e4,  1.0e5,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3285" href="#"></a></td>
<td><pre>        1.0e6,  1.0e7,  1.0e8,  1.0e9,  1.0e10, 1.0e11,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3286" href="#"></a></td>
<td><pre>        1.0e12, 1.0e13, 1.0e14, 1.0e15, 1.0e16, 1.0e17,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3287" href="#"></a></td>
<td><pre>        1.0e18, 1.0e19, 1.0e20, 1.0e21, 1.0e22</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3288" href="#"></a></td>
<td><pre>    };</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3289" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3290" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3291" href="#"></a></td>
<td><pre>     * Powers of 10 which can be represented exactly in {@code</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3292" href="#"></a></td>
<td><pre>     * float}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3293" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3294" href="#"></a></td>
<td><pre>    private static final float float10pow[] = {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3295" href="#"></a></td>
<td><pre>        1.0e0f, 1.0e1f, 1.0e2f, 1.0e3f, 1.0e4f, 1.0e5f,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3296" href="#"></a></td>
<td><pre>        1.0e6f, 1.0e7f, 1.0e8f, 1.0e9f, 1.0e10f</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3297" href="#"></a></td>
<td><pre>    };</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3298" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3299" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3300" href="#"></a></td>
<td><pre>     * Returns the size of an ulp, a unit in the last place, of this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3301" href="#"></a></td>
<td><pre>     * {@code BigDecimal}.  An ulp of a nonzero {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3302" href="#"></a></td>
<td><pre>     * value is the positive distance between this value and the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3303" href="#"></a></td>
<td><pre>     * {@code BigDecimal} value next larger in magnitude with the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3304" href="#"></a></td>
<td><pre>     * same number of digits.  An ulp of a zero value is numerically</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3305" href="#"></a></td>
<td><pre>     * equal to 1 with the scale of {@code this}.  The result is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3306" href="#"></a></td>
<td><pre>     * stored with the same scale as {@code this} so the result</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3307" href="#"></a></td>
<td><pre>     * for zero and nonzero values is equal to {@code [1,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3308" href="#"></a></td>
<td><pre>     * this.scale()]}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3309" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3310" href="#"></a></td>
<td><pre>     * @return the size of an ulp of {@code this}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3311" href="#"></a></td>
<td><pre>     * @since 1.5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3312" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3313" href="#"></a></td>
<td><pre>    public BigDecimal ulp() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3314" href="#"></a></td>
<td><pre>        return BigDecimal.valueOf(1, this.scale(), 1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3315" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3316" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3317" href="#"></a></td>
<td><pre>    // Private class to build a string representation for BigDecimal object.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3318" href="#"></a></td>
<td><pre>    // &quot;StringBuilderHelper&quot; is constructed as a thread local variable so it is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3319" href="#"></a></td>
<td><pre>    // thread safe. The StringBuilder field acts as a buffer to hold the temporary</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3320" href="#"></a></td>
<td><pre>    // representation of BigDecimal. The cmpCharArray holds all the characters for</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3321" href="#"></a></td>
<td><pre>    // the compact representation of BigDecimal (except for '-' sign' if it is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3322" href="#"></a></td>
<td><pre>    // negative) if its intCompact field is not INFLATED. It is shared by all</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3323" href="#"></a></td>
<td><pre>    // calls to toString() and its variants in that particular thread.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3324" href="#"></a></td>
<td><pre>    static class StringBuilderHelper {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3325" href="#"></a></td>
<td><pre>        final StringBuilder sb;    // Placeholder for BigDecimal string</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3326" href="#"></a></td>
<td><pre>        final char[] cmpCharArray; // character array to place the intCompact</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3327" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3328" href="#"></a></td>
<td><pre>        StringBuilderHelper() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3329" href="#"></a></td>
<td><pre>            sb = new StringBuilder();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3330" href="#"></a></td>
<td><pre>            // All non negative longs can be made to fit into 19 character array.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3331" href="#"></a></td>
<td><pre>            cmpCharArray = new char[19];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3332" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3333" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3334" href="#"></a></td>
<td><pre>        // Accessors.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3335" href="#"></a></td>
<td><pre>        StringBuilder getStringBuilder() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3336" href="#"></a></td>
<td><pre>            sb.setLength(0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3337" href="#"></a></td>
<td><pre>            return sb;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3338" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3339" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3340" href="#"></a></td>
<td><pre>        char[] getCompactCharArray() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3341" href="#"></a></td>
<td><pre>            return cmpCharArray;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3342" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3343" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3344" href="#"></a></td>
<td><pre>        /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3345" href="#"></a></td>
<td><pre>         * Places characters representing the intCompact in {@code long} into</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3346" href="#"></a></td>
<td><pre>         * cmpCharArray and returns the offset to the array where the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3347" href="#"></a></td>
<td><pre>         * representation starts.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3348" href="#"></a></td>
<td><pre>         *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3349" href="#"></a></td>
<td><pre>         * @param intCompact the number to put into the cmpCharArray.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3350" href="#"></a></td>
<td><pre>         * @return offset to the array where the representation starts.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3351" href="#"></a></td>
<td><pre>         * Note: intCompact must be greater or equal to zero.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3352" href="#"></a></td>
<td><pre>         */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3353" href="#"></a></td>
<td><pre>        int putIntCompact(long intCompact) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3354" href="#"></a></td>
<td><pre>            assert intCompact &gt;= 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3355" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3356" href="#"></a></td>
<td><pre>            long q;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3357" href="#"></a></td>
<td><pre>            int r;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3358" href="#"></a></td>
<td><pre>            // since we start from the least significant digit, charPos points to</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3359" href="#"></a></td>
<td><pre>            // the last character in cmpCharArray.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3360" href="#"></a></td>
<td><pre>            int charPos = cmpCharArray.length;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3361" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3362" href="#"></a></td>
<td><pre>            // Get 2 digits/iteration using longs until quotient fits into an int</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3363" href="#"></a></td>
<td><pre>            while (intCompact &gt; Integer.MAX_VALUE) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3364" href="#"></a></td>
<td><pre>                q = intCompact / 100;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3365" href="#"></a></td>
<td><pre>                r = (int)(intCompact - q * 100);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3366" href="#"></a></td>
<td><pre>                intCompact = q;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3367" href="#"></a></td>
<td><pre>                cmpCharArray[--charPos] = DIGIT_ONES[r];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3368" href="#"></a></td>
<td><pre>                cmpCharArray[--charPos] = DIGIT_TENS[r];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3369" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3370" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3371" href="#"></a></td>
<td><pre>            // Get 2 digits/iteration using ints when i2 &gt;= 100</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3372" href="#"></a></td>
<td><pre>            int q2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3373" href="#"></a></td>
<td><pre>            int i2 = (int)intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3374" href="#"></a></td>
<td><pre>            while (i2 &gt;= 100) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3375" href="#"></a></td>
<td><pre>                q2 = i2 / 100;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3376" href="#"></a></td>
<td><pre>                r  = i2 - q2 * 100;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3377" href="#"></a></td>
<td><pre>                i2 = q2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3378" href="#"></a></td>
<td><pre>                cmpCharArray[--charPos] = DIGIT_ONES[r];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3379" href="#"></a></td>
<td><pre>                cmpCharArray[--charPos] = DIGIT_TENS[r];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3380" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3381" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3382" href="#"></a></td>
<td><pre>            cmpCharArray[--charPos] = DIGIT_ONES[i2];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3383" href="#"></a></td>
<td><pre>            if (i2 &gt;= 10)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3384" href="#"></a></td>
<td><pre>                cmpCharArray[--charPos] = DIGIT_TENS[i2];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3385" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3386" href="#"></a></td>
<td><pre>            return charPos;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3387" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3388" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3389" href="#"></a></td>
<td><pre>        final static char[] DIGIT_TENS = {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3390" href="#"></a></td>
<td><pre>            '0', '0', '0', '0', '0', '0', '0', '0', '0', '0',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3391" href="#"></a></td>
<td><pre>            '1', '1', '1', '1', '1', '1', '1', '1', '1', '1',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3392" href="#"></a></td>
<td><pre>            '2', '2', '2', '2', '2', '2', '2', '2', '2', '2',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3393" href="#"></a></td>
<td><pre>            '3', '3', '3', '3', '3', '3', '3', '3', '3', '3',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3394" href="#"></a></td>
<td><pre>            '4', '4', '4', '4', '4', '4', '4', '4', '4', '4',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3395" href="#"></a></td>
<td><pre>            '5', '5', '5', '5', '5', '5', '5', '5', '5', '5',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3396" href="#"></a></td>
<td><pre>            '6', '6', '6', '6', '6', '6', '6', '6', '6', '6',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3397" href="#"></a></td>
<td><pre>            '7', '7', '7', '7', '7', '7', '7', '7', '7', '7',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3398" href="#"></a></td>
<td><pre>            '8', '8', '8', '8', '8', '8', '8', '8', '8', '8',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3399" href="#"></a></td>
<td><pre>            '9', '9', '9', '9', '9', '9', '9', '9', '9', '9',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3400" href="#"></a></td>
<td><pre>        };</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3401" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3402" href="#"></a></td>
<td><pre>        final static char[] DIGIT_ONES = {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3403" href="#"></a></td>
<td><pre>            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3404" href="#"></a></td>
<td><pre>            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3405" href="#"></a></td>
<td><pre>            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3406" href="#"></a></td>
<td><pre>            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3407" href="#"></a></td>
<td><pre>            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3408" href="#"></a></td>
<td><pre>            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3409" href="#"></a></td>
<td><pre>            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3410" href="#"></a></td>
<td><pre>            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3411" href="#"></a></td>
<td><pre>            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3412" href="#"></a></td>
<td><pre>            '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3413" href="#"></a></td>
<td><pre>        };</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3414" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3415" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3416" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3417" href="#"></a></td>
<td><pre>     * Lay out this {@code BigDecimal} into a {@code char[]} array.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3418" href="#"></a></td>
<td><pre>     * The Java 1.2 equivalent to this was called {@code getValueString}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3419" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3420" href="#"></a></td>
<td><pre>     * @param  sci {@code true} for Scientific exponential notation;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3421" href="#"></a></td>
<td><pre>     *          {@code false} for Engineering</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3422" href="#"></a></td>
<td><pre>     * @return string with canonical string representation of this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3423" href="#"></a></td>
<td><pre>     *         {@code BigDecimal}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3424" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3425" href="#"></a></td>
<td><pre>    private String layoutChars(boolean sci) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3426" href="#"></a></td>
<td><pre>        if (scale == 0)                      // zero scale is trivial</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3427" href="#"></a></td>
<td><pre>            return (intCompact != INFLATED) ?</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3428" href="#"></a></td>
<td><pre>                Long.toString(intCompact):</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3429" href="#"></a></td>
<td><pre>                intVal.toString();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3430" href="#"></a></td>
<td><pre>        if (scale == 2  &amp;&amp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3431" href="#"></a></td>
<td><pre>            intCompact &gt;= 0 &amp;&amp; intCompact &lt; Integer.MAX_VALUE) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3432" href="#"></a></td>
<td><pre>            // currency fast path</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3433" href="#"></a></td>
<td><pre>            int lowInt = (int)intCompact % 100;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3434" href="#"></a></td>
<td><pre>            int highInt = (int)intCompact / 100;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3435" href="#"></a></td>
<td><pre>            return (Integer.toString(highInt) + '.' +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3436" href="#"></a></td>
<td><pre>                    StringBuilderHelper.DIGIT_TENS[lowInt] +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3437" href="#"></a></td>
<td><pre>                    StringBuilderHelper.DIGIT_ONES[lowInt]) ;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3438" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3439" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3440" href="#"></a></td>
<td><pre>        StringBuilderHelper sbHelper = threadLocalStringBuilderHelper.get();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3441" href="#"></a></td>
<td><pre>        char[] coeff;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3442" href="#"></a></td>
<td><pre>        int offset;  // offset is the starting index for coeff array</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3443" href="#"></a></td>
<td><pre>        // Get the significand as an absolute value</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3444" href="#"></a></td>
<td><pre>        if (intCompact != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3445" href="#"></a></td>
<td><pre>            offset = sbHelper.putIntCompact(Math.abs(intCompact));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3446" href="#"></a></td>
<td><pre>            coeff  = sbHelper.getCompactCharArray();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3447" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3448" href="#"></a></td>
<td><pre>            offset = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3449" href="#"></a></td>
<td><pre>            coeff  = intVal.abs().toString().toCharArray();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3450" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3451" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3452" href="#"></a></td>
<td><pre>        // Construct a buffer, with sufficient capacity for all cases.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3453" href="#"></a></td>
<td><pre>        // If E-notation is needed, length will be: +1 if negative, +1</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3454" href="#"></a></td>
<td><pre>        // if '.' needed, +2 for &quot;E+&quot;, + up to 10 for adjusted exponent.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3455" href="#"></a></td>
<td><pre>        // Otherwise it could have +1 if negative, plus leading &quot;0.00000&quot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3456" href="#"></a></td>
<td><pre>        StringBuilder buf = sbHelper.getStringBuilder();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3457" href="#"></a></td>
<td><pre>        if (signum() &lt; 0)             // prefix '-' if negative</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3458" href="#"></a></td>
<td><pre>            buf.append('-');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3459" href="#"></a></td>
<td><pre>        int coeffLen = coeff.length - offset;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3460" href="#"></a></td>
<td><pre>        long adjusted = -(long)scale + (coeffLen -1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3461" href="#"></a></td>
<td><pre>        if ((scale &gt;= 0) &amp;&amp; (adjusted &gt;= -6)) { // plain number</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3462" href="#"></a></td>
<td><pre>            int pad = scale - coeffLen;         // count of padding zeros</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3463" href="#"></a></td>
<td><pre>            if (pad &gt;= 0) {                     // 0.xxx form</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3464" href="#"></a></td>
<td><pre>                buf.append('0');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3465" href="#"></a></td>
<td><pre>                buf.append('.');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3466" href="#"></a></td>
<td><pre>                for (; pad&gt;0; pad--) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3467" href="#"></a></td>
<td><pre>                    buf.append('0');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3468" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3469" href="#"></a></td>
<td><pre>                buf.append(coeff, offset, coeffLen);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3470" href="#"></a></td>
<td><pre>            } else {                         // xx.xx form</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3471" href="#"></a></td>
<td><pre>                buf.append(coeff, offset, -pad);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3472" href="#"></a></td>
<td><pre>                buf.append('.');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3473" href="#"></a></td>
<td><pre>                buf.append(coeff, -pad + offset, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3474" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3475" href="#"></a></td>
<td><pre>        } else { // E-notation is needed</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3476" href="#"></a></td>
<td><pre>            if (sci) {                       // Scientific notation</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3477" href="#"></a></td>
<td><pre>                buf.append(coeff[offset]);   // first character</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3478" href="#"></a></td>
<td><pre>                if (coeffLen &gt; 1) {          // more to come</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3479" href="#"></a></td>
<td><pre>                    buf.append('.');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3480" href="#"></a></td>
<td><pre>                    buf.append(coeff, offset + 1, coeffLen - 1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3481" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3482" href="#"></a></td>
<td><pre>            } else {                         // Engineering notation</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3483" href="#"></a></td>
<td><pre>                int sig = (int)(adjusted % 3);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3484" href="#"></a></td>
<td><pre>                if (sig &lt; 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3485" href="#"></a></td>
<td><pre>                    sig += 3;                // [adjusted was negative]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3486" href="#"></a></td>
<td><pre>                adjusted -= sig;             // now a multiple of 3</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3487" href="#"></a></td>
<td><pre>                sig++;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3488" href="#"></a></td>
<td><pre>                if (signum() == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3489" href="#"></a></td>
<td><pre>                    switch (sig) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3490" href="#"></a></td>
<td><pre>                    case 1:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3491" href="#"></a></td>
<td><pre>                        buf.append('0'); // exponent is a multiple of three</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3492" href="#"></a></td>
<td><pre>                        break;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3493" href="#"></a></td>
<td><pre>                    case 2:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3494" href="#"></a></td>
<td><pre>                        buf.append(&quot;0.00&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3495" href="#"></a></td>
<td><pre>                        adjusted += 3;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3496" href="#"></a></td>
<td><pre>                        break;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3497" href="#"></a></td>
<td><pre>                    case 3:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3498" href="#"></a></td>
<td><pre>                        buf.append(&quot;0.0&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3499" href="#"></a></td>
<td><pre>                        adjusted += 3;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3500" href="#"></a></td>
<td><pre>                        break;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3501" href="#"></a></td>
<td><pre>                    default:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3502" href="#"></a></td>
<td><pre>                        throw new AssertionError(&quot;Unexpected sig value &quot; + sig);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3503" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3504" href="#"></a></td>
<td><pre>                } else if (sig &gt;= coeffLen) {   // significand all in integer</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3505" href="#"></a></td>
<td><pre>                    buf.append(coeff, offset, coeffLen);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3506" href="#"></a></td>
<td><pre>                    // may need some zeros, too</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3507" href="#"></a></td>
<td><pre>                    for (int i = sig - coeffLen; i &gt; 0; i--)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3508" href="#"></a></td>
<td><pre>                        buf.append('0');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3509" href="#"></a></td>
<td><pre>                } else {                     // xx.xxE form</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3510" href="#"></a></td>
<td><pre>                    buf.append(coeff, offset, sig);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3511" href="#"></a></td>
<td><pre>                    buf.append('.');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3512" href="#"></a></td>
<td><pre>                    buf.append(coeff, offset + sig, coeffLen - sig);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3513" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3514" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3515" href="#"></a></td>
<td><pre>            if (adjusted != 0) {             // [!sci could have made 0]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3516" href="#"></a></td>
<td><pre>                buf.append('E');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3517" href="#"></a></td>
<td><pre>                if (adjusted &gt; 0)            // force sign for positive</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3518" href="#"></a></td>
<td><pre>                    buf.append('+');</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3519" href="#"></a></td>
<td><pre>                buf.append(adjusted);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3520" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3521" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3522" href="#"></a></td>
<td><pre>        return buf.toString();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3523" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3524" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3525" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3526" href="#"></a></td>
<td><pre>     * Return 10 to the power n, as a {@code BigInteger}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3527" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3528" href="#"></a></td>
<td><pre>     * @param  n the power of ten to be returned (&gt;=0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3529" href="#"></a></td>
<td><pre>     * @return a {@code BigInteger} with the value (10&lt;sup&gt;n&lt;/sup&gt;)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3530" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3531" href="#"></a></td>
<td><pre>    private static BigInteger bigTenToThe(int n) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3532" href="#"></a></td>
<td><pre>        if (n &lt; 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3533" href="#"></a></td>
<td><pre>            return BigInteger.ZERO;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3534" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3535" href="#"></a></td>
<td><pre>        if (n &lt; BIG_TEN_POWERS_TABLE_MAX) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3536" href="#"></a></td>
<td><pre>            BigInteger[] pows = BIG_TEN_POWERS_TABLE;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3537" href="#"></a></td>
<td><pre>            if (n &lt; pows.length)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3538" href="#"></a></td>
<td><pre>                return pows[n];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3539" href="#"></a></td>
<td><pre>            else</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3540" href="#"></a></td>
<td><pre>                return expandBigIntegerTenPowers(n);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3541" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3542" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3543" href="#"></a></td>
<td><pre>        return BigInteger.TEN.pow(n);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3544" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3545" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3546" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3547" href="#"></a></td>
<td><pre>     * Expand the BIG_TEN_POWERS_TABLE array to contain at least 10**n.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3548" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3549" href="#"></a></td>
<td><pre>     * @param n the power of ten to be returned (&gt;=0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3550" href="#"></a></td>
<td><pre>     * @return a {@code BigDecimal} with the value (10&lt;sup&gt;n&lt;/sup&gt;) and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3551" href="#"></a></td>
<td><pre>     *         in the meantime, the BIG_TEN_POWERS_TABLE array gets</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3552" href="#"></a></td>
<td><pre>     *         expanded to the size greater than n.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3553" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3554" href="#"></a></td>
<td><pre>    private static BigInteger expandBigIntegerTenPowers(int n) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3555" href="#"></a></td>
<td><pre>        synchronized(BigDecimal.class) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3556" href="#"></a></td>
<td><pre>            BigInteger[] pows = BIG_TEN_POWERS_TABLE;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3557" href="#"></a></td>
<td><pre>            int curLen = pows.length;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3558" href="#"></a></td>
<td><pre>            // The following comparison and the above synchronized statement is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3559" href="#"></a></td>
<td><pre>            // to prevent multiple threads from expanding the same array.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3560" href="#"></a></td>
<td><pre>            if (curLen &lt;= n) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3561" href="#"></a></td>
<td><pre>                int newLen = curLen &lt;&lt; 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3562" href="#"></a></td>
<td><pre>                while (newLen &lt;= n)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3563" href="#"></a></td>
<td><pre>                    newLen &lt;&lt;= 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3564" href="#"></a></td>
<td><pre>                pows = Arrays.copyOf(pows, newLen);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3565" href="#"></a></td>
<td><pre>                for (int i = curLen; i &lt; newLen; i++)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3566" href="#"></a></td>
<td><pre>                    pows[i] = pows[i - 1].multiply(BigInteger.TEN);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3567" href="#"></a></td>
<td><pre>                // Based on the following facts:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3568" href="#"></a></td>
<td><pre>                // 1. pows is a private local varible;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3569" href="#"></a></td>
<td><pre>                // 2. the following store is a volatile store.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3570" href="#"></a></td>
<td><pre>                // the newly created array elements can be safely published.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3571" href="#"></a></td>
<td><pre>                BIG_TEN_POWERS_TABLE = pows;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3572" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3573" href="#"></a></td>
<td><pre>            return pows[n];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3574" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3575" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3576" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3577" href="#"></a></td>
<td><pre>    private static final long[] LONG_TEN_POWERS_TABLE = {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3578" href="#"></a></td>
<td><pre>        1,                     // 0 / 10^0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3579" href="#"></a></td>
<td><pre>        10,                    // 1 / 10^1</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3580" href="#"></a></td>
<td><pre>        100,                   // 2 / 10^2</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3581" href="#"></a></td>
<td><pre>        1000,                  // 3 / 10^3</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3582" href="#"></a></td>
<td><pre>        10000,                 // 4 / 10^4</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3583" href="#"></a></td>
<td><pre>        100000,                // 5 / 10^5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3584" href="#"></a></td>
<td><pre>        1000000,               // 6 / 10^6</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3585" href="#"></a></td>
<td><pre>        10000000,              // 7 / 10^7</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3586" href="#"></a></td>
<td><pre>        100000000,             // 8 / 10^8</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3587" href="#"></a></td>
<td><pre>        1000000000,            // 9 / 10^9</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3588" href="#"></a></td>
<td><pre>        10000000000L,          // 10 / 10^10</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3589" href="#"></a></td>
<td><pre>        100000000000L,         // 11 / 10^11</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3590" href="#"></a></td>
<td><pre>        1000000000000L,        // 12 / 10^12</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3591" href="#"></a></td>
<td><pre>        10000000000000L,       // 13 / 10^13</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3592" href="#"></a></td>
<td><pre>        100000000000000L,      // 14 / 10^14</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3593" href="#"></a></td>
<td><pre>        1000000000000000L,     // 15 / 10^15</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3594" href="#"></a></td>
<td><pre>        10000000000000000L,    // 16 / 10^16</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3595" href="#"></a></td>
<td><pre>        100000000000000000L,   // 17 / 10^17</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3596" href="#"></a></td>
<td><pre>        1000000000000000000L   // 18 / 10^18</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3597" href="#"></a></td>
<td><pre>    };</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3598" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3599" href="#"></a></td>
<td><pre>    private static volatile BigInteger BIG_TEN_POWERS_TABLE[] = {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3600" href="#"></a></td>
<td><pre>        BigInteger.ONE,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3601" href="#"></a></td>
<td><pre>        BigInteger.valueOf(10),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3602" href="#"></a></td>
<td><pre>        BigInteger.valueOf(100),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3603" href="#"></a></td>
<td><pre>        BigInteger.valueOf(1000),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3604" href="#"></a></td>
<td><pre>        BigInteger.valueOf(10000),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3605" href="#"></a></td>
<td><pre>        BigInteger.valueOf(100000),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3606" href="#"></a></td>
<td><pre>        BigInteger.valueOf(1000000),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3607" href="#"></a></td>
<td><pre>        BigInteger.valueOf(10000000),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3608" href="#"></a></td>
<td><pre>        BigInteger.valueOf(100000000),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3609" href="#"></a></td>
<td><pre>        BigInteger.valueOf(1000000000),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3610" href="#"></a></td>
<td><pre>        BigInteger.valueOf(10000000000L),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3611" href="#"></a></td>
<td><pre>        BigInteger.valueOf(100000000000L),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3612" href="#"></a></td>
<td><pre>        BigInteger.valueOf(1000000000000L),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3613" href="#"></a></td>
<td><pre>        BigInteger.valueOf(10000000000000L),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3614" href="#"></a></td>
<td><pre>        BigInteger.valueOf(100000000000000L),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3615" href="#"></a></td>
<td><pre>        BigInteger.valueOf(1000000000000000L),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3616" href="#"></a></td>
<td><pre>        BigInteger.valueOf(10000000000000000L),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3617" href="#"></a></td>
<td><pre>        BigInteger.valueOf(100000000000000000L),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3618" href="#"></a></td>
<td><pre>        BigInteger.valueOf(1000000000000000000L)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3619" href="#"></a></td>
<td><pre>    };</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3620" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3621" href="#"></a></td>
<td><pre>    private static final int BIG_TEN_POWERS_TABLE_INITLEN =</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3622" href="#"></a></td>
<td><pre>        BIG_TEN_POWERS_TABLE.length;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3623" href="#"></a></td>
<td><pre>    private static final int BIG_TEN_POWERS_TABLE_MAX =</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3624" href="#"></a></td>
<td><pre>        16 * BIG_TEN_POWERS_TABLE_INITLEN;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3625" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3626" href="#"></a></td>
<td><pre>    private static final long THRESHOLDS_TABLE[] = {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3627" href="#"></a></td>
<td><pre>        Long.MAX_VALUE,                     // 0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3628" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/10L,                 // 1</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3629" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/100L,                // 2</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3630" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/1000L,               // 3</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3631" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/10000L,              // 4</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3632" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/100000L,             // 5</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3633" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/1000000L,            // 6</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3634" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/10000000L,           // 7</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3635" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/100000000L,          // 8</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3636" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/1000000000L,         // 9</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3637" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/10000000000L,        // 10</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3638" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/100000000000L,       // 11</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3639" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/1000000000000L,      // 12</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3640" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/10000000000000L,     // 13</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3641" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/100000000000000L,    // 14</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3642" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/1000000000000000L,   // 15</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3643" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/10000000000000000L,  // 16</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3644" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/100000000000000000L, // 17</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3645" href="#"></a></td>
<td><pre>        Long.MAX_VALUE/1000000000000000000L // 18</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3646" href="#"></a></td>
<td><pre>    };</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3647" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3648" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3649" href="#"></a></td>
<td><pre>     * Compute val * 10 ^ n; return this product if it is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3650" href="#"></a></td>
<td><pre>     * representable as a long, INFLATED otherwise.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3651" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3652" href="#"></a></td>
<td><pre>    private static long longMultiplyPowerTen(long val, int n) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3653" href="#"></a></td>
<td><pre>        if (val == 0 || n &lt;= 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3654" href="#"></a></td>
<td><pre>            return val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3655" href="#"></a></td>
<td><pre>        long[] tab = LONG_TEN_POWERS_TABLE;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3656" href="#"></a></td>
<td><pre>        long[] bounds = THRESHOLDS_TABLE;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3657" href="#"></a></td>
<td><pre>        if (n &lt; tab.length &amp;&amp; n &lt; bounds.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3658" href="#"></a></td>
<td><pre>            long tenpower = tab[n];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3659" href="#"></a></td>
<td><pre>            if (val == 1)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3660" href="#"></a></td>
<td><pre>                return tenpower;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3661" href="#"></a></td>
<td><pre>            if (Math.abs(val) &lt;= bounds[n])</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3662" href="#"></a></td>
<td><pre>                return val * tenpower;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3663" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3664" href="#"></a></td>
<td><pre>        return INFLATED;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3665" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3666" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3667" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3668" href="#"></a></td>
<td><pre>     * Compute this * 10 ^ n.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3669" href="#"></a></td>
<td><pre>     * Needed mainly to allow special casing to trap zero value</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3670" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3671" href="#"></a></td>
<td><pre>    private BigInteger bigMultiplyPowerTen(int n) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3672" href="#"></a></td>
<td><pre>        if (n &lt;= 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3673" href="#"></a></td>
<td><pre>            return this.inflated();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3674" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3675" href="#"></a></td>
<td><pre>        if (intCompact != INFLATED)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3676" href="#"></a></td>
<td><pre>            return bigTenToThe(n).multiply(intCompact);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3677" href="#"></a></td>
<td><pre>        else</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3678" href="#"></a></td>
<td><pre>            return intVal.multiply(bigTenToThe(n));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3679" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3680" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3681" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3682" href="#"></a></td>
<td><pre>     * Returns appropriate BigInteger from intVal field if intVal is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3683" href="#"></a></td>
<td><pre>     * null, i.e. the compact representation is in use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3684" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3685" href="#"></a></td>
<td><pre>    private BigInteger inflated() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3686" href="#"></a></td>
<td><pre>        if (intVal == null) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3687" href="#"></a></td>
<td><pre>            return BigInteger.valueOf(intCompact);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3688" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3689" href="#"></a></td>
<td><pre>        return intVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3690" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3691" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3692" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3693" href="#"></a></td>
<td><pre>     * Match the scales of two {@code BigDecimal}s to align their</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3694" href="#"></a></td>
<td><pre>     * least significant digits.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3695" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3696" href="#"></a></td>
<td><pre>     * &lt;p&gt;If the scales of val[0] and val[1] differ, rescale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3697" href="#"></a></td>
<td><pre>     * (non-destructively) the lower-scaled {@code BigDecimal} so</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3698" href="#"></a></td>
<td><pre>     * they match.  That is, the lower-scaled reference will be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3699" href="#"></a></td>
<td><pre>     * replaced by a reference to a new object with the same scale as</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3700" href="#"></a></td>
<td><pre>     * the other {@code BigDecimal}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3701" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3702" href="#"></a></td>
<td><pre>     * @param  val array of two elements referring to the two</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3703" href="#"></a></td>
<td><pre>     *         {@code BigDecimal}s to be aligned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3704" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3705" href="#"></a></td>
<td><pre>    private static void matchScale(BigDecimal[] val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3706" href="#"></a></td>
<td><pre>        if (val[0].scale == val[1].scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3707" href="#"></a></td>
<td><pre>            return;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3708" href="#"></a></td>
<td><pre>        } else if (val[0].scale &lt; val[1].scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3709" href="#"></a></td>
<td><pre>            val[0] = val[0].setScale(val[1].scale, ROUND_UNNECESSARY);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3710" href="#"></a></td>
<td><pre>        } else if (val[1].scale &lt; val[0].scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3711" href="#"></a></td>
<td><pre>            val[1] = val[1].setScale(val[0].scale, ROUND_UNNECESSARY);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3712" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3713" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3714" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3715" href="#"></a></td>
<td><pre>    private static class UnsafeHolder {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3716" href="#"></a></td>
<td><pre>        private static final sun.misc.Unsafe unsafe;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3717" href="#"></a></td>
<td><pre>        private static final long intCompactOffset;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3718" href="#"></a></td>
<td><pre>        private static final long intValOffset;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3719" href="#"></a></td>
<td><pre>        static {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3720" href="#"></a></td>
<td><pre>            try {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3721" href="#"></a></td>
<td><pre>                unsafe = sun.misc.Unsafe.getUnsafe();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3722" href="#"></a></td>
<td><pre>                intCompactOffset = unsafe.objectFieldOffset</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3723" href="#"></a></td>
<td><pre>                    (BigDecimal.class.getDeclaredField(&quot;intCompact&quot;));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3724" href="#"></a></td>
<td><pre>                intValOffset = unsafe.objectFieldOffset</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3725" href="#"></a></td>
<td><pre>                    (BigDecimal.class.getDeclaredField(&quot;intVal&quot;));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3726" href="#"></a></td>
<td><pre>            } catch (Exception ex) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3727" href="#"></a></td>
<td><pre>                throw new ExceptionInInitializerError(ex);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3728" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3729" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3730" href="#"></a></td>
<td><pre>        static void setIntCompactVolatile(BigDecimal bd, long val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3731" href="#"></a></td>
<td><pre>            unsafe.putLongVolatile(bd, intCompactOffset, val);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3732" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3733" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3734" href="#"></a></td>
<td><pre>        static void setIntValVolatile(BigDecimal bd, BigInteger val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3735" href="#"></a></td>
<td><pre>            unsafe.putObjectVolatile(bd, intValOffset, val);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3736" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3737" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3738" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3739" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3740" href="#"></a></td>
<td><pre>     * Reconstitute the {@code BigDecimal} instance from a stream (that is,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3741" href="#"></a></td>
<td><pre>     * deserialize it).</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3742" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3743" href="#"></a></td>
<td><pre>     * @param s the stream being read.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3744" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3745" href="#"></a></td>
<td><pre>    private void readObject(java.io.ObjectInputStream s)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3746" href="#"></a></td>
<td><pre>        throws java.io.IOException, ClassNotFoundException {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3747" href="#"></a></td>
<td><pre>        // Read in all fields</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3748" href="#"></a></td>
<td><pre>        s.defaultReadObject();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3749" href="#"></a></td>
<td><pre>        // validate possibly bad fields</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3750" href="#"></a></td>
<td><pre>        if (intVal == null) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3751" href="#"></a></td>
<td><pre>            String message = &quot;BigDecimal: null intVal in stream&quot;;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3752" href="#"></a></td>
<td><pre>            throw new java.io.StreamCorruptedException(message);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3753" href="#"></a></td>
<td><pre>        // [all values of scale are now allowed]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3754" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3755" href="#"></a></td>
<td><pre>        UnsafeHolder.setIntCompactVolatile(this, compactValFor(intVal));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3756" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3757" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3758" href="#"></a></td>
<td><pre>   /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3759" href="#"></a></td>
<td><pre>    * Serialize this {@code BigDecimal} to the stream in question</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3760" href="#"></a></td>
<td><pre>    *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3761" href="#"></a></td>
<td><pre>    * @param s the stream to serialize to.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3762" href="#"></a></td>
<td><pre>    */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3763" href="#"></a></td>
<td><pre>   private void writeObject(java.io.ObjectOutputStream s)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3764" href="#"></a></td>
<td><pre>       throws java.io.IOException {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3765" href="#"></a></td>
<td><pre>       // Must inflate to maintain compatible serial form.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3766" href="#"></a></td>
<td><pre>       if (this.intVal == null)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3767" href="#"></a></td>
<td><pre>           UnsafeHolder.setIntValVolatile(this, BigInteger.valueOf(this.intCompact));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3768" href="#"></a></td>
<td><pre>       // Could reset intVal back to null if it has to be set.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3769" href="#"></a></td>
<td><pre>       s.defaultWriteObject();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3770" href="#"></a></td>
<td><pre>   }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3771" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3772" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3773" href="#"></a></td>
<td><pre>     * Returns the length of the absolute value of a {@code long}, in decimal</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3774" href="#"></a></td>
<td><pre>     * digits.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3775" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3776" href="#"></a></td>
<td><pre>     * @param x the {@code long}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3777" href="#"></a></td>
<td><pre>     * @return the length of the unscaled value, in deciaml digits.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3778" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3779" href="#"></a></td>
<td><pre>    static int longDigitLength(long x) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3780" href="#"></a></td>
<td><pre>        /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3781" href="#"></a></td>
<td><pre>         * As described in &quot;Bit Twiddling Hacks&quot; by Sean Anderson,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3782" href="#"></a></td>
<td><pre>         * (http://graphics.stanford.edu/~seander/bithacks.html)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3783" href="#"></a></td>
<td><pre>         * integer log 10 of x is within 1 of (1233/4096)* (1 +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3784" href="#"></a></td>
<td><pre>         * integer log 2 of x). The fraction 1233/4096 approximates</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3785" href="#"></a></td>
<td><pre>         * log10(2). So we first do a version of log2 (a variant of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3786" href="#"></a></td>
<td><pre>         * Long class with pre-checks and opposite directionality) and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3787" href="#"></a></td>
<td><pre>         * then scale and check against powers table. This is a little</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3788" href="#"></a></td>
<td><pre>         * simpler in present context than the version in Hacker's</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3789" href="#"></a></td>
<td><pre>         * Delight sec 11-4. Adding one to bit length allows comparing</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3790" href="#"></a></td>
<td><pre>         * downward from the LONG_TEN_POWERS_TABLE that we need</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3791" href="#"></a></td>
<td><pre>         * anyway.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3792" href="#"></a></td>
<td><pre>         */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3793" href="#"></a></td>
<td><pre>        assert x != BigDecimal.INFLATED;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3794" href="#"></a></td>
<td><pre>        if (x &lt; 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3795" href="#"></a></td>
<td><pre>            x = -x;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3796" href="#"></a></td>
<td><pre>        if (x &lt; 10) // must screen for 0, might as well 10</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3797" href="#"></a></td>
<td><pre>            return 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3798" href="#"></a></td>
<td><pre>        int r = ((64 - Long.numberOfLeadingZeros(x) + 1) * 1233) &gt;&gt;&gt; 12;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3799" href="#"></a></td>
<td><pre>        long[] tab = LONG_TEN_POWERS_TABLE;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3800" href="#"></a></td>
<td><pre>        // if r &gt;= length, must have max possible digits for long</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3801" href="#"></a></td>
<td><pre>        return (r &gt;= tab.length || x &lt; tab[r]) ? r : r + 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3802" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3803" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3804" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3805" href="#"></a></td>
<td><pre>     * Returns the length of the absolute value of a BigInteger, in</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3806" href="#"></a></td>
<td><pre>     * decimal digits.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3807" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3808" href="#"></a></td>
<td><pre>     * @param b the BigInteger</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3809" href="#"></a></td>
<td><pre>     * @return the length of the unscaled value, in decimal digits</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3810" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3811" href="#"></a></td>
<td><pre>    private static int bigDigitLength(BigInteger b) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3812" href="#"></a></td>
<td><pre>        /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3813" href="#"></a></td>
<td><pre>         * Same idea as the long version, but we need a better</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3814" href="#"></a></td>
<td><pre>         * approximation of log10(2). Using 646456993/2^31</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3815" href="#"></a></td>
<td><pre>         * is accurate up to max possible reported bitLength.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3816" href="#"></a></td>
<td><pre>         */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3817" href="#"></a></td>
<td><pre>        if (b.signum == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3818" href="#"></a></td>
<td><pre>            return 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3819" href="#"></a></td>
<td><pre>        int r = (int)((((long)b.bitLength() + 1) * 646456993) &gt;&gt;&gt; 31);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3820" href="#"></a></td>
<td><pre>        return b.compareMagnitude(bigTenToThe(r)) &lt; 0? r : r+1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3821" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3822" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3823" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3824" href="#"></a></td>
<td><pre>     * Check a scale for Underflow or Overflow.  If this BigDecimal is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3825" href="#"></a></td>
<td><pre>     * nonzero, throw an exception if the scale is outof range. If this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3826" href="#"></a></td>
<td><pre>     * is zero, saturate the scale to the extreme value of the right</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3827" href="#"></a></td>
<td><pre>     * sign if the scale is out of range.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3828" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3829" href="#"></a></td>
<td><pre>     * @param val The new scale.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3830" href="#"></a></td>
<td><pre>     * @throws ArithmeticException (overflow or underflow) if the new</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3831" href="#"></a></td>
<td><pre>     *         scale is out of range.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3832" href="#"></a></td>
<td><pre>     * @return validated scale as an int.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3833" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3834" href="#"></a></td>
<td><pre>    private int checkScale(long val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3835" href="#"></a></td>
<td><pre>        int asInt = (int)val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3836" href="#"></a></td>
<td><pre>        if (asInt != val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3837" href="#"></a></td>
<td><pre>            asInt = val&gt;Integer.MAX_VALUE ? Integer.MAX_VALUE : Integer.MIN_VALUE;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3838" href="#"></a></td>
<td><pre>            BigInteger b;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3839" href="#"></a></td>
<td><pre>            if (intCompact != 0 &amp;&amp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3840" href="#"></a></td>
<td><pre>                ((b = intVal) == null || b.signum() != 0))</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3841" href="#"></a></td>
<td><pre>                throw new ArithmeticException(asInt&gt;0 ? &quot;Underflow&quot;:&quot;Overflow&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3842" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3843" href="#"></a></td>
<td><pre>        return asInt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3844" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3845" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3846" href="#"></a></td>
<td><pre>   /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3847" href="#"></a></td>
<td><pre>     * Returns the compact value for given {@code BigInteger}, or</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3848" href="#"></a></td>
<td><pre>     * INFLATED if too big. Relies on internal representation of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3849" href="#"></a></td>
<td><pre>     * {@code BigInteger}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3850" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3851" href="#"></a></td>
<td><pre>    private static long compactValFor(BigInteger b) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3852" href="#"></a></td>
<td><pre>        int[] m = b.mag;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3853" href="#"></a></td>
<td><pre>        int len = m.length;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3854" href="#"></a></td>
<td><pre>        if (len == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3855" href="#"></a></td>
<td><pre>            return 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3856" href="#"></a></td>
<td><pre>        int d = m[0];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3857" href="#"></a></td>
<td><pre>        if (len &gt; 2 || (len == 2 &amp;&amp; d &lt; 0))</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3858" href="#"></a></td>
<td><pre>            return INFLATED;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3859" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3860" href="#"></a></td>
<td><pre>        long u = (len == 2)?</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3861" href="#"></a></td>
<td><pre>            (((long) m[1] &amp; LONG_MASK) + (((long)d) &lt;&lt; 32)) :</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3862" href="#"></a></td>
<td><pre>            (((long)d)   &amp; LONG_MASK);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3863" href="#"></a></td>
<td><pre>        return (b.signum &lt; 0)? -u : u;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3864" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3865" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3866" href="#"></a></td>
<td><pre>    private static int longCompareMagnitude(long x, long y) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3867" href="#"></a></td>
<td><pre>        if (x &lt; 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3868" href="#"></a></td>
<td><pre>            x = -x;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3869" href="#"></a></td>
<td><pre>        if (y &lt; 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3870" href="#"></a></td>
<td><pre>            y = -y;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3871" href="#"></a></td>
<td><pre>        return (x &lt; y) ? -1 : ((x == y) ? 0 : 1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3872" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3873" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3874" href="#"></a></td>
<td><pre>    private static int saturateLong(long s) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3875" href="#"></a></td>
<td><pre>        int i = (int)s;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3876" href="#"></a></td>
<td><pre>        return (s == i) ? i : (s &lt; 0 ? Integer.MIN_VALUE : Integer.MAX_VALUE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3877" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3878" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3879" href="#"></a></td>
<td><pre>    /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3880" href="#"></a></td>
<td><pre>     * Internal printing routine</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3881" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3882" href="#"></a></td>
<td><pre>    private static void print(String name, BigDecimal bd) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3883" href="#"></a></td>
<td><pre>        System.err.format(&quot;%s:\tintCompact %d\tintVal %d\tscale %d\tprecision %d%n&quot;,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3884" href="#"></a></td>
<td><pre>                          name,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3885" href="#"></a></td>
<td><pre>                          bd.intCompact,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3886" href="#"></a></td>
<td><pre>                          bd.intVal,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3887" href="#"></a></td>
<td><pre>                          bd.scale,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3888" href="#"></a></td>
<td><pre>                          bd.precision);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3889" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3890" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3891" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3892" href="#"></a></td>
<td><pre>     * Check internal invariants of this BigDecimal.  These invariants</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3893" href="#"></a></td>
<td><pre>     * include:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3894" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3895" href="#"></a></td>
<td><pre>     * &lt;ul&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3896" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3897" href="#"></a></td>
<td><pre>     * &lt;li&gt;The object must be initialized; either intCompact must not be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3898" href="#"></a></td>
<td><pre>     * INFLATED or intVal is non-null.  Both of these conditions may</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3899" href="#"></a></td>
<td><pre>     * be true.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3900" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3901" href="#"></a></td>
<td><pre>     * &lt;li&gt;If both intCompact and intVal and set, their values must be</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3902" href="#"></a></td>
<td><pre>     * consistent.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3903" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3904" href="#"></a></td>
<td><pre>     * &lt;li&gt;If precision is nonzero, it must have the right value.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3905" href="#"></a></td>
<td><pre>     * &lt;/ul&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3906" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3907" href="#"></a></td>
<td><pre>     * Note: Since this is an audit method, we are not supposed to change the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3908" href="#"></a></td>
<td><pre>     * state of this BigDecimal object.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3909" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3910" href="#"></a></td>
<td><pre>    private BigDecimal audit() {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3911" href="#"></a></td>
<td><pre>        if (intCompact == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3912" href="#"></a></td>
<td><pre>            if (intVal == null) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3913" href="#"></a></td>
<td><pre>                print(&quot;audit&quot;, this);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3914" href="#"></a></td>
<td><pre>                throw new AssertionError(&quot;null intVal&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3915" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3916" href="#"></a></td>
<td><pre>            // Check precision</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3917" href="#"></a></td>
<td><pre>            if (precision &gt; 0 &amp;&amp; precision != bigDigitLength(intVal)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3918" href="#"></a></td>
<td><pre>                print(&quot;audit&quot;, this);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3919" href="#"></a></td>
<td><pre>                throw new AssertionError(&quot;precision mismatch&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3920" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3921" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3922" href="#"></a></td>
<td><pre>            if (intVal != null) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3923" href="#"></a></td>
<td><pre>                long val = intVal.longValue();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3924" href="#"></a></td>
<td><pre>                if (val != intCompact) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3925" href="#"></a></td>
<td><pre>                    print(&quot;audit&quot;, this);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3926" href="#"></a></td>
<td><pre>                    throw new AssertionError(&quot;Inconsistent state, intCompact=&quot; +</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3927" href="#"></a></td>
<td><pre>                                             intCompact + &quot;\t intVal=&quot; + val);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3928" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3929" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3930" href="#"></a></td>
<td><pre>            // Check precision</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3931" href="#"></a></td>
<td><pre>            if (precision &gt; 0 &amp;&amp; precision != longDigitLength(intCompact)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3932" href="#"></a></td>
<td><pre>                print(&quot;audit&quot;, this);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3933" href="#"></a></td>
<td><pre>                throw new AssertionError(&quot;precision mismatch&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3934" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3935" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3936" href="#"></a></td>
<td><pre>        return this;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3937" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3938" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3939" href="#"></a></td>
<td><pre>    /* the same as checkScale where value!=0 */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3940" href="#"></a></td>
<td><pre>    private static int checkScaleNonZero(long val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3941" href="#"></a></td>
<td><pre>        int asInt = (int)val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3942" href="#"></a></td>
<td><pre>        if (asInt != val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3943" href="#"></a></td>
<td><pre>            throw new ArithmeticException(asInt&gt;0 ? &quot;Underflow&quot;:&quot;Overflow&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3944" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3945" href="#"></a></td>
<td><pre>        return asInt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3946" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3947" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3948" href="#"></a></td>
<td><pre>    private static int checkScale(long intCompact, long val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3949" href="#"></a></td>
<td><pre>        int asInt = (int)val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3950" href="#"></a></td>
<td><pre>        if (asInt != val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3951" href="#"></a></td>
<td><pre>            asInt = val&gt;Integer.MAX_VALUE ? Integer.MAX_VALUE : Integer.MIN_VALUE;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3952" href="#"></a></td>
<td><pre>            if (intCompact != 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3953" href="#"></a></td>
<td><pre>                throw new ArithmeticException(asInt&gt;0 ? &quot;Underflow&quot;:&quot;Overflow&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3954" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3955" href="#"></a></td>
<td><pre>        return asInt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3956" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3957" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3958" href="#"></a></td>
<td><pre>    private static int checkScale(BigInteger intVal, long val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3959" href="#"></a></td>
<td><pre>        int asInt = (int)val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3960" href="#"></a></td>
<td><pre>        if (asInt != val) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3961" href="#"></a></td>
<td><pre>            asInt = val&gt;Integer.MAX_VALUE ? Integer.MAX_VALUE : Integer.MIN_VALUE;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3962" href="#"></a></td>
<td><pre>            if (intVal.signum() != 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3963" href="#"></a></td>
<td><pre>                throw new ArithmeticException(asInt&gt;0 ? &quot;Underflow&quot;:&quot;Overflow&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3964" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3965" href="#"></a></td>
<td><pre>        return asInt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3966" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3967" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3968" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3969" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} rounded according to the MathContext</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3970" href="#"></a></td>
<td><pre>     * settings;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3971" href="#"></a></td>
<td><pre>     * If rounding is needed a new {@code BigDecimal} is created and returned.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3972" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3973" href="#"></a></td>
<td><pre>     * @param val the value to be rounded</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3974" href="#"></a></td>
<td><pre>     * @param mc the context to use.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3975" href="#"></a></td>
<td><pre>     * @return a {@code BigDecimal} rounded according to the MathContext</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3976" href="#"></a></td>
<td><pre>     *         settings.  May return {@code value}, if no rounding needed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3977" href="#"></a></td>
<td><pre>     * @throws ArithmeticException if the rounding mode is</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3978" href="#"></a></td>
<td><pre>     *         {@code RoundingMode.UNNECESSARY} and the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3979" href="#"></a></td>
<td><pre>     *         result is inexact.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3980" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3981" href="#"></a></td>
<td><pre>    private static BigDecimal doRound(BigDecimal val, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3982" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3983" href="#"></a></td>
<td><pre>        boolean wasDivided = false;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3984" href="#"></a></td>
<td><pre>        if (mcp &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3985" href="#"></a></td>
<td><pre>            BigInteger intVal = val.intVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3986" href="#"></a></td>
<td><pre>            long compactVal = val.intCompact;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3987" href="#"></a></td>
<td><pre>            int scale = val.scale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3988" href="#"></a></td>
<td><pre>            int prec = val.precision();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3989" href="#"></a></td>
<td><pre>            int mode = mc.roundingMode.oldMode;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3990" href="#"></a></td>
<td><pre>            int drop;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3991" href="#"></a></td>
<td><pre>            if (compactVal == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3992" href="#"></a></td>
<td><pre>                drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3993" href="#"></a></td>
<td><pre>                while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3994" href="#"></a></td>
<td><pre>                    scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3995" href="#"></a></td>
<td><pre>                    intVal = divideAndRoundByTenPow(intVal, drop, mode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3996" href="#"></a></td>
<td><pre>                    wasDivided = true;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3997" href="#"></a></td>
<td><pre>                    compactVal = compactValFor(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3998" href="#"></a></td>
<td><pre>                    if (compactVal != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="3999" href="#"></a></td>
<td><pre>                        prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4000" href="#"></a></td>
<td><pre>                        break;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4001" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4002" href="#"></a></td>
<td><pre>                    prec = bigDigitLength(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4003" href="#"></a></td>
<td><pre>                    drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4004" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4005" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4006" href="#"></a></td>
<td><pre>            if (compactVal != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4007" href="#"></a></td>
<td><pre>                drop = prec - mcp;  // drop can't be more than 18</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4008" href="#"></a></td>
<td><pre>                while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4009" href="#"></a></td>
<td><pre>                    scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4010" href="#"></a></td>
<td><pre>                    compactVal = divideAndRound(compactVal, LONG_TEN_POWERS_TABLE[drop], mc.roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4011" href="#"></a></td>
<td><pre>                    wasDivided = true;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4012" href="#"></a></td>
<td><pre>                    prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4013" href="#"></a></td>
<td><pre>                    drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4014" href="#"></a></td>
<td><pre>                    intVal = null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4015" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4016" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4017" href="#"></a></td>
<td><pre>            return wasDivided ? new BigDecimal(intVal,compactVal,scale,prec) : val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4018" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4019" href="#"></a></td>
<td><pre>        return val;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4020" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4021" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4022" href="#"></a></td>
<td><pre>    /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4023" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} created from {@code long} value with</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4024" href="#"></a></td>
<td><pre>     * given scale rounded according to the MathContext settings</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4025" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4026" href="#"></a></td>
<td><pre>    private static BigDecimal doRound(long compactVal, int scale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4027" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4028" href="#"></a></td>
<td><pre>        if (mcp &gt; 0 &amp;&amp; mcp &lt; 19) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4029" href="#"></a></td>
<td><pre>            int prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4030" href="#"></a></td>
<td><pre>            int drop = prec - mcp;  // drop can't be more than 18</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4031" href="#"></a></td>
<td><pre>            while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4032" href="#"></a></td>
<td><pre>                scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4033" href="#"></a></td>
<td><pre>                compactVal = divideAndRound(compactVal, LONG_TEN_POWERS_TABLE[drop], mc.roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4034" href="#"></a></td>
<td><pre>                prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4035" href="#"></a></td>
<td><pre>                drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4036" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4037" href="#"></a></td>
<td><pre>            return valueOf(compactVal, scale, prec);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4038" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4039" href="#"></a></td>
<td><pre>        return valueOf(compactVal, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4040" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4041" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4042" href="#"></a></td>
<td><pre>    /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4043" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} created from {@code BigInteger} value with</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4044" href="#"></a></td>
<td><pre>     * given scale rounded according to the MathContext settings</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4045" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4046" href="#"></a></td>
<td><pre>    private static BigDecimal doRound(BigInteger intVal, int scale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4047" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4048" href="#"></a></td>
<td><pre>        int prec = 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4049" href="#"></a></td>
<td><pre>        if (mcp &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4050" href="#"></a></td>
<td><pre>            long compactVal = compactValFor(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4051" href="#"></a></td>
<td><pre>            int mode = mc.roundingMode.oldMode;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4052" href="#"></a></td>
<td><pre>            int drop;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4053" href="#"></a></td>
<td><pre>            if (compactVal == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4054" href="#"></a></td>
<td><pre>                prec = bigDigitLength(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4055" href="#"></a></td>
<td><pre>                drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4056" href="#"></a></td>
<td><pre>                while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4057" href="#"></a></td>
<td><pre>                    scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4058" href="#"></a></td>
<td><pre>                    intVal = divideAndRoundByTenPow(intVal, drop, mode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4059" href="#"></a></td>
<td><pre>                    compactVal = compactValFor(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4060" href="#"></a></td>
<td><pre>                    if (compactVal != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4061" href="#"></a></td>
<td><pre>                        break;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4062" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4063" href="#"></a></td>
<td><pre>                    prec = bigDigitLength(intVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4064" href="#"></a></td>
<td><pre>                    drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4065" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4066" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4067" href="#"></a></td>
<td><pre>            if (compactVal != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4068" href="#"></a></td>
<td><pre>                prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4069" href="#"></a></td>
<td><pre>                drop = prec - mcp;     // drop can't be more than 18</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4070" href="#"></a></td>
<td><pre>                while (drop &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4071" href="#"></a></td>
<td><pre>                    scale = checkScaleNonZero((long) scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4072" href="#"></a></td>
<td><pre>                    compactVal = divideAndRound(compactVal, LONG_TEN_POWERS_TABLE[drop], mc.roundingMode.oldMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4073" href="#"></a></td>
<td><pre>                    prec = longDigitLength(compactVal);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4074" href="#"></a></td>
<td><pre>                    drop = prec - mcp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4075" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4076" href="#"></a></td>
<td><pre>                return valueOf(compactVal,scale,prec);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4077" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4078" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4079" href="#"></a></td>
<td><pre>        return new BigDecimal(intVal,INFLATED,scale,prec);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4080" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4081" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4082" href="#"></a></td>
<td><pre>    /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4083" href="#"></a></td>
<td><pre>     * Divides {@code BigInteger} value by ten power.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4084" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4085" href="#"></a></td>
<td><pre>    private static BigInteger divideAndRoundByTenPow(BigInteger intVal, int tenPow, int roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4086" href="#"></a></td>
<td><pre>        if (tenPow &lt; LONG_TEN_POWERS_TABLE.length)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4087" href="#"></a></td>
<td><pre>            intVal = divideAndRound(intVal, LONG_TEN_POWERS_TABLE[tenPow], roundingMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4088" href="#"></a></td>
<td><pre>        else</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4089" href="#"></a></td>
<td><pre>            intVal = divideAndRound(intVal, bigTenToThe(tenPow), roundingMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4090" href="#"></a></td>
<td><pre>        return intVal;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4091" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4092" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4093" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4094" href="#"></a></td>
<td><pre>     * Internally used for division operation for division {@code long} by</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4095" href="#"></a></td>
<td><pre>     * {@code long}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4096" href="#"></a></td>
<td><pre>     * The returned {@code BigDecimal} object is the quotient whose scale is set</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4097" href="#"></a></td>
<td><pre>     * to the passed in scale. If the remainder is not zero, it will be rounded</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4098" href="#"></a></td>
<td><pre>     * based on the passed in roundingMode. Also, if the remainder is zero and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4099" href="#"></a></td>
<td><pre>     * the last parameter, i.e. preferredScale is NOT equal to scale, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4100" href="#"></a></td>
<td><pre>     * trailing zeros of the result is stripped to match the preferredScale.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4101" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4102" href="#"></a></td>
<td><pre>    private static BigDecimal divideAndRound(long ldividend, long ldivisor, int scale, int roundingMode,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4103" href="#"></a></td>
<td><pre>                                             int preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4104" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4105" href="#"></a></td>
<td><pre>        int qsign; // quotient sign</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4106" href="#"></a></td>
<td><pre>        long q = ldividend / ldivisor; // store quotient in long</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4107" href="#"></a></td>
<td><pre>        if (roundingMode == ROUND_DOWN &amp;&amp; scale == preferredScale)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4108" href="#"></a></td>
<td><pre>            return valueOf(q, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4109" href="#"></a></td>
<td><pre>        long r = ldividend % ldivisor; // store remainder in long</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4110" href="#"></a></td>
<td><pre>        qsign = ((ldividend &lt; 0) == (ldivisor &lt; 0)) ? 1 : -1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4111" href="#"></a></td>
<td><pre>        if (r != 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4112" href="#"></a></td>
<td><pre>            boolean increment = needIncrement(ldivisor, roundingMode, qsign, q, r);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4113" href="#"></a></td>
<td><pre>            return valueOf((increment ? q + qsign : q), scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4114" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4115" href="#"></a></td>
<td><pre>            if (preferredScale != scale)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4116" href="#"></a></td>
<td><pre>                return createAndStripZerosToMatchScale(q, scale, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4117" href="#"></a></td>
<td><pre>            else</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4118" href="#"></a></td>
<td><pre>                return valueOf(q, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4119" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4120" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4121" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4122" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4123" href="#"></a></td>
<td><pre>     * Divides {@code long} by {@code long} and do rounding based on the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4124" href="#"></a></td>
<td><pre>     * passed in roundingMode.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4125" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4126" href="#"></a></td>
<td><pre>    private static long divideAndRound(long ldividend, long ldivisor, int roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4127" href="#"></a></td>
<td><pre>        int qsign; // quotient sign</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4128" href="#"></a></td>
<td><pre>        long q = ldividend / ldivisor; // store quotient in long</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4129" href="#"></a></td>
<td><pre>        if (roundingMode == ROUND_DOWN)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4130" href="#"></a></td>
<td><pre>            return q;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4131" href="#"></a></td>
<td><pre>        long r = ldividend % ldivisor; // store remainder in long</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4132" href="#"></a></td>
<td><pre>        qsign = ((ldividend &lt; 0) == (ldivisor &lt; 0)) ? 1 : -1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4133" href="#"></a></td>
<td><pre>        if (r != 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4134" href="#"></a></td>
<td><pre>            boolean increment = needIncrement(ldivisor, roundingMode, qsign, q,     r);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4135" href="#"></a></td>
<td><pre>            return increment ? q + qsign : q;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4136" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4137" href="#"></a></td>
<td><pre>            return q;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4138" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4139" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4140" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4141" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4142" href="#"></a></td>
<td><pre>     * Shared logic of need increment computation.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4143" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4144" href="#"></a></td>
<td><pre>    private static boolean commonNeedIncrement(int roundingMode, int qsign,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4145" href="#"></a></td>
<td><pre>                                        int cmpFracHalf, boolean oddQuot) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4146" href="#"></a></td>
<td><pre>        switch(roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4147" href="#"></a></td>
<td><pre>        case ROUND_UNNECESSARY:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4148" href="#"></a></td>
<td><pre>            throw new ArithmeticException(&quot;Rounding necessary&quot;);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4149" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4150" href="#"></a></td>
<td><pre>        case ROUND_UP: // Away from zero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4151" href="#"></a></td>
<td><pre>            return true;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4152" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4153" href="#"></a></td>
<td><pre>        case ROUND_DOWN: // Towards zero</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4154" href="#"></a></td>
<td><pre>            return false;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4155" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4156" href="#"></a></td>
<td><pre>        case ROUND_CEILING: // Towards +infinity</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4157" href="#"></a></td>
<td><pre>            return qsign &gt; 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4158" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4159" href="#"></a></td>
<td><pre>        case ROUND_FLOOR: // Towards -infinity</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4160" href="#"></a></td>
<td><pre>            return qsign &lt; 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4161" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4162" href="#"></a></td>
<td><pre>        default: // Some kind of half-way rounding</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4163" href="#"></a></td>
<td><pre>            assert roundingMode &gt;= ROUND_HALF_UP &amp;&amp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4164" href="#"></a></td>
<td><pre>                roundingMode &lt;= ROUND_HALF_EVEN: &quot;Unexpected rounding mode&quot; + RoundingMode.valueOf(roundingMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4165" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4166" href="#"></a></td>
<td><pre>            if (cmpFracHalf &lt; 0 ) // We're closer to higher digit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4167" href="#"></a></td>
<td><pre>                return false;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4168" href="#"></a></td>
<td><pre>            else if (cmpFracHalf &gt; 0 ) // We're closer to lower digit</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4169" href="#"></a></td>
<td><pre>                return true;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4170" href="#"></a></td>
<td><pre>            else { // half-way</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4171" href="#"></a></td>
<td><pre>                assert cmpFracHalf == 0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4172" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4173" href="#"></a></td>
<td><pre>                switch(roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4174" href="#"></a></td>
<td><pre>                case ROUND_HALF_DOWN:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4175" href="#"></a></td>
<td><pre>                    return false;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4176" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4177" href="#"></a></td>
<td><pre>                case ROUND_HALF_UP:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4178" href="#"></a></td>
<td><pre>                    return true;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4179" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4180" href="#"></a></td>
<td><pre>                case ROUND_HALF_EVEN:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4181" href="#"></a></td>
<td><pre>                    return oddQuot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4182" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4183" href="#"></a></td>
<td><pre>                default:</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4184" href="#"></a></td>
<td><pre>                    throw new AssertionError(&quot;Unexpected rounding mode&quot; + roundingMode);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4185" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4186" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4187" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4188" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4189" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4190" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4191" href="#"></a></td>
<td><pre>     * Tests if quotient has to be incremented according the roundingMode</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4192" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4193" href="#"></a></td>
<td><pre>    private static boolean needIncrement(long ldivisor, int roundingMode,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4194" href="#"></a></td>
<td><pre>                                         int qsign, long q, long r) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4195" href="#"></a></td>
<td><pre>        assert r != 0L;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4196" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4197" href="#"></a></td>
<td><pre>        int cmpFracHalf;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4198" href="#"></a></td>
<td><pre>        if (r &lt;= HALF_LONG_MIN_VALUE || r &gt; HALF_LONG_MAX_VALUE) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4199" href="#"></a></td>
<td><pre>            cmpFracHalf = 1; // 2 * r can't fit into long</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4200" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4201" href="#"></a></td>
<td><pre>            cmpFracHalf = longCompareMagnitude(2 * r, ldivisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4202" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4203" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4204" href="#"></a></td>
<td><pre>        return commonNeedIncrement(roundingMode, qsign, cmpFracHalf, (q &amp; 1L) != 0L);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4205" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4206" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4207" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4208" href="#"></a></td>
<td><pre>     * Divides {@code BigInteger} value by {@code long} value and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4209" href="#"></a></td>
<td><pre>     * do rounding based on the passed in roundingMode.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4210" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4211" href="#"></a></td>
<td><pre>    private static BigInteger divideAndRound(BigInteger bdividend, long ldivisor, int roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4212" href="#"></a></td>
<td><pre>        boolean isRemainderZero; // record remainder is zero or not</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4213" href="#"></a></td>
<td><pre>        int qsign; // quotient sign</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4214" href="#"></a></td>
<td><pre>        long r = 0; // store quotient &amp; remainder in long</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4215" href="#"></a></td>
<td><pre>        MutableBigInteger mq = null; // store quotient</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4216" href="#"></a></td>
<td><pre>        // Descend into mutables for faster remainder checks</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4217" href="#"></a></td>
<td><pre>        MutableBigInteger mdividend = new MutableBigInteger(bdividend.mag);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4218" href="#"></a></td>
<td><pre>        mq = new MutableBigInteger();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4219" href="#"></a></td>
<td><pre>        r = mdividend.divide(ldivisor, mq);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4220" href="#"></a></td>
<td><pre>        isRemainderZero = (r == 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4221" href="#"></a></td>
<td><pre>        qsign = (ldivisor &lt; 0) ? -bdividend.signum : bdividend.signum;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4222" href="#"></a></td>
<td><pre>        if (!isRemainderZero) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4223" href="#"></a></td>
<td><pre>            if(needIncrement(ldivisor, roundingMode, qsign, mq, r)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4224" href="#"></a></td>
<td><pre>                mq.add(MutableBigInteger.ONE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4225" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4226" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4227" href="#"></a></td>
<td><pre>        return mq.toBigInteger(qsign);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4228" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4229" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4230" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4231" href="#"></a></td>
<td><pre>     * Internally used for division operation for division {@code BigInteger}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4232" href="#"></a></td>
<td><pre>     * by {@code long}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4233" href="#"></a></td>
<td><pre>     * The returned {@code BigDecimal} object is the quotient whose scale is set</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4234" href="#"></a></td>
<td><pre>     * to the passed in scale. If the remainder is not zero, it will be rounded</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4235" href="#"></a></td>
<td><pre>     * based on the passed in roundingMode. Also, if the remainder is zero and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4236" href="#"></a></td>
<td><pre>     * the last parameter, i.e. preferredScale is NOT equal to scale, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4237" href="#"></a></td>
<td><pre>     * trailing zeros of the result is stripped to match the preferredScale.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4238" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4239" href="#"></a></td>
<td><pre>    private static BigDecimal divideAndRound(BigInteger bdividend,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4240" href="#"></a></td>
<td><pre>                                             long ldivisor, int scale, int roundingMode, int preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4241" href="#"></a></td>
<td><pre>        boolean isRemainderZero; // record remainder is zero or not</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4242" href="#"></a></td>
<td><pre>        int qsign; // quotient sign</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4243" href="#"></a></td>
<td><pre>        long r = 0; // store quotient &amp; remainder in long</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4244" href="#"></a></td>
<td><pre>        MutableBigInteger mq = null; // store quotient</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4245" href="#"></a></td>
<td><pre>        // Descend into mutables for faster remainder checks</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4246" href="#"></a></td>
<td><pre>        MutableBigInteger mdividend = new MutableBigInteger(bdividend.mag);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4247" href="#"></a></td>
<td><pre>        mq = new MutableBigInteger();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4248" href="#"></a></td>
<td><pre>        r = mdividend.divide(ldivisor, mq);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4249" href="#"></a></td>
<td><pre>        isRemainderZero = (r == 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4250" href="#"></a></td>
<td><pre>        qsign = (ldivisor &lt; 0) ? -bdividend.signum : bdividend.signum;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4251" href="#"></a></td>
<td><pre>        if (!isRemainderZero) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4252" href="#"></a></td>
<td><pre>            if(needIncrement(ldivisor, roundingMode, qsign, mq, r)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4253" href="#"></a></td>
<td><pre>                mq.add(MutableBigInteger.ONE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4254" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4255" href="#"></a></td>
<td><pre>            return mq.toBigDecimal(qsign, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4256" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4257" href="#"></a></td>
<td><pre>            if (preferredScale != scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4258" href="#"></a></td>
<td><pre>                long compactVal = mq.toCompactValue(qsign);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4259" href="#"></a></td>
<td><pre>                if(compactVal!=INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4260" href="#"></a></td>
<td><pre>                    return createAndStripZerosToMatchScale(compactVal, scale, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4261" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4262" href="#"></a></td>
<td><pre>                BigInteger intVal =  mq.toBigInteger(qsign);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4263" href="#"></a></td>
<td><pre>                return createAndStripZerosToMatchScale(intVal,scale, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4264" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4265" href="#"></a></td>
<td><pre>                return mq.toBigDecimal(qsign, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4266" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4267" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4268" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4269" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4270" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4271" href="#"></a></td>
<td><pre>     * Tests if quotient has to be incremented according the roundingMode</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4272" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4273" href="#"></a></td>
<td><pre>    private static boolean needIncrement(long ldivisor, int roundingMode,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4274" href="#"></a></td>
<td><pre>                                         int qsign, MutableBigInteger mq, long r) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4275" href="#"></a></td>
<td><pre>        assert r != 0L;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4276" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4277" href="#"></a></td>
<td><pre>        int cmpFracHalf;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4278" href="#"></a></td>
<td><pre>        if (r &lt;= HALF_LONG_MIN_VALUE || r &gt; HALF_LONG_MAX_VALUE) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4279" href="#"></a></td>
<td><pre>            cmpFracHalf = 1; // 2 * r can't fit into long</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4280" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4281" href="#"></a></td>
<td><pre>            cmpFracHalf = longCompareMagnitude(2 * r, ldivisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4282" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4283" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4284" href="#"></a></td>
<td><pre>        return commonNeedIncrement(roundingMode, qsign, cmpFracHalf, mq.isOdd());</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4285" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4286" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4287" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4288" href="#"></a></td>
<td><pre>     * Divides {@code BigInteger} value by {@code BigInteger} value and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4289" href="#"></a></td>
<td><pre>     * do rounding based on the passed in roundingMode.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4290" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4291" href="#"></a></td>
<td><pre>    private static BigInteger divideAndRound(BigInteger bdividend, BigInteger bdivisor, int roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4292" href="#"></a></td>
<td><pre>        boolean isRemainderZero; // record remainder is zero or not</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4293" href="#"></a></td>
<td><pre>        int qsign; // quotient sign</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4294" href="#"></a></td>
<td><pre>        // Descend into mutables for faster remainder checks</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4295" href="#"></a></td>
<td><pre>        MutableBigInteger mdividend = new MutableBigInteger(bdividend.mag);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4296" href="#"></a></td>
<td><pre>        MutableBigInteger mq = new MutableBigInteger();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4297" href="#"></a></td>
<td><pre>        MutableBigInteger mdivisor = new MutableBigInteger(bdivisor.mag);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4298" href="#"></a></td>
<td><pre>        MutableBigInteger mr = mdividend.divide(mdivisor, mq);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4299" href="#"></a></td>
<td><pre>        isRemainderZero = mr.isZero();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4300" href="#"></a></td>
<td><pre>        qsign = (bdividend.signum != bdivisor.signum) ? -1 : 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4301" href="#"></a></td>
<td><pre>        if (!isRemainderZero) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4302" href="#"></a></td>
<td><pre>            if (needIncrement(mdivisor, roundingMode, qsign, mq, mr)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4303" href="#"></a></td>
<td><pre>                mq.add(MutableBigInteger.ONE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4304" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4305" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4306" href="#"></a></td>
<td><pre>        return mq.toBigInteger(qsign);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4307" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4308" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4309" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4310" href="#"></a></td>
<td><pre>     * Internally used for division operation for division {@code BigInteger}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4311" href="#"></a></td>
<td><pre>     * by {@code BigInteger}.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4312" href="#"></a></td>
<td><pre>     * The returned {@code BigDecimal} object is the quotient whose scale is set</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4313" href="#"></a></td>
<td><pre>     * to the passed in scale. If the remainder is not zero, it will be rounded</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4314" href="#"></a></td>
<td><pre>     * based on the passed in roundingMode. Also, if the remainder is zero and</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4315" href="#"></a></td>
<td><pre>     * the last parameter, i.e. preferredScale is NOT equal to scale, the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4316" href="#"></a></td>
<td><pre>     * trailing zeros of the result is stripped to match the preferredScale.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4317" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4318" href="#"></a></td>
<td><pre>    private static BigDecimal divideAndRound(BigInteger bdividend, BigInteger bdivisor, int scale, int roundingMode,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4319" href="#"></a></td>
<td><pre>                                             int preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4320" href="#"></a></td>
<td><pre>        boolean isRemainderZero; // record remainder is zero or not</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4321" href="#"></a></td>
<td><pre>        int qsign; // quotient sign</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4322" href="#"></a></td>
<td><pre>        // Descend into mutables for faster remainder checks</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4323" href="#"></a></td>
<td><pre>        MutableBigInteger mdividend = new MutableBigInteger(bdividend.mag);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4324" href="#"></a></td>
<td><pre>        MutableBigInteger mq = new MutableBigInteger();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4325" href="#"></a></td>
<td><pre>        MutableBigInteger mdivisor = new MutableBigInteger(bdivisor.mag);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4326" href="#"></a></td>
<td><pre>        MutableBigInteger mr = mdividend.divide(mdivisor, mq);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4327" href="#"></a></td>
<td><pre>        isRemainderZero = mr.isZero();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4328" href="#"></a></td>
<td><pre>        qsign = (bdividend.signum != bdivisor.signum) ? -1 : 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4329" href="#"></a></td>
<td><pre>        if (!isRemainderZero) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4330" href="#"></a></td>
<td><pre>            if (needIncrement(mdivisor, roundingMode, qsign, mq, mr)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4331" href="#"></a></td>
<td><pre>                mq.add(MutableBigInteger.ONE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4332" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4333" href="#"></a></td>
<td><pre>            return mq.toBigDecimal(qsign, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4334" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4335" href="#"></a></td>
<td><pre>            if (preferredScale != scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4336" href="#"></a></td>
<td><pre>                long compactVal = mq.toCompactValue(qsign);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4337" href="#"></a></td>
<td><pre>                if (compactVal != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4338" href="#"></a></td>
<td><pre>                    return createAndStripZerosToMatchScale(compactVal, scale, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4339" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4340" href="#"></a></td>
<td><pre>                BigInteger intVal = mq.toBigInteger(qsign);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4341" href="#"></a></td>
<td><pre>                return createAndStripZerosToMatchScale(intVal, scale, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4342" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4343" href="#"></a></td>
<td><pre>                return mq.toBigDecimal(qsign, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4344" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4345" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4346" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4347" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4348" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4349" href="#"></a></td>
<td><pre>     * Tests if quotient has to be incremented according the roundingMode</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4350" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4351" href="#"></a></td>
<td><pre>    private static boolean needIncrement(MutableBigInteger mdivisor, int roundingMode,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4352" href="#"></a></td>
<td><pre>                                         int qsign, MutableBigInteger mq, MutableBigInteger mr) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4353" href="#"></a></td>
<td><pre>        assert !mr.isZero();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4354" href="#"></a></td>
<td><pre>        int cmpFracHalf = mr.compareHalf(mdivisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4355" href="#"></a></td>
<td><pre>        return commonNeedIncrement(roundingMode, qsign, cmpFracHalf, mq.isOdd());</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4356" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4357" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4358" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4359" href="#"></a></td>
<td><pre>     * Remove insignificant trailing zeros from this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4360" href="#"></a></td>
<td><pre>     * {@code BigInteger} value until the preferred scale is reached or no</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4361" href="#"></a></td>
<td><pre>     * more zeros can be removed.  If the preferred scale is less than</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4362" href="#"></a></td>
<td><pre>     * Integer.MIN_VALUE, all the trailing zeros will be removed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4363" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4364" href="#"></a></td>
<td><pre>     * @return new {@code BigDecimal} with a scale possibly reduced</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4365" href="#"></a></td>
<td><pre>     * to be closed to the preferred scale.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4366" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4367" href="#"></a></td>
<td><pre>    private static BigDecimal createAndStripZerosToMatchScale(BigInteger intVal, int scale, long preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4368" href="#"></a></td>
<td><pre>        BigInteger qr[]; // quotient-remainder pair</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4369" href="#"></a></td>
<td><pre>        while (intVal.compareMagnitude(BigInteger.TEN) &gt;= 0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4370" href="#"></a></td>
<td><pre>               &amp;&amp; scale &gt; preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4371" href="#"></a></td>
<td><pre>            if (intVal.testBit(0))</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4372" href="#"></a></td>
<td><pre>                break; // odd number cannot end in 0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4373" href="#"></a></td>
<td><pre>            qr = intVal.divideAndRemainder(BigInteger.TEN);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4374" href="#"></a></td>
<td><pre>            if (qr[1].signum() != 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4375" href="#"></a></td>
<td><pre>                break; // non-0 remainder</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4376" href="#"></a></td>
<td><pre>            intVal = qr[0];</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4377" href="#"></a></td>
<td><pre>            scale = checkScale(intVal,(long) scale - 1); // could Overflow</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4378" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4379" href="#"></a></td>
<td><pre>        return valueOf(intVal, scale, 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4380" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4381" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4382" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4383" href="#"></a></td>
<td><pre>     * Remove insignificant trailing zeros from this</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4384" href="#"></a></td>
<td><pre>     * {@code long} value until the preferred scale is reached or no</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4385" href="#"></a></td>
<td><pre>     * more zeros can be removed.  If the preferred scale is less than</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4386" href="#"></a></td>
<td><pre>     * Integer.MIN_VALUE, all the trailing zeros will be removed.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4387" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4388" href="#"></a></td>
<td><pre>     * @return new {@code BigDecimal} with a scale possibly reduced</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4389" href="#"></a></td>
<td><pre>     * to be closed to the preferred scale.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4390" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4391" href="#"></a></td>
<td><pre>    private static BigDecimal createAndStripZerosToMatchScale(long compactVal, int scale, long preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4392" href="#"></a></td>
<td><pre>        while (Math.abs(compactVal) &gt;= 10L &amp;&amp; scale &gt; preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4393" href="#"></a></td>
<td><pre>            if ((compactVal &amp; 1L) != 0L)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4394" href="#"></a></td>
<td><pre>                break; // odd number cannot end in 0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4395" href="#"></a></td>
<td><pre>            long r = compactVal % 10L;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4396" href="#"></a></td>
<td><pre>            if (r != 0L)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4397" href="#"></a></td>
<td><pre>                break; // non-0 remainder</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4398" href="#"></a></td>
<td><pre>            compactVal /= 10;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4399" href="#"></a></td>
<td><pre>            scale = checkScale(compactVal, (long) scale - 1); // could Overflow</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4400" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4401" href="#"></a></td>
<td><pre>        return valueOf(compactVal, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4402" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4403" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4404" href="#"></a></td>
<td><pre>    private static BigDecimal stripZerosToMatchScale(BigInteger intVal, long intCompact, int scale, int preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4405" href="#"></a></td>
<td><pre>        if(intCompact!=INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4406" href="#"></a></td>
<td><pre>            return createAndStripZerosToMatchScale(intCompact, scale, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4407" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4408" href="#"></a></td>
<td><pre>            return createAndStripZerosToMatchScale(intVal==null ? INFLATED_BIGINT : intVal,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4409" href="#"></a></td>
<td><pre>                                                   scale, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4410" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4411" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4412" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4413" href="#"></a></td>
<td><pre>    /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4414" href="#"></a></td>
<td><pre>     * returns INFLATED if oveflow</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4415" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4416" href="#"></a></td>
<td><pre>    private static long add(long xs, long ys){</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4417" href="#"></a></td>
<td><pre>        long sum = xs + ys;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4418" href="#"></a></td>
<td><pre>        // See &quot;Hacker's Delight&quot; section 2-12 for explanation of</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4419" href="#"></a></td>
<td><pre>        // the overflow test.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4420" href="#"></a></td>
<td><pre>        if ( (((sum ^ xs) &amp; (sum ^ ys))) &gt;= 0L) { // not overflowed</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4421" href="#"></a></td>
<td><pre>            return sum;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4422" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4423" href="#"></a></td>
<td><pre>        return INFLATED;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4424" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4425" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4426" href="#"></a></td>
<td><pre>    private static BigDecimal add(long xs, long ys, int scale){</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4427" href="#"></a></td>
<td><pre>        long sum = add(xs, ys);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4428" href="#"></a></td>
<td><pre>        if (sum!=INFLATED)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4429" href="#"></a></td>
<td><pre>            return BigDecimal.valueOf(sum, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4430" href="#"></a></td>
<td><pre>        return new BigDecimal(BigInteger.valueOf(xs).add(ys), scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4431" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4432" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4433" href="#"></a></td>
<td><pre>    private static BigDecimal add(final long xs, int scale1, final long ys, int scale2) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4434" href="#"></a></td>
<td><pre>        long sdiff = (long) scale1 - scale2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4435" href="#"></a></td>
<td><pre>        if (sdiff == 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4436" href="#"></a></td>
<td><pre>            return add(xs, ys, scale1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4437" href="#"></a></td>
<td><pre>        } else if (sdiff &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4438" href="#"></a></td>
<td><pre>            int raise = checkScale(xs,-sdiff);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4439" href="#"></a></td>
<td><pre>            long scaledX = longMultiplyPowerTen(xs, raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4440" href="#"></a></td>
<td><pre>            if (scaledX != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4441" href="#"></a></td>
<td><pre>                return add(scaledX, ys, scale2);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4442" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4443" href="#"></a></td>
<td><pre>                BigInteger bigsum = bigMultiplyPowerTen(xs,raise).add(ys);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4444" href="#"></a></td>
<td><pre>                return ((xs^ys)&gt;=0) ? // same sign test</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4445" href="#"></a></td>
<td><pre>                    new BigDecimal(bigsum, INFLATED, scale2, 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4446" href="#"></a></td>
<td><pre>                    : valueOf(bigsum, scale2, 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4447" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4448" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4449" href="#"></a></td>
<td><pre>            int raise = checkScale(ys,sdiff);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4450" href="#"></a></td>
<td><pre>            long scaledY = longMultiplyPowerTen(ys, raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4451" href="#"></a></td>
<td><pre>            if (scaledY != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4452" href="#"></a></td>
<td><pre>                return add(xs, scaledY, scale1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4453" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4454" href="#"></a></td>
<td><pre>                BigInteger bigsum = bigMultiplyPowerTen(ys,raise).add(xs);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4455" href="#"></a></td>
<td><pre>                return ((xs^ys)&gt;=0) ?</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4456" href="#"></a></td>
<td><pre>                    new BigDecimal(bigsum, INFLATED, scale1, 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4457" href="#"></a></td>
<td><pre>                    : valueOf(bigsum, scale1, 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4458" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4459" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4460" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4461" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4462" href="#"></a></td>
<td><pre>    private static BigDecimal add(final long xs, int scale1, BigInteger snd, int scale2) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4463" href="#"></a></td>
<td><pre>        int rscale = scale1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4464" href="#"></a></td>
<td><pre>        long sdiff = (long)rscale - scale2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4465" href="#"></a></td>
<td><pre>        boolean sameSigns =  (Long.signum(xs) == snd.signum);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4466" href="#"></a></td>
<td><pre>        BigInteger sum;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4467" href="#"></a></td>
<td><pre>        if (sdiff &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4468" href="#"></a></td>
<td><pre>            int raise = checkScale(xs,-sdiff);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4469" href="#"></a></td>
<td><pre>            rscale = scale2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4470" href="#"></a></td>
<td><pre>            long scaledX = longMultiplyPowerTen(xs, raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4471" href="#"></a></td>
<td><pre>            if (scaledX == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4472" href="#"></a></td>
<td><pre>                sum = snd.add(bigMultiplyPowerTen(xs,raise));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4473" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4474" href="#"></a></td>
<td><pre>                sum = snd.add(scaledX);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4475" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4476" href="#"></a></td>
<td><pre>        } else { //if (sdiff &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4477" href="#"></a></td>
<td><pre>            int raise = checkScale(snd,sdiff);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4478" href="#"></a></td>
<td><pre>            snd = bigMultiplyPowerTen(snd,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4479" href="#"></a></td>
<td><pre>            sum = snd.add(xs);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4480" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4481" href="#"></a></td>
<td><pre>        return (sameSigns) ?</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4482" href="#"></a></td>
<td><pre>            new BigDecimal(sum, INFLATED, rscale, 0) :</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4483" href="#"></a></td>
<td><pre>            valueOf(sum, rscale, 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4484" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4485" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4486" href="#"></a></td>
<td><pre>    private static BigDecimal add(BigInteger fst, int scale1, BigInteger snd, int scale2) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4487" href="#"></a></td>
<td><pre>        int rscale = scale1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4488" href="#"></a></td>
<td><pre>        long sdiff = (long)rscale - scale2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4489" href="#"></a></td>
<td><pre>        if (sdiff != 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4490" href="#"></a></td>
<td><pre>            if (sdiff &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4491" href="#"></a></td>
<td><pre>                int raise = checkScale(fst,-sdiff);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4492" href="#"></a></td>
<td><pre>                rscale = scale2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4493" href="#"></a></td>
<td><pre>                fst = bigMultiplyPowerTen(fst,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4494" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4495" href="#"></a></td>
<td><pre>                int raise = checkScale(snd,sdiff);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4496" href="#"></a></td>
<td><pre>                snd = bigMultiplyPowerTen(snd,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4497" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4498" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4499" href="#"></a></td>
<td><pre>        BigInteger sum = fst.add(snd);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4500" href="#"></a></td>
<td><pre>        return (fst.signum == snd.signum) ?</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4501" href="#"></a></td>
<td><pre>                new BigDecimal(sum, INFLATED, rscale, 0) :</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4502" href="#"></a></td>
<td><pre>                valueOf(sum, rscale, 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4503" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4504" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4505" href="#"></a></td>
<td><pre>    private static BigInteger bigMultiplyPowerTen(long value, int n) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4506" href="#"></a></td>
<td><pre>        if (n &lt;= 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4507" href="#"></a></td>
<td><pre>            return BigInteger.valueOf(value);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4508" href="#"></a></td>
<td><pre>        return bigTenToThe(n).multiply(value);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4509" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4510" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4511" href="#"></a></td>
<td><pre>    private static BigInteger bigMultiplyPowerTen(BigInteger value, int n) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4512" href="#"></a></td>
<td><pre>        if (n &lt;= 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4513" href="#"></a></td>
<td><pre>            return value;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4514" href="#"></a></td>
<td><pre>        if(n&lt;LONG_TEN_POWERS_TABLE.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4515" href="#"></a></td>
<td><pre>                return value.multiply(LONG_TEN_POWERS_TABLE[n]);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4516" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4517" href="#"></a></td>
<td><pre>        return value.multiply(bigTenToThe(n));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4518" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4519" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4520" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4521" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (xs /</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4522" href="#"></a></td>
<td><pre>     * ys)}, with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4523" href="#"></a></td>
<td><pre>     *</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4524" href="#"></a></td>
<td><pre>     * Fast path - used only when (xscale &lt;= yscale &amp;&amp; yscale &lt; 18</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4525" href="#"></a></td>
<td><pre>     *  &amp;&amp; mc.presision&lt;18) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4526" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4527" href="#"></a></td>
<td><pre>    private static BigDecimal divideSmallFastPath(final long xs, int xscale,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4528" href="#"></a></td>
<td><pre>                                                  final long ys, int yscale,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4529" href="#"></a></td>
<td><pre>                                                  long preferredScale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4530" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4531" href="#"></a></td>
<td><pre>        int roundingMode = mc.roundingMode.oldMode;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4532" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4533" href="#"></a></td>
<td><pre>        assert (xscale &lt;= yscale) &amp;&amp; (yscale &lt; 18) &amp;&amp; (mcp &lt; 18);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4534" href="#"></a></td>
<td><pre>        int xraise = yscale - xscale; // xraise &gt;=0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4535" href="#"></a></td>
<td><pre>        long scaledX = (xraise==0) ? xs :</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4536" href="#"></a></td>
<td><pre>            longMultiplyPowerTen(xs, xraise); // can't overflow here!</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4537" href="#"></a></td>
<td><pre>        BigDecimal quotient;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4538" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4539" href="#"></a></td>
<td><pre>        int cmp = longCompareMagnitude(scaledX, ys);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4540" href="#"></a></td>
<td><pre>        if(cmp &gt; 0) { // satisfy constraint (b)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4541" href="#"></a></td>
<td><pre>            yscale -= 1; // [that is, divisor *= 10]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4542" href="#"></a></td>
<td><pre>            int scl = checkScaleNonZero(preferredScale + yscale - xscale + mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4543" href="#"></a></td>
<td><pre>            if (checkScaleNonZero((long) mcp + yscale - xscale) &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4544" href="#"></a></td>
<td><pre>                // assert newScale &gt;= xscale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4545" href="#"></a></td>
<td><pre>                int raise = checkScaleNonZero((long) mcp + yscale - xscale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4546" href="#"></a></td>
<td><pre>                long scaledXs;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4547" href="#"></a></td>
<td><pre>                if ((scaledXs = longMultiplyPowerTen(xs, raise)) == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4548" href="#"></a></td>
<td><pre>                    quotient = null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4549" href="#"></a></td>
<td><pre>                    if((mcp-1) &gt;=0 &amp;&amp; (mcp-1)&lt;LONG_TEN_POWERS_TABLE.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4550" href="#"></a></td>
<td><pre>                        quotient = multiplyDivideAndRound(LONG_TEN_POWERS_TABLE[mcp-1], scaledX, ys, scl, roundingMode, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4551" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4552" href="#"></a></td>
<td><pre>                    if(quotient==null) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4553" href="#"></a></td>
<td><pre>                        BigInteger rb = bigMultiplyPowerTen(scaledX,mcp-1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4554" href="#"></a></td>
<td><pre>                        quotient = divideAndRound(rb, ys,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4555" href="#"></a></td>
<td><pre>                                                  scl, roundingMode, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4556" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4557" href="#"></a></td>
<td><pre>                } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4558" href="#"></a></td>
<td><pre>                    quotient = divideAndRound(scaledXs, ys, scl, roundingMode, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4559" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4560" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4561" href="#"></a></td>
<td><pre>                int newScale = checkScaleNonZero((long) xscale - mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4562" href="#"></a></td>
<td><pre>                // assert newScale &gt;= yscale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4563" href="#"></a></td>
<td><pre>                if (newScale == yscale) { // easy case</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4564" href="#"></a></td>
<td><pre>                    quotient = divideAndRound(xs, ys, scl, roundingMode,checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4565" href="#"></a></td>
<td><pre>                } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4566" href="#"></a></td>
<td><pre>                    int raise = checkScaleNonZero((long) newScale - yscale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4567" href="#"></a></td>
<td><pre>                    long scaledYs;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4568" href="#"></a></td>
<td><pre>                    if ((scaledYs = longMultiplyPowerTen(ys, raise)) == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4569" href="#"></a></td>
<td><pre>                        BigInteger rb = bigMultiplyPowerTen(ys,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4570" href="#"></a></td>
<td><pre>                        quotient = divideAndRound(BigInteger.valueOf(xs),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4571" href="#"></a></td>
<td><pre>                                                  rb, scl, roundingMode,checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4572" href="#"></a></td>
<td><pre>                    } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4573" href="#"></a></td>
<td><pre>                        quotient = divideAndRound(xs, scaledYs, scl, roundingMode,checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4574" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4575" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4576" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4577" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4578" href="#"></a></td>
<td><pre>            // abs(scaledX) &lt;= abs(ys)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4579" href="#"></a></td>
<td><pre>            // result is &quot;scaledX * 10^msp / ys&quot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4580" href="#"></a></td>
<td><pre>            int scl = checkScaleNonZero(preferredScale + yscale - xscale + mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4581" href="#"></a></td>
<td><pre>            if(cmp==0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4582" href="#"></a></td>
<td><pre>                // abs(scaleX)== abs(ys) =&gt; result will be scaled 10^mcp + correct sign</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4583" href="#"></a></td>
<td><pre>                quotient = roundedTenPower(((scaledX &lt; 0) == (ys &lt; 0)) ? 1 : -1, mcp, scl, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4584" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4585" href="#"></a></td>
<td><pre>                // abs(scaledX) &lt; abs(ys)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4586" href="#"></a></td>
<td><pre>                long scaledXs;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4587" href="#"></a></td>
<td><pre>                if ((scaledXs = longMultiplyPowerTen(scaledX, mcp)) == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4588" href="#"></a></td>
<td><pre>                    quotient = null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4589" href="#"></a></td>
<td><pre>                    if(mcp&lt;LONG_TEN_POWERS_TABLE.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4590" href="#"></a></td>
<td><pre>                        quotient = multiplyDivideAndRound(LONG_TEN_POWERS_TABLE[mcp], scaledX, ys, scl, roundingMode, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4591" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4592" href="#"></a></td>
<td><pre>                    if(quotient==null) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4593" href="#"></a></td>
<td><pre>                        BigInteger rb = bigMultiplyPowerTen(scaledX,mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4594" href="#"></a></td>
<td><pre>                        quotient = divideAndRound(rb, ys,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4595" href="#"></a></td>
<td><pre>                                                  scl, roundingMode, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4596" href="#"></a></td>
<td><pre>                    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4597" href="#"></a></td>
<td><pre>                } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4598" href="#"></a></td>
<td><pre>                    quotient = divideAndRound(scaledXs, ys, scl, roundingMode, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4599" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4600" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4601" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4602" href="#"></a></td>
<td><pre>        // doRound, here, only affects 1000000000 case.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4603" href="#"></a></td>
<td><pre>        return doRound(quotient,mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4604" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4605" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4606" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4607" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (xs /</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4608" href="#"></a></td>
<td><pre>     * ys)}, with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4609" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4610" href="#"></a></td>
<td><pre>    private static BigDecimal divide(final long xs, int xscale, final long ys, int yscale, long preferredScale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4611" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4612" href="#"></a></td>
<td><pre>        if(xscale &lt;= yscale &amp;&amp; yscale &lt; 18 &amp;&amp; mcp&lt;18) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4613" href="#"></a></td>
<td><pre>            return divideSmallFastPath(xs, xscale, ys, yscale, preferredScale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4614" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4615" href="#"></a></td>
<td><pre>        if (compareMagnitudeNormalized(xs, xscale, ys, yscale) &gt; 0) {// satisfy constraint (b)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4616" href="#"></a></td>
<td><pre>            yscale -= 1; // [that is, divisor *= 10]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4617" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4618" href="#"></a></td>
<td><pre>        int roundingMode = mc.roundingMode.oldMode;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4619" href="#"></a></td>
<td><pre>        // In order to find out whether the divide generates the exact result,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4620" href="#"></a></td>
<td><pre>        // we avoid calling the above divide method. 'quotient' holds the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4621" href="#"></a></td>
<td><pre>        // return BigDecimal object whose scale will be set to 'scl'.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4622" href="#"></a></td>
<td><pre>        int scl = checkScaleNonZero(preferredScale + yscale - xscale + mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4623" href="#"></a></td>
<td><pre>        BigDecimal quotient;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4624" href="#"></a></td>
<td><pre>        if (checkScaleNonZero((long) mcp + yscale - xscale) &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4625" href="#"></a></td>
<td><pre>            int raise = checkScaleNonZero((long) mcp + yscale - xscale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4626" href="#"></a></td>
<td><pre>            long scaledXs;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4627" href="#"></a></td>
<td><pre>            if ((scaledXs = longMultiplyPowerTen(xs, raise)) == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4628" href="#"></a></td>
<td><pre>                BigInteger rb = bigMultiplyPowerTen(xs,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4629" href="#"></a></td>
<td><pre>                quotient = divideAndRound(rb, ys, scl, roundingMode, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4630" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4631" href="#"></a></td>
<td><pre>                quotient = divideAndRound(scaledXs, ys, scl, roundingMode, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4632" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4633" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4634" href="#"></a></td>
<td><pre>            int newScale = checkScaleNonZero((long) xscale - mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4635" href="#"></a></td>
<td><pre>            // assert newScale &gt;= yscale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4636" href="#"></a></td>
<td><pre>            if (newScale == yscale) { // easy case</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4637" href="#"></a></td>
<td><pre>                quotient = divideAndRound(xs, ys, scl, roundingMode,checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4638" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4639" href="#"></a></td>
<td><pre>                int raise = checkScaleNonZero((long) newScale - yscale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4640" href="#"></a></td>
<td><pre>                long scaledYs;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4641" href="#"></a></td>
<td><pre>                if ((scaledYs = longMultiplyPowerTen(ys, raise)) == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4642" href="#"></a></td>
<td><pre>                    BigInteger rb = bigMultiplyPowerTen(ys,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4643" href="#"></a></td>
<td><pre>                    quotient = divideAndRound(BigInteger.valueOf(xs),</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4644" href="#"></a></td>
<td><pre>                                              rb, scl, roundingMode,checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4645" href="#"></a></td>
<td><pre>                } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4646" href="#"></a></td>
<td><pre>                    quotient = divideAndRound(xs, scaledYs, scl, roundingMode,checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4647" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4648" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4649" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4650" href="#"></a></td>
<td><pre>        // doRound, here, only affects 1000000000 case.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4651" href="#"></a></td>
<td><pre>        return doRound(quotient,mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4652" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4653" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4654" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4655" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (xs /</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4656" href="#"></a></td>
<td><pre>     * ys)}, with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4657" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4658" href="#"></a></td>
<td><pre>    private static BigDecimal divide(BigInteger xs, int xscale, long ys, int yscale, long preferredScale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4659" href="#"></a></td>
<td><pre>        // Normalize dividend &amp; divisor so that both fall into [0.1, 0.999...]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4660" href="#"></a></td>
<td><pre>        if ((-compareMagnitudeNormalized(ys, yscale, xs, xscale)) &gt; 0) {// satisfy constraint (b)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4661" href="#"></a></td>
<td><pre>            yscale -= 1; // [that is, divisor *= 10]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4662" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4663" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4664" href="#"></a></td>
<td><pre>        int roundingMode = mc.roundingMode.oldMode;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4665" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4666" href="#"></a></td>
<td><pre>        // In order to find out whether the divide generates the exact result,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4667" href="#"></a></td>
<td><pre>        // we avoid calling the above divide method. 'quotient' holds the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4668" href="#"></a></td>
<td><pre>        // return BigDecimal object whose scale will be set to 'scl'.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4669" href="#"></a></td>
<td><pre>        BigDecimal quotient;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4670" href="#"></a></td>
<td><pre>        int scl = checkScaleNonZero(preferredScale + yscale - xscale + mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4671" href="#"></a></td>
<td><pre>        if (checkScaleNonZero((long) mcp + yscale - xscale) &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4672" href="#"></a></td>
<td><pre>            int raise = checkScaleNonZero((long) mcp + yscale - xscale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4673" href="#"></a></td>
<td><pre>            BigInteger rb = bigMultiplyPowerTen(xs,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4674" href="#"></a></td>
<td><pre>            quotient = divideAndRound(rb, ys, scl, roundingMode, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4675" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4676" href="#"></a></td>
<td><pre>            int newScale = checkScaleNonZero((long) xscale - mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4677" href="#"></a></td>
<td><pre>            // assert newScale &gt;= yscale</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4678" href="#"></a></td>
<td><pre>            if (newScale == yscale) { // easy case</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4679" href="#"></a></td>
<td><pre>                quotient = divideAndRound(xs, ys, scl, roundingMode,checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4680" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4681" href="#"></a></td>
<td><pre>                int raise = checkScaleNonZero((long) newScale - yscale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4682" href="#"></a></td>
<td><pre>                long scaledYs;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4683" href="#"></a></td>
<td><pre>                if ((scaledYs = longMultiplyPowerTen(ys, raise)) == INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4684" href="#"></a></td>
<td><pre>                    BigInteger rb = bigMultiplyPowerTen(ys,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4685" href="#"></a></td>
<td><pre>                    quotient = divideAndRound(xs, rb, scl, roundingMode,checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4686" href="#"></a></td>
<td><pre>                } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4687" href="#"></a></td>
<td><pre>                    quotient = divideAndRound(xs, scaledYs, scl, roundingMode,checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4688" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4689" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4690" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4691" href="#"></a></td>
<td><pre>        // doRound, here, only affects 1000000000 case.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4692" href="#"></a></td>
<td><pre>        return doRound(quotient, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4693" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4694" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4695" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4696" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (xs /</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4697" href="#"></a></td>
<td><pre>     * ys)}, with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4698" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4699" href="#"></a></td>
<td><pre>    private static BigDecimal divide(long xs, int xscale, BigInteger ys, int yscale, long preferredScale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4700" href="#"></a></td>
<td><pre>        // Normalize dividend &amp; divisor so that both fall into [0.1, 0.999...]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4701" href="#"></a></td>
<td><pre>        if (compareMagnitudeNormalized(xs, xscale, ys, yscale) &gt; 0) {// satisfy constraint (b)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4702" href="#"></a></td>
<td><pre>            yscale -= 1; // [that is, divisor *= 10]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4703" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4704" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4705" href="#"></a></td>
<td><pre>        int roundingMode = mc.roundingMode.oldMode;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4706" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4707" href="#"></a></td>
<td><pre>        // In order to find out whether the divide generates the exact result,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4708" href="#"></a></td>
<td><pre>        // we avoid calling the above divide method. 'quotient' holds the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4709" href="#"></a></td>
<td><pre>        // return BigDecimal object whose scale will be set to 'scl'.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4710" href="#"></a></td>
<td><pre>        BigDecimal quotient;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4711" href="#"></a></td>
<td><pre>        int scl = checkScaleNonZero(preferredScale + yscale - xscale + mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4712" href="#"></a></td>
<td><pre>        if (checkScaleNonZero((long) mcp + yscale - xscale) &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4713" href="#"></a></td>
<td><pre>            int raise = checkScaleNonZero((long) mcp + yscale - xscale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4714" href="#"></a></td>
<td><pre>            BigInteger rb = bigMultiplyPowerTen(xs,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4715" href="#"></a></td>
<td><pre>            quotient = divideAndRound(rb, ys, scl, roundingMode, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4716" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4717" href="#"></a></td>
<td><pre>            int newScale = checkScaleNonZero((long) xscale - mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4718" href="#"></a></td>
<td><pre>            int raise = checkScaleNonZero((long) newScale - yscale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4719" href="#"></a></td>
<td><pre>            BigInteger rb = bigMultiplyPowerTen(ys,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4720" href="#"></a></td>
<td><pre>            quotient = divideAndRound(BigInteger.valueOf(xs), rb, scl, roundingMode,checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4721" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4722" href="#"></a></td>
<td><pre>        // doRound, here, only affects 1000000000 case.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4723" href="#"></a></td>
<td><pre>        return doRound(quotient, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4724" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4725" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4726" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4727" href="#"></a></td>
<td><pre>     * Returns a {@code BigDecimal} whose value is {@code (xs /</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4728" href="#"></a></td>
<td><pre>     * ys)}, with rounding according to the context settings.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4729" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4730" href="#"></a></td>
<td><pre>    private static BigDecimal divide(BigInteger xs, int xscale, BigInteger ys, int yscale, long preferredScale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4731" href="#"></a></td>
<td><pre>        // Normalize dividend &amp; divisor so that both fall into [0.1, 0.999...]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4732" href="#"></a></td>
<td><pre>        if (compareMagnitudeNormalized(xs, xscale, ys, yscale) &gt; 0) {// satisfy constraint (b)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4733" href="#"></a></td>
<td><pre>            yscale -= 1; // [that is, divisor *= 10]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4734" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4735" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4736" href="#"></a></td>
<td><pre>        int roundingMode = mc.roundingMode.oldMode;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4737" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4738" href="#"></a></td>
<td><pre>        // In order to find out whether the divide generates the exact result,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4739" href="#"></a></td>
<td><pre>        // we avoid calling the above divide method. 'quotient' holds the</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4740" href="#"></a></td>
<td><pre>        // return BigDecimal object whose scale will be set to 'scl'.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4741" href="#"></a></td>
<td><pre>        BigDecimal quotient;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4742" href="#"></a></td>
<td><pre>        int scl = checkScaleNonZero(preferredScale + yscale - xscale + mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4743" href="#"></a></td>
<td><pre>        if (checkScaleNonZero((long) mcp + yscale - xscale) &gt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4744" href="#"></a></td>
<td><pre>            int raise = checkScaleNonZero((long) mcp + yscale - xscale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4745" href="#"></a></td>
<td><pre>            BigInteger rb = bigMultiplyPowerTen(xs,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4746" href="#"></a></td>
<td><pre>            quotient = divideAndRound(rb, ys, scl, roundingMode, checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4747" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4748" href="#"></a></td>
<td><pre>            int newScale = checkScaleNonZero((long) xscale - mcp);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4749" href="#"></a></td>
<td><pre>            int raise = checkScaleNonZero((long) newScale - yscale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4750" href="#"></a></td>
<td><pre>            BigInteger rb = bigMultiplyPowerTen(ys,raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4751" href="#"></a></td>
<td><pre>            quotient = divideAndRound(xs, rb, scl, roundingMode,checkScaleNonZero(preferredScale));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4752" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4753" href="#"></a></td>
<td><pre>        // doRound, here, only affects 1000000000 case.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4754" href="#"></a></td>
<td><pre>        return doRound(quotient, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4755" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4756" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4757" href="#"></a></td>
<td><pre>    /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4758" href="#"></a></td>
<td><pre>     * performs divideAndRound for (dividend0*dividend1, divisor)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4759" href="#"></a></td>
<td><pre>     * returns null if quotient can't fit into long value;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4760" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4761" href="#"></a></td>
<td><pre>    private static BigDecimal multiplyDivideAndRound(long dividend0, long dividend1, long divisor, int scale, int roundingMode,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4762" href="#"></a></td>
<td><pre>                                                     int preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4763" href="#"></a></td>
<td><pre>        int qsign = Long.signum(dividend0)*Long.signum(dividend1)*Long.signum(divisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4764" href="#"></a></td>
<td><pre>        dividend0 = Math.abs(dividend0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4765" href="#"></a></td>
<td><pre>        dividend1 = Math.abs(dividend1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4766" href="#"></a></td>
<td><pre>        divisor = Math.abs(divisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4767" href="#"></a></td>
<td><pre>        // multiply dividend0 * dividend1</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4768" href="#"></a></td>
<td><pre>        long d0_hi = dividend0 &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4769" href="#"></a></td>
<td><pre>        long d0_lo = dividend0 &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4770" href="#"></a></td>
<td><pre>        long d1_hi = dividend1 &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4771" href="#"></a></td>
<td><pre>        long d1_lo = dividend1 &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4772" href="#"></a></td>
<td><pre>        long product = d0_lo * d1_lo;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4773" href="#"></a></td>
<td><pre>        long d0 = product &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4774" href="#"></a></td>
<td><pre>        long d1 = product &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4775" href="#"></a></td>
<td><pre>        product = d0_hi * d1_lo + d1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4776" href="#"></a></td>
<td><pre>        d1 = product &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4777" href="#"></a></td>
<td><pre>        long d2 = product &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4778" href="#"></a></td>
<td><pre>        product = d0_lo * d1_hi + d1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4779" href="#"></a></td>
<td><pre>        d1 = product &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4780" href="#"></a></td>
<td><pre>        d2 += product &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4781" href="#"></a></td>
<td><pre>        long d3 = d2&gt;&gt;&gt;32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4782" href="#"></a></td>
<td><pre>        d2 &amp;= LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4783" href="#"></a></td>
<td><pre>        product = d0_hi*d1_hi + d2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4784" href="#"></a></td>
<td><pre>        d2 = product &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4785" href="#"></a></td>
<td><pre>        d3 = ((product&gt;&gt;&gt;32) + d3) &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4786" href="#"></a></td>
<td><pre>        final long dividendHi = make64(d3,d2);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4787" href="#"></a></td>
<td><pre>        final long dividendLo = make64(d1,d0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4788" href="#"></a></td>
<td><pre>        // divide</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4789" href="#"></a></td>
<td><pre>        return divideAndRound128(dividendHi, dividendLo, divisor, qsign, scale, roundingMode, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4790" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4791" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4792" href="#"></a></td>
<td><pre>    private static final long DIV_NUM_BASE = (1L&lt;&lt;32); // Number base (32 bits).</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4793" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4794" href="#"></a></td>
<td><pre>    /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4795" href="#"></a></td>
<td><pre>     * divideAndRound 128-bit value by long divisor.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4796" href="#"></a></td>
<td><pre>     * returns null if quotient can't fit into long value;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4797" href="#"></a></td>
<td><pre>     * Specialized version of Knuth's division</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4798" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4799" href="#"></a></td>
<td><pre>    private static BigDecimal divideAndRound128(final long dividendHi, final long dividendLo, long divisor, int sign,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4800" href="#"></a></td>
<td><pre>                                                int scale, int roundingMode, int preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4801" href="#"></a></td>
<td><pre>        if (dividendHi &gt;= divisor) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4802" href="#"></a></td>
<td><pre>            return null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4803" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4804" href="#"></a></td>
<td><pre>        final int shift = Long.numberOfLeadingZeros(divisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4805" href="#"></a></td>
<td><pre>        divisor &lt;&lt;= shift;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4806" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4807" href="#"></a></td>
<td><pre>        final long v1 = divisor &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4808" href="#"></a></td>
<td><pre>        final long v0 = divisor &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4809" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4810" href="#"></a></td>
<td><pre>        long q1, q0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4811" href="#"></a></td>
<td><pre>        long r_tmp;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4812" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4813" href="#"></a></td>
<td><pre>        long tmp = dividendLo &lt;&lt; shift;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4814" href="#"></a></td>
<td><pre>        long u1 = tmp &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4815" href="#"></a></td>
<td><pre>        long u0 = tmp &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4816" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4817" href="#"></a></td>
<td><pre>        tmp = (dividendHi &lt;&lt; shift) | (dividendLo &gt;&gt;&gt; 64 - shift);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4818" href="#"></a></td>
<td><pre>        long u2 = tmp &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4819" href="#"></a></td>
<td><pre>        tmp = divWord(tmp,v1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4820" href="#"></a></td>
<td><pre>        q1 = tmp &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4821" href="#"></a></td>
<td><pre>        r_tmp = tmp &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4822" href="#"></a></td>
<td><pre>        while(q1 &gt;= DIV_NUM_BASE || unsignedLongCompare(q1*v0, make64(r_tmp, u1))) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4823" href="#"></a></td>
<td><pre>            q1--;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4824" href="#"></a></td>
<td><pre>            r_tmp += v1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4825" href="#"></a></td>
<td><pre>            if (r_tmp &gt;= DIV_NUM_BASE)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4826" href="#"></a></td>
<td><pre>                break;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4827" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4828" href="#"></a></td>
<td><pre>        tmp = mulsub(u2,u1,v1,v0,q1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4829" href="#"></a></td>
<td><pre>        u1 = tmp &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4830" href="#"></a></td>
<td><pre>        tmp = divWord(tmp,v1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4831" href="#"></a></td>
<td><pre>        q0 = tmp &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4832" href="#"></a></td>
<td><pre>        r_tmp = tmp &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4833" href="#"></a></td>
<td><pre>        while(q0 &gt;= DIV_NUM_BASE || unsignedLongCompare(q0*v0,make64(r_tmp,u0))) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4834" href="#"></a></td>
<td><pre>            q0--;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4835" href="#"></a></td>
<td><pre>            r_tmp += v1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4836" href="#"></a></td>
<td><pre>            if (r_tmp &gt;= DIV_NUM_BASE)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4837" href="#"></a></td>
<td><pre>                break;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4838" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4839" href="#"></a></td>
<td><pre>        if((int)q1 &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4840" href="#"></a></td>
<td><pre>            // result (which is positive and unsigned here)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4841" href="#"></a></td>
<td><pre>            // can't fit into long due to sign bit is used for value</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4842" href="#"></a></td>
<td><pre>            MutableBigInteger mq = new MutableBigInteger(new int[]{(int)q1, (int)q0});</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4843" href="#"></a></td>
<td><pre>            if (roundingMode == ROUND_DOWN &amp;&amp; scale == preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4844" href="#"></a></td>
<td><pre>                return mq.toBigDecimal(sign, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4845" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4846" href="#"></a></td>
<td><pre>            long r = mulsub(u1, u0, v1, v0, q0) &gt;&gt;&gt; shift;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4847" href="#"></a></td>
<td><pre>            if (r != 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4848" href="#"></a></td>
<td><pre>                if(needIncrement(divisor &gt;&gt;&gt; shift, roundingMode, sign, mq, r)){</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4849" href="#"></a></td>
<td><pre>                    mq.add(MutableBigInteger.ONE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4850" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4851" href="#"></a></td>
<td><pre>                return mq.toBigDecimal(sign, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4852" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4853" href="#"></a></td>
<td><pre>                if (preferredScale != scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4854" href="#"></a></td>
<td><pre>                    BigInteger intVal =  mq.toBigInteger(sign);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4855" href="#"></a></td>
<td><pre>                    return createAndStripZerosToMatchScale(intVal,scale, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4856" href="#"></a></td>
<td><pre>                } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4857" href="#"></a></td>
<td><pre>                    return mq.toBigDecimal(sign, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4858" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4859" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4860" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4861" href="#"></a></td>
<td><pre>        long q = make64(q1,q0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4862" href="#"></a></td>
<td><pre>        q*=sign;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4863" href="#"></a></td>
<td><pre>        if (roundingMode == ROUND_DOWN &amp;&amp; scale == preferredScale)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4864" href="#"></a></td>
<td><pre>            return valueOf(q, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4865" href="#"></a></td>
<td><pre>        long r = mulsub(u1, u0, v1, v0, q0) &gt;&gt;&gt; shift;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4866" href="#"></a></td>
<td><pre>        if (r != 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4867" href="#"></a></td>
<td><pre>            boolean increment = needIncrement(divisor &gt;&gt;&gt; shift, roundingMode, sign, q, r);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4868" href="#"></a></td>
<td><pre>            return valueOf((increment ? q + sign : q), scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4869" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4870" href="#"></a></td>
<td><pre>            if (preferredScale != scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4871" href="#"></a></td>
<td><pre>                return createAndStripZerosToMatchScale(q, scale, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4872" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4873" href="#"></a></td>
<td><pre>                return valueOf(q, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4874" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4875" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4876" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4877" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4878" href="#"></a></td>
<td><pre>    /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4879" href="#"></a></td>
<td><pre>     * calculate divideAndRound for ldividend*10^raise / divisor</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4880" href="#"></a></td>
<td><pre>     * when abs(dividend)==abs(divisor);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4881" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4882" href="#"></a></td>
<td><pre>    private static BigDecimal roundedTenPower(int qsign, int raise, int scale, int preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4883" href="#"></a></td>
<td><pre>        if (scale &gt; preferredScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4884" href="#"></a></td>
<td><pre>            int diff = scale - preferredScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4885" href="#"></a></td>
<td><pre>            if(diff &lt; raise) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4886" href="#"></a></td>
<td><pre>                return scaledTenPow(raise - diff, qsign, preferredScale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4887" href="#"></a></td>
<td><pre>            } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4888" href="#"></a></td>
<td><pre>                return valueOf(qsign,scale-raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4889" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4890" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4891" href="#"></a></td>
<td><pre>            return scaledTenPow(raise, qsign, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4892" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4893" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4894" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4895" href="#"></a></td>
<td><pre>    static BigDecimal scaledTenPow(int n, int sign, int scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4896" href="#"></a></td>
<td><pre>        if (n &lt; LONG_TEN_POWERS_TABLE.length)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4897" href="#"></a></td>
<td><pre>            return valueOf(sign*LONG_TEN_POWERS_TABLE[n],scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4898" href="#"></a></td>
<td><pre>        else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4899" href="#"></a></td>
<td><pre>            BigInteger unscaledVal = bigTenToThe(n);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4900" href="#"></a></td>
<td><pre>            if(sign==-1) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4901" href="#"></a></td>
<td><pre>                unscaledVal = unscaledVal.negate();</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4902" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4903" href="#"></a></td>
<td><pre>            return new BigDecimal(unscaledVal, INFLATED, scale, n+1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4904" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4905" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4906" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4907" href="#"></a></td>
<td><pre>    private static long divWord(long n, long dLong) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4908" href="#"></a></td>
<td><pre>        long r;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4909" href="#"></a></td>
<td><pre>        long q;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4910" href="#"></a></td>
<td><pre>        if (dLong == 1) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4911" href="#"></a></td>
<td><pre>            q = (int)n;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4912" href="#"></a></td>
<td><pre>            return (q &amp; LONG_MASK);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4913" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4914" href="#"></a></td>
<td><pre>        // Approximate the quotient and remainder</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4915" href="#"></a></td>
<td><pre>        q = (n &gt;&gt;&gt; 1) / (dLong &gt;&gt;&gt; 1);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4916" href="#"></a></td>
<td><pre>        r = n - q*dLong;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4917" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4918" href="#"></a></td>
<td><pre>        // Correct the approximation</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4919" href="#"></a></td>
<td><pre>        while (r &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4920" href="#"></a></td>
<td><pre>            r += dLong;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4921" href="#"></a></td>
<td><pre>            q--;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4922" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4923" href="#"></a></td>
<td><pre>        while (r &gt;= dLong) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4924" href="#"></a></td>
<td><pre>            r -= dLong;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4925" href="#"></a></td>
<td><pre>            q++;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4926" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4927" href="#"></a></td>
<td><pre>        // n - q*dlong == r &amp;&amp; 0 &lt;= r &lt;dLong, hence we're done.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4928" href="#"></a></td>
<td><pre>        return (r &lt;&lt; 32) | (q &amp; LONG_MASK);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4929" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4930" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4931" href="#"></a></td>
<td><pre>    private static long make64(long hi, long lo) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4932" href="#"></a></td>
<td><pre>        return hi&lt;&lt;32 | lo;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4933" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4934" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4935" href="#"></a></td>
<td><pre>    private static long mulsub(long u1, long u0, final long v1, final long v0, long q0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4936" href="#"></a></td>
<td><pre>        long tmp = u0 - q0*v0;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4937" href="#"></a></td>
<td><pre>        return make64(u1 + (tmp&gt;&gt;&gt;32) - q0*v1,tmp &amp; LONG_MASK);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4938" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4939" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4940" href="#"></a></td>
<td><pre>    private static boolean unsignedLongCompare(long one, long two) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4941" href="#"></a></td>
<td><pre>        return (one+Long.MIN_VALUE) &gt; (two+Long.MIN_VALUE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4942" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4943" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4944" href="#"></a></td>
<td><pre>    private static boolean unsignedLongCompareEq(long one, long two) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4945" href="#"></a></td>
<td><pre>        return (one+Long.MIN_VALUE) &gt;= (two+Long.MIN_VALUE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4946" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4947" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4948" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4949" href="#"></a></td>
<td><pre>    // Compare Normalize dividend &amp; divisor so that both fall into [0.1, 0.999...]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4950" href="#"></a></td>
<td><pre>    private static int compareMagnitudeNormalized(long xs, int xscale, long ys, int yscale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4951" href="#"></a></td>
<td><pre>        // assert xs!=0 &amp;&amp; ys!=0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4952" href="#"></a></td>
<td><pre>        int sdiff = xscale - yscale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4953" href="#"></a></td>
<td><pre>        if (sdiff != 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4954" href="#"></a></td>
<td><pre>            if (sdiff &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4955" href="#"></a></td>
<td><pre>                xs = longMultiplyPowerTen(xs, -sdiff);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4956" href="#"></a></td>
<td><pre>            } else { // sdiff &gt; 0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4957" href="#"></a></td>
<td><pre>                ys = longMultiplyPowerTen(ys, sdiff);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4958" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4959" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4960" href="#"></a></td>
<td><pre>        if (xs != INFLATED)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4961" href="#"></a></td>
<td><pre>            return (ys != INFLATED) ? longCompareMagnitude(xs, ys) : -1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4962" href="#"></a></td>
<td><pre>        else</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4963" href="#"></a></td>
<td><pre>            return 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4964" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4965" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4966" href="#"></a></td>
<td><pre>    // Compare Normalize dividend &amp; divisor so that both fall into [0.1, 0.999...]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4967" href="#"></a></td>
<td><pre>    private static int compareMagnitudeNormalized(long xs, int xscale, BigInteger ys, int yscale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4968" href="#"></a></td>
<td><pre>        // assert &quot;ys can't be represented as long&quot;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4969" href="#"></a></td>
<td><pre>        if (xs == 0)</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4970" href="#"></a></td>
<td><pre>            return -1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4971" href="#"></a></td>
<td><pre>        int sdiff = xscale - yscale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4972" href="#"></a></td>
<td><pre>        if (sdiff &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4973" href="#"></a></td>
<td><pre>            if (longMultiplyPowerTen(xs, -sdiff) == INFLATED ) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4974" href="#"></a></td>
<td><pre>                return bigMultiplyPowerTen(xs, -sdiff).compareMagnitude(ys);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4975" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4976" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4977" href="#"></a></td>
<td><pre>        return -1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4978" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4979" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4980" href="#"></a></td>
<td><pre>    // Compare Normalize dividend &amp; divisor so that both fall into [0.1, 0.999...]</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4981" href="#"></a></td>
<td><pre>    private static int compareMagnitudeNormalized(BigInteger xs, int xscale, BigInteger ys, int yscale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4982" href="#"></a></td>
<td><pre>        int sdiff = xscale - yscale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4983" href="#"></a></td>
<td><pre>        if (sdiff &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4984" href="#"></a></td>
<td><pre>            return bigMultiplyPowerTen(xs, -sdiff).compareMagnitude(ys);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4985" href="#"></a></td>
<td><pre>        } else { // sdiff &gt;= 0</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4986" href="#"></a></td>
<td><pre>            return xs.compareMagnitude(bigMultiplyPowerTen(ys, sdiff));</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4987" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4988" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4989" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4990" href="#"></a></td>
<td><pre>    private static long multiply(long x, long y){</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4991" href="#"></a></td>
<td><pre>                long product = x * y;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4992" href="#"></a></td>
<td><pre>        long ax = Math.abs(x);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4993" href="#"></a></td>
<td><pre>        long ay = Math.abs(y);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4994" href="#"></a></td>
<td><pre>        if (((ax | ay) &gt;&gt;&gt; 31 == 0) || (y == 0) || (product / y == x)){</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4995" href="#"></a></td>
<td><pre>                        return product;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4996" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4997" href="#"></a></td>
<td><pre>        return INFLATED;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4998" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="4999" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5000" href="#"></a></td>
<td><pre>    private static BigDecimal multiply(long x, long y, int scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5001" href="#"></a></td>
<td><pre>        long product = multiply(x, y);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5002" href="#"></a></td>
<td><pre>        if(product!=INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5003" href="#"></a></td>
<td><pre>            return valueOf(product,scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5004" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5005" href="#"></a></td>
<td><pre>        return new BigDecimal(BigInteger.valueOf(x).multiply(y),INFLATED,scale,0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5006" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5007" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5008" href="#"></a></td>
<td><pre>    private static BigDecimal multiply(long x, BigInteger y, int scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5009" href="#"></a></td>
<td><pre>        if(x==0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5010" href="#"></a></td>
<td><pre>            return zeroValueOf(scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5011" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5012" href="#"></a></td>
<td><pre>        return new BigDecimal(y.multiply(x),INFLATED,scale,0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5013" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5014" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5015" href="#"></a></td>
<td><pre>    private static BigDecimal multiply(BigInteger x, BigInteger y, int scale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5016" href="#"></a></td>
<td><pre>        return new BigDecimal(x.multiply(y),INFLATED,scale,0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5017" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5018" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5019" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5020" href="#"></a></td>
<td><pre>     * Multiplies two long values and rounds according {@code MathContext}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5021" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5022" href="#"></a></td>
<td><pre>    private static BigDecimal multiplyAndRound(long x, long y, int scale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5023" href="#"></a></td>
<td><pre>        long product = multiply(x, y);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5024" href="#"></a></td>
<td><pre>        if(product!=INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5025" href="#"></a></td>
<td><pre>            return doRound(product, scale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5026" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5027" href="#"></a></td>
<td><pre>        // attempt to do it in 128 bits</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5028" href="#"></a></td>
<td><pre>        int rsign = 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5029" href="#"></a></td>
<td><pre>        if(x &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5030" href="#"></a></td>
<td><pre>            x = -x;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5031" href="#"></a></td>
<td><pre>            rsign = -1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5032" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5033" href="#"></a></td>
<td><pre>        if(y &lt; 0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5034" href="#"></a></td>
<td><pre>            y = -y;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5035" href="#"></a></td>
<td><pre>            rsign *= -1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5036" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5037" href="#"></a></td>
<td><pre>        // multiply dividend0 * dividend1</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5038" href="#"></a></td>
<td><pre>        long m0_hi = x &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5039" href="#"></a></td>
<td><pre>        long m0_lo = x &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5040" href="#"></a></td>
<td><pre>        long m1_hi = y &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5041" href="#"></a></td>
<td><pre>        long m1_lo = y &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5042" href="#"></a></td>
<td><pre>        product = m0_lo * m1_lo;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5043" href="#"></a></td>
<td><pre>        long m0 = product &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5044" href="#"></a></td>
<td><pre>        long m1 = product &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5045" href="#"></a></td>
<td><pre>        product = m0_hi * m1_lo + m1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5046" href="#"></a></td>
<td><pre>        m1 = product &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5047" href="#"></a></td>
<td><pre>        long m2 = product &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5048" href="#"></a></td>
<td><pre>        product = m0_lo * m1_hi + m1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5049" href="#"></a></td>
<td><pre>        m1 = product &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5050" href="#"></a></td>
<td><pre>        m2 += product &gt;&gt;&gt; 32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5051" href="#"></a></td>
<td><pre>        long m3 = m2&gt;&gt;&gt;32;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5052" href="#"></a></td>
<td><pre>        m2 &amp;= LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5053" href="#"></a></td>
<td><pre>        product = m0_hi*m1_hi + m2;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5054" href="#"></a></td>
<td><pre>        m2 = product &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5055" href="#"></a></td>
<td><pre>        m3 = ((product&gt;&gt;&gt;32) + m3) &amp; LONG_MASK;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5056" href="#"></a></td>
<td><pre>        final long mHi = make64(m3,m2);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5057" href="#"></a></td>
<td><pre>        final long mLo = make64(m1,m0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5058" href="#"></a></td>
<td><pre>        BigDecimal res = doRound128(mHi, mLo, rsign, scale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5059" href="#"></a></td>
<td><pre>        if(res!=null) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5060" href="#"></a></td>
<td><pre>            return res;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5061" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5062" href="#"></a></td>
<td><pre>        res = new BigDecimal(BigInteger.valueOf(x).multiply(y*rsign), INFLATED, scale, 0);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5063" href="#"></a></td>
<td><pre>        return doRound(res,mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5064" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5065" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5066" href="#"></a></td>
<td><pre>    private static BigDecimal multiplyAndRound(long x, BigInteger y, int scale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5067" href="#"></a></td>
<td><pre>        if(x==0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5068" href="#"></a></td>
<td><pre>            return zeroValueOf(scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5069" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5070" href="#"></a></td>
<td><pre>        return doRound(y.multiply(x), scale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5071" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5072" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5073" href="#"></a></td>
<td><pre>    private static BigDecimal multiplyAndRound(BigInteger x, BigInteger y, int scale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5074" href="#"></a></td>
<td><pre>        return doRound(x.multiply(y), scale, mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5075" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5076" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5077" href="#"></a></td>
<td><pre>    /**</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5078" href="#"></a></td>
<td><pre>     * rounds 128-bit value according {@code MathContext}</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5079" href="#"></a></td>
<td><pre>     * returns null if result can't be repsented as compact BigDecimal.</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5080" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5081" href="#"></a></td>
<td><pre>    private static BigDecimal doRound128(long hi, long lo, int sign, int scale, MathContext mc) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5082" href="#"></a></td>
<td><pre>        int mcp = mc.precision;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5083" href="#"></a></td>
<td><pre>        int drop;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5084" href="#"></a></td>
<td><pre>        BigDecimal res = null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5085" href="#"></a></td>
<td><pre>        if(((drop = precision(hi, lo) - mcp) &gt; 0)&amp;&amp;(drop&lt;LONG_TEN_POWERS_TABLE.length)) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5086" href="#"></a></td>
<td><pre>            scale = checkScaleNonZero((long)scale - drop);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5087" href="#"></a></td>
<td><pre>            res = divideAndRound128(hi, lo, LONG_TEN_POWERS_TABLE[drop], sign, scale, mc.roundingMode.oldMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5088" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5089" href="#"></a></td>
<td><pre>        if(res!=null) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5090" href="#"></a></td>
<td><pre>            return doRound(res,mc);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5091" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5092" href="#"></a></td>
<td><pre>        return null;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5093" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5094" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5095" href="#"></a></td>
<td><pre>    private static final long[][] LONGLONG_TEN_POWERS_TABLE = {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5096" href="#"></a></td>
<td><pre>        {   0L, 0x8AC7230489E80000L },  //10^19</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5097" href="#"></a></td>
<td><pre>        {       0x5L, 0x6bc75e2d63100000L },  //10^20</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5098" href="#"></a></td>
<td><pre>        {       0x36L, 0x35c9adc5dea00000L },  //10^21</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5099" href="#"></a></td>
<td><pre>        {       0x21eL, 0x19e0c9bab2400000L  },  //10^22</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5100" href="#"></a></td>
<td><pre>        {       0x152dL, 0x02c7e14af6800000L  },  //10^23</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5101" href="#"></a></td>
<td><pre>        {       0xd3c2L, 0x1bcecceda1000000L  },  //10^24</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5102" href="#"></a></td>
<td><pre>        {       0x84595L, 0x161401484a000000L  },  //10^25</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5103" href="#"></a></td>
<td><pre>        {       0x52b7d2L, 0xdcc80cd2e4000000L  },  //10^26</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5104" href="#"></a></td>
<td><pre>        {       0x33b2e3cL, 0x9fd0803ce8000000L  },  //10^27</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5105" href="#"></a></td>
<td><pre>        {       0x204fce5eL, 0x3e25026110000000L  },  //10^28</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5106" href="#"></a></td>
<td><pre>        {       0x1431e0faeL, 0x6d7217caa0000000L  },  //10^29</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5107" href="#"></a></td>
<td><pre>        {       0xc9f2c9cd0L, 0x4674edea40000000L  },  //10^30</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5108" href="#"></a></td>
<td><pre>        {       0x7e37be2022L, 0xc0914b2680000000L  },  //10^31</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5109" href="#"></a></td>
<td><pre>        {       0x4ee2d6d415bL, 0x85acef8100000000L  },  //10^32</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5110" href="#"></a></td>
<td><pre>        {       0x314dc6448d93L, 0x38c15b0a00000000L  },  //10^33</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5111" href="#"></a></td>
<td><pre>        {       0x1ed09bead87c0L, 0x378d8e6400000000L  },  //10^34</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5112" href="#"></a></td>
<td><pre>        {       0x13426172c74d82L, 0x2b878fe800000000L  },  //10^35</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5113" href="#"></a></td>
<td><pre>        {       0xc097ce7bc90715L, 0xb34b9f1000000000L  },  //10^36</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5114" href="#"></a></td>
<td><pre>        {       0x785ee10d5da46d9L, 0x00f436a000000000L  },  //10^37</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5115" href="#"></a></td>
<td><pre>        {       0x4b3b4ca85a86c47aL, 0x098a224000000000L  },  //10^38</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5116" href="#"></a></td>
<td><pre>    };</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5117" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5118" href="#"></a></td>
<td><pre>    /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5119" href="#"></a></td>
<td><pre>     * returns precision of 128-bit value</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5120" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5121" href="#"></a></td>
<td><pre>    private static int precision(long hi, long lo){</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5122" href="#"></a></td>
<td><pre>        if(hi==0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5123" href="#"></a></td>
<td><pre>            if(lo&gt;=0) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5124" href="#"></a></td>
<td><pre>                return longDigitLength(lo);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5125" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5126" href="#"></a></td>
<td><pre>            return (unsignedLongCompareEq(lo, LONGLONG_TEN_POWERS_TABLE[0][1])) ? 20 : 19;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5127" href="#"></a></td>
<td><pre>            // 0x8AC7230489E80000L  = unsigned 2^19</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5128" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5129" href="#"></a></td>
<td><pre>        int r = ((128 - Long.numberOfLeadingZeros(hi) + 1) * 1233) &gt;&gt;&gt; 12;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5130" href="#"></a></td>
<td><pre>        int idx = r-19;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5131" href="#"></a></td>
<td><pre>        return (idx &gt;= LONGLONG_TEN_POWERS_TABLE.length || longLongCompareMagnitude(hi, lo,</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5132" href="#"></a></td>
<td><pre>                                                                                    LONGLONG_TEN_POWERS_TABLE[idx][0], LONGLONG_TEN_POWERS_TABLE[idx][1])) ? r : r + 1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5133" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5134" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5135" href="#"></a></td>
<td><pre>    /*</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5136" href="#"></a></td>
<td><pre>     * returns true if 128 bit number &lt;hi0,lo0&gt; is less then &lt;hi1,lo1&gt;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5137" href="#"></a></td>
<td><pre>     * hi0 &amp; hi1 should be non-negative</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5138" href="#"></a></td>
<td><pre>     */</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5139" href="#"></a></td>
<td><pre>    private static boolean longLongCompareMagnitude(long hi0, long lo0, long hi1, long lo1) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5140" href="#"></a></td>
<td><pre>        if(hi0!=hi1) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5141" href="#"></a></td>
<td><pre>            return hi0&lt;hi1;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5142" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5143" href="#"></a></td>
<td><pre>        return (lo0+Long.MIN_VALUE) &lt;(lo1+Long.MIN_VALUE);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5144" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5145" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5146" href="#"></a></td>
<td><pre>    private static BigDecimal divide(long dividend, int dividendScale, long divisor, int divisorScale, int scale, int roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5147" href="#"></a></td>
<td><pre>        if (checkScale(dividend,(long)scale + divisorScale) &gt; dividendScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5148" href="#"></a></td>
<td><pre>            int newScale = scale + divisorScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5149" href="#"></a></td>
<td><pre>            int raise = newScale - dividendScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5150" href="#"></a></td>
<td><pre>            if(raise&lt;LONG_TEN_POWERS_TABLE.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5151" href="#"></a></td>
<td><pre>                long xs = dividend;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5152" href="#"></a></td>
<td><pre>                if ((xs = longMultiplyPowerTen(xs, raise)) != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5153" href="#"></a></td>
<td><pre>                    return divideAndRound(xs, divisor, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5154" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5155" href="#"></a></td>
<td><pre>                BigDecimal q = multiplyDivideAndRound(LONG_TEN_POWERS_TABLE[raise], dividend, divisor, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5156" href="#"></a></td>
<td><pre>                if(q!=null) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5157" href="#"></a></td>
<td><pre>                    return q;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5158" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5159" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5160" href="#"></a></td>
<td><pre>            BigInteger scaledDividend = bigMultiplyPowerTen(dividend, raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5161" href="#"></a></td>
<td><pre>            return divideAndRound(scaledDividend, divisor, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5162" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5163" href="#"></a></td>
<td><pre>            int newScale = checkScale(divisor,(long)dividendScale - scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5164" href="#"></a></td>
<td><pre>            int raise = newScale - divisorScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5165" href="#"></a></td>
<td><pre>            if(raise&lt;LONG_TEN_POWERS_TABLE.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5166" href="#"></a></td>
<td><pre>                long ys = divisor;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5167" href="#"></a></td>
<td><pre>                if ((ys = longMultiplyPowerTen(ys, raise)) != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5168" href="#"></a></td>
<td><pre>                    return divideAndRound(dividend, ys, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5169" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5170" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5171" href="#"></a></td>
<td><pre>            BigInteger scaledDivisor = bigMultiplyPowerTen(divisor, raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5172" href="#"></a></td>
<td><pre>            return divideAndRound(BigInteger.valueOf(dividend), scaledDivisor, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5173" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5174" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5175" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5176" href="#"></a></td>
<td><pre>    private static BigDecimal divide(BigInteger dividend, int dividendScale, long divisor, int divisorScale, int scale, int roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5177" href="#"></a></td>
<td><pre>        if (checkScale(dividend,(long)scale + divisorScale) &gt; dividendScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5178" href="#"></a></td>
<td><pre>            int newScale = scale + divisorScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5179" href="#"></a></td>
<td><pre>            int raise = newScale - dividendScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5180" href="#"></a></td>
<td><pre>            BigInteger scaledDividend = bigMultiplyPowerTen(dividend, raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5181" href="#"></a></td>
<td><pre>            return divideAndRound(scaledDividend, divisor, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5182" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5183" href="#"></a></td>
<td><pre>            int newScale = checkScale(divisor,(long)dividendScale - scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5184" href="#"></a></td>
<td><pre>            int raise = newScale - divisorScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5185" href="#"></a></td>
<td><pre>            if(raise&lt;LONG_TEN_POWERS_TABLE.length) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5186" href="#"></a></td>
<td><pre>                long ys = divisor;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5187" href="#"></a></td>
<td><pre>                if ((ys = longMultiplyPowerTen(ys, raise)) != INFLATED) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5188" href="#"></a></td>
<td><pre>                    return divideAndRound(dividend, ys, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5189" href="#"></a></td>
<td><pre>                }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5190" href="#"></a></td>
<td><pre>            }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5191" href="#"></a></td>
<td><pre>            BigInteger scaledDivisor = bigMultiplyPowerTen(divisor, raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5192" href="#"></a></td>
<td><pre>            return divideAndRound(dividend, scaledDivisor, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5193" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5194" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5195" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5196" href="#"></a></td>
<td><pre>    private static BigDecimal divide(long dividend, int dividendScale, BigInteger divisor, int divisorScale, int scale, int roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5197" href="#"></a></td>
<td><pre>        if (checkScale(dividend,(long)scale + divisorScale) &gt; dividendScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5198" href="#"></a></td>
<td><pre>            int newScale = scale + divisorScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5199" href="#"></a></td>
<td><pre>            int raise = newScale - dividendScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5200" href="#"></a></td>
<td><pre>            BigInteger scaledDividend = bigMultiplyPowerTen(dividend, raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5201" href="#"></a></td>
<td><pre>            return divideAndRound(scaledDividend, divisor, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5202" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5203" href="#"></a></td>
<td><pre>            int newScale = checkScale(divisor,(long)dividendScale - scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5204" href="#"></a></td>
<td><pre>            int raise = newScale - divisorScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5205" href="#"></a></td>
<td><pre>            BigInteger scaledDivisor = bigMultiplyPowerTen(divisor, raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5206" href="#"></a></td>
<td><pre>            return divideAndRound(BigInteger.valueOf(dividend), scaledDivisor, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5207" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5208" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5209" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5210" href="#"></a></td>
<td><pre>    private static BigDecimal divide(BigInteger dividend, int dividendScale, BigInteger divisor, int divisorScale, int scale, int roundingMode) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5211" href="#"></a></td>
<td><pre>        if (checkScale(dividend,(long)scale + divisorScale) &gt; dividendScale) {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5212" href="#"></a></td>
<td><pre>            int newScale = scale + divisorScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5213" href="#"></a></td>
<td><pre>            int raise = newScale - dividendScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5214" href="#"></a></td>
<td><pre>            BigInteger scaledDividend = bigMultiplyPowerTen(dividend, raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5215" href="#"></a></td>
<td><pre>            return divideAndRound(scaledDividend, divisor, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5216" href="#"></a></td>
<td><pre>        } else {</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5217" href="#"></a></td>
<td><pre>            int newScale = checkScale(divisor,(long)dividendScale - scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5218" href="#"></a></td>
<td><pre>            int raise = newScale - divisorScale;</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5219" href="#"></a></td>
<td><pre>            BigInteger scaledDivisor = bigMultiplyPowerTen(divisor, raise);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5220" href="#"></a></td>
<td><pre>            return divideAndRound(dividend, scaledDivisor, scale, roundingMode, scale);</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5221" href="#"></a></td>
<td><pre>        }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5222" href="#"></a></td>
<td><pre>    }</pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5223" href="#"></a></td>
<td><pre></pre></td>
</tr>
<tr>
<td><a class="linenum-cell" data-linenum="5224" href="#"></a></td>
<td><pre>}</pre></td>
</tr>
</table>
</body>
</html>
