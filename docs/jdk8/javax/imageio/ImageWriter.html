<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/css/styles.css"/>
    </head>
<body>
<pre class="code">
/*
 * Copyright (c) 1999, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.imageio;

import java.awt.Dimension;
import java.awt.Rectangle;
import java.awt.image.BufferedImage;
import java.awt.image.RenderedImage;
import java.awt.image.Raster;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.Locale;
import java.util.MissingResourceException;
import java.util.ResourceBundle;
import javax.imageio.event.IIOWriteWarningListener;
import javax.imageio.event.IIOWriteProgressListener;
import javax.imageio.metadata.IIOMetadata;
import javax.imageio.stream.ImageOutputStream;
import javax.imageio.spi.ImageWriterSpi;

/**
 * An abstract superclass for encoding and writing images.  This class
 * must be subclassed by classes that write out images in the context
 * of the Java Image I/O framework.
 *
 * &lt;p&gt; &lt;code&gt;ImageWriter&lt;/code&gt; objects are normally instantiated by
 * the service provider class for the specific format.  Service
 * provider classes are registered with the &lt;code&gt;IIORegistry&lt;/code&gt;,
 * which uses them for format recognition and presentation of
 * available format readers and writers.
 *
 * &lt;p&gt;
 *
 * @see ImageReader
 * @see ImageWriteParam
 * @see javax.imageio.spi.IIORegistry
 * @see javax.imageio.spi.ImageWriterSpi
 *
 */
public abstract class ImageWriter implements ImageTranscoder {

    /**
     * The &lt;code&gt;ImageWriterSpi&lt;/code&gt; that instantiated this object,
     * or &lt;code&gt;null&lt;/code&gt; if its identity is not known or none
     * exists.  By default it is initialized to &lt;code&gt;null&lt;/code&gt;.
     */
    protected ImageWriterSpi originatingProvider = null;

    /**
     * The &lt;code&gt;ImageOutputStream&lt;/code&gt; or other &lt;code&gt;Object&lt;/code&gt;
     * set by &lt;code&gt;setOutput&lt;/code&gt; and retrieved by
     * &lt;code&gt;getOutput&lt;/code&gt;.  By default it is initialized to
     * &lt;code&gt;null&lt;/code&gt;.
     */
    protected Object output = null;

    /**
     * An array of &lt;code&gt;Locale&lt;/code&gt;s that may be used to localize
     * warning messages and compression setting values, or
     * &lt;code&gt;null&lt;/code&gt; if localization is not supported.  By default
     * it is initialized to &lt;code&gt;null&lt;/code&gt;.
     */
    protected Locale[] availableLocales = null;

    /**
     * The current &lt;code&gt;Locale&lt;/code&gt; to be used for localization, or
     * &lt;code&gt;null&lt;/code&gt; if none has been set.  By default it is
     * initialized to &lt;code&gt;null&lt;/code&gt;.
     */
    protected Locale locale = null;

    /**
     * A &lt;code&gt;List&lt;/code&gt; of currently registered
     * &lt;code&gt;IIOWriteWarningListener&lt;/code&gt;s, initialized by default to
     * &lt;code&gt;null&lt;/code&gt;, which is synonymous with an empty
     * &lt;code&gt;List&lt;/code&gt;.
     */
    protected List&lt;IIOWriteWarningListener&gt; warningListeners = null;

    /**
     * A &lt;code&gt;List&lt;/code&gt; of &lt;code&gt;Locale&lt;/code&gt;s, one for each
     * element of &lt;code&gt;warningListeners&lt;/code&gt;, initialized by default
     * &lt;code&gt;null&lt;/code&gt;, which is synonymous with an empty
     * &lt;code&gt;List&lt;/code&gt;.
     */
    protected List&lt;Locale&gt; warningLocales = null;

    /**
     * A &lt;code&gt;List&lt;/code&gt; of currently registered
     * &lt;code&gt;IIOWriteProgressListener&lt;/code&gt;s, initialized by default
     * &lt;code&gt;null&lt;/code&gt;, which is synonymous with an empty
     * &lt;code&gt;List&lt;/code&gt;.
     */
    protected List&lt;IIOWriteProgressListener&gt; progressListeners = null;

    /**
     * If &lt;code&gt;true&lt;/code&gt;, the current write operation should be
     * aborted.
     */
    private boolean abortFlag = false;

    /**
     * Constructs an &lt;code&gt;ImageWriter&lt;/code&gt; and sets its
     * &lt;code&gt;originatingProvider&lt;/code&gt; instance variable to the
     * supplied value.
     *
     * &lt;p&gt; Subclasses that make use of extensions should provide a
     * constructor with signature &lt;code&gt;(ImageWriterSpi,
     * Object)&lt;/code&gt; in order to retrieve the extension object.  If
     * the extension object is unsuitable, an
     * &lt;code&gt;IllegalArgumentException&lt;/code&gt; should be thrown.
     *
     * @param originatingProvider the &lt;code&gt;ImageWriterSpi&lt;/code&gt; that
     * is constructing this object, or &lt;code&gt;null&lt;/code&gt;.
     */
    protected ImageWriter(ImageWriterSpi originatingProvider) {
        this.originatingProvider = originatingProvider;
    }

    /**
     * Returns the &lt;code&gt;ImageWriterSpi&lt;/code&gt; object that created
     * this &lt;code&gt;ImageWriter&lt;/code&gt;, or &lt;code&gt;null&lt;/code&gt; if this
     * object was not created through the &lt;code&gt;IIORegistry&lt;/code&gt;.
     *
     * &lt;p&gt; The default implementation returns the value of the
     * &lt;code&gt;originatingProvider&lt;/code&gt; instance variable.
     *
     * @return an &lt;code&gt;ImageWriterSpi&lt;/code&gt;, or &lt;code&gt;null&lt;/code&gt;.
     *
     * @see ImageWriterSpi
     */
    public ImageWriterSpi getOriginatingProvider() {
        return originatingProvider;
    }

    /**
     * Sets the destination to the given
     * &lt;code&gt;ImageOutputStream&lt;/code&gt; or other &lt;code&gt;Object&lt;/code&gt;.
     * The destination is assumed to be ready to accept data, and will
     * not be closed at the end of each write. This allows distributed
     * imaging applications to transmit a series of images over a
     * single network connection.  If &lt;code&gt;output&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, any currently set output will be removed.
     *
     * &lt;p&gt; If &lt;code&gt;output&lt;/code&gt; is an
     * &lt;code&gt;ImageOutputStream&lt;/code&gt;, calls to the
     * &lt;code&gt;write&lt;/code&gt;, &lt;code&gt;writeToSequence&lt;/code&gt;, and
     * &lt;code&gt;prepareWriteEmpty&lt;/code&gt;/&lt;code&gt;endWriteEmpty&lt;/code&gt;
     * methods will preserve the existing contents of the stream.
     * Other write methods, such as &lt;code&gt;writeInsert&lt;/code&gt;,
     * &lt;code&gt;replaceStreamMetadata&lt;/code&gt;,
     * &lt;code&gt;replaceImageMetadata&lt;/code&gt;, &lt;code&gt;replacePixels&lt;/code&gt;,
     * &lt;code&gt;prepareInsertEmpty&lt;/code&gt;/&lt;code&gt;endInsertEmpty&lt;/code&gt;,
     * and &lt;code&gt;endWriteSequence&lt;/code&gt;, require the full contents
     * of the stream to be readable and writable, and may alter any
     * portion of the stream.
     *
     * &lt;p&gt; Use of a general &lt;code&gt;Object&lt;/code&gt; other than an
     * &lt;code&gt;ImageOutputStream&lt;/code&gt; is intended for writers that
     * interact directly with an output device or imaging protocol.
     * The set of legal classes is advertised by the writer's service
     * provider's &lt;code&gt;getOutputTypes&lt;/code&gt; method; most writers
     * will return a single-element array containing only
     * &lt;code&gt;ImageOutputStream.class&lt;/code&gt; to indicate that they
     * accept only an &lt;code&gt;ImageOutputStream&lt;/code&gt;.
     *
     * &lt;p&gt; The default implementation sets the &lt;code&gt;output&lt;/code&gt;
     * instance variable to the value of &lt;code&gt;output&lt;/code&gt; after
     * checking &lt;code&gt;output&lt;/code&gt; against the set of classes
     * advertised by the originating provider, if there is one.
     *
     * @param output the &lt;code&gt;ImageOutputStream&lt;/code&gt; or other
     * &lt;code&gt;Object&lt;/code&gt; to use for future writing.
     *
     * @exception IllegalArgumentException if &lt;code&gt;output&lt;/code&gt; is
     * not an instance of one of the classes returned by the
     * originating service provider's &lt;code&gt;getOutputTypes&lt;/code&gt;
     * method.
     *
     * @see #getOutput
     */
    public void setOutput(Object output) {
        if (output != null) {
            ImageWriterSpi provider = getOriginatingProvider();
            if (provider != null) {
                Class[] classes = provider.getOutputTypes();
                boolean found = false;
                for (int i = 0; i &lt; classes.length; i++) {
                    if (classes[i].isInstance(output)) {
                        found = true;
                        break;
                    }
                }
                if (!found) {
                    throw new IllegalArgumentException(&quot;Illegal output type!&quot;);
                }
            }
        }

        this.output = output;
    }

    /**
     * Returns the &lt;code&gt;ImageOutputStream&lt;/code&gt; or other
     * &lt;code&gt;Object&lt;/code&gt; set by the most recent call to the
     * &lt;code&gt;setOutput&lt;/code&gt; method.  If no destination has been
     * set, &lt;code&gt;null&lt;/code&gt; is returned.
     *
     * &lt;p&gt; The default implementation returns the value of the
     * &lt;code&gt;output&lt;/code&gt; instance variable.
     *
     * @return the &lt;code&gt;Object&lt;/code&gt; that was specified using
     * &lt;code&gt;setOutput&lt;/code&gt;, or &lt;code&gt;null&lt;/code&gt;.
     *
     * @see #setOutput
     */
    public Object getOutput() {
        return output;
    }

    // Localization

    /**
     * Returns an array of &lt;code&gt;Locale&lt;/code&gt;s that may be used to
     * localize warning listeners and compression settings.  A return
     * value of &lt;code&gt;null&lt;/code&gt; indicates that localization is not
     * supported.
     *
     * &lt;p&gt; The default implementation returns a clone of the
     * &lt;code&gt;availableLocales&lt;/code&gt; instance variable if it is
     * non-&lt;code&gt;null&lt;/code&gt;, or else returns &lt;code&gt;null&lt;/code&gt;.
     *
     * @return an array of &lt;code&gt;Locale&lt;/code&gt;s that may be used as
     * arguments to &lt;code&gt;setLocale&lt;/code&gt;, or &lt;code&gt;null&lt;/code&gt;.
     */
    public Locale[] getAvailableLocales() {
        return (availableLocales == null) ?
            null : (Locale[])availableLocales.clone();
    }

    /**
     * Sets the current &lt;code&gt;Locale&lt;/code&gt; of this
     * &lt;code&gt;ImageWriter&lt;/code&gt; to the given value.  A value of
     * &lt;code&gt;null&lt;/code&gt; removes any previous setting, and indicates
     * that the writer should localize as it sees fit.
     *
     * &lt;p&gt; The default implementation checks &lt;code&gt;locale&lt;/code&gt;
     * against the values returned by
     * &lt;code&gt;getAvailableLocales&lt;/code&gt;, and sets the
     * &lt;code&gt;locale&lt;/code&gt; instance variable if it is found.  If
     * &lt;code&gt;locale&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;, the instance variable
     * is set to &lt;code&gt;null&lt;/code&gt; without any checking.
     *
     * @param locale the desired &lt;code&gt;Locale&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt;.
     *
     * @exception IllegalArgumentException if &lt;code&gt;locale&lt;/code&gt; is
     * non-&lt;code&gt;null&lt;/code&gt; but is not one of the values returned by
     * &lt;code&gt;getAvailableLocales&lt;/code&gt;.
     *
     * @see #getLocale
     */
    public void setLocale(Locale locale) {
        if (locale != null) {
            Locale[] locales = getAvailableLocales();
            boolean found = false;
            if (locales != null) {
                for (int i = 0; i &lt; locales.length; i++) {
                    if (locale.equals(locales[i])) {
                        found = true;
                        break;
                    }
                }
            }
            if (!found) {
                throw new IllegalArgumentException(&quot;Invalid locale!&quot;);
            }
        }
        this.locale = locale;
    }

    /**
     * Returns the currently set &lt;code&gt;Locale&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt; if none has been set.
     *
     * &lt;p&gt; The default implementation returns the value of the
     * &lt;code&gt;locale&lt;/code&gt; instance variable.
     *
     * @return the current &lt;code&gt;Locale&lt;/code&gt;, or &lt;code&gt;null&lt;/code&gt;.
     *
     * @see #setLocale
     */
    public Locale getLocale() {
        return locale;
    }

    // Write params

    /**
     * Returns a new &lt;code&gt;ImageWriteParam&lt;/code&gt; object of the
     * appropriate type for this file format containing default
     * values, that is, those values that would be used
     * if no &lt;code&gt;ImageWriteParam&lt;/code&gt; object were specified.  This
     * is useful as a starting point for tweaking just a few parameters
     * and otherwise leaving the default settings alone.
     *
     * &lt;p&gt; The default implementation constructs and returns a new
     * &lt;code&gt;ImageWriteParam&lt;/code&gt; object that does not allow tiling,
     * progressive encoding, or compression, and that will be
     * localized for the current &lt;code&gt;Locale&lt;/code&gt; (&lt;i&gt;i.e.&lt;/i&gt;,
     * what you would get by calling &lt;code&gt;new
     * ImageWriteParam(getLocale())&lt;/code&gt;.
     *
     * &lt;p&gt; Individual plug-ins may return an instance of
     * &lt;code&gt;ImageWriteParam&lt;/code&gt; with additional optional features
     * enabled, or they may return an instance of a plug-in specific
     * subclass of &lt;code&gt;ImageWriteParam&lt;/code&gt;.
     *
     * @return a new &lt;code&gt;ImageWriteParam&lt;/code&gt; object containing
     * default values.
     */
    public ImageWriteParam getDefaultWriteParam() {
        return new ImageWriteParam(getLocale());
    }

    // Metadata

    /**
     * Returns an &lt;code&gt;IIOMetadata&lt;/code&gt; object containing default
     * values for encoding a stream of images.  The contents of the
     * object may be manipulated using either the XML tree structure
     * returned by the &lt;code&gt;IIOMetadata.getAsTree&lt;/code&gt; method, an
     * &lt;code&gt;IIOMetadataController&lt;/code&gt; object, or via plug-in
     * specific interfaces, and the resulting data supplied to one of
     * the &lt;code&gt;write&lt;/code&gt; methods that take a stream metadata
     * parameter.
     *
     * &lt;p&gt; An optional &lt;code&gt;ImageWriteParam&lt;/code&gt; may be supplied
     * for cases where it may affect the structure of the stream
     * metadata.
     *
     * &lt;p&gt; If the supplied &lt;code&gt;ImageWriteParam&lt;/code&gt; contains
     * optional setting values not supported by this writer (&lt;i&gt;e.g.&lt;/i&gt;
     * progressive encoding or any format-specific settings), they
     * will be ignored.
     *
     * &lt;p&gt; Writers that do not make use of stream metadata
     * (&lt;i&gt;e.g.&lt;/i&gt;, writers for single-image formats) should return
     * &lt;code&gt;null&lt;/code&gt;.
     *
     * @param param an &lt;code&gt;ImageWriteParam&lt;/code&gt; that will be used to
     * encode the image, or &lt;code&gt;null&lt;/code&gt;.
     *
     * @return an &lt;code&gt;IIOMetadata&lt;/code&gt; object.
     */
    public abstract IIOMetadata
        getDefaultStreamMetadata(ImageWriteParam param);

    /**
     * Returns an &lt;code&gt;IIOMetadata&lt;/code&gt; object containing default
     * values for encoding an image of the given type.  The contents
     * of the object may be manipulated using either the XML tree
     * structure returned by the &lt;code&gt;IIOMetadata.getAsTree&lt;/code&gt;
     * method, an &lt;code&gt;IIOMetadataController&lt;/code&gt; object, or via
     * plug-in specific interfaces, and the resulting data supplied to
     * one of the &lt;code&gt;write&lt;/code&gt; methods that take a stream
     * metadata parameter.
     *
     * &lt;p&gt; An optional &lt;code&gt;ImageWriteParam&lt;/code&gt; may be supplied
     * for cases where it may affect the structure of the image
     * metadata.
     *
     * &lt;p&gt; If the supplied &lt;code&gt;ImageWriteParam&lt;/code&gt; contains
     * optional setting values not supported by this writer (&lt;i&gt;e.g.&lt;/i&gt;
     * progressive encoding or any format-specific settings), they
     * will be ignored.
     *
     * @param imageType an &lt;code&gt;ImageTypeSpecifier&lt;/code&gt; indicating the
     * format of the image to be written later.
     * @param param an &lt;code&gt;ImageWriteParam&lt;/code&gt; that will be used to
     * encode the image, or &lt;code&gt;null&lt;/code&gt;.
     *
     * @return an &lt;code&gt;IIOMetadata&lt;/code&gt; object.
     */
    public abstract IIOMetadata
        getDefaultImageMetadata(ImageTypeSpecifier imageType,
                                ImageWriteParam param);

    // comment inherited
    public abstract IIOMetadata convertStreamMetadata(IIOMetadata inData,
                                                      ImageWriteParam param);

    // comment inherited
    public abstract IIOMetadata
        convertImageMetadata(IIOMetadata inData,
                             ImageTypeSpecifier imageType,
                             ImageWriteParam param);

    // Thumbnails

    /**
     * Returns the number of thumbnails supported by the format being
     * written, given the image type and any additional write
     * parameters and metadata objects that will be used during
     * encoding.  A return value of &lt;code&gt;-1&lt;/code&gt; indicates that
     * insufficient information is available.
     *
     * &lt;p&gt; An &lt;code&gt;ImageWriteParam&lt;/code&gt; may optionally be supplied
     * for cases where it may affect thumbnail handling.
     *
     * &lt;p&gt; If the supplied &lt;code&gt;ImageWriteParam&lt;/code&gt; contains
     * optional setting values not supported by this writer (&lt;i&gt;e.g.&lt;/i&gt;
     * progressive encoding or any format-specific settings), they
     * will be ignored.
     *
     * &lt;p&gt; The default implementation returns 0.
     *
     * @param imageType an &lt;code&gt;ImageTypeSpecifier&lt;/code&gt; indicating
     * the type of image to be written, or &lt;code&gt;null&lt;/code&gt;.
     * @param param the &lt;code&gt;ImageWriteParam&lt;/code&gt; that will be used for
     * writing, or &lt;code&gt;null&lt;/code&gt;.
     * @param streamMetadata an &lt;code&gt;IIOMetadata&lt;/code&gt; object that will
     * be used for writing, or &lt;code&gt;null&lt;/code&gt;.
     * @param imageMetadata an &lt;code&gt;IIOMetadata&lt;/code&gt; object that will
     * be used for writing, or &lt;code&gt;null&lt;/code&gt;.
     *
     * @return the number of thumbnails that may be written given the
     * supplied parameters, or &lt;code&gt;-1&lt;/code&gt; if insufficient
     * information is available.
     */
    public int getNumThumbnailsSupported(ImageTypeSpecifier imageType,
                                         ImageWriteParam param,
                                         IIOMetadata streamMetadata,
                                         IIOMetadata imageMetadata) {
        return 0;
    }

    /**
     * Returns an array of &lt;code&gt;Dimension&lt;/code&gt;s indicating the
     * legal size ranges for thumbnail images as they will be encoded
     * in the output file or stream.  This information is merely
     * advisory; the writer will resize any supplied thumbnails as
     * necessary.
     *
     * &lt;p&gt; The information is returned as a set of pairs; the first
     * element of a pair contains an (inclusive) minimum width and
     * height, and the second element contains an (inclusive) maximum
     * width and height.  Together, each pair defines a valid range of
     * sizes.  To specify a fixed size, the same width and height will
     * appear for both elements.  A return value of &lt;code&gt;null&lt;/code&gt;
     * indicates that the size is arbitrary or unknown.
     *
     * &lt;p&gt; An &lt;code&gt;ImageWriteParam&lt;/code&gt; may optionally be supplied
     * for cases where it may affect thumbnail handling.
     *
     * &lt;p&gt; If the supplied &lt;code&gt;ImageWriteParam&lt;/code&gt; contains
     * optional setting values not supported by this writer (&lt;i&gt;e.g.&lt;/i&gt;
     * progressive encoding or any format-specific settings), they
     * will be ignored.
     *
     * &lt;p&gt; The default implementation returns &lt;code&gt;null&lt;/code&gt;.
     *
     * @param imageType an &lt;code&gt;ImageTypeSpecifier&lt;/code&gt; indicating the
     * type of image to be written, or &lt;code&gt;null&lt;/code&gt;.
     * @param param the &lt;code&gt;ImageWriteParam&lt;/code&gt; that will be used for
     * writing, or &lt;code&gt;null&lt;/code&gt;.
     * @param streamMetadata an &lt;code&gt;IIOMetadata&lt;/code&gt; object that will
     * be used for writing, or &lt;code&gt;null&lt;/code&gt;.
     * @param imageMetadata an &lt;code&gt;IIOMetadata&lt;/code&gt; object that will
     * be used for writing, or &lt;code&gt;null&lt;/code&gt;.
     *
     * @return an array of &lt;code&gt;Dimension&lt;/code&gt;s with an even length
     * of at least two, or &lt;code&gt;null&lt;/code&gt;.
     */
    public Dimension[] getPreferredThumbnailSizes(ImageTypeSpecifier imageType,
                                                  ImageWriteParam param,
                                                  IIOMetadata streamMetadata,
                                                  IIOMetadata imageMetadata) {
        return null;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if the methods that take an
     * &lt;code&gt;IIOImage&lt;/code&gt; parameter are capable of dealing with a
     * &lt;code&gt;Raster&lt;/code&gt; (as opposed to &lt;code&gt;RenderedImage&lt;/code&gt;)
     * source image.  If this method returns &lt;code&gt;false&lt;/code&gt;, then
     * those methods will throw an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt; if supplied with an
     * &lt;code&gt;IIOImage&lt;/code&gt; containing a &lt;code&gt;Raster&lt;/code&gt;.
     *
     * &lt;p&gt; The default implementation returns &lt;code&gt;false&lt;/code&gt;.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;Raster&lt;/code&gt; sources are
     * supported.
     */
    public boolean canWriteRasters() {
        return false;
    }

    /**
     * Appends a complete image stream containing a single image and
     * associated stream and image metadata and thumbnails to the
     * output.  Any necessary header information is included.  If the
     * output is an &lt;code&gt;ImageOutputStream&lt;/code&gt;, its existing
     * contents prior to the current seek position are not affected,
     * and need not be readable or writable.
     *
     * &lt;p&gt; The output must have been set beforehand using the
     * &lt;code&gt;setOutput&lt;/code&gt; method.
     *
     * &lt;p&gt; Stream metadata may optionally be supplied; if it is
     * &lt;code&gt;null&lt;/code&gt;, default stream metadata will be used.
     *
     * &lt;p&gt; If &lt;code&gt;canWriteRasters&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;,
     * the &lt;code&gt;IIOImage&lt;/code&gt; may contain a &lt;code&gt;Raster&lt;/code&gt;
     * source.  Otherwise, it must contain a
     * &lt;code&gt;RenderedImage&lt;/code&gt; source.
     *
     * &lt;p&gt; The supplied thumbnails will be resized if needed, and any
     * thumbnails in excess of the supported number will be ignored.
     * If the format requires additional thumbnails that are not
     * provided, the writer should generate them internally.
     *
     * &lt;p&gt;  An &lt;code&gt;ImageWriteParam&lt;/code&gt; may
     * optionally be supplied to control the writing process.  If
     * &lt;code&gt;param&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;, a default write param
     * will be used.
     *
     * &lt;p&gt; If the supplied &lt;code&gt;ImageWriteParam&lt;/code&gt; contains
     * optional setting values not supported by this writer (&lt;i&gt;e.g.&lt;/i&gt;
     * progressive encoding or any format-specific settings), they
     * will be ignored.
     *
     * @param streamMetadata an &lt;code&gt;IIOMetadata&lt;/code&gt; object representing
     * stream metadata, or &lt;code&gt;null&lt;/code&gt; to use default values.
     * @param image an &lt;code&gt;IIOImage&lt;/code&gt; object containing an
     * image, thumbnails, and metadata to be written.
     * @param param an &lt;code&gt;ImageWriteParam&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt; to use a default
     * &lt;code&gt;ImageWriteParam&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if &lt;code&gt;image&lt;/code&gt;
     * contains a &lt;code&gt;Raster&lt;/code&gt; and &lt;code&gt;canWriteRasters&lt;/code&gt;
     * returns &lt;code&gt;false&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;image&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     * @exception IOException if an error occurs during writing.
     */
    public abstract void write(IIOMetadata streamMetadata,
                               IIOImage image,
                               ImageWriteParam param) throws IOException;

    /**
     * Appends a complete image stream containing a single image with
     * default metadata and thumbnails to the output.  This method is
     * a shorthand for &lt;code&gt;write(null, image, null)&lt;/code&gt;.
     *
     * @param image an &lt;code&gt;IIOImage&lt;/code&gt; object containing an
     * image, thumbnails, and metadata to be written.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception IllegalArgumentException if &lt;code&gt;image&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     * @exception UnsupportedOperationException if &lt;code&gt;image&lt;/code&gt;
     * contains a &lt;code&gt;Raster&lt;/code&gt; and &lt;code&gt;canWriteRasters&lt;/code&gt;
     * returns &lt;code&gt;false&lt;/code&gt;.
     * @exception IOException if an error occurs during writing.
     */
    public void write(IIOImage image) throws IOException {
        write(null, image, null);
    }

    /**
     * Appends a complete image stream consisting of a single image
     * with default metadata and thumbnails to the output.  This
     * method is a shorthand for &lt;code&gt;write(null, new IIOImage(image,
     * null, null), null)&lt;/code&gt;.
     *
     * @param image a &lt;code&gt;RenderedImage&lt;/code&gt; to be written.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception IllegalArgumentException if &lt;code&gt;image&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     * @exception IOException if an error occurs during writing.
     */
    public void write(RenderedImage image) throws IOException {
        write(null, new IIOImage(image, null, null), null);
    }

    // Check that the output has been set, then throw an
    // UnsupportedOperationException.
    private void unsupported() {
        if (getOutput() == null) {
            throw new IllegalStateException(&quot;getOutput() == null!&quot;);
        }
        throw new UnsupportedOperationException(&quot;Unsupported write variant!&quot;);
    }

    // Sequence writes

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if the writer is able to append an
     * image to an image stream that already contains header
     * information and possibly prior images.
     *
     * &lt;p&gt; If &lt;code&gt;canWriteSequence&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;,
     * &lt;code&gt;writeToSequence&lt;/code&gt; and &lt;code&gt;endWriteSequence&lt;/code&gt;
     * will throw an &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * &lt;p&gt; The default implementation returns &lt;code&gt;false&lt;/code&gt;.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if images may be appended sequentially.
     */
    public boolean canWriteSequence() {
        return false;
    }

    /**
     * Prepares a stream to accept a series of subsequent
     * &lt;code&gt;writeToSequence&lt;/code&gt; calls, using the provided stream
     * metadata object.  The metadata will be written to the stream if
     * it should precede the image data.  If the argument is &lt;code&gt;null&lt;/code&gt;,
     * default stream metadata is used.
     *
     * &lt;p&gt; If the output is an &lt;code&gt;ImageOutputStream&lt;/code&gt;, the existing
     * contents of the output prior to the current seek position are
     * flushed, and need not be readable or writable.  If the format
     * requires that &lt;code&gt;endWriteSequence&lt;/code&gt; be able to rewind to
     * patch up the header information, such as for a sequence of images
     * in a single TIFF file, then the metadata written by this method
     * must remain in a writable portion of the stream.  Other formats
     * may flush the stream after this method and after each image.
     *
     * &lt;p&gt; If &lt;code&gt;canWriteSequence&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;,
     * this method will throw an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * &lt;p&gt; The output must have been set beforehand using either
     * the &lt;code&gt;setOutput&lt;/code&gt; method.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @param streamMetadata A stream metadata object, or &lt;code&gt;null&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canWriteSequence&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;.
     * @exception IOException if an error occurs writing the stream
     * metadata.
     */
    public void prepareWriteSequence(IIOMetadata streamMetadata)
        throws IOException {
        unsupported();
    }

    /**
     * Appends a single image and possibly associated metadata and
     * thumbnails, to the output.  If the output is an
     * &lt;code&gt;ImageOutputStream&lt;/code&gt;, the existing contents of the
     * output prior to the current seek position may be flushed, and
     * need not be readable or writable, unless the plug-in needs to
     * be able to patch up the header information when
     * &lt;code&gt;endWriteSequence&lt;/code&gt; is called (&lt;i&gt;e.g.&lt;/i&gt; TIFF).
     *
     * &lt;p&gt; If &lt;code&gt;canWriteSequence&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;,
     * this method will throw an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * &lt;p&gt; The output must have been set beforehand using
     * the &lt;code&gt;setOutput&lt;/code&gt; method.
     *
     * &lt;p&gt; &lt;code&gt;prepareWriteSequence&lt;/code&gt; must have been called
     * beforehand, or an &lt;code&gt;IllegalStateException&lt;/code&gt; is thrown.
     *
     * &lt;p&gt; If &lt;code&gt;canWriteRasters&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;,
     * the &lt;code&gt;IIOImage&lt;/code&gt; may contain a &lt;code&gt;Raster&lt;/code&gt;
     * source.  Otherwise, it must contain a
     * &lt;code&gt;RenderedImage&lt;/code&gt; source.
     *
     * &lt;p&gt; The supplied thumbnails will be resized if needed, and any
     * thumbnails in excess of the supported number will be ignored.
     * If the format requires additional thumbnails that are not
     * provided, the writer will generate them internally.
     *
     * &lt;p&gt; An &lt;code&gt;ImageWriteParam&lt;/code&gt; may optionally be supplied
     * to control the writing process.  If &lt;code&gt;param&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, a default write param will be used.
     *
     * &lt;p&gt; If the supplied &lt;code&gt;ImageWriteParam&lt;/code&gt; contains
     * optional setting values not supported by this writer (&lt;i&gt;e.g.&lt;/i&gt;
     * progressive encoding or any format-specific settings), they
     * will be ignored.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @param image an &lt;code&gt;IIOImage&lt;/code&gt; object containing an
     * image, thumbnails, and metadata to be written.
     * @param param an &lt;code&gt;ImageWriteParam&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt; to use a default
     * &lt;code&gt;ImageWriteParam&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set, or &lt;code&gt;prepareWriteSequence&lt;/code&gt; has not been called.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canWriteSequence&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;image&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     * @exception UnsupportedOperationException if &lt;code&gt;image&lt;/code&gt;
     * contains a &lt;code&gt;Raster&lt;/code&gt; and &lt;code&gt;canWriteRasters&lt;/code&gt;
     * returns &lt;code&gt;false&lt;/code&gt;.
     * @exception IOException if an error occurs during writing.
     */
    public void writeToSequence(IIOImage image, ImageWriteParam param)
        throws IOException {
        unsupported();
    }

    /**
     * Completes the writing of a sequence of images begun with
     * &lt;code&gt;prepareWriteSequence&lt;/code&gt;.  Any stream metadata that
     * should come at the end of the sequence of images is written out,
     * and any header information at the beginning of the sequence is
     * patched up if necessary.  If the output is an
     * &lt;code&gt;ImageOutputStream&lt;/code&gt;, data through the stream metadata
     * at the end of the sequence are flushed and need not be readable
     * or writable.
     *
     * &lt;p&gt; If &lt;code&gt;canWriteSequence&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;,
     * this method will throw an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set, or &lt;code&gt;prepareWriteSequence&lt;/code&gt; has not been called.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canWriteSequence&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;.
     * @exception IOException if an error occurs during writing.
     */
    public void endWriteSequence() throws IOException {
        unsupported();
    }

    // Metadata replacement

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if it is possible to replace the
     * stream metadata already present in the output.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise returns &lt;code&gt;false&lt;/code&gt;.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if replacement of stream metadata is
     * allowed.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception IOException if an I/O error occurs during the query.
     */
    public boolean canReplaceStreamMetadata() throws IOException {
        if (getOutput() == null) {
            throw new IllegalStateException(&quot;getOutput() == null!&quot;);
        }
        return false;
    }

    /**
     * Replaces the stream metadata in the output with new
     * information.  If the output is an
     * &lt;code&gt;ImageOutputStream&lt;/code&gt;, the prior contents of the
     * stream are examined and possibly edited to make room for the
     * new data.  All of the prior contents of the output must be
     * available for reading and writing.
     *
     * &lt;p&gt; If &lt;code&gt;canReplaceStreamMetadata&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;, an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt; will be thrown.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @param streamMetadata an &lt;code&gt;IIOMetadata&lt;/code&gt; object representing
     * stream metadata, or &lt;code&gt;null&lt;/code&gt; to use default values.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if the
     * &lt;code&gt;canReplaceStreamMetadata&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;.  modes do not include
     * @exception IOException if an error occurs during writing.
     */
    public void replaceStreamMetadata(IIOMetadata streamMetadata)
        throws IOException {
        unsupported();
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if it is possible to replace the
     * image metadata associated with an existing image with index
     * &lt;code&gt;imageIndex&lt;/code&gt;.  If this method returns
     * &lt;code&gt;false&lt;/code&gt;, a call to
     * &lt;code&gt;replaceImageMetadata(imageIndex)&lt;/code&gt; will throw an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * &lt;p&gt; A writer that does not support any image metadata
     * replacement may return &lt;code&gt;false&lt;/code&gt; without performing
     * bounds checking on the index.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise returns &lt;code&gt;false&lt;/code&gt;
     * without checking the value of &lt;code&gt;imageIndex&lt;/code&gt;.
     *
     * @param imageIndex the index of the image whose metadata is to
     * be replaced.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if the image metadata of the given
     * image can be replaced.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception IndexOutOfBoundsException if the writer supports
     * image metadata replacement in general, but
     * &lt;code&gt;imageIndex&lt;/code&gt; is less than 0 or greater than the
     * largest available index.
     * @exception IOException if an I/O error occurs during the query.
     */
    public boolean canReplaceImageMetadata(int imageIndex)
        throws IOException {
        if (getOutput() == null) {
            throw new IllegalStateException(&quot;getOutput() == null!&quot;);
        }
        return false;
    }

    /**
     * Replaces the image metadata associated with an existing image.
     *
     * &lt;p&gt; If &lt;code&gt;canReplaceImageMetadata(imageIndex)&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;, an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt; will be thrown.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @param imageIndex the index of the image whose metadata is to
     * be replaced.
     * @param imageMetadata an &lt;code&gt;IIOMetadata&lt;/code&gt; object
     * representing image metadata, or &lt;code&gt;null&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not been
     * set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canReplaceImageMetadata&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;.
     * @exception IndexOutOfBoundsException if &lt;code&gt;imageIndex&lt;/code&gt;
     * is less than 0 or greater than the largest available index.
     * @exception IOException if an error occurs during writing.
     */
    public void replaceImageMetadata(int imageIndex,
                                     IIOMetadata imageMetadata)
        throws IOException {
        unsupported();
    }

    // Image insertion

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if the writer supports the insertion
     * of a new image at the given index.  Existing images with
     * indices greater than or equal to the insertion index will have
     * their indices increased by 1.  A value for
     * &lt;code&gt;imageIndex&lt;/code&gt; of &lt;code&gt;-1&lt;/code&gt; may be used to
     * signify an index one larger than the current largest index.
     *
     * &lt;p&gt; A writer that does not support any image insertion may
     * return &lt;code&gt;false&lt;/code&gt; without performing bounds checking on
     * the index.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise returns &lt;code&gt;false&lt;/code&gt;
     * without checking the value of &lt;code&gt;imageIndex&lt;/code&gt;.
     *
     * @param imageIndex the index at which the image is to be
     * inserted.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if an image may be inserted at the
     * given index.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception IndexOutOfBoundsException if the writer supports
     * image insertion in general, but &lt;code&gt;imageIndex&lt;/code&gt; is less
     * than -1 or greater than the largest available index.
     * @exception IOException if an I/O error occurs during the query.
     */
    public boolean canInsertImage(int imageIndex) throws IOException {
        if (getOutput() == null) {
            throw new IllegalStateException(&quot;getOutput() == null!&quot;);
        }
        return false;
    }

    /**
     * Inserts a new image into an existing image stream.  Existing
     * images with an index greater than &lt;code&gt;imageIndex&lt;/code&gt; are
     * preserved, and their indices are each increased by 1.  A value
     * for &lt;code&gt;imageIndex&lt;/code&gt; of -1 may be used to signify an
     * index one larger than the previous largest index; that is, it
     * will cause the image to be logically appended to the end of the
     * sequence.  If the output is an &lt;code&gt;ImageOutputStream&lt;/code&gt;,
     * the entirety of the stream must be both readable and writeable.
     *
     * &lt;p&gt; If &lt;code&gt;canInsertImage(imageIndex)&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;, an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt; will be thrown.
     *
     * &lt;p&gt; An &lt;code&gt;ImageWriteParam&lt;/code&gt; may optionally be supplied
     * to control the writing process.  If &lt;code&gt;param&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, a default write param will be used.
     *
     * &lt;p&gt; If the supplied &lt;code&gt;ImageWriteParam&lt;/code&gt; contains
     * optional setting values not supported by this writer (&lt;i&gt;e.g.&lt;/i&gt;
     * progressive encoding or any format-specific settings), they
     * will be ignored.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @param imageIndex the index at which to write the image.
     * @param image an &lt;code&gt;IIOImage&lt;/code&gt; object containing an
     * image, thumbnails, and metadata to be written.
     * @param param an &lt;code&gt;ImageWriteParam&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt; to use a default
     * &lt;code&gt;ImageWriteParam&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canInsertImage(imageIndex)&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;image&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     * @exception IndexOutOfBoundsException if &lt;code&gt;imageIndex&lt;/code&gt;
     * is less than -1 or greater than the largest available index.
     * @exception UnsupportedOperationException if &lt;code&gt;image&lt;/code&gt;
     * contains a &lt;code&gt;Raster&lt;/code&gt; and &lt;code&gt;canWriteRasters&lt;/code&gt;
     * returns &lt;code&gt;false&lt;/code&gt;.
     * @exception IOException if an error occurs during writing.
     */
    public void writeInsert(int imageIndex,
                            IIOImage image,
                            ImageWriteParam param) throws IOException {
        unsupported();
    }

    // Image removal

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if the writer supports the removal
     * of an existing image at the given index.  Existing images with
     * indices greater than the insertion index will have
     * their indices decreased by 1.
     *
     * &lt;p&gt; A writer that does not support any image removal may
     * return &lt;code&gt;false&lt;/code&gt; without performing bounds checking on
     * the index.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise returns &lt;code&gt;false&lt;/code&gt;
     * without checking the value of &lt;code&gt;imageIndex&lt;/code&gt;.
     *
     * @param imageIndex the index of the image to be removed.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if it is possible to remove the given
     * image.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception IndexOutOfBoundsException if the writer supports
     * image removal in general, but &lt;code&gt;imageIndex&lt;/code&gt; is less
     * than 0 or greater than the largest available index.
     * @exception IOException if an I/O error occurs during the
     * query.
     */
    public boolean canRemoveImage(int imageIndex) throws IOException {
        if (getOutput() == null) {
            throw new IllegalStateException(&quot;getOutput() == null!&quot;);
        }
        return false;
    }

    /**
     * Removes an image from the stream.
     *
     * &lt;p&gt; If &lt;code&gt;canRemoveImage(imageIndex)&lt;/code&gt; returns false,
     * an &lt;code&gt;UnsupportedOperationException&lt;/code&gt;will be thrown.
     *
     * &lt;p&gt; The removal may or may not cause a reduction in the actual
     * file size.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @param imageIndex the index of the image to be removed.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canRemoveImage(imageIndex)&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;.
     * @exception IndexOutOfBoundsException if &lt;code&gt;imageIndex&lt;/code&gt;
     * is less than 0 or greater than the largest available index.
     * @exception IOException if an I/O error occurs during the
     * removal.
     */
    public void removeImage(int imageIndex) throws IOException {
        unsupported();
    }

    // Empty images

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if the writer supports the writing of
     * a complete image stream consisting of a single image with
     * undefined pixel values and associated metadata and thumbnails
     * to the output.  The pixel values may be defined by future
     * calls to the &lt;code&gt;replacePixels&lt;/code&gt; methods.  If the output
     * is an &lt;code&gt;ImageOutputStream&lt;/code&gt;, its existing contents
     * prior to the current seek position are not affected, and need
     * not be readable or writable.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise returns &lt;code&gt;false&lt;/code&gt;.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if the writing of complete image
     * stream with contents to be defined later is supported.
     *
     * @exception IllegalStateException if the output has not been
     * set.
     * @exception IOException if an I/O error occurs during the
     * query.
     */
    public boolean canWriteEmpty() throws IOException {
        if (getOutput() == null) {
            throw new IllegalStateException(&quot;getOutput() == null!&quot;);
        }
        return false;
    }

    /**
     * Begins the writing of a complete image stream, consisting of a
     * single image with undefined pixel values and associated
     * metadata and thumbnails, to the output.  The pixel values will
     * be defined by future calls to the &lt;code&gt;replacePixels&lt;/code&gt;
     * methods.  If the output is an &lt;code&gt;ImageOutputStream&lt;/code&gt;,
     * its existing contents prior to the current seek position are
     * not affected, and need not be readable or writable.
     *
     * &lt;p&gt; The writing is not complete until a call to
     * &lt;code&gt;endWriteEmpty&lt;/code&gt; occurs.  Calls to
     * &lt;code&gt;prepareReplacePixels&lt;/code&gt;, &lt;code&gt;replacePixels&lt;/code&gt;,
     * and &lt;code&gt;endReplacePixels&lt;/code&gt; may occur between calls to
     * &lt;code&gt;prepareWriteEmpty&lt;/code&gt; and &lt;code&gt;endWriteEmpty&lt;/code&gt;.
     * However, calls to &lt;code&gt;prepareWriteEmpty&lt;/code&gt; cannot be
     * nested, and calls to &lt;code&gt;prepareWriteEmpty&lt;/code&gt; and
     * &lt;code&gt;prepareInsertEmpty&lt;/code&gt; may not be interspersed.
     *
     * &lt;p&gt; If &lt;code&gt;canWriteEmpty&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;,
     * an &lt;code&gt;UnsupportedOperationException&lt;/code&gt; will be thrown.
     *
     * &lt;p&gt; An &lt;code&gt;ImageWriteParam&lt;/code&gt; may optionally be supplied
     * to control the writing process.  If &lt;code&gt;param&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, a default write param will be used.
     *
     * &lt;p&gt; If the supplied &lt;code&gt;ImageWriteParam&lt;/code&gt; contains
     * optional setting values not supported by this writer (&lt;i&gt;e.g.&lt;/i&gt;
     * progressive encoding or any format-specific settings), they
     * will be ignored.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @param streamMetadata an &lt;code&gt;IIOMetadata&lt;/code&gt; object representing
     * stream metadata, or &lt;code&gt;null&lt;/code&gt; to use default values.
     * @param imageType an &lt;code&gt;ImageTypeSpecifier&lt;/code&gt; describing
     * the layout of the image.
     * @param width the width of the image.
     * @param height the height of the image.
     * @param imageMetadata an &lt;code&gt;IIOMetadata&lt;/code&gt; object
     * representing image metadata, or &lt;code&gt;null&lt;/code&gt;.
     * @param thumbnails a &lt;code&gt;List&lt;/code&gt; of
     * &lt;code&gt;BufferedImage&lt;/code&gt; thumbnails for this image, or
     * &lt;code&gt;null&lt;/code&gt;.
     * @param param an &lt;code&gt;ImageWriteParam&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt; to use a default
     * &lt;code&gt;ImageWriteParam&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canWriteEmpty&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;.
     * @exception IllegalStateException if a previous call to
     * &lt;code&gt;prepareWriteEmpty&lt;/code&gt; has been made without a
     * corresponding call to &lt;code&gt;endWriteEmpty&lt;/code&gt;.
     * @exception IllegalStateException if a previous call to
     * &lt;code&gt;prepareInsertEmpty&lt;/code&gt; has been made without a
     * corresponding call to &lt;code&gt;endInsertEmpty&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;imageType&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt; or &lt;code&gt;thumbnails&lt;/code&gt; contains
     * &lt;code&gt;null&lt;/code&gt; references or objects other than
     * &lt;code&gt;BufferedImage&lt;/code&gt;s.
     * @exception IllegalArgumentException if width or height are less
     * than 1.
     * @exception IOException if an I/O error occurs during writing.
     */
    public void prepareWriteEmpty(IIOMetadata streamMetadata,
                                  ImageTypeSpecifier imageType,
                                  int width, int height,
                                  IIOMetadata imageMetadata,
                                  List&lt;? extends BufferedImage&gt; thumbnails,
                                  ImageWriteParam param) throws IOException {
        unsupported();
    }

    /**
     * Completes the writing of a new image that was begun with a
     * prior call to &lt;code&gt;prepareWriteEmpty&lt;/code&gt;.
     *
     * &lt;p&gt; If &lt;code&gt;canWriteEmpty()&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;,
     * an &lt;code&gt;UnsupportedOperationException&lt;/code&gt; will be thrown.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canWriteEmpty(imageIndex)&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;.
     * @exception IllegalStateException if a previous call to
     * &lt;code&gt;prepareWriteEmpty&lt;/code&gt; without a corresponding call to
     * &lt;code&gt;endWriteEmpty&lt;/code&gt; has not been made.
     * @exception IllegalStateException if a previous call to
     * &lt;code&gt;prepareInsertEmpty&lt;/code&gt; without a corresponding call to
     * &lt;code&gt;endInsertEmpty&lt;/code&gt; has been made.
     * @exception IllegalStateException if a call to
     * &lt;code&gt;prepareReiplacePixels&lt;/code&gt; has been made without a
     * matching call to &lt;code&gt;endReplacePixels&lt;/code&gt;.
     * @exception IOException if an I/O error occurs during writing.
     */
    public void endWriteEmpty() throws IOException {
        if (getOutput() == null) {
            throw new IllegalStateException(&quot;getOutput() == null!&quot;);
        }
        throw new IllegalStateException(&quot;No call to prepareWriteEmpty!&quot;);
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if the writer supports the insertion
     * of a new, empty image at the given index.  The pixel values of
     * the image are undefined, and may be specified in pieces using
     * the &lt;code&gt;replacePixels&lt;/code&gt; methods.  Existing images with
     * indices greater than or equal to the insertion index will have
     * their indices increased by 1.  A value for
     * &lt;code&gt;imageIndex&lt;/code&gt; of &lt;code&gt;-1&lt;/code&gt; may be used to
     * signify an index one larger than the current largest index.
     *
     * &lt;p&gt; A writer that does not support insertion of empty images
     * may return &lt;code&gt;false&lt;/code&gt; without performing bounds
     * checking on the index.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise returns &lt;code&gt;false&lt;/code&gt;
     * without checking the value of &lt;code&gt;imageIndex&lt;/code&gt;.
     *
     * @param imageIndex the index at which the image is to be
     * inserted.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if an empty image may be inserted at
     * the given index.
     *
     * @exception IllegalStateException if the output has not been
     * set.
     * @exception IndexOutOfBoundsException if the writer supports
     * empty image insertion in general, but &lt;code&gt;imageIndex&lt;/code&gt;
     * is less than -1 or greater than the largest available index.
     * @exception IOException if an I/O error occurs during the
     * query.
     */
    public boolean canInsertEmpty(int imageIndex) throws IOException {
        if (getOutput() == null) {
            throw new IllegalStateException(&quot;getOutput() == null!&quot;);
        }
        return false;
    }

    /**
     * Begins the insertion of a new image with undefined pixel values
     * into an existing image stream.  Existing images with an index
     * greater than &lt;code&gt;imageIndex&lt;/code&gt; are preserved, and their
     * indices are each increased by 1.  A value for
     * &lt;code&gt;imageIndex&lt;/code&gt; of -1 may be used to signify an index
     * one larger than the previous largest index; that is, it will
     * cause the image to be logically appended to the end of the
     * sequence.  If the output is an &lt;code&gt;ImageOutputStream&lt;/code&gt;,
     * the entirety of the stream must be both readable and writeable.
     *
     * &lt;p&gt; The image contents may be
     * supplied later using the &lt;code&gt;replacePixels&lt;/code&gt; method.
     * The insertion is not complete until a call to
     * &lt;code&gt;endInsertEmpty&lt;/code&gt; occurs.  Calls to
     * &lt;code&gt;prepareReplacePixels&lt;/code&gt;, &lt;code&gt;replacePixels&lt;/code&gt;,
     * and &lt;code&gt;endReplacePixels&lt;/code&gt; may occur between calls to
     * &lt;code&gt;prepareInsertEmpty&lt;/code&gt; and
     * &lt;code&gt;endInsertEmpty&lt;/code&gt;.  However, calls to
     * &lt;code&gt;prepareInsertEmpty&lt;/code&gt; cannot be nested, and calls to
     * &lt;code&gt;prepareWriteEmpty&lt;/code&gt; and
     * &lt;code&gt;prepareInsertEmpty&lt;/code&gt; may not be interspersed.
     *
     * &lt;p&gt; If &lt;code&gt;canInsertEmpty(imageIndex)&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;, an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt; will be thrown.
     *
     * &lt;p&gt; An &lt;code&gt;ImageWriteParam&lt;/code&gt; may optionally be supplied
     * to control the writing process.  If &lt;code&gt;param&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, a default write param will be used.
     *
     * &lt;p&gt; If the supplied &lt;code&gt;ImageWriteParam&lt;/code&gt; contains
     * optional setting values not supported by this writer (&lt;i&gt;e.g.&lt;/i&gt;
     * progressive encoding or any format-specific settings), they
     * will be ignored.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @param imageIndex the index at which to write the image.
     * @param imageType an &lt;code&gt;ImageTypeSpecifier&lt;/code&gt; describing
     * the layout of the image.
     * @param width the width of the image.
     * @param height the height of the image.
     * @param imageMetadata an &lt;code&gt;IIOMetadata&lt;/code&gt; object
     * representing image metadata, or &lt;code&gt;null&lt;/code&gt;.
     * @param thumbnails a &lt;code&gt;List&lt;/code&gt; of
     * &lt;code&gt;BufferedImage&lt;/code&gt; thumbnails for this image, or
     * &lt;code&gt;null&lt;/code&gt;.
     * @param param an &lt;code&gt;ImageWriteParam&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt; to use a default
     * &lt;code&gt;ImageWriteParam&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canInsertEmpty(imageIndex)&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;.
     * @exception IndexOutOfBoundsException if &lt;code&gt;imageIndex&lt;/code&gt;
     * is less than -1 or greater than the largest available index.
     * @exception IllegalStateException if a previous call to
     * &lt;code&gt;prepareInsertEmpty&lt;/code&gt; has been made without a
     * corresponding call to &lt;code&gt;endInsertEmpty&lt;/code&gt;.
     * @exception IllegalStateException if a previous call to
     * &lt;code&gt;prepareWriteEmpty&lt;/code&gt; has been made without a
     * corresponding call to &lt;code&gt;endWriteEmpty&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;imageType&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt; or &lt;code&gt;thumbnails&lt;/code&gt; contains
     * &lt;code&gt;null&lt;/code&gt; references or objects other than
     * &lt;code&gt;BufferedImage&lt;/code&gt;s.
     * @exception IllegalArgumentException if width or height are less
     * than 1.
     * @exception IOException if an I/O error occurs during writing.
     */
    public void prepareInsertEmpty(int imageIndex,
                                   ImageTypeSpecifier imageType,
                                   int width, int height,
                                   IIOMetadata imageMetadata,
                                   List&lt;? extends BufferedImage&gt; thumbnails,
                                   ImageWriteParam param) throws IOException {
        unsupported();
    }

    /**
     * Completes the insertion of a new image that was begun with a
     * prior call to &lt;code&gt;prepareInsertEmpty&lt;/code&gt;.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canInsertEmpty(imageIndex)&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;.
     * @exception IllegalStateException if a previous call to
     * &lt;code&gt;prepareInsertEmpty&lt;/code&gt; without a corresponding call to
     * &lt;code&gt;endInsertEmpty&lt;/code&gt; has not been made.
     * @exception IllegalStateException if a previous call to
     * &lt;code&gt;prepareWriteEmpty&lt;/code&gt; without a corresponding call to
     * &lt;code&gt;endWriteEmpty&lt;/code&gt; has been made.
     * @exception IllegalStateException if a call to
     * &lt;code&gt;prepareReplacePixels&lt;/code&gt; has been made without a
     * matching call to &lt;code&gt;endReplacePixels&lt;/code&gt;.
     * @exception IOException if an I/O error occurs during writing.
     */
    public void endInsertEmpty() throws IOException {
        unsupported();
    }

    // Pixel replacement

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if the writer allows pixels of the
     * given image to be replaced using the &lt;code&gt;replacePixels&lt;/code&gt;
     * methods.
     *
     * &lt;p&gt; A writer that does not support any pixel replacement may
     * return &lt;code&gt;false&lt;/code&gt; without performing bounds checking on
     * the index.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise returns &lt;code&gt;false&lt;/code&gt;
     * without checking the value of &lt;code&gt;imageIndex&lt;/code&gt;.
     *
     * @param imageIndex the index of the image whose pixels are to be
     * replaced.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if the pixels of the given
     * image can be replaced.
     *
     * @exception IllegalStateException if the output has not been
     * set.
     * @exception IndexOutOfBoundsException if the writer supports
     * pixel replacement in general, but &lt;code&gt;imageIndex&lt;/code&gt; is
     * less than 0 or greater than the largest available index.
     * @exception IOException if an I/O error occurs during the query.
     */
    public boolean canReplacePixels(int imageIndex) throws IOException {
        if (getOutput() == null) {
            throw new IllegalStateException(&quot;getOutput() == null!&quot;);
        }
        return false;
    }

    /**
     * Prepares the writer to handle a series of calls to the
     * &lt;code&gt;replacePixels&lt;/code&gt; methods.  The affected pixel area
     * will be clipped against the supplied
     *
     * &lt;p&gt; If &lt;code&gt;canReplacePixels&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;, and
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt; will be thrown.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @param imageIndex the index of the image whose pixels are to be
     * replaced.
     * @param region a &lt;code&gt;Rectangle&lt;/code&gt; that will be used to clip
     * future pixel regions.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canReplacePixels(imageIndex)&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;.
     * @exception IndexOutOfBoundsException if &lt;code&gt;imageIndex&lt;/code&gt;
     * is less than 0 or greater than the largest available index.
     * @exception IllegalStateException if there is a previous call to
     * &lt;code&gt;prepareReplacePixels&lt;/code&gt; without a matching call to
     * &lt;code&gt;endReplacePixels&lt;/code&gt; (&lt;i&gt;i.e.&lt;/i&gt;, nesting is not
     * allowed).
     * @exception IllegalArgumentException if &lt;code&gt;region&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt; or has a width or height less than 1.
     * @exception IOException if an I/O error occurs during the
     * preparation.
     */
    public void prepareReplacePixels(int imageIndex,
                                     Rectangle region)  throws IOException {
        unsupported();
    }

    /**
     * Replaces a portion of an image already present in the output
     * with a portion of the given image.  The image data must match,
     * or be convertible to, the image layout of the existing image.
     *
     * &lt;p&gt; The destination region is specified in the
     * &lt;code&gt;param&lt;/code&gt; argument, and will be clipped to the image
     * boundaries and the region supplied to
     * &lt;code&gt;prepareReplacePixels&lt;/code&gt;.  At least one pixel of the
     * source must not be clipped, or an exception is thrown.
     *
     * &lt;p&gt; An &lt;code&gt;ImageWriteParam&lt;/code&gt; may optionally be supplied
     * to control the writing process.  If &lt;code&gt;param&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, a default write param will be used.
     *
     * &lt;p&gt; If the supplied &lt;code&gt;ImageWriteParam&lt;/code&gt; contains
     * optional setting values not supported by this writer (&lt;i&gt;e.g.&lt;/i&gt;
     * progressive encoding or any format-specific settings), they
     * will be ignored.
     *
     * &lt;p&gt; This method may only be called after a call to
     * &lt;code&gt;prepareReplacePixels&lt;/code&gt;, or else an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; will be thrown.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @param image a &lt;code&gt;RenderedImage&lt;/code&gt; containing source
     * pixels.
     * @param param an &lt;code&gt;ImageWriteParam&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt; to use a default
     * &lt;code&gt;ImageWriteParam&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canReplacePixels(imageIndex)&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;.
     * @exception IllegalStateException if there is no previous call to
     * &lt;code&gt;prepareReplacePixels&lt;/code&gt; without a matching call to
     * &lt;code&gt;endReplacePixels&lt;/code&gt;.
     * @exception IllegalArgumentException if any of the following are true:
     * &lt;ul&gt;
     * &lt;li&gt; &lt;code&gt;image&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.
     * &lt;li&gt; &lt;code&gt;param&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.
     * &lt;li&gt; the intersected region does not contain at least one pixel.
     * &lt;li&gt; the layout of &lt;code&gt;image&lt;/code&gt; does not match, or this
     * writer cannot convert it to, the existing image layout.
     * &lt;/ul&gt;
     * @exception IOException if an I/O error occurs during writing.
     */
    public void replacePixels(RenderedImage image, ImageWriteParam param)
        throws IOException {
        unsupported();
    }

    /**
     * Replaces a portion of an image already present in the output
     * with a portion of the given &lt;code&gt;Raster&lt;/code&gt;.  The image
     * data must match, or be convertible to, the image layout of the
     * existing image.
     *
     * &lt;p&gt; An &lt;code&gt;ImageWriteParam&lt;/code&gt; may optionally be supplied
     * to control the writing process.  If &lt;code&gt;param&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, a default write param will be used.
     *
     * &lt;p&gt; The destination region is specified in the
     * &lt;code&gt;param&lt;/code&gt; argument, and will be clipped to the image
     * boundaries and the region supplied to
     * &lt;code&gt;prepareReplacePixels&lt;/code&gt;.  At least one pixel of the
     * source must not be clipped, or an exception is thrown.
     *
     * &lt;p&gt; If the supplied &lt;code&gt;ImageWriteParam&lt;/code&gt; contains
     * optional setting values not supported by this writer (&lt;i&gt;e.g.&lt;/i&gt;
     * progressive encoding or any format-specific settings), they
     * will be ignored.
     *
     * &lt;p&gt; This method may only be called after a call to
     * &lt;code&gt;prepareReplacePixels&lt;/code&gt;, or else an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; will be thrown.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @param raster a &lt;code&gt;Raster&lt;/code&gt; containing source
     * pixels.
     * @param param an &lt;code&gt;ImageWriteParam&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt; to use a default
     * &lt;code&gt;ImageWriteParam&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canReplacePixels(imageIndex)&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;.
     * @exception IllegalStateException if there is no previous call to
     * &lt;code&gt;prepareReplacePixels&lt;/code&gt; without a matching call to
     * &lt;code&gt;endReplacePixels&lt;/code&gt;.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canWriteRasters&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;.
     * @exception IllegalArgumentException if any of the following are true:
     * &lt;ul&gt;
     * &lt;li&gt; &lt;code&gt;raster&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.
     * &lt;li&gt; &lt;code&gt;param&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.
     * &lt;li&gt; the intersected region does not contain at least one pixel.
     * &lt;li&gt; the layout of &lt;code&gt;raster&lt;/code&gt; does not match, or this
     * writer cannot convert it to, the existing image layout.
     * &lt;/ul&gt;
     * @exception IOException if an I/O error occurs during writing.
     */
    public void replacePixels(Raster raster, ImageWriteParam param)
        throws IOException {
        unsupported();
    }

    /**
     * Terminates a sequence of calls to &lt;code&gt;replacePixels&lt;/code&gt;.
     *
     * &lt;p&gt; If &lt;code&gt;canReplacePixels&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;, and
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt; will be thrown.
     *
     * &lt;p&gt; The default implementation throws an
     * &lt;code&gt;IllegalStateException&lt;/code&gt; if the output is
     * &lt;code&gt;null&lt;/code&gt;, and otherwise throws an
     * &lt;code&gt;UnsupportedOperationException&lt;/code&gt;.
     *
     * @exception IllegalStateException if the output has not
     * been set.
     * @exception UnsupportedOperationException if
     * &lt;code&gt;canReplacePixels(imageIndex)&lt;/code&gt; returns
     * &lt;code&gt;false&lt;/code&gt;.
     * @exception IllegalStateException if there is no previous call
     * to &lt;code&gt;prepareReplacePixels&lt;/code&gt; without a matching call to
     * &lt;code&gt;endReplacePixels&lt;/code&gt;.
     * @exception IOException if an I/O error occurs during writing.
     */
    public void endReplacePixels() throws IOException {
        unsupported();
    }

    // Abort

    /**
     * Requests that any current write operation be aborted.  The
     * contents of the output following the abort will be undefined.
     *
     * &lt;p&gt; Writers should call &lt;code&gt;clearAbortRequest&lt;/code&gt; at the
     * beginning of each write operation, and poll the value of
     * &lt;code&gt;abortRequested&lt;/code&gt; regularly during the write.
     */
    public synchronized void abort() {
        this.abortFlag = true;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if a request to abort the current
     * write operation has been made since the writer was instantiated or
     * &lt;code&gt;clearAbortRequest&lt;/code&gt; was called.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if the current write operation should
     * be aborted.
     *
     * @see #abort
     * @see #clearAbortRequest
     */
    protected synchronized boolean abortRequested() {
        return this.abortFlag;
    }

    /**
     * Clears any previous abort request.  After this method has been
     * called, &lt;code&gt;abortRequested&lt;/code&gt; will return
     * &lt;code&gt;false&lt;/code&gt;.
     *
     * @see #abort
     * @see #abortRequested
     */
    protected synchronized void clearAbortRequest() {
        this.abortFlag = false;
    }

    // Listeners

    /**
     * Adds an &lt;code&gt;IIOWriteWarningListener&lt;/code&gt; to the list of
     * registered warning listeners.  If &lt;code&gt;listener&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, no exception will be thrown and no action
     * will be taken.  Messages sent to the given listener will be
     * localized, if possible, to match the current
     * &lt;code&gt;Locale&lt;/code&gt;.  If no &lt;code&gt;Locale&lt;/code&gt; has been set,
     * warning messages may be localized as the writer sees fit.
     *
     * @param listener an &lt;code&gt;IIOWriteWarningListener&lt;/code&gt; to be
     * registered.
     *
     * @see #removeIIOWriteWarningListener
     */
    public void addIIOWriteWarningListener(IIOWriteWarningListener listener) {
        if (listener == null) {
            return;
        }
        warningListeners = ImageReader.addToList(warningListeners, listener);
        warningLocales = ImageReader.addToList(warningLocales, getLocale());
    }

    /**
     * Removes an &lt;code&gt;IIOWriteWarningListener&lt;/code&gt; from the list
     * of registered warning listeners.  If the listener was not
     * previously registered, or if &lt;code&gt;listener&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, no exception will be thrown and no action
     * will be taken.
     *
     * @param listener an &lt;code&gt;IIOWriteWarningListener&lt;/code&gt; to be
     * deregistered.
     *
     * @see #addIIOWriteWarningListener
     */
    public
        void removeIIOWriteWarningListener(IIOWriteWarningListener listener) {
        if (listener == null || warningListeners == null) {
            return;
        }
        int index = warningListeners.indexOf(listener);
        if (index != -1) {
            warningListeners.remove(index);
            warningLocales.remove(index);
            if (warningListeners.size() == 0) {
                warningListeners = null;
                warningLocales = null;
            }
        }
    }

    /**
     * Removes all currently registered
     * &lt;code&gt;IIOWriteWarningListener&lt;/code&gt; objects.
     *
     * &lt;p&gt; The default implementation sets the
     * &lt;code&gt;warningListeners&lt;/code&gt; and &lt;code&gt;warningLocales&lt;/code&gt;
     * instance variables to &lt;code&gt;null&lt;/code&gt;.
     */
    public void removeAllIIOWriteWarningListeners() {
        this.warningListeners = null;
        this.warningLocales = null;
    }

    /**
     * Adds an &lt;code&gt;IIOWriteProgressListener&lt;/code&gt; to the list of
     * registered progress listeners.  If &lt;code&gt;listener&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, no exception will be thrown and no action
     * will be taken.
     *
     * @param listener an &lt;code&gt;IIOWriteProgressListener&lt;/code&gt; to be
     * registered.
     *
     * @see #removeIIOWriteProgressListener
     */
    public void
        addIIOWriteProgressListener(IIOWriteProgressListener listener) {
        if (listener == null) {
            return;
        }
        progressListeners = ImageReader.addToList(progressListeners, listener);
    }

    /**
     * Removes an &lt;code&gt;IIOWriteProgressListener&lt;/code&gt; from the list
     * of registered progress listeners.  If the listener was not
     * previously registered, or if &lt;code&gt;listener&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, no exception will be thrown and no action
     * will be taken.
     *
     * @param listener an &lt;code&gt;IIOWriteProgressListener&lt;/code&gt; to be
     * deregistered.
     *
     * @see #addIIOWriteProgressListener
     */
    public void
        removeIIOWriteProgressListener(IIOWriteProgressListener listener) {
        if (listener == null || progressListeners == null) {
            return;
        }
        progressListeners =
            ImageReader.removeFromList(progressListeners, listener);
    }

    /**
     * Removes all currently registered
     * &lt;code&gt;IIOWriteProgressListener&lt;/code&gt; objects.
     *
     * &lt;p&gt; The default implementation sets the
     * &lt;code&gt;progressListeners&lt;/code&gt; instance variable to
     * &lt;code&gt;null&lt;/code&gt;.
     */
    public void removeAllIIOWriteProgressListeners() {
        this.progressListeners = null;
    }

    /**
     * Broadcasts the start of an image write to all registered
     * &lt;code&gt;IIOWriteProgressListener&lt;/code&gt;s by calling their
     * &lt;code&gt;imageStarted&lt;/code&gt; method.  Subclasses may use this
     * method as a convenience.
     *
     * @param imageIndex the index of the image about to be written.
     */
    protected void processImageStarted(int imageIndex) {
        if (progressListeners == null) {
            return;
        }
        int numListeners = progressListeners.size();
        for (int i = 0; i &lt; numListeners; i++) {
            IIOWriteProgressListener listener =
                (IIOWriteProgressListener)progressListeners.get(i);
            listener.imageStarted(this, imageIndex);
        }
    }

    /**
     * Broadcasts the current percentage of image completion to all
     * registered &lt;code&gt;IIOWriteProgressListener&lt;/code&gt;s by calling
     * their &lt;code&gt;imageProgress&lt;/code&gt; method.  Subclasses may use
     * this method as a convenience.
     *
     * @param percentageDone the current percentage of completion,
     * as a &lt;code&gt;float&lt;/code&gt;.
     */
    protected void processImageProgress(float percentageDone) {
        if (progressListeners == null) {
            return;
        }
        int numListeners = progressListeners.size();
        for (int i = 0; i &lt; numListeners; i++) {
            IIOWriteProgressListener listener =
                (IIOWriteProgressListener)progressListeners.get(i);
            listener.imageProgress(this, percentageDone);
        }
    }

    /**
     * Broadcasts the completion of an image write to all registered
     * &lt;code&gt;IIOWriteProgressListener&lt;/code&gt;s by calling their
     * &lt;code&gt;imageComplete&lt;/code&gt; method.  Subclasses may use this
     * method as a convenience.
     */
    protected void processImageComplete() {
        if (progressListeners == null) {
            return;
        }
        int numListeners = progressListeners.size();
        for (int i = 0; i &lt; numListeners; i++) {
            IIOWriteProgressListener listener =
                (IIOWriteProgressListener)progressListeners.get(i);
            listener.imageComplete(this);
        }
    }

    /**
     * Broadcasts the start of a thumbnail write to all registered
     * &lt;code&gt;IIOWriteProgressListener&lt;/code&gt;s by calling their
     * &lt;code&gt;thumbnailStarted&lt;/code&gt; method.  Subclasses may use this
     * method as a convenience.
     *
     * @param imageIndex the index of the image associated with the
     * thumbnail.
     * @param thumbnailIndex the index of the thumbnail.
     */
    protected void processThumbnailStarted(int imageIndex,
                                           int thumbnailIndex) {
        if (progressListeners == null) {
            return;
        }
        int numListeners = progressListeners.size();
        for (int i = 0; i &lt; numListeners; i++) {
            IIOWriteProgressListener listener =
                (IIOWriteProgressListener)progressListeners.get(i);
            listener.thumbnailStarted(this, imageIndex, thumbnailIndex);
        }
    }

    /**
     * Broadcasts the current percentage of thumbnail completion to
     * all registered &lt;code&gt;IIOWriteProgressListener&lt;/code&gt;s by calling
     * their &lt;code&gt;thumbnailProgress&lt;/code&gt; method.  Subclasses may
     * use this method as a convenience.
     *
     * @param percentageDone the current percentage of completion,
     * as a &lt;code&gt;float&lt;/code&gt;.
     */
    protected void processThumbnailProgress(float percentageDone) {
        if (progressListeners == null) {
            return;
        }
        int numListeners = progressListeners.size();
        for (int i = 0; i &lt; numListeners; i++) {
            IIOWriteProgressListener listener =
                (IIOWriteProgressListener)progressListeners.get(i);
            listener.thumbnailProgress(this, percentageDone);
        }
    }

    /**
     * Broadcasts the completion of a thumbnail write to all registered
     * &lt;code&gt;IIOWriteProgressListener&lt;/code&gt;s by calling their
     * &lt;code&gt;thumbnailComplete&lt;/code&gt; method.  Subclasses may use this
     * method as a convenience.
     */
    protected void processThumbnailComplete() {
        if (progressListeners == null) {
            return;
        }
        int numListeners = progressListeners.size();
        for (int i = 0; i &lt; numListeners; i++) {
            IIOWriteProgressListener listener =
                (IIOWriteProgressListener)progressListeners.get(i);
            listener.thumbnailComplete(this);
        }
    }

    /**
     * Broadcasts that the write has been aborted to all registered
     * &lt;code&gt;IIOWriteProgressListener&lt;/code&gt;s by calling their
     * &lt;code&gt;writeAborted&lt;/code&gt; method.  Subclasses may use this
     * method as a convenience.
     */
    protected void processWriteAborted() {
        if (progressListeners == null) {
            return;
        }
        int numListeners = progressListeners.size();
        for (int i = 0; i &lt; numListeners; i++) {
            IIOWriteProgressListener listener =
                (IIOWriteProgressListener)progressListeners.get(i);
            listener.writeAborted(this);
        }
    }

    /**
     * Broadcasts a warning message to all registered
     * &lt;code&gt;IIOWriteWarningListener&lt;/code&gt;s by calling their
     * &lt;code&gt;warningOccurred&lt;/code&gt; method.  Subclasses may use this
     * method as a convenience.
     *
     * @param imageIndex the index of the image on which the warning
     * occurred.
     * @param warning the warning message.
     *
     * @exception IllegalArgumentException if &lt;code&gt;warning&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;.
     */
    protected void processWarningOccurred(int imageIndex,
                                          String warning) {
        if (warningListeners == null) {
            return;
        }
        if (warning == null) {
            throw new IllegalArgumentException(&quot;warning == null!&quot;);
        }
        int numListeners = warningListeners.size();
        for (int i = 0; i &lt; numListeners; i++) {
            IIOWriteWarningListener listener =
                (IIOWriteWarningListener)warningListeners.get(i);

            listener.warningOccurred(this, imageIndex, warning);
        }
    }

    /**
     * Broadcasts a localized warning message to all registered
     * &lt;code&gt;IIOWriteWarningListener&lt;/code&gt;s by calling their
     * &lt;code&gt;warningOccurred&lt;/code&gt; method with a string taken
     * from a &lt;code&gt;ResourceBundle&lt;/code&gt;.  Subclasses may use this
     * method as a convenience.
     *
     * @param imageIndex the index of the image on which the warning
     * occurred.
     * @param baseName the base name of a set of
     * &lt;code&gt;ResourceBundle&lt;/code&gt;s containing localized warning
     * messages.
     * @param keyword the keyword used to index the warning message
     * within the set of &lt;code&gt;ResourceBundle&lt;/code&gt;s.
     *
     * @exception IllegalArgumentException if &lt;code&gt;baseName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;keyword&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;.
     * @exception IllegalArgumentException if no appropriate
     * &lt;code&gt;ResourceBundle&lt;/code&gt; may be located.
     * @exception IllegalArgumentException if the named resource is
     * not found in the located &lt;code&gt;ResourceBundle&lt;/code&gt;.
     * @exception IllegalArgumentException if the object retrieved
     * from the &lt;code&gt;ResourceBundle&lt;/code&gt; is not a
     * &lt;code&gt;String&lt;/code&gt;.
     */
    protected void processWarningOccurred(int imageIndex,
                                          String baseName,
                                          String keyword) {
        if (warningListeners == null) {
            return;
        }
        if (baseName == null) {
            throw new IllegalArgumentException(&quot;baseName == null!&quot;);
        }
        if (keyword == null) {
            throw new IllegalArgumentException(&quot;keyword == null!&quot;);
        }
        int numListeners = warningListeners.size();
        for (int i = 0; i &lt; numListeners; i++) {
            IIOWriteWarningListener listener =
                (IIOWriteWarningListener)warningListeners.get(i);
            Locale locale = (Locale)warningLocales.get(i);
            if (locale == null) {
                locale = Locale.getDefault();
            }

            /**
             * If an applet supplies an implementation of ImageWriter and
             * resource bundles, then the resource bundle will need to be
             * accessed via the applet class loader. So first try the context
             * class loader to locate the resource bundle.
             * If that throws MissingResourceException, then try the
             * system class loader.
             */
            ClassLoader loader = (ClassLoader)
                java.security.AccessController.doPrivileged(
                   new java.security.PrivilegedAction() {
                      public Object run() {
                        return Thread.currentThread().getContextClassLoader();
                      }
                });

            ResourceBundle bundle = null;
            try {
                bundle = ResourceBundle.getBundle(baseName, locale, loader);
            } catch (MissingResourceException mre) {
                try {
                    bundle = ResourceBundle.getBundle(baseName, locale);
                } catch (MissingResourceException mre1) {
                    throw new IllegalArgumentException(&quot;Bundle not found!&quot;);
                }
            }

            String warning = null;
            try {
                warning = bundle.getString(keyword);
            } catch (ClassCastException cce) {
                throw new IllegalArgumentException(&quot;Resource is not a String!&quot;);
            } catch (MissingResourceException mre) {
                throw new IllegalArgumentException(&quot;Resource is missing!&quot;);
            }

            listener.warningOccurred(this, imageIndex, warning);
        }
    }

    // State management

    /**
     * Restores the &lt;code&gt;ImageWriter&lt;/code&gt; to its initial state.
     *
     * &lt;p&gt; The default implementation calls
     * &lt;code&gt;setOutput(null)&lt;/code&gt;, &lt;code&gt;setLocale(null)&lt;/code&gt;,
     * &lt;code&gt;removeAllIIOWriteWarningListeners()&lt;/code&gt;,
     * &lt;code&gt;removeAllIIOWriteProgressListeners()&lt;/code&gt;, and
     * &lt;code&gt;clearAbortRequest&lt;/code&gt;.
     */
    public void reset() {
        setOutput(null);
        setLocale(null);
        removeAllIIOWriteWarningListeners();
        removeAllIIOWriteProgressListeners();
        clearAbortRequest();
    }

    /**
     * Allows any resources held by this object to be released.  The
     * result of calling any other method (other than
     * &lt;code&gt;finalize&lt;/code&gt;) subsequent to a call to this method
     * is undefined.
     *
     * &lt;p&gt;It is important for applications to call this method when they
     * know they will no longer be using this &lt;code&gt;ImageWriter&lt;/code&gt;.
     * Otherwise, the writer may continue to hold on to resources
     * indefinitely.
     *
     * &lt;p&gt;The default implementation of this method in the superclass does
     * nothing.  Subclass implementations should ensure that all resources,
     * especially native resources, are released.
     */
    public void dispose() {
    }
}
</pre>
</body>
</html>
