<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/css/styles.css"/>
    </head>
<body>
<pre class="code">
/*
 * Copyright (c) 2005, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
/*
 * $Id: XMLSignatureFactory.java,v 1.14 2005/09/15 14:29:01 mullan Exp $
 */
package javax.xml.crypto.dsig;

import javax.xml.crypto.Data;
import javax.xml.crypto.MarshalException;
import javax.xml.crypto.NoSuchMechanismException;
import javax.xml.crypto.URIDereferencer;
import javax.xml.crypto.XMLStructure;
import javax.xml.crypto.dom.DOMStructure;
import javax.xml.crypto.dsig.keyinfo.KeyInfo;
import javax.xml.crypto.dsig.keyinfo.KeyInfoFactory;
import javax.xml.crypto.dsig.spec.*;
import javax.xml.crypto.dsig.dom.DOMValidateContext;
import javax.xml.crypto.dsig.dom.DOMSignContext;

import java.security.InvalidAlgorithmParameterException;
import java.security.NoSuchAlgorithmException;
import java.security.NoSuchProviderException;
import java.security.Provider;
import java.security.Security;
import java.util.List;

import sun.security.jca.*;
import sun.security.jca.GetInstance.Instance;

/**
 * A factory for creating {@link XMLSignature} objects from scratch or
 * for unmarshalling an &lt;code&gt;XMLSignature&lt;/code&gt; object from a corresponding
 * XML representation.
 *
 * &lt;h2&gt;XMLSignatureFactory Type&lt;/h2&gt;
 *
 * &lt;p&gt;Each instance of &lt;code&gt;XMLSignatureFactory&lt;/code&gt; supports a specific
 * XML mechanism type. To create an &lt;code&gt;XMLSignatureFactory&lt;/code&gt;, call one
 * of the static {@link #getInstance getInstance} methods, passing in the XML
 * mechanism type desired, for example:
 *
 * &lt;blockquote&gt;&lt;code&gt;
 * XMLSignatureFactory factory = XMLSignatureFactory.getInstance(&quot;DOM&quot;);
 * &lt;/code&gt;&lt;/blockquote&gt;
 *
 * &lt;p&gt;The objects that this factory produces will be based
 * on DOM and abide by the DOM interoperability requirements as defined in the
 * &lt;a href=&quot;../../../../../technotes/guides/security/xmldsig/overview.html#DOM Mechanism Requirements&quot;&gt;
 * DOM Mechanism Requirements&lt;/a&gt; section of the API overview. See the
 * &lt;a href=&quot;../../../../../technotes/guides/security/xmldsig/overview.html#Service Provider&quot;&gt;
 * Service Providers&lt;/a&gt; section of the API overview for a list of standard
 * mechanism types.
 *
 * &lt;p&gt;&lt;code&gt;XMLSignatureFactory&lt;/code&gt; implementations are registered and loaded
 * using the {@link java.security.Provider} mechanism.
 * For example, a service provider that supports the
 * DOM mechanism would be specified in the &lt;code&gt;Provider&lt;/code&gt; subclass as:
 * &lt;pre&gt;
 *     put(&quot;XMLSignatureFactory.DOM&quot;, &quot;org.example.DOMXMLSignatureFactory&quot;);
 * &lt;/pre&gt;
 *
 * &lt;p&gt;An implementation MUST minimally support the default mechanism type: DOM.
 *
 * &lt;p&gt;Note that a caller must use the same &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
 * instance to create the &lt;code&gt;XMLStructure&lt;/code&gt;s of a particular
 * &lt;code&gt;XMLSignature&lt;/code&gt; that is to be generated. The behavior is
 * undefined if &lt;code&gt;XMLStructure&lt;/code&gt;s from different providers or
 * different mechanism types are used together.
 *
 * &lt;p&gt;Also, the &lt;code&gt;XMLStructure&lt;/code&gt;s that are created by this factory
 * may contain state specific to the &lt;code&gt;XMLSignature&lt;/code&gt; and are not
 * intended to be reusable.
 *
 * &lt;h2&gt;Creating XMLSignatures from scratch&lt;/h2&gt;
 *
 * &lt;p&gt;Once the &lt;code&gt;XMLSignatureFactory&lt;/code&gt; has been created, objects
 * can be instantiated by calling the appropriate method. For example, a
 * {@link Reference} instance may be created by invoking one of the
 * {@link #newReference newReference} methods.
 *
 * &lt;h2&gt;Unmarshalling XMLSignatures from XML&lt;/h2&gt;
 *
 * &lt;p&gt;Alternatively, an &lt;code&gt;XMLSignature&lt;/code&gt; may be created from an
 * existing XML representation by invoking the {@link #unmarshalXMLSignature
 * unmarshalXMLSignature} method and passing it a mechanism-specific
 * {@link XMLValidateContext} instance containing the XML content:
 *
 * &lt;pre&gt;
 * DOMValidateContext context = new DOMValidateContext(key, signatureElement);
 * XMLSignature signature = factory.unmarshalXMLSignature(context);
 * &lt;/pre&gt;
 *
 * Each &lt;code&gt;XMLSignatureFactory&lt;/code&gt; must support the required
 * &lt;code&gt;XMLValidateContext&lt;/code&gt; types for that factory type, but may support
 * others. A DOM &lt;code&gt;XMLSignatureFactory&lt;/code&gt; must support {@link
 * DOMValidateContext} objects.
 *
 * &lt;h2&gt;Signing and marshalling XMLSignatures to XML&lt;/h2&gt;
 *
 * Each &lt;code&gt;XMLSignature&lt;/code&gt; created by the factory can also be
 * marshalled to an XML representation and signed, by invoking the
 * {@link XMLSignature#sign sign} method of the
 * {@link XMLSignature} object and passing it a mechanism-specific
 * {@link XMLSignContext} object containing the signing key and
 * marshalling parameters (see {@link DOMSignContext}).
 * For example:
 *
 * &lt;pre&gt;
 *    DOMSignContext context = new DOMSignContext(privateKey, document);
 *    signature.sign(context);
 * &lt;/pre&gt;
 *
 * &lt;b&gt;Concurrent Access&lt;/b&gt;
 * &lt;p&gt;The static methods of this class are guaranteed to be thread-safe.
 * Multiple threads may concurrently invoke the static methods defined in this
 * class with no ill effects.
 *
 * &lt;p&gt;However, this is not true for the non-static methods defined by this
 * class. Unless otherwise documented by a specific provider, threads that
 * need to access a single &lt;code&gt;XMLSignatureFactory&lt;/code&gt; instance
 * concurrently should synchronize amongst themselves and provide the
 * necessary locking. Multiple threads each manipulating a different
 * &lt;code&gt;XMLSignatureFactory&lt;/code&gt; instance need not synchronize.
 *
 * @author Sean Mullan
 * @author JSR 105 Expert Group
 * @since 1.6
 */
public abstract class XMLSignatureFactory {

    private String mechanismType;
    private Provider provider;

    /**
     * Default constructor, for invocation by subclasses.
     */
    protected XMLSignatureFactory() {}

    /**
     * Returns an &lt;code&gt;XMLSignatureFactory&lt;/code&gt; that supports the
     * specified XML processing mechanism and representation type (ex: &quot;DOM&quot;).
     *
     * &lt;p&gt;This method uses the standard JCA provider lookup mechanism to
     * locate and instantiate an &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     * implementation of the desired mechanism type. It traverses the list of
     * registered security &lt;code&gt;Provider&lt;/code&gt;s, starting with the most
     * preferred &lt;code&gt;Provider&lt;/code&gt;.  A new &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     * object from the first &lt;code&gt;Provider&lt;/code&gt; that supports the specified
     * mechanism is returned.
     *
     * &lt;p&gt;Note that the list of registered providers may be retrieved via
     * the {@link Security#getProviders() Security.getProviders()} method.
     *
     * @param mechanismType the type of the XML processing mechanism and
     *    representation. See the &lt;a
     *    href=&quot;../../../../../technotes/guides/security/xmldsig/overview.html#Service Provider&quot;&gt;
     *    Service Providers&lt;/a&gt; section of the API overview for a list of
     *    standard mechanism types.
     * @return a new &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     * @throws NullPointerException if &lt;code&gt;mechanismType&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     * @throws NoSuchMechanismException if no &lt;code&gt;Provider&lt;/code&gt; supports an
     *    &lt;code&gt;XMLSignatureFactory&lt;/code&gt; implementation for the specified
     *    mechanism
     * @see Provider
     */
    public static XMLSignatureFactory getInstance(String mechanismType) {
        if (mechanismType == null) {
            throw new NullPointerException(&quot;mechanismType cannot be null&quot;);
        }
        Instance instance;
        try {
            instance = GetInstance.getInstance
                (&quot;XMLSignatureFactory&quot;, null, mechanismType);
        } catch (NoSuchAlgorithmException nsae) {
            throw new NoSuchMechanismException(nsae);
        }
        XMLSignatureFactory factory = (XMLSignatureFactory) instance.impl;
        factory.mechanismType = mechanismType;
        factory.provider = instance.provider;
        return factory;
    }

    /**
     * Returns an &lt;code&gt;XMLSignatureFactory&lt;/code&gt; that supports the
     * requested XML processing mechanism and representation type (ex: &quot;DOM&quot;),
     * as supplied by the specified provider. Note that the specified
     * &lt;code&gt;Provider&lt;/code&gt; object does not have to be registered in the
     * provider list.
     *
     * @param mechanismType the type of the XML processing mechanism and
     *    representation. See the &lt;a
     *    href=&quot;../../../../../technotes/guides/security/xmldsig/overview.html#Service Provider&quot;&gt;
     *    Service Providers&lt;/a&gt; section of the API overview for a list of
     *    standard mechanism types.
     * @param provider the &lt;code&gt;Provider&lt;/code&gt; object
     * @return a new &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     * @throws NullPointerException if &lt;code&gt;provider&lt;/code&gt; or
     *    &lt;code&gt;mechanismType&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
     * @throws NoSuchMechanismException if an &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     *   implementation for the specified mechanism is not available
     *   from the specified &lt;code&gt;Provider&lt;/code&gt; object
     * @see Provider
     */
    public static XMLSignatureFactory getInstance(String mechanismType,
        Provider provider) {
        if (mechanismType == null) {
            throw new NullPointerException(&quot;mechanismType cannot be null&quot;);
        } else if (provider == null) {
            throw new NullPointerException(&quot;provider cannot be null&quot;);
        }

        Instance instance;
        try {
            instance = GetInstance.getInstance
                (&quot;XMLSignatureFactory&quot;, null, mechanismType, provider);
        } catch (NoSuchAlgorithmException nsae) {
            throw new NoSuchMechanismException(nsae);
        }
        XMLSignatureFactory factory = (XMLSignatureFactory) instance.impl;
        factory.mechanismType = mechanismType;
        factory.provider = instance.provider;
        return factory;
    }

    /**
     * Returns an &lt;code&gt;XMLSignatureFactory&lt;/code&gt; that supports the
     * requested XML processing mechanism and representation type (ex: &quot;DOM&quot;),
     * as supplied by the specified provider. The specified provider must be
     * registered in the security provider list.
     *
     * &lt;p&gt;Note that the list of registered providers may be retrieved via
     * the {@link Security#getProviders() Security.getProviders()} method.
     *
     * @param mechanismType the type of the XML processing mechanism and
     *    representation. See the &lt;a
     *    href=&quot;../../../../../technotes/guides/security/xmldsig/overview.html#Service Provider&quot;&gt;
     *    Service Providers&lt;/a&gt; section of the API overview for a list of
     *    standard mechanism types.
     * @param provider the string name of the provider
     * @return a new &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     * @throws NoSuchProviderException if the specified provider is not
     *    registered in the security provider list
     * @throws NullPointerException if &lt;code&gt;provider&lt;/code&gt; or
     *    &lt;code&gt;mechanismType&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
     * @throws NoSuchMechanismException if an &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     *    implementation for the specified mechanism is not
     *    available from the specified provider
     * @see Provider
     */
    public static XMLSignatureFactory getInstance(String mechanismType,
        String provider) throws NoSuchProviderException {
        if (mechanismType == null) {
            throw new NullPointerException(&quot;mechanismType cannot be null&quot;);
        } else if (provider == null) {
            throw new NullPointerException(&quot;provider cannot be null&quot;);
        } else if (provider.length() == 0) {
            throw new NoSuchProviderException();
        }

        Instance instance;
        try {
            instance = GetInstance.getInstance
                (&quot;XMLSignatureFactory&quot;, null, mechanismType, provider);
        } catch (NoSuchAlgorithmException nsae) {
            throw new NoSuchMechanismException(nsae);
        }
        XMLSignatureFactory factory = (XMLSignatureFactory) instance.impl;
        factory.mechanismType = mechanismType;
        factory.provider = instance.provider;
        return factory;
    }

    /**
     * Returns an &lt;code&gt;XMLSignatureFactory&lt;/code&gt; that supports the
     * default XML processing mechanism and representation type (&quot;DOM&quot;).
     *
     * &lt;p&gt;This method uses the standard JCA provider lookup mechanism to
     * locate and instantiate an &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     * implementation of the default mechanism type. It traverses the list of
     * registered security &lt;code&gt;Provider&lt;/code&gt;s, starting with the most
     * preferred &lt;code&gt;Provider&lt;/code&gt;.  A new &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     * object from the first &lt;code&gt;Provider&lt;/code&gt; that supports the DOM
     * mechanism is returned.
     *
     * &lt;p&gt;Note that the list of registered providers may be retrieved via
     * the {@link Security#getProviders() Security.getProviders()} method.
     *
     * @return a new &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     * @throws NoSuchMechanismException if no &lt;code&gt;Provider&lt;/code&gt; supports an
     *    &lt;code&gt;XMLSignatureFactory&lt;/code&gt; implementation for the DOM
     *    mechanism
     * @see Provider
     */
    public static XMLSignatureFactory getInstance() {
        return getInstance(&quot;DOM&quot;);
    }

    /**
     * Returns the type of the XML processing mechanism and representation
     * supported by this &lt;code&gt;XMLSignatureFactory&lt;/code&gt; (ex: &quot;DOM&quot;).
     *
     * @return the XML processing mechanism type supported by this
     *    &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     */
    public final String getMechanismType() {
        return mechanismType;
    }

    /**
     * Returns the provider of this &lt;code&gt;XMLSignatureFactory&lt;/code&gt;.
     *
     * @return the provider of this &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     */
    public final Provider getProvider() {
        return provider;
    }

    /**
     * Creates an &lt;code&gt;XMLSignature&lt;/code&gt; and initializes it with the contents
     * of the specified &lt;code&gt;SignedInfo&lt;/code&gt; and &lt;code&gt;KeyInfo&lt;/code&gt;
     * objects.
     *
     * @param si the signed info
     * @param ki the key info (may be &lt;code&gt;null&lt;/code&gt;)
     * @return an &lt;code&gt;XMLSignature&lt;/code&gt;
     * @throws NullPointerException if &lt;code&gt;si&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
     */
    public abstract XMLSignature newXMLSignature(SignedInfo si, KeyInfo ki);

    /**
     * Creates an &lt;code&gt;XMLSignature&lt;/code&gt; and initializes it with the
     * specified parameters.
     *
     * @param si the signed info
     * @param ki the key info (may be &lt;code&gt;null&lt;/code&gt;)
     * @param objects a list of {@link XMLObject}s (may be empty or
     *    &lt;code&gt;null&lt;/code&gt;)
     * @param id the Id (may be &lt;code&gt;null&lt;/code&gt;)
     * @param signatureValueId the SignatureValue Id (may be &lt;code&gt;null&lt;/code&gt;)
     * @return an &lt;code&gt;XMLSignature&lt;/code&gt;
     * @throws NullPointerException if &lt;code&gt;si&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
     * @throws ClassCastException if any of the &lt;code&gt;objects&lt;/code&gt; are not of
     *    type &lt;code&gt;XMLObject&lt;/code&gt;
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public abstract XMLSignature newXMLSignature(SignedInfo si, KeyInfo ki,
        List objects, String id, String signatureValueId);

    /**
     * Creates a &lt;code&gt;Reference&lt;/code&gt; with the specified URI and digest
     * method.
     *
     * @param uri the reference URI (may be &lt;code&gt;null&lt;/code&gt;)
     * @param dm the digest method
     * @return a &lt;code&gt;Reference&lt;/code&gt;
     * @throws IllegalArgumentException if &lt;code&gt;uri&lt;/code&gt; is not RFC 2396
     *    compliant
     * @throws NullPointerException if &lt;code&gt;dm&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
     */
    public abstract Reference newReference(String uri, DigestMethod dm);

    /**
     * Creates a &lt;code&gt;Reference&lt;/code&gt; with the specified parameters.
     *
     * @param uri the reference URI (may be &lt;code&gt;null&lt;/code&gt;)
     * @param dm the digest method
     * @param transforms a list of {@link Transform}s. The list is defensively
     *    copied to protect against subsequent modification. May be
     *    &lt;code&gt;null&lt;/code&gt; or empty.
     * @param type the reference type, as a URI (may be &lt;code&gt;null&lt;/code&gt;)
     * @param id the reference ID (may be &lt;code&gt;null&lt;/code&gt;)
     * @return a &lt;code&gt;Reference&lt;/code&gt;
     * @throws ClassCastException if any of the &lt;code&gt;transforms&lt;/code&gt; are
     *    not of type &lt;code&gt;Transform&lt;/code&gt;
     * @throws IllegalArgumentException if &lt;code&gt;uri&lt;/code&gt; is not RFC 2396
     *    compliant
     * @throws NullPointerException if &lt;code&gt;dm&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public abstract Reference newReference(String uri, DigestMethod dm,
        List transforms, String type, String id);

    /**
     * Creates a &lt;code&gt;Reference&lt;/code&gt; with the specified parameters and
     * pre-calculated digest value.
     *
     * &lt;p&gt;This method is useful when the digest value of a
     * &lt;code&gt;Reference&lt;/code&gt; has been previously computed. See for example,
     * the
     * &lt;a href=&quot;http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=dss&quot;&gt;
     * OASIS-DSS (Digital Signature Services)&lt;/a&gt; specification.
     *
     * @param uri the reference URI (may be &lt;code&gt;null&lt;/code&gt;)
     * @param dm the digest method
     * @param transforms a list of {@link Transform}s. The list is defensively
     *    copied to protect against subsequent modification. May be
     *    &lt;code&gt;null&lt;/code&gt; or empty.
     * @param type the reference type, as a URI (may be &lt;code&gt;null&lt;/code&gt;)
     * @param id the reference ID (may be &lt;code&gt;null&lt;/code&gt;)
     * @param digestValue the digest value. The array is cloned to protect
     *    against subsequent modification.
     * @return a &lt;code&gt;Reference&lt;/code&gt;
     * @throws ClassCastException if any of the &lt;code&gt;transforms&lt;/code&gt; are
     *    not of type &lt;code&gt;Transform&lt;/code&gt;
     * @throws IllegalArgumentException if &lt;code&gt;uri&lt;/code&gt; is not RFC 2396
     *    compliant
     * @throws NullPointerException if &lt;code&gt;dm&lt;/code&gt; or
     *    &lt;code&gt;digestValue&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public abstract Reference newReference(String uri, DigestMethod dm,
        List transforms, String type, String id, byte[] digestValue);

    /**
     * Creates a &lt;code&gt;Reference&lt;/code&gt; with the specified parameters.
     *
     * &lt;p&gt;This method is useful when a list of transforms have already been
     * applied to the &lt;code&gt;Reference&lt;/code&gt;. See for example,
     * the
     * &lt;a href=&quot;http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=dss&quot;&gt;
     * OASIS-DSS (Digital Signature Services)&lt;/a&gt; specification.
     *
     * &lt;p&gt;When an &lt;code&gt;XMLSignature&lt;/code&gt; containing this reference is
     * generated, the specified &lt;code&gt;transforms&lt;/code&gt; (if non-null) are
     * applied to the specified &lt;code&gt;result&lt;/code&gt;. The
     * &lt;code&gt;Transforms&lt;/code&gt; element of the resulting &lt;code&gt;Reference&lt;/code&gt;
     * element is set to the concatenation of the
     * &lt;code&gt;appliedTransforms&lt;/code&gt; and &lt;code&gt;transforms&lt;/code&gt;.
     *
     * @param uri the reference URI (may be &lt;code&gt;null&lt;/code&gt;)
     * @param dm the digest method
     * @param appliedTransforms a list of {@link Transform}s that have
     *    already been applied. The list is defensively
     *    copied to protect against subsequent modification. The list must
     *    contain at least one entry.
     * @param result the result of processing the sequence of
     *    &lt;code&gt;appliedTransforms&lt;/code&gt;
     * @param transforms a list of {@link Transform}s that are to be applied
     *    when generating the signature. The list is defensively copied to
     *    protect against subsequent modification. May be &lt;code&gt;null&lt;/code&gt;
     *    or empty.
     * @param type the reference type, as a URI (may be &lt;code&gt;null&lt;/code&gt;)
     * @param id the reference ID (may be &lt;code&gt;null&lt;/code&gt;)
     * @return a &lt;code&gt;Reference&lt;/code&gt;
     * @throws ClassCastException if any of the transforms (in either list)
     *    are not of type &lt;code&gt;Transform&lt;/code&gt;
     * @throws IllegalArgumentException if &lt;code&gt;uri&lt;/code&gt; is not RFC 2396
     *    compliant or &lt;code&gt;appliedTransforms&lt;/code&gt; is empty
     * @throws NullPointerException if &lt;code&gt;dm&lt;/code&gt;,
     *    &lt;code&gt;appliedTransforms&lt;/code&gt; or &lt;code&gt;result&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public abstract Reference newReference(String uri, DigestMethod dm,
        List appliedTransforms, Data result, List transforms, String type,
        String id);

    /**
     * Creates a &lt;code&gt;SignedInfo&lt;/code&gt; with the specified canonicalization
     * and signature methods, and list of one or more references.
     *
     * @param cm the canonicalization method
     * @param sm the signature method
     * @param references a list of one or more {@link Reference}s. The list is
     *    defensively copied to protect against subsequent modification.
     * @return a &lt;code&gt;SignedInfo&lt;/code&gt;
     * @throws ClassCastException if any of the references are not of
     *    type &lt;code&gt;Reference&lt;/code&gt;
     * @throws IllegalArgumentException if &lt;code&gt;references&lt;/code&gt; is empty
     * @throws NullPointerException if any of the parameters
     *    are &lt;code&gt;null&lt;/code&gt;
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public abstract SignedInfo newSignedInfo(CanonicalizationMethod cm,
        SignatureMethod sm, List references);

    /**
     * Creates a &lt;code&gt;SignedInfo&lt;/code&gt; with the specified parameters.
     *
     * @param cm the canonicalization method
     * @param sm the signature method
     * @param references a list of one or more {@link Reference}s. The list is
     *    defensively copied to protect against subsequent modification.
     * @param id the id (may be &lt;code&gt;null&lt;/code&gt;)
     * @return a &lt;code&gt;SignedInfo&lt;/code&gt;
     * @throws ClassCastException if any of the references are not of
     *    type &lt;code&gt;Reference&lt;/code&gt;
     * @throws IllegalArgumentException if &lt;code&gt;references&lt;/code&gt; is empty
     * @throws NullPointerException if &lt;code&gt;cm&lt;/code&gt;, &lt;code&gt;sm&lt;/code&gt;, or
     *    &lt;code&gt;references&lt;/code&gt; are &lt;code&gt;null&lt;/code&gt;
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public abstract SignedInfo newSignedInfo(CanonicalizationMethod cm,
        SignatureMethod sm, List references, String id);

    // Object factory methods
    /**
     * Creates an &lt;code&gt;XMLObject&lt;/code&gt; from the specified parameters.
     *
     * @param content a list of {@link XMLStructure}s. The list
     *    is defensively copied to protect against subsequent modification.
     *    May be &lt;code&gt;null&lt;/code&gt; or empty.
     * @param id the Id (may be &lt;code&gt;null&lt;/code&gt;)
     * @param mimeType the mime type (may be &lt;code&gt;null&lt;/code&gt;)
     * @param encoding the encoding (may be &lt;code&gt;null&lt;/code&gt;)
     * @return an &lt;code&gt;XMLObject&lt;/code&gt;
     * @throws ClassCastException if &lt;code&gt;content&lt;/code&gt; contains any
     *    entries that are not of type {@link XMLStructure}
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public abstract XMLObject newXMLObject(List content, String id,
        String mimeType, String encoding);

    /**
     * Creates a &lt;code&gt;Manifest&lt;/code&gt; containing the specified
     * list of {@link Reference}s.
     *
     * @param references a list of one or more &lt;code&gt;Reference&lt;/code&gt;s. The list
     *    is defensively copied to protect against subsequent modification.
     * @return a &lt;code&gt;Manifest&lt;/code&gt;
     * @throws NullPointerException if &lt;code&gt;references&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     * @throws IllegalArgumentException if &lt;code&gt;references&lt;/code&gt; is empty
     * @throws ClassCastException if &lt;code&gt;references&lt;/code&gt; contains any
     *    entries that are not of type {@link Reference}
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public abstract Manifest newManifest(List references);

    /**
     * Creates a &lt;code&gt;Manifest&lt;/code&gt; containing the specified
     * list of {@link Reference}s and optional id.
     *
     * @param references a list of one or more &lt;code&gt;Reference&lt;/code&gt;s. The list
     *    is defensively copied to protect against subsequent modification.
     * @param id the id (may be &lt;code&gt;null&lt;/code&gt;)
     * @return a &lt;code&gt;Manifest&lt;/code&gt;
     * @throws NullPointerException if &lt;code&gt;references&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     * @throws IllegalArgumentException if &lt;code&gt;references&lt;/code&gt; is empty
     * @throws ClassCastException if &lt;code&gt;references&lt;/code&gt; contains any
     *    entries that are not of type {@link Reference}
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public abstract Manifest newManifest(List references, String id);

    /**
     * Creates a &lt;code&gt;SignatureProperty&lt;/code&gt; containing the specified
     * list of {@link XMLStructure}s, target URI and optional id.
     *
     * @param content a list of one or more &lt;code&gt;XMLStructure&lt;/code&gt;s. The list
     *    is defensively copied to protect against subsequent modification.
     * @param target the target URI of the Signature that this property applies
     *    to
     * @param id the id (may be &lt;code&gt;null&lt;/code&gt;)
     * @return a &lt;code&gt;SignatureProperty&lt;/code&gt;
     * @throws NullPointerException if &lt;code&gt;content&lt;/code&gt; or
     *    &lt;code&gt;target&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
     * @throws IllegalArgumentException if &lt;code&gt;content&lt;/code&gt; is empty
     * @throws ClassCastException if &lt;code&gt;content&lt;/code&gt; contains any
     *    entries that are not of type {@link XMLStructure}
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public abstract SignatureProperty newSignatureProperty
        (List content, String target, String id);

    /**
     * Creates a &lt;code&gt;SignatureProperties&lt;/code&gt; containing the specified
     * list of {@link SignatureProperty}s and optional id.
     *
     * @param properties a list of one or more &lt;code&gt;SignatureProperty&lt;/code&gt;s.
     *    The list is defensively copied to protect against subsequent
     *    modification.
     * @param id the id (may be &lt;code&gt;null&lt;/code&gt;)
     * @return a &lt;code&gt;SignatureProperties&lt;/code&gt;
     * @throws NullPointerException if &lt;code&gt;properties&lt;/code&gt;
     *    is &lt;code&gt;null&lt;/code&gt;
     * @throws IllegalArgumentException if &lt;code&gt;properties&lt;/code&gt; is empty
     * @throws ClassCastException if &lt;code&gt;properties&lt;/code&gt; contains any
     *    entries that are not of type {@link SignatureProperty}
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    public abstract SignatureProperties newSignatureProperties
        (List properties, String id);

    // Algorithm factory methods
    /**
     * Creates a &lt;code&gt;DigestMethod&lt;/code&gt; for the specified algorithm URI
     * and parameters.
     *
     * @param algorithm the URI identifying the digest algorithm
     * @param params algorithm-specific digest parameters (may be
     *    &lt;code&gt;null&lt;/code&gt;)
     * @return the &lt;code&gt;DigestMethod&lt;/code&gt;
     * @throws InvalidAlgorithmParameterException if the specified parameters
     *    are inappropriate for the requested algorithm
     * @throws NoSuchAlgorithmException if an implementation of the
     *    specified algorithm cannot be found
     * @throws NullPointerException if &lt;code&gt;algorithm&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     */
    public abstract DigestMethod newDigestMethod(String algorithm,
        DigestMethodParameterSpec params) throws NoSuchAlgorithmException,
        InvalidAlgorithmParameterException;

    /**
     * Creates a &lt;code&gt;SignatureMethod&lt;/code&gt; for the specified algorithm URI
     * and parameters.
     *
     * @param algorithm the URI identifying the signature algorithm
     * @param params algorithm-specific signature parameters (may be
     *    &lt;code&gt;null&lt;/code&gt;)
     * @return the &lt;code&gt;SignatureMethod&lt;/code&gt;
     * @throws InvalidAlgorithmParameterException if the specified parameters
     *    are inappropriate for the requested algorithm
     * @throws NoSuchAlgorithmException if an implementation of the
     *    specified algorithm cannot be found
     * @throws NullPointerException if &lt;code&gt;algorithm&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     */
    public abstract SignatureMethod newSignatureMethod(String algorithm,
        SignatureMethodParameterSpec params) throws NoSuchAlgorithmException,
        InvalidAlgorithmParameterException;

    /**
     * Creates a &lt;code&gt;Transform&lt;/code&gt; for the specified algorithm URI
     * and parameters.
     *
     * @param algorithm the URI identifying the transform algorithm
     * @param params algorithm-specific transform parameters (may be
     *    &lt;code&gt;null&lt;/code&gt;)
     * @return the &lt;code&gt;Transform&lt;/code&gt;
     * @throws InvalidAlgorithmParameterException if the specified parameters
     *    are inappropriate for the requested algorithm
     * @throws NoSuchAlgorithmException if an implementation of the
     *    specified algorithm cannot be found
     * @throws NullPointerException if &lt;code&gt;algorithm&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     */
    public abstract Transform newTransform(String algorithm,
        TransformParameterSpec params) throws NoSuchAlgorithmException,
        InvalidAlgorithmParameterException;

    /**
     * Creates a &lt;code&gt;Transform&lt;/code&gt; for the specified algorithm URI
     * and parameters. The parameters are specified as a mechanism-specific
     * &lt;code&gt;XMLStructure&lt;/code&gt; (ex: {@link DOMStructure}). This method is
     * useful when the parameters are in XML form or there is no standard
     * class for specifying the parameters.
     *
     * @param algorithm the URI identifying the transform algorithm
     * @param params a mechanism-specific XML structure from which to
     *   unmarshal the parameters from (may be &lt;code&gt;null&lt;/code&gt; if
     *   not required or optional)
     * @return the &lt;code&gt;Transform&lt;/code&gt;
     * @throws ClassCastException if the type of &lt;code&gt;params&lt;/code&gt; is
     *   inappropriate for this &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     * @throws InvalidAlgorithmParameterException if the specified parameters
     *    are inappropriate for the requested algorithm
     * @throws NoSuchAlgorithmException if an implementation of the
     *    specified algorithm cannot be found
     * @throws NullPointerException if &lt;code&gt;algorithm&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     */
    public abstract Transform newTransform(String algorithm,
        XMLStructure params) throws NoSuchAlgorithmException,
        InvalidAlgorithmParameterException;

    /**
     * Creates a &lt;code&gt;CanonicalizationMethod&lt;/code&gt; for the specified
     * algorithm URI and parameters.
     *
     * @param algorithm the URI identifying the canonicalization algorithm
     * @param params algorithm-specific canonicalization parameters (may be
     *    &lt;code&gt;null&lt;/code&gt;)
     * @return the &lt;code&gt;CanonicalizationMethod&lt;/code&gt;
     * @throws InvalidAlgorithmParameterException if the specified parameters
     *    are inappropriate for the requested algorithm
     * @throws NoSuchAlgorithmException if an implementation of the
     *    specified algorithm cannot be found
     * @throws NullPointerException if &lt;code&gt;algorithm&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     */
    public abstract CanonicalizationMethod newCanonicalizationMethod(
        String algorithm, C14NMethodParameterSpec params)
        throws NoSuchAlgorithmException, InvalidAlgorithmParameterException;

    /**
     * Creates a &lt;code&gt;CanonicalizationMethod&lt;/code&gt; for the specified
     * algorithm URI and parameters. The parameters are specified as a
     * mechanism-specific &lt;code&gt;XMLStructure&lt;/code&gt; (ex: {@link DOMStructure}).
     * This method is useful when the parameters are in XML form or there is
     * no standard class for specifying the parameters.
     *
     * @param algorithm the URI identifying the canonicalization algorithm
     * @param params a mechanism-specific XML structure from which to
     *   unmarshal the parameters from (may be &lt;code&gt;null&lt;/code&gt; if
     *   not required or optional)
     * @return the &lt;code&gt;CanonicalizationMethod&lt;/code&gt;
     * @throws ClassCastException if the type of &lt;code&gt;params&lt;/code&gt; is
     *   inappropriate for this &lt;code&gt;XMLSignatureFactory&lt;/code&gt;
     * @throws InvalidAlgorithmParameterException if the specified parameters
     *    are inappropriate for the requested algorithm
     * @throws NoSuchAlgorithmException if an implementation of the
     *    specified algorithm cannot be found
     * @throws NullPointerException if &lt;code&gt;algorithm&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     */
    public abstract CanonicalizationMethod newCanonicalizationMethod(
        String algorithm, XMLStructure params)
        throws NoSuchAlgorithmException, InvalidAlgorithmParameterException;

    /**
     * Returns a &lt;code&gt;KeyInfoFactory&lt;/code&gt; that creates &lt;code&gt;KeyInfo&lt;/code&gt;
     * objects. The returned &lt;code&gt;KeyInfoFactory&lt;/code&gt; has the same
     * mechanism type and provider as this &lt;code&gt;XMLSignatureFactory&lt;/code&gt;.
     *
     * @return a &lt;code&gt;KeyInfoFactory&lt;/code&gt;
     * @throws NoSuchMechanismException if a &lt;code&gt;KeyFactory&lt;/code&gt;
     *    implementation with the same mechanism type and provider
     *    is not available
     */
    public final KeyInfoFactory getKeyInfoFactory() {
        return KeyInfoFactory.getInstance(getMechanismType(), getProvider());
    }

    /**
     * Unmarshals a new &lt;code&gt;XMLSignature&lt;/code&gt; instance from a
     * mechanism-specific &lt;code&gt;XMLValidateContext&lt;/code&gt; instance.
     *
     * @param context a mechanism-specific context from which to unmarshal the
     *    signature from
     * @return the &lt;code&gt;XMLSignature&lt;/code&gt;
     * @throws NullPointerException if &lt;code&gt;context&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     * @throws ClassCastException if the type of &lt;code&gt;context&lt;/code&gt; is
     *    inappropriate for this factory
     * @throws MarshalException if an unrecoverable exception occurs
     *    during unmarshalling
     */
    public abstract XMLSignature unmarshalXMLSignature
        (XMLValidateContext context) throws MarshalException;

    /**
     * Unmarshals a new &lt;code&gt;XMLSignature&lt;/code&gt; instance from a
     * mechanism-specific &lt;code&gt;XMLStructure&lt;/code&gt; instance.
     * This method is useful if you only want to unmarshal (and not
     * validate) an &lt;code&gt;XMLSignature&lt;/code&gt;.
     *
     * @param xmlStructure a mechanism-specific XML structure from which to
     *    unmarshal the signature from
     * @return the &lt;code&gt;XMLSignature&lt;/code&gt;
     * @throws NullPointerException if &lt;code&gt;xmlStructure&lt;/code&gt; is
     *    &lt;code&gt;null&lt;/code&gt;
     * @throws ClassCastException if the type of &lt;code&gt;xmlStructure&lt;/code&gt; is
     *    inappropriate for this factory
     * @throws MarshalException if an unrecoverable exception occurs
     *    during unmarshalling
     */
    public abstract XMLSignature unmarshalXMLSignature
        (XMLStructure xmlStructure) throws MarshalException;

    /**
     * Indicates whether a specified feature is supported.
     *
     * @param feature the feature name (as an absolute URI)
     * @return &lt;code&gt;true&lt;/code&gt; if the specified feature is supported,
     *    &lt;code&gt;false&lt;/code&gt; otherwise
     * @throws NullPointerException if &lt;code&gt;feature&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
     */
    public abstract boolean isFeatureSupported(String feature);

    /**
     * Returns a reference to the &lt;code&gt;URIDereferencer&lt;/code&gt; that is used by
     * default to dereference URIs in {@link Reference} objects.
     *
     * @return a reference to the default &lt;code&gt;URIDereferencer&lt;/code&gt; (never
     *    &lt;code&gt;null&lt;/code&gt;)
     */
    public abstract URIDereferencer getURIDereferencer();
}
</pre>
</body>
</html>
