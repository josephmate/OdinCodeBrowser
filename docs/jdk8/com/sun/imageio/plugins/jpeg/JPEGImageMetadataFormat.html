<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/css/styles.css"/>
    </head>
<body>
<pre class="code">
/*
 * Copyright (c) 2001, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.imageio.plugins.jpeg;

import javax.imageio.metadata.IIOMetadataFormat;
import javax.imageio.metadata.IIOMetadataFormatImpl;
import javax.imageio.ImageTypeSpecifier;

import java.awt.color.ICC_Profile;
import java.awt.color.ColorSpace;
import java.awt.image.ColorModel;

import java.util.List;
import java.util.ArrayList;

public class JPEGImageMetadataFormat extends JPEGMetadataFormat {

    private static JPEGImageMetadataFormat theInstance = null;

    private JPEGImageMetadataFormat() {
        super(JPEG.nativeImageMetadataFormatName,
              CHILD_POLICY_ALL);

        addElement(&quot;JPEGvariety&quot;,
                   JPEG.nativeImageMetadataFormatName,
                   CHILD_POLICY_CHOICE);

        addElement(&quot;markerSequence&quot;,
                   JPEG.nativeImageMetadataFormatName,
                   CHILD_POLICY_SEQUENCE);

        addElement(&quot;app0JFIF&quot;, &quot;JPEGvariety&quot;, CHILD_POLICY_SOME);

        addStreamElements(&quot;markerSequence&quot;);

        addElement(&quot;app14Adobe&quot;, &quot;markerSequence&quot;, CHILD_POLICY_EMPTY);

        addElement(&quot;sof&quot;, &quot;markerSequence&quot;, 1, 4);

        addElement(&quot;sos&quot;, &quot;markerSequence&quot;, 1, 4);

        addElement(&quot;JFXX&quot;, &quot;app0JFIF&quot;, 1, Integer.MAX_VALUE);

        addElement(&quot;app0JFXX&quot;, &quot;JFXX&quot;, CHILD_POLICY_CHOICE);

        addElement(&quot;app2ICC&quot;, &quot;app0JFIF&quot;, CHILD_POLICY_EMPTY);

        addAttribute(&quot;app0JFIF&quot;,
                     &quot;majorVersion&quot;,
                     DATATYPE_INTEGER,
                     false,
                     &quot;1&quot;,
                     &quot;0&quot;, &quot;255&quot;,
                     true, true);
        addAttribute(&quot;app0JFIF&quot;,
                     &quot;minorVersion&quot;,
                     DATATYPE_INTEGER,
                     false,
                     &quot;2&quot;,
                     &quot;0&quot;, &quot;255&quot;,
                     true, true);
        List resUnits = new ArrayList();
        resUnits.add(&quot;0&quot;);
        resUnits.add(&quot;1&quot;);
        resUnits.add(&quot;2&quot;);
        addAttribute(&quot;app0JFIF&quot;,
                     &quot;resUnits&quot;,
                     DATATYPE_INTEGER,
                     false,
                     &quot;0&quot;,
                     resUnits);
        addAttribute(&quot;app0JFIF&quot;,
                     &quot;Xdensity&quot;,
                     DATATYPE_INTEGER,
                     false,
                     &quot;1&quot;,
                     &quot;1&quot;, &quot;65535&quot;,
                     true, true);
        addAttribute(&quot;app0JFIF&quot;,
                     &quot;Ydensity&quot;,
                     DATATYPE_INTEGER,
                     false,
                     &quot;1&quot;,
                     &quot;1&quot;, &quot;65535&quot;,
                     true, true);
        addAttribute(&quot;app0JFIF&quot;,
                     &quot;thumbWidth&quot;,
                     DATATYPE_INTEGER,
                     false,
                     &quot;0&quot;,
                     &quot;0&quot;, &quot;255&quot;,
                     true, true);
        addAttribute(&quot;app0JFIF&quot;,
                     &quot;thumbHeight&quot;,
                     DATATYPE_INTEGER,
                     false,
                     &quot;0&quot;,
                     &quot;0&quot;, &quot;255&quot;,
                     true, true);

        addElement(&quot;JFIFthumbJPEG&quot;, &quot;app0JFXX&quot;, CHILD_POLICY_SOME);
        addElement(&quot;JFIFthumbPalette&quot;, &quot;app0JFXX&quot;, CHILD_POLICY_EMPTY);
        addElement(&quot;JFIFthumbRGB&quot;, &quot;app0JFXX&quot;, CHILD_POLICY_EMPTY);

        List codes = new ArrayList();
        codes.add(&quot;16&quot;); // Hex 10
        codes.add(&quot;17&quot;); // Hex 11
        codes.add(&quot;19&quot;); // Hex 13
        addAttribute(&quot;app0JFXX&quot;,
                     &quot;extensionCode&quot;,
                     DATATYPE_INTEGER,
                     false,
                     null,
                     codes);

        addChildElement(&quot;markerSequence&quot;, &quot;JFIFthumbJPEG&quot;);

        addAttribute(&quot;JFIFthumbPalette&quot;,
                     &quot;thumbWidth&quot;,
                     DATATYPE_INTEGER,
                     false,
                     null,
                     &quot;0&quot;, &quot;255&quot;,
                     true, true);
        addAttribute(&quot;JFIFthumbPalette&quot;,
                     &quot;thumbHeight&quot;,
                     DATATYPE_INTEGER,
                     false,
                     null,
                     &quot;0&quot;, &quot;255&quot;,
                     true, true);

        addAttribute(&quot;JFIFthumbRGB&quot;,
                     &quot;thumbWidth&quot;,
                     DATATYPE_INTEGER,
                     false,
                     null,
                     &quot;0&quot;, &quot;255&quot;,
                     true, true);
        addAttribute(&quot;JFIFthumbRGB&quot;,
                     &quot;thumbHeight&quot;,
                     DATATYPE_INTEGER,
                     false,
                     null,
                     &quot;0&quot;, &quot;255&quot;,
                     true, true);

        addObjectValue(&quot;app2ICC&quot;, ICC_Profile.class, false, null);

        addAttribute(&quot;app14Adobe&quot;,
                     &quot;version&quot;,
                     DATATYPE_INTEGER,
                     false,
                     &quot;100&quot;,
                     &quot;100&quot;, &quot;255&quot;,
                     true, true);
        addAttribute(&quot;app14Adobe&quot;,
                     &quot;flags0&quot;,
                     DATATYPE_INTEGER,
                     false,
                     &quot;0&quot;,
                     &quot;0&quot;, &quot;65535&quot;,
                     true, true);
        addAttribute(&quot;app14Adobe&quot;,
                     &quot;flags1&quot;,
                     DATATYPE_INTEGER,
                     false,
                     &quot;0&quot;,
                     &quot;0&quot;, &quot;65535&quot;,
                     true, true);

        List transforms = new ArrayList();
        transforms.add(&quot;0&quot;);
        transforms.add(&quot;1&quot;);
        transforms.add(&quot;2&quot;);
        addAttribute(&quot;app14Adobe&quot;,
                     &quot;transform&quot;,
                     DATATYPE_INTEGER,
                     true,
                     null,
                     transforms);

        addElement(&quot;componentSpec&quot;, &quot;sof&quot;, CHILD_POLICY_EMPTY);

        List procs = new ArrayList();
        procs.add(&quot;0&quot;);
        procs.add(&quot;1&quot;);
        procs.add(&quot;2&quot;);
        addAttribute(&quot;sof&quot;,
                     &quot;process&quot;,
                     DATATYPE_INTEGER,
                     false,
                     null,
                     procs);
        addAttribute(&quot;sof&quot;,
                     &quot;samplePrecision&quot;,
                     DATATYPE_INTEGER,
                     false,
                     &quot;8&quot;);
        addAttribute(&quot;sof&quot;,
                     &quot;numLines&quot;,
                     DATATYPE_INTEGER,
                     false,
                     null,
                     &quot;0&quot;, &quot;65535&quot;,
                     true, true);
        addAttribute(&quot;sof&quot;,
                     &quot;samplesPerLine&quot;,
                     DATATYPE_INTEGER,
                     false,
                     null,
                     &quot;0&quot;, &quot;65535&quot;,
                     true, true);
        List comps = new ArrayList();
        comps.add(&quot;1&quot;);
        comps.add(&quot;2&quot;);
        comps.add(&quot;3&quot;);
        comps.add(&quot;4&quot;);
        addAttribute(&quot;sof&quot;,
                     &quot;numFrameComponents&quot;,
                     DATATYPE_INTEGER,
                     false,
                     null,
                     comps);

        addAttribute(&quot;componentSpec&quot;,
                     &quot;componentId&quot;,
                     DATATYPE_INTEGER,
                     true,
                     null,
                     &quot;0&quot;, &quot;255&quot;,
                     true, true);
        addAttribute(&quot;componentSpec&quot;,
                     &quot;HsamplingFactor&quot;,
                     DATATYPE_INTEGER,
                     true,
                     null,
                     &quot;1&quot;, &quot;255&quot;,
                     true, true);
        addAttribute(&quot;componentSpec&quot;,
                     &quot;VsamplingFactor&quot;,
                     DATATYPE_INTEGER,
                     true,
                     null,
                     &quot;1&quot;, &quot;255&quot;,
                     true, true);
        List tabids = new ArrayList();
        tabids.add(&quot;0&quot;);
        tabids.add(&quot;1&quot;);
        tabids.add(&quot;2&quot;);
        tabids.add(&quot;3&quot;);
        addAttribute(&quot;componentSpec&quot;,
                     &quot;QtableSelector&quot;,
                     DATATYPE_INTEGER,
                     true,
                     null,
                     tabids);

        addElement(&quot;scanComponentSpec&quot;, &quot;sos&quot;, CHILD_POLICY_EMPTY);

        addAttribute(&quot;sos&quot;,
                     &quot;numScanComponents&quot;,
                     DATATYPE_INTEGER,
                     true,
                     null,
                     comps);
        addAttribute(&quot;sos&quot;,
                     &quot;startSpectralSelection&quot;,
                      DATATYPE_INTEGER,
                     false,
                     &quot;0&quot;,
                     &quot;0&quot;, &quot;63&quot;,
                     true, true);
        addAttribute(&quot;sos&quot;,
                     &quot;endSpectralSelection&quot;,
                      DATATYPE_INTEGER,
                     false,
                     &quot;63&quot;,
                     &quot;0&quot;, &quot;63&quot;,
                     true, true);
        addAttribute(&quot;sos&quot;,
                     &quot;approxHigh&quot;,
                      DATATYPE_INTEGER,
                     false,
                     &quot;0&quot;,
                     &quot;0&quot;, &quot;15&quot;,
                     true, true);
        addAttribute(&quot;sos&quot;,
                     &quot;approxLow&quot;,
                      DATATYPE_INTEGER,
                     false,
                     &quot;0&quot;,
                     &quot;0&quot;, &quot;15&quot;,
                     true, true);

        addAttribute(&quot;scanComponentSpec&quot;,
                     &quot;componentSelector&quot;,
                     DATATYPE_INTEGER,
                     true,
                     null,
                     &quot;0&quot;, &quot;255&quot;,
                     true, true);
        addAttribute(&quot;scanComponentSpec&quot;,
                     &quot;dcHuffTable&quot;,
                     DATATYPE_INTEGER,
                     true,
                     null,
                     tabids);
        addAttribute(&quot;scanComponentSpec&quot;,
                     &quot;acHuffTable&quot;,
                     DATATYPE_INTEGER,
                     true,
                     null,
                     tabids);
    }

    public boolean canNodeAppear(String elementName,
                                 ImageTypeSpecifier imageType) {
        // All images can have these
        if (elementName.equals(getRootName())
            || elementName.equals(&quot;JPEGvariety&quot;)
            || isInSubtree(elementName, &quot;markerSequence&quot;)) {
            return true;
        }

        // If it is an element in the app0jfif subtree, just check
        // that the image type is JFIF compliant.
        if ((isInSubtree(elementName, &quot;app0JFIF&quot;))
            &amp;&amp; JPEG.isJFIFcompliant(imageType, true)) {
            return true;
        }

        return false;
    }


    public static synchronized IIOMetadataFormat getInstance() {
        if (theInstance == null) {
            theInstance = new JPEGImageMetadataFormat();
        }
        return theInstance;
    }
}
</pre>
</body>
</html>
