<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/css/styles.css"/>
    </head>
<body>
<pre class="code">
/*
 * Copyright (c) 2002, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package com.sun.jmx.mbeanserver;

import java.util.logging.Level;

import javax.management.Attribute;
import javax.management.AttributeList;
import javax.management.AttributeNotFoundException;
import javax.management.DynamicMBean;
import javax.management.InvalidAttributeValueException;
import javax.management.JMRuntimeException;
import javax.management.MBeanAttributeInfo;
import javax.management.MBeanException;
import javax.management.MBeanInfo;
import javax.management.MBeanRegistration;
import javax.management.MBeanServer;
import javax.management.MBeanServerDelegate;
import javax.management.ObjectName;
import javax.management.ReflectionException;
import javax.management.RuntimeOperationsException;

import static com.sun.jmx.defaults.JmxProperties.MBEANSERVER_LOGGER;

/**
 * This class is the MBean implementation of the MBeanServerDelegate.
 *
 * @since 1.5
 */
final class MBeanServerDelegateImpl
    extends MBeanServerDelegate
    implements DynamicMBean, MBeanRegistration {

    final private static String[] attributeNames = new String[] {
        &quot;MBeanServerId&quot;,
        &quot;SpecificationName&quot;,
        &quot;SpecificationVersion&quot;,
        &quot;SpecificationVendor&quot;,
        &quot;ImplementationName&quot;,
        &quot;ImplementationVersion&quot;,
        &quot;ImplementationVendor&quot;
    };

    private static final MBeanAttributeInfo[] attributeInfos =
        new MBeanAttributeInfo[] {
            new MBeanAttributeInfo(&quot;MBeanServerId&quot;,&quot;java.lang.String&quot;,
                                   &quot;The MBean server agent identification&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;SpecificationName&quot;,&quot;java.lang.String&quot;,
                                   &quot;The full name of the JMX specification &quot;+
                                   &quot;implemented by this product.&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;SpecificationVersion&quot;,&quot;java.lang.String&quot;,
                                   &quot;The version of the JMX specification &quot;+
                                   &quot;implemented by this product.&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;SpecificationVendor&quot;,&quot;java.lang.String&quot;,
                                   &quot;The vendor of the JMX specification &quot;+
                                   &quot;implemented by this product.&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;ImplementationName&quot;,&quot;java.lang.String&quot;,
                                   &quot;The JMX implementation name &quot;+
                                   &quot;(the name of this product)&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;ImplementationVersion&quot;,&quot;java.lang.String&quot;,
                                   &quot;The JMX implementation version &quot;+
                                   &quot;(the version of this product).&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;ImplementationVendor&quot;,&quot;java.lang.String&quot;,
                                   &quot;the JMX implementation vendor &quot;+
                                   &quot;(the vendor of this product).&quot;,
                                   true,false,false)
                };

    private final MBeanInfo delegateInfo;

    public MBeanServerDelegateImpl () {
        super();
        delegateInfo =
            new MBeanInfo(&quot;javax.management.MBeanServerDelegate&quot;,
                          &quot;Represents  the MBean server from the management &quot;+
                          &quot;point of view.&quot;,
                          MBeanServerDelegateImpl.attributeInfos, null,
                          null,getNotificationInfo());
    }

    final public ObjectName preRegister (MBeanServer server, ObjectName name)
        throws java.lang.Exception {
        if (name == null) return DELEGATE_NAME;
        else return name;
    }

    final public void postRegister (Boolean registrationDone) {
    }

    final public void preDeregister()
        throws java.lang.Exception {
        throw new IllegalArgumentException(
                 &quot;The MBeanServerDelegate MBean cannot be unregistered&quot;);
    }

    final public void postDeregister() {
    }

    /**
     * Obtains the value of a specific attribute of the MBeanServerDelegate.
     *
     * @param attribute The name of the attribute to be retrieved
     *
     * @return  The value of the attribute retrieved.
     *
     * @exception AttributeNotFoundException
     * @exception MBeanException
     *            Wraps a &lt;CODE&gt;java.lang.Exception&lt;/CODE&gt; thrown by the
     *            MBean's getter.
     */
    public Object getAttribute(String attribute)
        throws AttributeNotFoundException,
               MBeanException, ReflectionException {
        try {
            // attribute must not be null
            //
            if (attribute == null)
                throw new AttributeNotFoundException(&quot;null&quot;);

            // Extract the requested attribute from file
            //
            if (attribute.equals(&quot;MBeanServerId&quot;))
                return getMBeanServerId();
            else if (attribute.equals(&quot;SpecificationName&quot;))
                return getSpecificationName();
            else if (attribute.equals(&quot;SpecificationVersion&quot;))
                return getSpecificationVersion();
            else if (attribute.equals(&quot;SpecificationVendor&quot;))
                return getSpecificationVendor();
            else if (attribute.equals(&quot;ImplementationName&quot;))
                return getImplementationName();
            else if (attribute.equals(&quot;ImplementationVersion&quot;))
                return getImplementationVersion();
            else if (attribute.equals(&quot;ImplementationVendor&quot;))
                return getImplementationVendor();

            // Unknown attribute
            //
            else
                throw new AttributeNotFoundException(&quot;null&quot;);

        } catch (AttributeNotFoundException x) {
            throw x;
        } catch (JMRuntimeException j) {
            throw j;
        } catch (SecurityException s) {
            throw s;
        } catch (Exception x) {
            throw new MBeanException(x,&quot;Failed to get &quot; + attribute);
        }
    }

    /**
     * This method always fail since all MBeanServerDelegateMBean attributes
     * are read-only.
     *
     * @param attribute The identification of the attribute to
     * be set and  the value it is to be set to.
     *
     * @exception AttributeNotFoundException
     */
    public void setAttribute(Attribute attribute)
        throws AttributeNotFoundException, InvalidAttributeValueException,
               MBeanException, ReflectionException {

        // Now we will always fail:
        // Either because the attribute is null or because it is not
        // accessible (or does not exist).
        //
        final String attname = (attribute==null?null:attribute.getName());
        if (attname == null) {
            final RuntimeException r =
                new IllegalArgumentException(&quot;Attribute name cannot be null&quot;);
            throw new RuntimeOperationsException(r,
                &quot;Exception occurred trying to invoke the setter on the MBean&quot;);
        }

        // This is a hack: we call getAttribute in order to generate an
        // AttributeNotFoundException if the attribute does not exist.
        //
        Object val = getAttribute(attname);

        // If we reach this point, we know that the requested attribute
        // exists. However, since all attributes are read-only, we throw
        // an AttributeNotFoundException.
        //
        throw new AttributeNotFoundException(attname + &quot; not accessible&quot;);
    }

    /**
     * Makes it possible to get the values of several attributes of
     * the MBeanServerDelegate.
     *
     * @param attributes A list of the attributes to be retrieved.
     *
     * @return  The list of attributes retrieved.
     *
     */
    public AttributeList getAttributes(String[] attributes) {
        // If attributes is null, the get all attributes.
        //
        final String[] attn = (attributes==null?attributeNames:attributes);

        // Prepare the result list.
        //
        final int len = attn.length;
        final AttributeList list = new AttributeList(len);

        // Get each requested attribute.
        //
        for (int i=0;i&lt;len;i++) {
            try {
                final Attribute a =
                    new Attribute(attn[i],getAttribute(attn[i]));
                list.add(a);
            } catch (Exception x) {
                // Skip the attribute that couldn't be obtained.
                //
                if (MBEANSERVER_LOGGER.isLoggable(Level.FINEST)) {
                    MBEANSERVER_LOGGER.logp(Level.FINEST,
                            MBeanServerDelegateImpl.class.getName(),
                            &quot;getAttributes&quot;,
                            &quot;Attribute &quot; + attn[i] + &quot; not found&quot;);
                }
            }
        }

        // Finally return the result.
        //
        return list;
    }

    /**
     * This method always return an empty list since all
     * MBeanServerDelegateMBean attributes are read-only.
     *
     * @param attributes A list of attributes: The identification of the
     * attributes to be set and  the values they are to be set to.
     *
     * @return  The list of attributes that were set, with their new values.
     *          In fact, this method always return an empty list since all
     *          MBeanServerDelegateMBean attributes are read-only.
     */
    public AttributeList setAttributes(AttributeList attributes) {
        return new AttributeList(0);
    }

    /**
     * Always fails since the MBeanServerDelegate MBean has no operation.
     *
     * @param actionName The name of the action to be invoked.
     * @param params An array containing the parameters to be set when the
     *        action is invoked.
     * @param signature An array containing the signature of the action.
     *
     * @return  The object returned by the action, which represents
     *          the result of invoking the action on the MBean specified.
     *
     * @exception MBeanException  Wraps a &lt;CODE&gt;java.lang.Exception&lt;/CODE&gt;
     *         thrown by the MBean's invoked method.
     * @exception ReflectionException  Wraps a
     *      &lt;CODE&gt;java.lang.Exception&lt;/CODE&gt; thrown while trying to invoke
     *      the method.
     */
    public Object invoke(String actionName, Object params[],
                         String signature[])
        throws MBeanException, ReflectionException {
        // Check that operation name is not null.
        //
        if (actionName == null) {
            final RuntimeException r =
              new IllegalArgumentException(&quot;Operation name  cannot be null&quot;);
            throw new RuntimeOperationsException(r,
            &quot;Exception occurred trying to invoke the operation on the MBean&quot;);
        }

        throw new ReflectionException(
                          new NoSuchMethodException(actionName),
                          &quot;The operation with name &quot; + actionName +
                          &quot; could not be found&quot;);
    }

    /**
     * Provides the MBeanInfo describing the MBeanServerDelegate.
     *
     * @return  The MBeanInfo describing the MBeanServerDelegate.
     *
     */
    public MBeanInfo getMBeanInfo() {
        return delegateInfo;
    }

}
</pre>
</body>
</html>
