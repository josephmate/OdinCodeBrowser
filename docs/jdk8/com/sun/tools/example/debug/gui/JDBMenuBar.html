<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/css/styles.css"/>
    </head>
<body>
<pre class="code">
/*
 * Copyright (c) 1998, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

/*
 * This source code is provided to illustrate the usage of a given feature
 * or technique and has been deliberately simplified. Additional steps
 * required for a production-quality application, such as security checks,
 * input validation and proper error handling, might not be present in
 * this sample code.
 */


package com.sun.tools.example.debug.gui;

import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.util.Vector;
import java.util.List;

import com.sun.tools.example.debug.bdi.*;

//### This is currently just a placeholder!

class JDBMenuBar extends JMenuBar {

    Environment env;

    ExecutionManager runtime;
    ClassManager classManager;
    SourceManager sourceManager;

    CommandInterpreter interpreter;

    JDBMenuBar(Environment env) {
        this.env = env;
        this.runtime = env.getExecutionManager();
        this.classManager = env.getClassManager();
        this.sourceManager = env.getSourceManager();
        this.interpreter = new CommandInterpreter(env, true);

        JMenu fileMenu = new JMenu(&quot;File&quot;);

        JMenuItem openItem = new JMenuItem(&quot;Open...&quot;, 'O');
        openItem.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                openCommand();
            }
        });
        fileMenu.add(openItem);
        addTool(fileMenu, &quot;Exit debugger&quot;, &quot;Exit&quot;, &quot;exit&quot;);

        JMenu cmdMenu = new JMenu(&quot;Commands&quot;);

        addTool(cmdMenu, &quot;Step into next line&quot;, &quot;Step&quot;, &quot;step&quot;);
        addTool(cmdMenu, &quot;Step over next line&quot;, &quot;Next&quot;, &quot;next&quot;);
        cmdMenu.addSeparator();

        addTool(cmdMenu, &quot;Step into next instruction&quot;,
                &quot;Step Instruction&quot;, &quot;stepi&quot;);
        addTool(cmdMenu, &quot;Step over next instruction&quot;,
                &quot;Next Instruction&quot;, &quot;nexti&quot;);
        cmdMenu.addSeparator();

        addTool(cmdMenu, &quot;Step out of current method call&quot;,
                &quot;Step Up&quot;, &quot;step up&quot;);
        cmdMenu.addSeparator();

        addTool(cmdMenu, &quot;Suspend execution&quot;, &quot;Interrupt&quot;, &quot;interrupt&quot;);
        addTool(cmdMenu, &quot;Continue execution&quot;, &quot;Continue&quot;, &quot;cont&quot;);
        cmdMenu.addSeparator();

        addTool(cmdMenu, &quot;Display current stack&quot;, &quot;Where&quot;, &quot;where&quot;);
        cmdMenu.addSeparator();

        addTool(cmdMenu, &quot;Move up one stack frame&quot;, &quot;Up&quot;, &quot;up&quot;);
        addTool(cmdMenu, &quot;Move down one stack frame&quot;, &quot;Down&quot;, &quot;down&quot;);
        cmdMenu.addSeparator();

        JMenuItem monitorItem = new JMenuItem(&quot;Monitor Expression...&quot;, 'M');
        monitorItem.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                monitorCommand();
            }
        });
        cmdMenu.add(monitorItem);

        JMenuItem unmonitorItem = new JMenuItem(&quot;Unmonitor Expression...&quot;);
        unmonitorItem.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                unmonitorCommand();
            }
        });
        cmdMenu.add(unmonitorItem);

        JMenu breakpointMenu = new JMenu(&quot;Breakpoint&quot;);
        JMenuItem stopItem = new JMenuItem(&quot;Stop in...&quot;, 'S');
        stopItem.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                buildBreakpoint();
            }
        });
        breakpointMenu.add(stopItem);

        JMenu helpMenu = new JMenu(&quot;Help&quot;);
        addTool(helpMenu, &quot;Display command list&quot;, &quot;Help&quot;, &quot;help&quot;);

        this.add(fileMenu);
        this.add(cmdMenu);
//      this.add(breakpointMenu);
        this.add(helpMenu);
    }

    private void buildBreakpoint() {
        Frame frame = JOptionPane.getRootFrame();
        JDialog dialog = new JDialog(frame, &quot;Specify Breakpoint&quot;);
        Container contents = dialog.getContentPane();
        Vector&lt;String&gt; classes = new Vector&lt;String&gt;();
        classes.add(&quot;Foo&quot;);
        classes.add(&quot;Bar&quot;);
        JList list = new JList(classes);
        JScrollPane scrollPane = new JScrollPane(list);
        contents.add(scrollPane);
        dialog.show();

    }

    private void monitorCommand() {
        String expr = (String)JOptionPane.showInputDialog(null,
                           &quot;Expression to monitor:&quot;, &quot;Add Monitor&quot;,
                           JOptionPane.QUESTION_MESSAGE, null, null, null);
        if (expr != null) {
            interpreter.executeCommand(&quot;monitor &quot; + expr);
        }
    }

    private void unmonitorCommand() {
        List monitors = env.getMonitorListModel().monitors();
        String expr = (String)JOptionPane.showInputDialog(null,
                           &quot;Expression to unmonitor:&quot;, &quot;Remove Monitor&quot;,
                           JOptionPane.QUESTION_MESSAGE, null,
                           monitors.toArray(),
                           monitors.get(monitors.size()-1));
        if (expr != null) {
            interpreter.executeCommand(&quot;unmonitor &quot; + expr);
        }
    }

    private void openCommand() {
        JFileChooser chooser = new JFileChooser();
        JDBFileFilter filter = new JDBFileFilter(&quot;java&quot;, &quot;Java source code&quot;);
        chooser.setFileFilter(filter);
        int result = chooser.showOpenDialog(this);
        if (result == JFileChooser.APPROVE_OPTION) {
            System.out.println(&quot;Chose file: &quot; + chooser.getSelectedFile().getName());
        }
    }

    private void addTool(JMenu menu, String toolTip, String labelText,
                         String command) {
        JMenuItem mi = new JMenuItem(labelText);
        mi.setToolTipText(toolTip);
        final String cmd = command;
        mi.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                interpreter.executeCommand(cmd);
            }
        });
        menu.add(mi);
    }

}
</pre>
</body>
</html>
